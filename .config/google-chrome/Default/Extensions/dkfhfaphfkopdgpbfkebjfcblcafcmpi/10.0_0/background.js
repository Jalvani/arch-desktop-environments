function _58b4f7f452cd95b4715b3436b25a14ac778530e643da15f8d36adbbe4f26914646b1608a908abdb3Orig(){oauth.authorize(function(){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("on google contacts - oauth.authorize()");oauth.sendSignedRequest("http://www.google.com/m8/feeds/contacts/default/full",_9147730f35cfc233d492d95d9250c6cf6063f1b2edf1725a91ac9500da2fdbe754a48386b9da9795,{parameters:{alt:"json","max-results":1E4}})})}
function _db2a2ef7cdddde643141d4c25421ac212fc08398107f0617e7d68f07682c0efde004de2d3ff69cbd(){console.log("NON-WEBAPP-HEARTBEAT-CHECK");console.log("Current polling frequency is: "+poll_freq);checkLastMightyNetworkPing()}console.log("----------------- Starting Background Script ** -----------");var globalHeartbeatInterval=setInterval(_db2a2ef7cdddde643141d4c25421ac212fc08398107f0617e7d68f07682c0efde004de2d3ff69cbd,1E4);_gaq.push(["_trackEvent","Background","Startup-BG-Script","",1]);
var token,time_last_channel_token_obtained=0,time_last_success_mighty_ping=new Date,globalContactsSyncMethod="SYNC_PHONE",username_prefix_jstrg_purpose,calling_from_chrome_extension=!0,capi_rollout_factor=3.8;console.log("capi rollout factor is "+capi_rollout_factor);
var GOOGLE_CONTACTS_OAUTH_STATUS="UNKNOWN",oauth=ChromeExOAuth.initBackgroundPage({request_url:"https://www.google.com/accounts/OAuthGetRequestToken",authorize_url:"https://www.google.com/accounts/OAuthAuthorizeToken",access_url:"https://www.google.com/accounts/OAuthGetAccessToken",consumer_key:"anonymous",consumer_secret:"anonymous",scope:"http://www.google.com/m8/feeds/",app_name:"MightyText - Contacts Sync"}),contacts_bkg_page=null,contacts_autocomplete_per_unique_phone_num=null,num_consecutive_internet_connection_failures=
0,notify_android_app_install_once=!1,debug_mode=1;_5cd11b7c1058b8371c2fed19b73ba9d6e5b8b260043f01c37bd01eb1f6d3981fe75e0719ff2cb5ee(!1);var google_login_status=!1,google_username_currently_logged_in="",login_and_beta_ready=!1,extra_login_status_info="";_02f52579b570f9d41c32ea3677e9d99e7cfa3ef028aa82fda6c321f7cc2681899c3189aa03bbe28f();var GOOGLE_CONTACTS_OAUTH_STATUS="UNKNOWN",should_get_contacts_token_in_new_tab=!0;
_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Google Contacts Token Status: "+GOOGLE_CONTACTS_OAUTH_STATUS);function _02f52579b570f9d41c32ea3677e9d99e7cfa3ef028aa82fda6c321f7cc2681899c3189aa03bbe28f(){window.setTimeout(function(){_569bae7793b4c97713590ef79a3b3c59f394ed9093402f4506f48db6a0b4bda0b5237720cf9b2d8b(1,!0)},300)}
function _9147730f35cfc233d492d95d9250c6cf6063f1b2edf1725a91ac9500da2fdbe754a48386b9da9795(b,a){contacts_bkg_page=[];contacts_autocomplete_per_unique_phone_num=[];for(var c=JSON.parse(b),k=0,d;d=c.feed.entry[k];k++){var e={name:d.title.$t,id:d.id.$t,emails:[],phonenums:[]},l={label:d.title.$t,value:""};if(d.gd$email)for(var h=d.gd$email,g=0,f;f=h[g];g++)e.emails.push(f.address);e.name||(e.name=e.emails[0]||"<Unknown>");if(d.gd$phoneNumber)for(h=d.gd$phoneNumber,g=0;g<h.length;g++)f=h[g],e.phonenums.push(f.$t),
l.label=e.name+" "+f.$t,l.value=f.$t,contacts_autocomplete_per_unique_phone_num.push({label:e.name+" "+f.$t,value:f.$t});d.gd$phoneNumber&&contacts_bkg_page.push(e)}}function _8701acf2f01edb8a56920734729a0057d39347a1e72577c97f39dc177a818090806c4eb78d185ab8GoogleOpenID(){oauth.clearTokens();_5cd11b7c1058b8371c2fed19b73ba9d6e5b8b260043f01c37bd01eb1f6d3981fe75e0719ff2cb5ee(!1)}var msgcount="",simplevalidation="",db,msgcount2="",msgList="",PendingSMSArray=[];
chrome.extension.onRequest.addListener(function(b,a,c){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63(a.tab?"from a content script:"+a.tab.url:"from the extension");"user_invoked_popup_so_force_google_login_check"==b.purpose&&(console.log("* User Clicked Popup icon in extension**  Now check if a user is logged in already"),console.log(extra_login_status_info),"WEBAPP_BETA"==extra_login_status_info?console.log("YES - user is a web app user. Don't do anything extra (dont call checkGoogleLoginTokenAndSetUsername)"):
(console.log("user does not have extra_login info set - so likely not signed in before, so check if they are now"),_569bae7793b4c97713590ef79a3b3c59f394ed9093402f4506f48db6a0b4bda0b5237720cf9b2d8b()),c({reply:"success"}))});
chrome.extension.onRequest.addListener(function(b,a,c){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63(a.tab?"from a content script:"+a.tab.url:"from the extension");"call_from_popup_to_check_contact_info"==b.greeting&&(should_get_contacts_token_in_new_tab=!1,_58b4f7f452cd95b4715b3436b25a14ac778530e643da15f8d36adbbe4f26914646b1608a908abdb3(),c({farewell:contacts_bkg_page,autocomplete_contacts_list:contacts_autocomplete_per_unique_phone_num,google_contacts_token_status:GOOGLE_CONTACTS_OAUTH_STATUS}))});
chrome.extension.onRequest.addListener(function(b,a,c){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63(a.tab?"from a content script:"+a.tab.url:"from the extension");"get_new_g_contacts_token_call_from_popup"==b.purpose&&(should_get_contacts_token_in_new_tab=!0,_58b4f7f452cd95b4715b3436b25a14ac778530e643da15f8d36adbbe4f26914646b1608a908abdb3Orig(),c({myreply:"yo yo"}))});
chrome.extension.onRequest.addListener(function(b,a,c){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63(a.tab?"from a content script:"+a.tab.url:"from the extension");"popup_checking_current_google_login_state"==b.purpose&&c({google_login_status_from_bg_page:google_login_status,login_and_beta_ready_from_bg_page:login_and_beta_ready,google_username_currently_logged_in_from_bg_page:google_username_currently_logged_in,extra_login_status_info_from_bg_page:extra_login_status_info})});
chrome.extension.onRequest.addListener(function(b,a,c){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63(a.tab?"from a content script:"+a.tab.url:"from the extension");"set_quick_polling_outbound_message"==b.purpose&&(_09e06f205a26ef868a902d5f711262e44a88873c3225d0f751d6fd3c7f740c83e9c987f665b14498("Outbound Message being sent, lower polling to check for ACK faster",2E3),c({myreply:"sent request to set polling to 2000"}))});
function _5fd483d6445d4bdcf561f67a7d33dee23db6a332eac129b4b348f33680c19b039af1ebbc1f6fa55e(b,a){}function _8af878fd87488424a042920a31a5898a9916ac08446b477f62bd7bd5992daf1ac4f8dc62d1ea8d57(b,a){log.innerHTML+="<p>"+a.message+"</p>"}function OLD__0c3f66b31b1026c0a60a4ba779ddf45496164c135fb498bd6afb7d505b94880ae3065c83ff256bc7(b,a){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Error during SQL insert: "+a.msg)}
var default_poll_freq=17E3,highest_poll_freq=7E4,poll_freq=default_poll_freq,consecutive_polls_without_message_activity=0,total_aggregate_polls=0,poll_state="START";db=openDatabase("Texty","1.0","Texty-SMS",2E5);localStorage.isInitialized||(localStorage.isActivated=!0,localStorage.frequency=1,localStorage.isInitialized=!0);_5a41d03096f397d6cb74f57caff39fa37590b2eb98c0b1a80c3c61f220f999324d62cc3f6ae81988();
if(webkitNotifications){var interval=0,currentGlobalIntervalID=setInterval(_77535ddaf82ba778d72706e99fa270b144251a8a132fda1bdecd783b79ba8f381b55250edc8dc52e,poll_freq);_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("STARTUP --  ** Setting polling to: "+poll_freq)}else chrome.tabs.create({url:"error.html"});
function _77535ddaf82ba778d72706e99fa270b144251a8a132fda1bdecd783b79ba8f381b55250edc8dc52e(){interval++;JSON.parse(localStorage.isActivated)&&localStorage.frequency<=interval&&(consecutive_polls_without_message_activity++,total_aggregate_polls++,_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("------------------------------------------------"),_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("At START of POLL at "+Date()),_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Poll State is: "+
poll_state),_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Current polling frequency is: "+poll_freq),_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("# of consecutive polls without activity is: "+consecutive_polls_without_message_activity),_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("TOTAL AGGREGATE POLLS: "+total_aggregate_polls),_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Google Login Status is: "+
google_login_status),4<consecutive_polls_without_message_activity&&"OK-NORMAL"==poll_state&&_09e06f205a26ef868a902d5f711262e44a88873c3225d0f751d6fd3c7f740c83e9c987f665b14498("*No new incoming message Activity in a while...increase polling freq...",Math.min(highest_poll_freq,1.05*poll_freq)),!0==google_login_status&&!0==network_connection_status&&!0==login_and_beta_ready?(_b7937446c23d6da3f83cb967d9b58f3896938e507abe7cae80a687dfa02ad26bdd97b8bc6c5be9c0(),"OK-NORMAL"!=poll_state&&(poll_state="OK-NORMAL",
console.log("stopping this Interval and restarting to default - g user logged in ...setting poll frequency to DEFAULT"),poll_freq=default_poll_freq*capi_rollout_factor,interval=0,clearInterval(currentGlobalIntervalID),window.setInterval(function(){_77535ddaf82ba778d72706e99fa270b144251a8a132fda1bdecd783b79ba8f381b55250edc8dc52e()},poll_freq))):(console.log("user not logged in -- reason is "+google_username_currently_logged_in),_569bae7793b4c97713590ef79a3b3c59f394ed9093402f4506f48db6a0b4bda0b5237720cf9b2d8b(),
_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Network Connection Status: "+network_connection_status),!1==network_connection_status?(poll_state="WAITING-FOR-NETWORK",_09e06f205a26ef868a902d5f711262e44a88873c3225d0f751d6fd3c7f740c83e9c987f665b14498("Waiting for Network",2E4)):"WAITING-FOR-USER-PROPER-AUTH"!=poll_state&&(poll_state="WAITING-FOR-USER-PROPER-AUTH",_09e06f205a26ef868a902d5f711262e44a88873c3225d0f751d6fd3c7f740c83e9c987f665b14498("Waiting for proper User Auth",
4E4))))}
function _09e06f205a26ef868a902d5f711262e44a88873c3225d0f751d6fd3c7f740c83e9c987f665b14498(b,a){console.log(b+"...Stopping this Interval and resetting Polling...setting poll frequency to "+a);poll_freq=a;poll_freq*=capi_rollout_factor;console.log("ACTUALLY setting to "+poll_freq+"...based on CAPI rollout factor of "+capi_rollout_factor);clearInterval(currentGlobalIntervalID);consecutive_polls_without_message_activity=0;currentGlobalIntervalID=window.setInterval(function(){_77535ddaf82ba778d72706e99fa270b144251a8a132fda1bdecd783b79ba8f381b55250edc8dc52e()},poll_freq)}
function _b7937446c23d6da3f83cb967d9b58f3896938e507abe7cae80a687dfa02ad26bdd97b8bc6c5be9c0(){_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Checking MightyText at "+Date());_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("google_login_status is: "+google_login_status);_28abba1cc59b60afdea7073bc8ff85568012c3e0e5b9a6c4eb5d7ec5110d7f42df39e9fbebdd450c(!0);_e7d09e596c8200cfd9134b2bb006470214fdb6b5912ce064da64fd34c572e7424d59e44b6278b79f()}
function checkLastMightyNetworkPing(){var b=((new Date).getTime()-time_last_success_mighty_ping.getTime())/1E3;_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("--------------\x3e Seconds Since LAST MightyText network ping: "+b);360<b&&(console.error("---\x3e has been a long time since last MT ping -- try to contact google.com first"),$.ajax({type:"GET",url:"https://accounts.google.com/latitude/mobile_phone-16.gif",cache:!1,success:function(a){console.log("Network ping to Google -- fine...");
_gaq.push(["_trackEvent","CRX-Background","Error","Forced-Reload-CRX",1]);console.log("google login status is true -- will reload CRX BG in 10 seconds");window.setTimeout(function(){window.location.reload()},1E4)}}))}
function _e7d09e596c8200cfd9134b2bb006470214fdb6b5912ce064da64fd34c572e7424d59e44b6278b79f(){if(0==time_last_channel_token_obtained)console.log("no channel opened yet in this session, go open one"),_42f6182dfd83478a27c0eb784bd6be87a4b10ae744330492a5903482e756a673862ee3adca47f77e();else{var b=((new Date).getTime()-time_last_channel_token_obtained.getTime())/1E3;_b58ec35652e6191d3e2e32f540192ee3c92a528c200d6bb341711532c638b475e536b0205ce17f63("Seconds Since LAST CHANNEL TOKEN OBTAINED: "+b);13500<b?
(console.log("has been > 3.75 hours, get a new channel token"),_42f6182dfd83478a27c0eb784bd6be87a4b10ae744330492a5903482e756a673862ee3adca47f77e()):console.log("has NOT been > 3.75 hours since last CAPI channel token was retrieved, no need to get a new one.")}}function _abcaa559d8efc88aee85bbf489134bd3053d9b0bf145850b9dfdbca9d497da0b5364ff4674c37b69(b,a){return Math.round(b*Math.pow(10,a))/Math.pow(10,a)};
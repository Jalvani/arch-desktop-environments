(function(){function g(){return document.location.search&&"?firstlaunch"===document.location.search.toLowerCase()}function l(a,b,d){}function m(a,c,d){document.querySelector("#evernoteGlobalTools").style.zIndex="0";b=document.createElement("IFRAME");b.id="evernoteFlePage";b.src=Browser.extension.getURL("content/fle/fle.html");b.seamless=!0;document.documentElement.appendChild(b)}function n(a,c,d){b.contentWindow.postMessage({name:"taskFinished",type:a.type},Browser.extension.getURL(""))}function p(a,
c,d){b.contentWindow.postMessage({name:"taskFinished",type:"screenshot"},Browser.extension.getURL(""))}function q(){function a(){f.removeEventListener("click",onclick);h||(document.querySelector("#evernoteGlobalTools").className="canFit evernoteClipperVisible",f.style.visibility="visible",b.style.display="block",b.contentWindow.postMessage({name:"taskFinished",type:"markup"},Browser.extension.getURL("")),h=!0)}function c(){this.removeEventListener("click",arguments.callee);var a=document.querySelector("#webclipper-fle-markup");
a.addEventListener("webkitTransitionEnd",d);a.style.opacity="0"}function d(){this.removeEventListener("webkitTransitionEnd",arguments.callee);this.style.display="none";a()}var h=!1;if(b&&g()){var f=document.querySelector(".skitch-surface");if(f){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState){var a=document.createElement("DIV");a.id="webclipper-fle-markup";a.innerHTML=e.responseText;GlobalUtils.localize(a);document.documentElement.appendChild(a);a.style.opacity="1";a.querySelector(".next-button").addEventListener("click",
c)}};e.open("GET",Browser.extension.getURL("content/fle/flemarkup.html"),!0);e.send(null);b.style.display="none"}else a()}}var b;g()&&(window.addEventListener("unload",function(){Browser.sendToExtension({name:"finishTour"})}),Browser.addMessageHandlers({config:l,startTour:m,taskFinished:n,receiveScreenshot:p}),window.addEventListener("message",function(a){if("eventDetected"==a.data.name)b.contentWindow.postMessage(a.data,Browser.extension.getURL(""));else if("fleMarkUp"==a.data.name)q();else if("redirect"==
a.data.name)Browser.sendToExtension({name:"finishTour"}),document.location.replace(document.location.protocol+"//"+document.location.host+document.location.pathname+"?firstlaunchreturn");else if("getLocation"==a.data.name){a={name:"getLocationReply",location:{}};for(k in location){var c=location[k];"string"==typeof c&&(a.location[k]=c)}b.contentWindow.postMessage(a,Browser.extension.getURL(""))}}),Browser.sendToExtension({name:"tourLoaded"}))})();

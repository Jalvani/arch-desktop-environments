function Coordinator(){function P(a){20<=window.innerWidth-a?(a=window.innerWidth-20,h.className=h.className.replace(/\s*evernoteClipperVisible/g,""),b.contentWindow.postMessage({name:"hideFilingDialogHacks",height:h.offsetHeight-12},Browser.extension.getURL("")),Q(),p.className=p.className.replace(/\s*evernoteClipperVisible/g,""),b.contentWindow.postMessage({name:"hideUserToolsHacks"},Browser.extension.getURL(""))):a=window.innerWidth;f.setSize(a,window.innerHeight);f.center()}function I(){f&&(f.getElement().parentNode.removeChild(f.getElement()),
f.destroy(),document.body.style.overflow="",c&&(c.contentDocument.body.style.overflow=""));f=null;y={};document.body.className=document.body.className.replace(/\s*skitchon/g,"")}function la(){/skitchon/.test(document.body.className)&&J?(w(),b.contentWindow.postMessage({name:"postCrop",fromKeyboard:!0},Browser.extension.getURL("")),J=!1):/evernoteClipperVisible/.test(h.className)?R():/evernoteClipperVisible/.test(b.className)&&S()}function Z(a){/evernoteClipperVisible/.test(b.className)&&!/skitchon/.test(document.body.className)&&
R({data:{focus:a}})}function K(a){/evernoteClipperVisible/.test(b.className)&&!/skitchon/.test(document.body.className)&&("expand"==a?contentPreview.expandPreview():"contract"==a?contentPreview.contractPreview():"up"==a?contentPreview.moveToElementAbove():"down"==a&&contentPreview.moveToElementBelow())}function ma(a){if(T)d[a]()}function z(){Q();h.className=h.className.replace(/\s*evernoteClipperVisible/g,"");r.className=r.className.replace(/\s*evernoteClipperVisible/g,"");p.className=p.className.replace(/\s*evernoteClipperVisible/g,
"");b.contentWindow.postMessage({name:"hideFilingDialogHacks"},Browser.extension.getURL(""));b.contentWindow.postMessage({name:"hideUserToolsHacks"},Browser.extension.getURL(""));window.focus()}function A(a){if(c){var q=c.scrollWidth;window.ClearlyComponent__reformat.$iframeBox[0].style.display="none";c.contentDocument.querySelector("#loading").style.display="none";c.contentDocument.documentElement.className=c.contentDocument.documentElement.className.replace(/\s*clearlyVisible/g,"");document.body.className=
document.body.className.replace(/\s*clearlyVisible/g,"");document.documentElement.className=document.documentElement.className.replace(/\s*clearlyVisible/g,"");document.body.scrollLeft=aa;document.body.scrollTop=ba;window.ClearlyComponent__reformat.$iframeBackground.animate({right:q+"px"},500,"clearlyEasingForBackground",function(){document.body.className=document.body.className.replace(/\s*clearlyBeforeVisible/g,"");document.documentElement.className=document.documentElement.className.replace(/\s*clearlyBeforeVisible/g,
"");c.style.top="-100%";c.style.left="-100%";c.style.height=document.body.clientHeight+"px";a&&("previewArticle"==a?contentPreview.previewArticle():"previewFullPage"==a?contentPreview.previewFullPage():"previewUrl"==a?contentPreview.previewUrl():"previewEmail"==a?contentPreview.previewEmail():"previewSelection"==a&&contentPreview.previewSelection())})}else a&&("previewArticle"==a?contentPreview.previewArticle():"previewFullPage"==a?contentPreview.previewFullPage():"previewUrl"==a?contentPreview.previewUrl():
"previewEmail"==a?contentPreview.previewEmail():"previewSelection"==a&&contentPreview.previewSelection())}function B(a,q){a&&a.for&&"screenshot"==a.for&&(L=!0,U=a.tool,ca=a.showSubtools,/evernoteClipperVisible/.test(h.className)||(F=!0));b.contentWindow.postMessage({name:"hideExtras"},Browser.extension.getURL(""));b.className=b.className.replace(/\s*evernoteClipperVisible/g,"");!q&&g&&(g.className=g.className.replace(/\s*evernoteClipperVisible/g,""));z()}function Q(){k.className=k.className.replace(/\s*evernoteClipperVisible/g,
"");b.contentWindow.postMessage({name:"hideShareDialogHacks",height:k.offsetHeight-12},Browser.extension.getURL(""))}function da(){f&&f.disableEvents();document.body.className=document.body.className.replace(/\s*skitchon/g,"");b.className=b.className.replace(/\s*(tempHidden|hidable)/g,"");document.body.style.overflow="";c&&(c.contentDocument.body.style.overflow="")}function S(a,q,l){V=!(!a||!a.dontStartPreview);/evernoteClipperVisible/.test(b.className)?(B(),Browser.sendToExtension({name:"showLoggedInState"}),
contentPreview.clear(),contentPreview.reset(),t=u=null,b.contentWindow.postMessage({name:"stopSkitch"},Browser.extension.getURL("")),I(),C=0,c&&(D||(D=!0,a=c.getAttribute("maxScrollY")||"0",Browser.sendToExtension({name:"trackEvent",userId:m,category:"Clearly",action:"scroll",label:n,value:100*parseInt(a)/(c.contentWindow.document.body.scrollHeight-c.contentWindow.innerHeight)})),E||(E=!0,Browser.sendToExtension({name:"trackEvent",userId:m,category:"Clearly",action:"saved",label:n}))),A()):(clipResultCoordinator.hideClipResult(!1),
w(a),Browser.sendToExtension({name:"showOpenState"}))}function na(){/evernoteClipperVisible/.test(b.className)&&b.contentWindow.postMessage({name:"save"},Browser.extension.getURL(""))}function ea(a){h.style.height=a+"px";b.contentWindow.postMessage({name:"getFilingTop"},Browser.extension.getURL(""))}function fa(){window.ClearlyComponent__reformat.applyOptions(window.ClearlyComponent__reformat.availableThemes.newsprint);window.ClearlyComponent__reformat.loadGoogleFontsRequiredByAppliedOptions();var a=
c.scrollWidth;document.body.className+=" clearlyBeforeVisible";document.documentElement.className+=" clearlyBeforeVisible";window.ClearlyComponent__reformat.$iframeBox[0].style.display="none";window.ClearlyComponent__reformat.$iframeBackground[0].style.right=a+"px";aa=document.body.scrollLeft;ba=document.body.scrollTop;c.style.top="0px";c.style.left="0px";c.style.height=document.body.scrollHeight+"px";window.ClearlyComponent__reformat.$iframeBackground.animate({right:"0px"},500,"clearlyEasingForBackground",
function(){c.contentDocument.querySelector("#loading").style.display="block";document.body.className+=" clearlyVisible";document.documentElement.className+=" clearlyVisible";c.contentDocument.documentElement.className+=" clearlyVisible";V||(b.contentWindow.postMessage({name:"makeHidable"},Browser.extension.getURL("")),b.contentWindow.postMessage({name:"tempHide"},Browser.extension.getURL("")));window.focus();0==window.ClearlyComponent__reformat.pagesCount?pageInfo.getCleanArticle(function(a){if(a&&
0<a.length){window.ClearlyComponent__reformat.addNewPage(a[0],window.location.href);W();for(var b=1;b<a.length;b++)window.ClearlyComponent__reformat.addNewPage(a[b],window.location.href);a=Math.max(document.body.scrollHeight,c.contentDocument.body.scrollHeight);c.style.height=a+"px"}else pageInfo.getDefaultArticle(function(a){a&&(window.ClearlyComponent__reformat.addNewPage(a.outerHTML,window.location.href),W())})},function(a,b){window.ClearlyComponent__reformat.addNewPage(a,b);var e=Math.max(document.body.scrollHeight,
c.contentDocument.body.scrollHeight);c.style.height=e+"px"}):W()})}function W(){window.ClearlyComponent__reformat.$iframeBox[0].style.display="block";c.contentDocument.querySelector("#loading").style.display="none";window.scrollTo(0,0);var a=Math.max(document.body.scrollHeight,c.contentDocument.body.scrollHeight);c.style.height=a+"px";Browser.sendToExtension({name:"bounce",message:{name:"taskFinished",type:"clearly"}})}function w(a){a&&(Browser.sendToExtension({name:"main_recordActivity"}),h.contentWindow.postMessage({name:"reset"},
Browser.extension.getURL("")),p.contentWindow.postMessage({name:"reset"},Browser.extension.getURL("")),b.contentWindow.postMessage({name:"reset"},Browser.extension.getURL("")),ga=a.username,m=a.userId,G=a.authTokens,M=a.premium,T=a.keyboardShortcutsEnabled,n="free",G.biz?n="business":M&&(n="premium"),h.contentWindow.postMessage({name:"initialize",alwaysTags:a.alwaysTags,gmailThread:pageInfo.isGmailThread(),keyboardShortcutsEnabled:T,title:document.title.trim(),url:pageInfo.getCanonicalUrl()||document.location.href,
userId:m,userType:n},Browser.extension.getURL("")),X||(X=!0,h.contentWindow.postMessage({name:"setKeyboardHandlers",handlers:x},Browser.extension.getURL(""))),Browser.sendToExtension({name:"getSmartFilingInfo",authTokens:G,query:pageInfo.getSearchQuery(),recText:pageInfo.getRecommendationText(!1),userId:m}),Browser.sendToExtension({name:"getNotebooks",authTokens:G,userId:m,username:ga}),Browser.sendToExtension({name:"getTags",authTokens:G,userId:m}),b.contentWindow.postMessage({name:"setUsername",
fullName:a.fullName},Browser.extension.getURL("")),b.contentWindow.postMessage({name:"setPossibleClipTypes",pageInfo:{pdf:pageInfo.getPdfUrl(),documentIsFrameset:pageInfo.documentIsFrameset,selection:pageInfo.getSelection()?!0:!1,gmail:pageInfo.isGmail(),gmailThread:pageInfo.isGmailThread()}},Browser.extension.getURL("")),b.className+=" needToLoadRest",p.contentWindow.postMessage({name:"setup",auth:a.authTokens.pers,baseUrl:a.baseUrl,currentUser:a.fullName,premium:M},Browser.extension.getURL("")),
p.style.height=151+46*(M?0:1)+"px");b.className=b.className.replace(/\s*tempHidden/g,"");b.className+=" evernoteClipperVisible";L=!1}function oa(){window.ClearlyComponent__reformat={callbacks:{frameCreated:function(){c=window.ClearlyComponent__reformat.iframe;c.contentWindow.addEventListener("scroll",function(){var a=c.contentWindow.scrollY;a>Y&&(Y=a,c.contentWindow.frameElement.setAttribute("maxScrollY",Y))});var a=c.contentDocument.createElement("div"),b=c.contentDocument.createElement("div");a.setAttribute("id",
"loading");b.setAttribute("id","loading_spinner");a.appendChild(b);c.contentDocument.body.appendChild(a);a=c.contentDocument.createElement("style");a.setAttribute("id","loading_sign_css");a.setAttribute("type","text/css");b="#loading { position: fixed; top: 0; right: 0; width: 100%; height: 100%; z-index: 300; ";b=1.5>window.devicePixelRatio?b+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--background.png")+"'); "):b+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--background@2x.png")+
"'); ");b+="background-position: center center; background-repeat: no-repeat; } #loading_spinner { position: absolute; top: 0; left: 0; width: 100%; height: 100%; ";b=1.5>window.devicePixelRatio?b+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--big.gif")+"'); "):b+("background-image: url('"+Browser.extension.getURL("clearly/images/loading--big@2x.gif")+"'); ");a.innerText=b+"background-position: center center; background-repeat: no-repeat; }";c.contentDocument.body.appendChild(a);
c.contentWindow.ClearlyComponent__highlight={callbacks:{},settings:{imgPath:Browser.extension.getURL("clearly/images/")},window:c.contentWindow,document:c.contentDocument,jQuery:window.jQuery};c.contentWindow.ClearlyComponent__highlight=initClearlyComponent__highlight(c.contentWindow.ClearlyComponent__highlight);c.contentWindow.ClearlyComponent__highlight.insertCSS();c.contentWindow.ClearlyComponent__highlight.addMouseHandlers();fa()}},settings:{cssPath:Browser.extension.getURL("clearly/css/"),pageLabel:Browser.i18n.getMessage("page")+
" ",onCreateFrameUseThisId:"evernoteClearlyArticle",onCreateFrameDoNotInsertCSS:!0},window:window,document:document,jQuery:window.jQuery};window.ClearlyComponent__reformat=initClearlyComponent__reformat(window.ClearlyComponent__reformat);$.easing.clearlyEasingForBackground=function(a,b,c,e,d){a=(b/=d)*b;d=a*b;return c+e*(-2.5*d*a+10*a*a-14*d+7*a+0.5*b)};window.ClearlyComponent__reformat.createFrame()}function ha(a){function q(b,c){var l={name:"receiveNoteContent",clipType:a.data.type,html:b,pendingNoteKey:H,
recommendationText:pageInfo.getRecommendationText(!1),share:a.data.share,hasTextHighlights:0<C,userId:m,userType:n,width:c};u&&(l.updateGuid=u);t&&(l.previousToken=t);Browser.sendToExtension(l);a.data.share||(contentPreview.reset(),C=0,t=u=null)}function l(){h.contentWindow.postMessage({name:"sendFilingInfo",pendingNoteKey:H,useDefaultNotebook:a.data.contextMenu},Browser.extension.getURL(""));"screenshot"==a.data.type?(a.data.contextMenu||f.getFile(function(b){b={name:"receiveNoteContent",clipType:"skitch",
content:'<img src="resource:0"></img>',contentClass:"evernote.skitch",pendingNoteKey:H,recommendationText:pageInfo.getRecommendationText(!1),resources:[{bytes:b.bytes,mime:b.mime}],share:a.data.share,userId:m,userType:n};u&&(b.updateGuid=u);t&&(b.previousToken=t);Browser.sendToExtension(b);for(var c in y)Browser.sendToExtension({name:"trackEvent",userId:m,category:"Skitch Tool",action:c,label:n,value:y[c]})}),a.data.share||(contentPreview.reset(),C=0,t=u=null,I())):"clearly"==a.data.type?(clipper.clipClearly(window.ClearlyComponent__reformat.$iframePages[0],
c.contentWindow,function(a,b){q(a,b)}),a.data.share||A(),E=!0,Browser.sendToExtension({name:"trackEvent",userId:m,category:"Clearly",action:"saved",label:n})):("article"==a.data.type?clipper.clipArticle(!0,q):"fullPage"==a.data.type?clipper.clipFullPage(!0,q):"selection"==a.data.type?clipper.clipSelection(!0,a.data.selectionText,q):"url"==a.data.type?clipper.clipUrl(q):"pdf"==a.data.type?clipper.clipPdf(q):"email"==a.data.type?clipper.clipEmail(q):"image"==a.data.type&&clipper.clipImage(a.data.imageUrl,
q),a.data.share||(contentPreview.clear(),I()));a.data.contextMenu&&b.contentWindow.postMessage({name:"stopSkitch"},Browser.extension.getURL(""))}if(V)k.className+=" evernoteClipperVisible",h.contentWindow.postMessage({name:"getClipResultInfo"},Browser.extension.getURL(""));else{H=UUID.generateGuid();if(a.data.share)z(),k.className+=" evernoteClipperVisible",l();else if(B(),Browser.sendToExtension({name:"showLoggedInState"}),clipResultCoordinator.showClipResult(H,l),c&&!D){D=!0;var e=c.getAttribute("maxScrollY")||
"0";Browser.sendToExtension({name:"trackEvent",userId:m,category:"Clearly",action:"scroll",label:n,value:100*parseInt(e)/(c.contentWindow.document.body.scrollHeight-c.contentWindow.innerHeight)})}c&&"clearly"!=a.data.type&&(E=!0,Browser.sendToExtension({name:"trackEvent",userId:m,category:"Clearly",action:"didn't save",label:n}))}}function v(a,c){/evernoteClipperVisible/.test(b.className)&&!/skitchon/.test(document.body.className)&&(a?b.contentWindow.postMessage({name:"switchMode",mode:a},Browser.extension.getURL("")):
c&&b.contentWindow.postMessage({name:"switchMode",direction:c},Browser.extension.getURL("")))}function s(a,c,l,e){/skitchon/.test(document.body.className)&&b.contentWindow.postMessage({name:"switchSkitchTool",tool:a,subtool:c,location:l,charCode:e},Browser.extension.getURL(""))}function ia(a){if(/evernoteClipperVisible/.test(a.className))return a.className=a.className.replace(/\s*evernoteClipperVisible/g,""),!1;z();a.className+=" evernoteClipperVisible";return!0}function R(a){ia(h)?(h.focus(),h.contentWindow.postMessage({name:"setFocus",
focus:a.data.focus},Browser.extension.getURL("")),b.contentWindow.postMessage({name:"showFilingDialogHacks",height:h.offsetHeight-12,top:h.offsetTop+2},Browser.extension.getURL(""))):b.contentWindow.postMessage({name:"hideFilingDialogHacks"},Browser.extension.getURL(""))}function ja(){/clearlyVisible/.test(document.documentElement.className)?c.contentWindow.ClearlyComponent__highlight.disable():window.ClearlyComponent__highlight.disable()}function ka(a){f.enableEvents();document.body.className+=" skitchon";
document.body.style.overflow="hidden";window.scrollTo(0,0);f.useTool(a.data.tool);"crop"==a.data.tool?(J=!0,B(),b.contentWindow.postMessage({name:"unmakeHidable"},Browser.extension.getURL(""))):"text"==a.data.tool&&a.data.location&&f.startActiveTool(a.data.location,{value:String.fromCharCode(a.data.charCode),selectOnFocus:!1});ja()}var b,h,g,c,p,r,k,f,y={},J=!1,Y=0,aa=0,ba=0,ga,m,G,M,n,T=!0,d={},x={},H,C=0,N=0,L=!1,U,ca=!1,F=!1,O=!1,D=!1,E=!1,V=!1,X=!1,u=null,t=null;Browser.addMessageHandlers({doneSharing:function(a,
b,c){u=a.guid;t=a.token},hideCoordinator:B,hideScrollbar:function(a,b,l){document.body.style.overflow="hidden";c&&(c.contentDocument.body.style.overflow="hidden")},injectedScript:function(a,b,c){"clearly/js/reformat.js"==a.script&&oa()},logoutCallback:function(a,c,l){B();contentPreview.clear();b.contentWindow.postMessage({name:"stopSkitch"},Browser.extension.getURL(""));I();A()},receiveKeyboardShortcuts:function(a,b,c){b={};for(var e in a.keys){var f=[];-1<a.keys[e].indexOf("|")?(f=a.keys[e].split("|").map(function(a){return a.split(",")[0]}),
c=f.join(" + ")):(c=a.keys[e].split(",")[0],f.push(c));b[c]=ma;"closeWebClipperShortcut"==e?(d[c]=la,x[e]=[c]):"previewArticleShortcut"==e?d[c]=function(){v("article")}:"previewFullPageShortcut"==e?d[c]=function(){v("fullPage")}:"previewUrlShortcut"==e?d[c]=function(){v("url")}:"selectionModeShortcut"==e?d[c]=function(){v("selection")}:"takeScreenshotShortcut"==e?d[c]=function(){v("screenshot")}:"clearlyShortcut"==e?d[c]=function(){v("clearly")}:"pdfShortcut"==e?d[c]=function(){v("pdf")}:"emailShortcut"==
e?d[c]=function(){v("email")}:"expandArticleShortcut"==e?d[c]=function(){K("expand")}:"contractArticleShortcut"==e?d[c]=function(){K("contract")}:"moveArticleUpShortcut"==e?d[c]=function(){K("up")}:"moveArticleDownShortcut"==e?d[c]=function(){K("down")}:"selectNotebookShortcut"==e?d[c]=function(){Z("notebook")}:"addTagsShortcut"==e?d[c]=function(){Z("tags")}:"saveShortcut"==e?d[c]=na:"arrowShortcut"==e?d[c]=function(){s("shape","arrow")}:"textShortcut"==e?d[c]=function(){s("text")}:"rectangleShortcut"==
e?d[c]=function(){s("shape","rectangle")}:"roundedRectangleShortcut"==e?d[c]=function(){s("shape","roundedRectangle")}:"ellipseShortcut"==e?d[c]=function(){s("shape","ellipse")}:"lineShortcut"==e?d[c]=function(){s("shape","line")}:"markerShortcut"==e?d[c]=function(){s("marker")}:"highlighterShortcut"==e?d[c]=function(){s("highlighter")}:"stampShortcut"==e?d[c]=function(){s("stamp")}:"pixelateShortcut"==e?d[c]=function(){s("pixelate")}:"cropShortcut"==e&&(d[c]=function(){s("crop")});if(-1<f.indexOf("91")){var g=
JSON.parse(JSON.stringify(f));/windows/i.test(window.navigator.userAgent)?(g[f.indexOf("91")]="17",g.sort(function(a,b){return a-b}),d[g.join(" + ")]=d[c],delete d[c],b[g.join(" + ")]=b[c],delete b[c],x[e]&&(x[e][0]=g.join(" + "))):(g[f.indexOf("91")]="93",g.sort(function(a,b){return a-b}),d[g.join(" + ")]=d[c],b[g.join(" + ")]=b[c],x[e]&&x[e].push(g.join(" + ")))}}Browser.addKeyboardHandlers(b);4==N&&(X=!0,h.contentWindow.postMessage({name:"setKeyboardHandlers",handlers:x},Browser.extension.getURL("")))},
receiveScreenshot:function(a,c,d){f=Skitch.createSurface({width:window.innerWidth,allowZoom:!1,height:window.innerHeight,url:a.url,top:0,left:0,margin:0,success:function(){document.body.appendChild(f.getElement());f.getElement().addEventListener("mousedown",function(){b.contentWindow.postMessage({name:"closeSubtools"},Browser.extension.getURL(""));b.style.width=""});f.useTool(a.tool);f.enableEvents();document.body.className+=" skitchon";b.contentWindow.postMessage({name:"makeHidable"},Browser.extension.getURL(""));
window.scrollTo(0,0);contentPreview.clear();A();f.toast(Browser.i18n.getMessage("screenshotToast"));w()}});f.on("toolStarted",function(a){y[a]||(y[a]=0);y[a]++});f.on("toolStopped",function(a){"crop"==a&&(J=!1,w(),b.contentWindow.postMessage({name:"postCrop"},Browser.extension.getURL("")))});f.localize({CROP_APPLY_TEXT:Browser.i18n.getMessage("apply"),CROP_CANCEL_TEXT:Browser.i18n.getMessage("regForm_cancel"),ZOOM_RESET_TEXT:Browser.i18n.getMessage("reset"),ZOOM_TIP_TEXT:Browser.i18n.getMessage("panInstruction")})},
showCoordinator:w,startSubmission:function(a,b,c){ha({data:a})},toggleCoordinator:S,pauseSkitch:function(){/skitchon/.test(document.body.className)&&b.contentWindow.postMessage({name:"stopSkitch"},Browser.extension.getURL(""))}});window.addEventListener("message",function(a){if(RegExp(a.origin,"i").test(Browser.extension.getURL("")))if("userDropdownHeader"==a.data.name)handleUserDropdownHeaderEvents(a);else if("setFilingToolsHeight"==a.data.name)ea(a.data.height);else if("receiveFilingTop"==a.data.name)h.style.top=
Math.min(window.innerHeight-parseInt(h.style.height)-20,a.data.top)+"px",/evernoteClipperVisible/.test(h.className)&&b.contentWindow.postMessage({name:"showFilingDialogHacks",height:h.offsetHeight-12,top:h.offsetTop+2},Browser.extension.getURL(""));else if("startSubmission"==a.data.name)ha(a);else if("toggleCoordinator"==a.data.name)S(a.data);else if("showOptions"==a.data.name)g?(g.className+=" evernoteClipperVisible",g.contentWindow.postMessage({name:"showYourself"},Browser.extension.getURL(""))):
(g=document.createElement("iframe"),g.id="evernoteOptionsPage",document.documentElement.appendChild(g),g.src=Browser.extension.getURL("options.html#iframe"),g.className="evernoteClipperVisible"),B(null,!0),da(),A(),contentPreview.gray();else if("hideOptions"==a.data.name)g.className=g.className.replace(/\s*evernoteClipperVisible/g,""),w(),b.contentWindow.postMessage({name:"reactivateClipperTool"},Browser.extension.getURL(""));else if("useSkitchTool"==a.data.name)ka(a);else if("useSkitchColor"==a.data.name)f.updateSelectedElementsColor(a.data.color),
f.useColor(a.data.color);else if("setToolbarWidth"==a.data.name)b.style.width=a.data.width;else if("dispatchEvent"==a.data.name){var d=a.data.type,l=a.data.x,e=a.data.y;a=document.createEvent("MouseEvents");l=window.innerWidth-l;e=window.innerHeight-e;a.initMouseEvent(d,!0,!0,window,1,null,null,l,e,!1,!1,!1,!1,1,null);document.querySelector(".skitch-layer-tool").dispatchEvent(a)}else"hideSkitch"==a.data.name?da():"toggleFilingTools"==a.data.name?R(a):"uiReady"==a.data.name?(N++,4==N&&Browser.sendToExtension({name:"uiReady"})):
"showClearly"==a.data.name?c?fa():Browser.sendToExtension({name:"injectScript",script:"clearly/js/reformat.js"}):"hideClearly"==a.data.name?A(a.data.after):"toggleUserTools"==a.data.name?ia(p)?b.contentWindow.postMessage({name:"showUserToolsHacks",height:parseFloat(p.style.height)},Browser.extension.getURL("")):b.contentWindow.postMessage({name:"hideUserToolsHacks"},Browser.extension.getURL("")):"showCoordinator"==a.data.name?w():"showEmailDialog"==a.data.name?(d=a.data,z(),r.className+=" evernoteClipperVisible",
r.contentWindow.postMessage({name:"setup",auth:d.auth,noteGuid:d.noteGuid,persAuth:d.persAuth,sharedAuth:d.sharedAuth,subject:d.subject,userId:d.userId},Browser.extension.getURL("")),b.contentWindow.postMessage({name:"showShareDialogHacks",height:r.offsetHeight-12},Browser.extension.getURL(""))):"hideEmailDialog"==a.data.name?(k.className+=" evernoteClipperVisible",k.contentWindow.postMessage(a.data,Browser.extension.getURL("")),r.className=r.className.replace(/\s*evernoteClipperVisible/g,""),b.contentWindow.postMessage({name:"showShareDialogHacks",
height:k.offsetHeight-12},Browser.extension.getURL(""))):"zoomin"==a.data.name?/skitchon/.test(document.body.className)&&(f.zoom(1.1,{x:window.innerWidth/2,y:window.innerHeight/2}),P(f.getBox().width)):"zoomout"==a.data.name?/skitchon/.test(document.body.className)&&(f.zoom(1/1.1,{x:window.innerWidth/2,y:window.innerHeight/2}),P(f.getBox().width)):-1<["setNotebook","createTag","clearTag","clearTags"].indexOf(a.data.name)?b.contentWindow.postMessage(a.data,Browser.extension.getURL("")):"setShareToolsHeight"==
a.data.name?(k.style.height=a.data.height+"px",/evernoteClipperVisible/.test(k.className)&&b.contentWindow.postMessage({name:"showShareDialogHacks",height:k.offsetHeight-12},Browser.extension.getURL(""))):"hideAllTools"==a.data.name?(z(),clipResultCoordinator.hideClipResult(!0)):"hideShareTools"==a.data.name?Q():"useHighlighter"==a.data.name?/skitchon/.test(document.body.className)?ka({data:{tool:"highlighter"}}):/clearlyVisible/.test(document.documentElement.className)?c.contentWindow.ClearlyComponent__highlight.enable():
window.ClearlyComponent__highlight.enable():"turnOffHTMLHighlighter"==a.data.name?ja():"setOptionsHeight"==a.data.name?a.data.height>window.innerHeight?(g.style.height=window.innerHeight+"px",g.style.top="calc(50% - "+window.innerHeight/2+"px)",g.contentWindow.postMessage({name:"setPinchHeight",totalHeight:window.innerHeight},Browser.extension.getURL(""))):(g.style.height=a.data.height+"px",g.style.top="calc(50% - "+a.data.height/2+"px)"):"tempHideGlobalTools"==a.data.name?b.className+=" tempHidden":
"untempHideGlobalTools"==a.data.name?b.className=b.className.replace(/\s*tempHidden/g,""):"makeGlobalToolsHidable"==a.data.name?(b.className+=" hidable",b.style.width=""):"eventFilter"!=a.data.name&&"eventClick"!=a.data.name||"globalTools"!==a.data.wnd||b.contentWindow.postMessage(a.data,Browser.extension.getURL(""))});window.addEventListener("keydown",function(a){/evernoteClipperVisible/.test(b.className)&&(/Mac OS X/.test(window.navigator.userAgent)?a.metaKey&&a.preventDefault():/Windows/.test(window.navigator.userAgent)&&
a.ctrlKey&&a.preventDefault(),-1<[8,13,27,39,37,65,70,66,83,77,80,69,67].indexOf(a.keyCode)&&(/skitchon/.test(document.body.className)||a.preventDefault()))});window.addEventListener("keypress",function(a){if(/skitchon/.test(document.body.className)&&!document.querySelector("textarea.skitch-tool-element-text-editor")){var b=f.getElement().offsetWidth/2,c=f.getElement().offsetHeight/2;s("text",null,{x:b,y:c},a.charCode);a.preventDefault()}});Browser.sendToExtension({name:"getKeyboardShortcuts",shortcuts:"closeWebClipperShortcut previewArticleShortcut previewFullPageShortcut previewUrlShortcut selectionModeShortcut takeScreenshotShortcut clearlyShortcut pdfShortcut emailShortcut expandArticleShortcut contractArticleShortcut moveArticleUpShortcut moveArticleDownShortcut selectNotebookShortcut addTagsShortcut saveShortcut arrowShortcut textShortcut rectangleShortcut roundedRectangleShortcut ellipseShortcut lineShortcut markerShortcut highlighterShortcut stampShortcut pixelateShortcut cropShortcut".split(" ")});
window.addEventListener("click",z);window.addEventListener("mousedown",function(a){/evernoteClipperVisible/.test(b.className)?contentPreview.isPointOnVeil(a.pageX,a.pageY)&&a.preventDefault():g&&/evernoteClipperVisible/.test(g.className)&&a.preventDefault()});window.addEventListener("resize",function(){/skitchon/.test(document.body.className)&&P(f.getBox().width);ea(parseInt(h.style.height))});window.addEventListener("unload",function(){Browser.sendToExtension({name:"showLoggedInOrOutState"});if(!D&&
c){var a=c.getAttribute("maxScrollY")||"0";Browser.sendToExtension({name:"trackEvent",userId:m,category:"Clearly",action:"scroll",label:n,value:100*parseInt(a)/(c.contentWindow.document.body.scrollHeight-c.contentWindow.innerHeight)});D=!0;E||(E=!0,Browser.sendToExtension({name:"trackEvent",userId:m,category:"Clearly",action:"didn't save",label:n}))}});(function(){h=document.createElement("iframe");h.id="evernoteFilingTools";h.src=Browser.extension.getURL("content/filing_tools/filing_tools.html");
h.addEventListener("webkitTransitionEnd",function(){L&&(F=!0,O&&(Browser.sendToExtension({name:"captureScreenshot",tool:U}),O=F=!1))});p=document.createElement("iframe");p.id="evernoteUserTools";p.src=Browser.extension.getURL("content/user_tools/user_tools.html");k=document.createElement("iframe");k.id="evernoteShareTools";k.src=Browser.extension.getURL("content/share_tools/share_tools.html");r=document.createElement("iframe");r.id="evernoteEmailSharing";r.src=Browser.extension.getURL("content/share_tools/email_sharing.html");
b=document.createElement("iframe");b.id="evernoteGlobalTools";b.src=Browser.extension.getURL("content/global_tools/global_tools.html");b.addEventListener("webkitTransitionEnd",function(){L&&(O=!0,F&&(Browser.sendToExtension({name:"captureScreenshot",tool:U,showSubtools:ca}),O=F=!1));/needToLoadRest/.test(b.className)&&(b.className=b.className.replace(/\s*needToLoadRest/g,""),Browser.sendToExtension({name:"getOption",option:"defaultClipAction"}))});N++;document.documentElement.appendChild(h);document.documentElement.appendChild(p);
document.documentElement.appendChild(k);document.documentElement.appendChild(r);document.documentElement.appendChild(b);window.ClearlyComponent__highlight={callbacks:{highlightAdded:function(){C++},highlightDeleted:function(){C--}},settings:{imgPath:Browser.extension.getURL("clearly/images/")},window:window,document:document,jQuery:window.jQuery};window.ClearlyComponent__highlight=initClearlyComponent__highlight(window.ClearlyComponent__highlight);window.ClearlyComponent__highlight.insertCSS();window.ClearlyComponent__highlight.addMouseHandlers()})();
Object.preventExtensions(this)}Object.preventExtensions(Coordinator);injected=!0;new Coordinator;

var JsonQueue={};
(function(){function h(a,c,b,d){e[c.shardId].expensiveOpInflight=!0;3==d.length&&(d[2].query?SimsearchCache.get(c.userId,c.type,d[2].query,function(e){k(e,a,c.shardId,b,d)}):d[2].url&&FilRecCache.get(c.userId,c.type,d[2].url,function(e){k(e,a,c.shardId,b,d)}))}function k(a,c,b,d,f){if(a)for(var g in f){if("function"==typeof f[g]){f[g](a);break}}else e[b].timeout=setTimeout(function(){JsonQueue.handleExpensiveOpComplete(b)},1E4),d.apply(c,f)}var e={};JsonQueue.handleExpensiveOpRequest=function(a,c){var b=
Array.prototype.slice.call(arguments);b.shift();b.shift();var d=a.shardId;e[d]||(e[d]={expensiveOpInflight:!1,queue:[],timeout:0});for(var f in b)if("function"==typeof b[f]){var g=b[f];b[f]=function(c,f){clearTimeout(e[d].timeout);c&&3==b.length&&(b[2].query?SimsearchCache.add(a.userId,a.type,b[2].query,JSON.parse(JSON.stringify(c))):b[2].url&&FilRecCache.add(a.userId,a.type,b[2].url,JSON.parse(JSON.stringify(c))));JsonQueue.handleExpensiveOpComplete(d);g(c,f)};break}e[d].expensiveOpInflight?e[d].queue.push({attrs:a,
func:c,args:b}):0<e[d].queue.length?e[d].queue.push({attrs:a,func:c,args:b}):h(this,a,c,b)};JsonQueue.handleExpensiveOpComplete=function(a){0<e[a].queue.length?(a=e[a].queue.shift(),h(this,a.attrs,a.func,a.args)):e[a].expensiveOpInflight=!1};JsonQueue.getShards=function(){return e};Object.preventExtensions(JsonQueue)})();

function Bootstrapper(c,n,d,l){function g(h){p=new JsonRpc(null,["UserStore.checkVersion","UserStore.getBootstrapInfo"],null,l,v.get("serviceHost"),d);var a=d.trim();""!==a&&(r=[a,a]);p.initWithUrl(l+r[h]+"/json");h=Persistent.get("EVERNOTE_VERSION").split(/\./);p.client.UserStore.checkVersion(b,"EvernoteChromeClipper",h[0],h[1]);w++;SAFARI?k=setTimeout(e,3E3):(chrome.alarms.onAlarm.addListener(function(a){"checkVersion"==a.name&&e()}),chrome.alarms.create("checkVersion",{when:Date.now()+3E3}))}function e(){SAFARI?
k&&clearTimeout(k):chrome.alarms.clear("checkVersion");p.client.UserStore.getBootstrapInfo(a,s);SAFARI?k=setTimeout(a,3E3):(chrome.alarms.onAlarm.addListener(function(h){"getBootstrapInfo"==h.name&&a()}),chrome.alarms.create("getBootstrapInfo",{when:Date.now()+3E3}))}function b(a,b){b&&("number"==typeof b.code&&200!=b.code?(log.warn("HTTP Error checking version. Assuming OK."),a=!0):log.log("Error checking version: "+JSON.stringify(b)));!0===a?e():(q=!1,alert(Browser.i18n.getMessage("checkVersionWarning")),
f(q))}function a(a,b){SAFARI?k&&clearTimeout(k):chrome.alarms.clear("getBootstrapInfo");if(a&&a.profiles&&a.profiles.list){a=a.profiles.list;for(var d=0,e=v.getName(),c=0;c<a.length;c++)"undefined"!==typeof a[c].name&&a[c].name===e&&(d=c);Persistent.set("BootstrapInfoIndex",d);Persistent.set("BootstrapInfo",a)}else if(2<=w)log.error("Couldn't contact either bootstrap server. Using what we've got...");else{g(x);return}f(q);t=!1}function f(a){for(var b=m.length-1;0<=b;b--){try{m[b](a)}catch(c){log.error("Error running callback: "+
c.message+c.stack)}m.pop()}m=[]}var s=navigator.language;c&&(log.log("Will simulate Simplified Chinese."),s="zh-CN");var m=[],t=!1,q=!0,v=new BootstrapInfo(d),u=0;"zh-CN"===s&&(u=1);var x=u?0:1,w=0,r=["www.evernote.com","app.yinxiang.com"];c=["stage.evernote.com","stage-china.evernote.com"];n&&(log.log("Will bootstrap from stage servers."),r=c);var p,k;this.bootstrap=function(a){a&&m.push(a);navigator.onLine?t||(g(u),t=!0):(log.log("Bootstrapping while offline, will use existing info."),f(q))};Object.preventExtensions(this)}
Object.preventExtensions(Bootstrapper);
function BootstrapInfo(c){function n(){var b=d(),a=Persistent.get(g);return a&&a.length>b&&"undefined"!==typeof a[b].name?a[b].name:""}function d(){var b=Persistent.get(l);return b?b:0}var l="BootstrapInfoIndex",g="BootstrapInfo",e={serviceHost:"www.evernote.com",marketingUrl:"http://www.evernote.com",supportUrl:"https://support.evernote.com",accountEmailDomain:"www.evernote.com",enableFacebookSharing:!0,enableGiftSubscriptions:!0,enableSharedNotebooks:!0,enableSingleNoteSharing:!0,enableSponsoredAccounts:!0,
enableSupportTickets:!0,enableTwitterSharing:!0};this.getIndex=d;this.setIndex=function(b){Persistent.set(l,b);var a=d();b!==a&&Persistent.clear("savedAuthInfo")};this.getLength=function(){var b=Persistent.get(g);return b&&b.length?b.length:0};this.get=function(b){if("name"==b)return n();if("serviceHost"==b){var a=c;a&&(a=a.trim());if(a)return log.log("Using overidden serviceHost: "+a),a}if("undefined"===typeof e[b])return log.error("Invalid Bootstrap Info Key: "+b),!1;var a=d(),f=Persistent.get(g);
return f&&f.length>a&&f[a].settings?f[a].settings[b]:e[b]};this.getName=n;Object.preventExtensions(this)}Object.preventExtensions(BootstrapInfo);

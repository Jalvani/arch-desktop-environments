// Skitch SDK version:1.0.0.185 - 2013-08-30T22:00:23.483Z
(function(){var c=Array.prototype.slice;"undefined"!==typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.msRequestAnimationFrame||window.webkitRequestAnimationFrame,window.setImmediate=window.setImmediate||window.msSetImmediate||function(b){return setTimeout(b,0)},window.URL=window.URL||window.webkitURL,window.indexedDB=window.indexedDB||window.msIndexedDB||window.webkitIndexedDB||window.mozIndexedDB,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,window.requestFileSystem=
window.requestFileSystem||window.webkitRequestFileSystem,window.directoryEntry=window.directoryEntry||window.webkitDirEntry);Function.prototype.bind||(Function.prototype.bind=function(b){if(typeof this!=="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=c.call(arguments,1),f=this,a=function(){},d=function(){return f.apply(a&&a.prototype&&this instanceof a&&b?this:b,e.concat(c.call(arguments)))};a.prototype=this.prototype;d.prototype=new a;
return d})})();

/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery)

/**
 * Copyright 2013 Tim Down.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


if(!Array.prototype.push){Array.prototype.push=function(){for(var i=0,len=arguments.length;i<len;i++){this[this.length]=arguments[i];}
return this.length;};}
if(!Array.prototype.shift){Array.prototype.shift=function(){if(this.length>0){var firstItem=this[0];for(var i=0,len=this.length-1;i<len;i++){this[i]=this[i+1];}
this.length=this.length-1;return firstItem;}};}
if(!Array.prototype.splice){Array.prototype.splice=function(startIndex,deleteCount){var itemsAfterDeleted=this.slice(startIndex+deleteCount);var itemsDeleted=this.slice(startIndex,startIndex+deleteCount);this.length=startIndex;var argumentsArray=[];for(var i=0,len=arguments.length;i<len;i++){argumentsArray[i]=arguments[i];}
var itemsToAppend=(argumentsArray.length>2)?itemsAfterDeleted=argumentsArray.slice(2).concat(itemsAfterDeleted):itemsAfterDeleted;for(i=0,len=itemsToAppend.length;i<len;i++){this.push(itemsToAppend[i]);}
return itemsDeleted;};}
var log4javascript=(function(){function isUndefined(obj){return typeof obj=="undefined";}
function EventSupport(){}
EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(eventTypesParam){if(eventTypesParam instanceof Array){this.eventTypes=eventTypesParam;this.eventListeners={};for(var i=0,len=this.eventTypes.length;i<len;i++){this.eventListeners[this.eventTypes[i]]=[];}}else{handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array");}},addEventListener:function(eventType,listener){if(typeof listener=="function"){if(!array_contains(this.eventTypes,eventType)){handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+eventType+"'");}
this.eventListeners[eventType].push(listener);}else{handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function");}},removeEventListener:function(eventType,listener){if(typeof listener=="function"){if(!array_contains(this.eventTypes,eventType)){handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+eventType+"'");}
array_remove(this.eventListeners[eventType],listener);}else{handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function");}},dispatchEvent:function(eventType,eventArgs){if(array_contains(this.eventTypes,eventType)){var listeners=this.eventListeners[eventType];for(var i=0,len=listeners.length;i<len;i++){listeners[i](this,eventType,eventArgs);}}else{handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+eventType+"'");}}};var applicationStartDate=new Date();var uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+
Math.floor(Math.random()*100000000);var emptyFunction=function(){};var newLine="\r\n";var pageLoaded=false;function Log4JavaScript(){}
Log4JavaScript.prototype=new EventSupport();log4javascript=new Log4JavaScript();log4javascript.version="1.4.6";log4javascript.edition="log4javascript";function toStr(obj){if(obj&&obj.toString){return obj.toString();}else{return String(obj);}}
function getExceptionMessage(ex){if(ex.message){return ex.message;}else if(ex.description){return ex.description;}else{return toStr(ex);}}
function getUrlFileName(url){var lastSlashIndex=Math.max(url.lastIndexOf("/"),url.lastIndexOf("\\"));return url.substr(lastSlashIndex+1);}
function getExceptionStringRep(ex){if(ex){var exStr="Exception: "+getExceptionMessage(ex);try{if(ex.lineNumber){exStr+=" on line number "+ex.lineNumber;}
if(ex.fileName){exStr+=" in file "+getUrlFileName(ex.fileName);}}catch(localEx){logLog.warn("Unable to obtain file and line information for error");}
if(showStackTraces&&ex.stack){exStr+=newLine+"Stack trace:"+newLine+ex.stack;}
return exStr;}
return null;}
function bool(obj){return Boolean(obj);}
function trim(str){return str.replace(/^\s+/,"").replace(/\s+$/,"");}
function splitIntoLines(text){var text2=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return text2.split("\n");}
var urlEncode=(typeof window.encodeURIComponent!="undefined")?function(str){return encodeURIComponent(str);}:function(str){return escape(str).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D");};var urlDecode=(typeof window.decodeURIComponent!="undefined")?function(str){return decodeURIComponent(str);}:function(str){return unescape(str).replace(/%2B/g,"+").replace(/%22/g,"\"").replace(/%27/g,"'").replace(/%2F/g,"/").replace(/%3D/g,"=");};function array_remove(arr,val){var index=-1;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===val){index=i;break;}}
if(index>=0){arr.splice(index,1);return true;}else{return false;}}
function array_contains(arr,val){for(var i=0,len=arr.length;i<len;i++){if(arr[i]==val){return true;}}
return false;}
function extractBooleanFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue;}else{return bool(param);}}
function extractStringFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue;}else{return String(param);}}
function extractIntFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue;}else{try{var value=parseInt(param,10);return isNaN(value)?defaultValue:value;}catch(ex){logLog.warn("Invalid int param "+param,ex);return defaultValue;}}}
function extractFunctionFromParam(param,defaultValue){if(typeof param=="function"){return param;}else{return defaultValue;}}
function isError(err){return(err instanceof Error);}
if(!Function.prototype.apply){Function.prototype.apply=function(obj,args){var methodName="__apply__";if(typeof obj[methodName]!="undefined"){methodName+=String(Math.random()).substr(2);}
obj[methodName]=this;var argsStrings=[];for(var i=0,len=args.length;i<len;i++){argsStrings[i]="args["+i+"]";}
var script="obj."+methodName+"("+argsStrings.join(",")+")";var returnValue=eval(script);delete obj[methodName];return returnValue;};}
if(!Function.prototype.call){Function.prototype.call=function(obj){var args=[];for(var i=1,len=arguments.length;i<len;i++){args[i-1]=arguments[i];}
return this.apply(obj,args);};}
function getListenersPropertyName(eventName){return"__log4javascript_listeners__"+eventName;}
function addEvent(node,eventName,listener,useCapture,win){win=win?win:window;if(node.addEventListener){node.addEventListener(eventName,listener,useCapture);}else if(node.attachEvent){node.attachEvent("on"+eventName,listener);}else{var propertyName=getListenersPropertyName(eventName);if(!node[propertyName]){node[propertyName]=[];node["on"+eventName]=function(evt){evt=getEvent(evt,win);var listenersPropertyName=getListenersPropertyName(eventName);var listeners=this[listenersPropertyName].concat([]);var currentListener;while((currentListener=listeners.shift())){currentListener.call(this,evt);}};}
node[propertyName].push(listener);}}
function removeEvent(node,eventName,listener,useCapture){if(node.removeEventListener){node.removeEventListener(eventName,listener,useCapture);}else if(node.detachEvent){node.detachEvent("on"+eventName,listener);}else{var propertyName=getListenersPropertyName(eventName);if(node[propertyName]){array_remove(node[propertyName],listener);}}}
function getEvent(evt,win){win=win?win:window;return evt?evt:win.event;}
function stopEventPropagation(evt){if(evt.stopPropagation){evt.stopPropagation();}else if(typeof evt.cancelBubble!="undefined"){evt.cancelBubble=true;}
evt.returnValue=false;}
var logLog={quietMode:false,debugMessages:[],setQuietMode:function(quietMode){this.quietMode=bool(quietMode);},numberOfErrors:0,alertAllErrors:false,setAlertAllErrors:function(alertAllErrors){this.alertAllErrors=alertAllErrors;},debug:function(message){this.debugMessages.push(message);},displayDebug:function(){alert(this.debugMessages.join(newLine));},warn:function(message,exception){},error:function(message,exception){if(++this.numberOfErrors==1||this.alertAllErrors){if(!this.quietMode){var alertMessage="log4javascript error: "+message;if(exception){alertMessage+=newLine+newLine+"Original error: "+getExceptionStringRep(exception);}
alert(alertMessage);}}}};log4javascript.logLog=logLog;log4javascript.setEventTypes(["load","error"]);function handleError(message,exception){logLog.error(message,exception);log4javascript.dispatchEvent("error",{"message":message,"exception":exception});}
log4javascript.handleError=handleError;var enabled=!((typeof log4javascript_disabled!="undefined")&&log4javascript_disabled);log4javascript.setEnabled=function(enable){enabled=bool(enable);};log4javascript.isEnabled=function(){return enabled;};var useTimeStampsInMilliseconds=true;log4javascript.setTimeStampsInMilliseconds=function(timeStampsInMilliseconds){useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds);};log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds;};log4javascript.evalInScope=function(expr){return eval(expr);};var showStackTraces=false;log4javascript.setShowStackTraces=function(show){showStackTraces=bool(show);};var Level=function(level,name){this.level=level;this.name=name;};Level.prototype={toString:function(){return this.name;},equals:function(level){return this.level==level.level;},isGreaterOrEqual:function(level){return this.level>=level.level;}};Level.ALL=new Level(Number.MIN_VALUE,"ALL");Level.TRACE=new Level(10000,"TRACE");Level.DEBUG=new Level(20000,"DEBUG");Level.INFO=new Level(30000,"INFO");Level.WARN=new Level(40000,"WARN");Level.ERROR=new Level(50000,"ERROR");Level.FATAL=new Level(60000,"FATAL");Level.OFF=new Level(Number.MAX_VALUE,"OFF");log4javascript.Level=Level;function Timer(name,level){this.name=name;this.level=isUndefined(level)?Level.INFO:level;this.start=new Date();}
Timer.prototype.getElapsedTime=function(){return new Date().getTime()-this.start.getTime();};var anonymousLoggerName="[anonymous]";var defaultLoggerName="[default]";var nullLoggerName="[null]";var rootLoggerName="root";function Logger(name){this.name=name;this.parent=null;this.children=[];var appenders=[];var loggerLevel=null;var isRoot=(this.name===rootLoggerName);var isNull=(this.name===nullLoggerName);var appenderCache=null;var appenderCacheInvalidated=false;this.addChild=function(childLogger){this.children.push(childLogger);childLogger.parent=this;childLogger.invalidateAppenderCache();};var additive=true;this.getAdditivity=function(){return additive;};this.setAdditivity=function(additivity){var valueChanged=(additive!=additivity);additive=additivity;if(valueChanged){this.invalidateAppenderCache();}};this.addAppender=function(appender){if(isNull){handleError("Logger.addAppender: you may not add an appender to the null logger");}else{if(appender instanceof log4javascript.Appender){if(!array_contains(appenders,appender)){appenders.push(appender);appender.setAddedToLogger(this);this.invalidateAppenderCache();}}else{handleError("Logger.addAppender: appender supplied ('"+
toStr(appender)+"') is not a subclass of Appender");}}};this.removeAppender=function(appender){array_remove(appenders,appender);appender.setRemovedFromLogger(this);this.invalidateAppenderCache();};this.removeAllAppenders=function(){var appenderCount=appenders.length;if(appenderCount>0){for(var i=0;i<appenderCount;i++){appenders[i].setRemovedFromLogger(this);}
appenders.length=0;this.invalidateAppenderCache();}};this.getEffectiveAppenders=function(){if(appenderCache===null||appenderCacheInvalidated){var parentEffectiveAppenders=(isRoot||!this.getAdditivity())?[]:this.parent.getEffectiveAppenders();appenderCache=parentEffectiveAppenders.concat(appenders);appenderCacheInvalidated=false;}
return appenderCache;};this.invalidateAppenderCache=function(){appenderCacheInvalidated=true;for(var i=0,len=this.children.length;i<len;i++){this.children[i].invalidateAppenderCache();}};this.log=function(level,params){if(enabled&&level.isGreaterOrEqual(this.getEffectiveLevel())){var exception;var finalParamIndex=params.length-1;var lastParam=params[finalParamIndex];if(params.length>1&&isError(lastParam)){exception=lastParam;finalParamIndex--;}
var messages=[];for(var i=0;i<=finalParamIndex;i++){messages[i]=params[i];}
var loggingEvent=new LoggingEvent(this,new Date(),level,messages,exception);this.callAppenders(loggingEvent);}};this.callAppenders=function(loggingEvent){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].doAppend(loggingEvent);}};this.setLevel=function(level){if(isRoot&&level===null){handleError("Logger.setLevel: you cannot set the level of the root logger to null");}else if(level instanceof Level){loggerLevel=level;}else{handleError("Logger.setLevel: level supplied to logger "+
this.name+" is not an instance of log4javascript.Level");}};this.getLevel=function(){return loggerLevel;};this.getEffectiveLevel=function(){for(var logger=this;logger!==null;logger=logger.parent){var level=logger.getLevel();if(level!==null){return level;}}};this.group=function(name,initiallyExpanded){if(enabled){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].group(name,initiallyExpanded);}}};this.groupEnd=function(){if(enabled){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].groupEnd();}}};var timers={};this.time=function(name,level){if(enabled){if(isUndefined(name)){handleError("Logger.time: a name for the timer must be supplied");}else if(level&&!(level instanceof Level)){handleError("Logger.time: level supplied to timer "+
name+" is not an instance of log4javascript.Level");}else{timers[name]=new Timer(name,level);}}};this.timeEnd=function(name){if(enabled){if(isUndefined(name)){handleError("Logger.timeEnd: a name for the timer must be supplied");}else if(timers[name]){var timer=timers[name];var milliseconds=timer.getElapsedTime();this.log(timer.level,["Timer "+toStr(name)+" completed in "+milliseconds+"ms"]);delete timers[name];}else{logLog.warn("Logger.timeEnd: no timer found with name "+name);}}};this.assert=function(expr){if(enabled&&!expr){var args=[];for(var i=1,len=arguments.length;i<len;i++){args.push(arguments[i]);}
args=(args.length>0)?args:["Assertion Failure"];args.push(newLine);args.push(expr);this.log(Level.ERROR,args);}};this.toString=function(){return"Logger["+this.name+"]";};}
Logger.prototype={trace:function(){this.log(Level.TRACE,arguments);},debug:function(){this.log(Level.DEBUG,arguments);},info:function(){this.log(Level.INFO,arguments);},warn:function(){this.log(Level.WARN,arguments);},error:function(){this.log(Level.ERROR,arguments);},fatal:function(){this.log(Level.FATAL,arguments);},isEnabledFor:function(level){return level.isGreaterOrEqual(this.getEffectiveLevel());},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE);},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG);},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO);},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN);},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR);},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL);}};Logger.prototype.trace.isEntryPoint=true;Logger.prototype.debug.isEntryPoint=true;Logger.prototype.info.isEntryPoint=true;Logger.prototype.warn.isEntryPoint=true;Logger.prototype.error.isEntryPoint=true;Logger.prototype.fatal.isEntryPoint=true;var loggers={};var loggerNames=[];var ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG;var rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL);log4javascript.getRootLogger=function(){return rootLogger;};log4javascript.getLogger=function(loggerName){if(!(typeof loggerName=="string")){loggerName=anonymousLoggerName;logLog.warn("log4javascript.getLogger: non-string logger name "+
toStr(loggerName)+" supplied, returning anonymous logger");}
if(loggerName==rootLoggerName){handleError("log4javascript.getLogger: root logger may not be obtained by name");}
if(!loggers[loggerName]){var logger=new Logger(loggerName);loggers[loggerName]=logger;loggerNames.push(loggerName);var lastDotIndex=loggerName.lastIndexOf(".");var parentLogger;if(lastDotIndex>-1){var parentLoggerName=loggerName.substring(0,lastDotIndex);parentLogger=log4javascript.getLogger(parentLoggerName);}else{parentLogger=rootLogger;}
parentLogger.addChild(logger);}
return loggers[loggerName];};var defaultLogger=null;log4javascript.getDefaultLogger=function(){if(!defaultLogger){defaultLogger=log4javascript.getLogger(defaultLoggerName);var a=new log4javascript.PopUpAppender();defaultLogger.addAppender(a);}
return defaultLogger;};var nullLogger=null;log4javascript.getNullLogger=function(){if(!nullLogger){nullLogger=new Logger(nullLoggerName);nullLogger.setLevel(Level.OFF);}
return nullLogger;};log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL);loggers={};};var LoggingEvent=function(logger,timeStamp,level,messages,exception){this.logger=logger;this.timeStamp=timeStamp;this.timeStampInMilliseconds=timeStamp.getTime();this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1000);this.milliseconds=this.timeStamp.getMilliseconds();this.level=level;this.messages=messages;this.exception=exception;};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):"";},getCombinedMessages:function(){return(this.messages.length==1)?this.messages[0]:this.messages.join(newLine);},toString:function(){return"LoggingEvent["+this.level+"]";}};log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:false,overrideTimeStampsSetting:false,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method");},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method");},getContentType:function(){return"text/plain";},allowBatching:function(){return true;},setTimeStampsInMilliseconds:function(timeStampsInMilliseconds){this.overrideTimeStampsSetting=true;this.useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds);},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds;},getTimeStampValue:function(loggingEvent){return this.isTimeStampsInMilliseconds()?loggingEvent.timeStampInMilliseconds:loggingEvent.timeStampInSeconds;},getDataValues:function(loggingEvent,combineMessages){var dataValues=[[this.loggerKey,loggingEvent.logger.name],[this.timeStampKey,this.getTimeStampValue(loggingEvent)],[this.levelKey,loggingEvent.level.name],[this.urlKey,window.location.href],[this.messageKey,combineMessages?loggingEvent.getCombinedMessages():loggingEvent.messages]];if(!this.isTimeStampsInMilliseconds()){dataValues.push([this.millisecondsKey,loggingEvent.milliseconds]);}
if(loggingEvent.exception){dataValues.push([this.exceptionKey,getExceptionStringRep(loggingEvent.exception)]);}
if(this.hasCustomFields()){for(var i=0,len=this.customFields.length;i<len;i++){var val=this.customFields[i].value;if(typeof val==="function"){val=val(this,loggingEvent);}
dataValues.push([this.customFields[i].name,val]);}}
return dataValues;},setKeys:function(loggerKey,timeStampKey,levelKey,messageKey,exceptionKey,urlKey,millisecondsKey){this.loggerKey=extractStringFromParam(loggerKey,this.defaults.loggerKey);this.timeStampKey=extractStringFromParam(timeStampKey,this.defaults.timeStampKey);this.levelKey=extractStringFromParam(levelKey,this.defaults.levelKey);this.messageKey=extractStringFromParam(messageKey,this.defaults.messageKey);this.exceptionKey=extractStringFromParam(exceptionKey,this.defaults.exceptionKey);this.urlKey=extractStringFromParam(urlKey,this.defaults.urlKey);this.millisecondsKey=extractStringFromParam(millisecondsKey,this.defaults.millisecondsKey);},setCustomField:function(name,value){var fieldUpdated=false;for(var i=0,len=this.customFields.length;i<len;i++){if(this.customFields[i].name===name){this.customFields[i].value=value;fieldUpdated=true;}}
if(!fieldUpdated){this.customFields.push({"name":name,"value":value});}},hasCustomFields:function(){return(this.customFields.length>0);},toString:function(){handleError("Layout.toString: all layouts must override this method");}};log4javascript.Layout=Layout;var Appender=function(){};Appender.prototype=new EventSupport();Appender.prototype.layout=new PatternLayout();Appender.prototype.threshold=Level.ALL;Appender.prototype.loggers=[];Appender.prototype.doAppend=function(loggingEvent){if(enabled&&loggingEvent.level.level>=this.threshold.level){this.append(loggingEvent);}};Appender.prototype.append=function(loggingEvent){};Appender.prototype.setLayout=function(layout){if(layout instanceof Layout){this.layout=layout;}else{handleError("Appender.setLayout: layout supplied to "+
this.toString()+" is not a subclass of Layout");}};Appender.prototype.getLayout=function(){return this.layout;};Appender.prototype.setThreshold=function(threshold){if(threshold instanceof Level){this.threshold=threshold;}else{handleError("Appender.setThreshold: threshold supplied to "+
this.toString()+" is not a subclass of Level");}};Appender.prototype.getThreshold=function(){return this.threshold;};Appender.prototype.setAddedToLogger=function(logger){this.loggers.push(logger);};Appender.prototype.setRemovedFromLogger=function(logger){array_remove(this.loggers,logger);};Appender.prototype.group=emptyFunction;Appender.prototype.groupEnd=emptyFunction;Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method");};log4javascript.Appender=Appender;function SimpleLayout(){this.customFields=[];}
SimpleLayout.prototype=new Layout();SimpleLayout.prototype.format=function(loggingEvent){return loggingEvent.level.name+" - "+loggingEvent.getCombinedMessages();};SimpleLayout.prototype.ignoresThrowable=function(){return true;};SimpleLayout.prototype.toString=function(){return"SimpleLayout";};log4javascript.SimpleLayout=SimpleLayout;function NullLayout(){this.customFields=[];}
NullLayout.prototype=new Layout();NullLayout.prototype.format=function(loggingEvent){return loggingEvent.messages;};NullLayout.prototype.ignoresThrowable=function(){return true;};NullLayout.prototype.toString=function(){return"NullLayout";};log4javascript.NullLayout=NullLayout;function XmlLayout(combineMessages){this.combineMessages=extractBooleanFromParam(combineMessages,true);this.customFields=[];}
XmlLayout.prototype=new Layout();XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages;};XmlLayout.prototype.getContentType=function(){return"text/xml";};XmlLayout.prototype.escapeCdata=function(str){return str.replace(/\]\]>/,"]]>]]&gt;<![CDATA[");};XmlLayout.prototype.format=function(loggingEvent){var layout=this;var i,len;function formatMessage(message){message=(typeof message==="string")?message:toStr(message);return"<log4javascript:message><![CDATA["+
layout.escapeCdata(message)+"]]></log4javascript:message>";}
var str="<log4javascript:event logger=\""+loggingEvent.logger.name+"\" timestamp=\""+this.getTimeStampValue(loggingEvent)+"\"";if(!this.isTimeStampsInMilliseconds()){str+=" milliseconds=\""+loggingEvent.milliseconds+"\"";}
str+=" level=\""+loggingEvent.level.name+"\">"+newLine;if(this.combineMessages){str+=formatMessage(loggingEvent.getCombinedMessages());}else{str+="<log4javascript:messages>"+newLine;for(i=0,len=loggingEvent.messages.length;i<len;i++){str+=formatMessage(loggingEvent.messages[i])+newLine;}
str+="</log4javascript:messages>"+newLine;}
if(this.hasCustomFields()){for(i=0,len=this.customFields.length;i<len;i++){str+="<log4javascript:customfield name=\""+
this.customFields[i].name+"\"><![CDATA["+
this.customFields[i].value.toString()+"]]></log4javascript:customfield>"+newLine;}}
if(loggingEvent.exception){str+="<log4javascript:exception><![CDATA["+
getExceptionStringRep(loggingEvent.exception)+"]]></log4javascript:exception>"+newLine;}
str+="</log4javascript:event>"+newLine+newLine;return str;};XmlLayout.prototype.ignoresThrowable=function(){return false;};XmlLayout.prototype.toString=function(){return"XmlLayout";};log4javascript.XmlLayout=XmlLayout;function escapeNewLines(str){return str.replace(/\r\n|\r|\n/g,"\\r\\n");}
function JsonLayout(readable,combineMessages){this.readable=extractBooleanFromParam(readable,false);this.combineMessages=extractBooleanFromParam(combineMessages,true);this.batchHeader=this.readable?"["+newLine:"[";this.batchFooter=this.readable?"]"+newLine:"]";this.batchSeparator=this.readable?","+newLine:",";this.setKeys();this.colon=this.readable?": ":":";this.tab=this.readable?"\t":"";this.lineBreak=this.readable?newLine:"";this.customFields=[];}
JsonLayout.prototype=new Layout();JsonLayout.prototype.isReadable=function(){return this.readable;};JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages;};JsonLayout.prototype.format=function(loggingEvent){var layout=this;var dataValues=this.getDataValues(loggingEvent,this.combineMessages);var str="{"+this.lineBreak;var i,len;function formatValue(val,prefix,expand){var formattedValue;var valType=typeof val;if(val instanceof Date){formattedValue=String(val.getTime());}else if(expand&&(val instanceof Array)){formattedValue="["+layout.lineBreak;for(var i=0,len=val.length;i<len;i++){var childPrefix=prefix+layout.tab;formattedValue+=childPrefix+formatValue(val[i],childPrefix,false);if(i<val.length-1){formattedValue+=",";}
formattedValue+=layout.lineBreak;}
formattedValue+=prefix+"]";}else if(valType!=="number"&&valType!=="boolean"){formattedValue="\""+escapeNewLines(toStr(val).replace(/\"/g,"\\\""))+"\"";}else{formattedValue=val;}
return formattedValue;}
for(i=0,len=dataValues.length-1;i<=len;i++){str+=this.tab+"\""+dataValues[i][0]+"\""+this.colon+formatValue(dataValues[i][1],this.tab,true);if(i<len){str+=",";}
str+=this.lineBreak;}
str+="}"+this.lineBreak;return str;};JsonLayout.prototype.ignoresThrowable=function(){return false;};JsonLayout.prototype.toString=function(){return"JsonLayout";};JsonLayout.prototype.getContentType=function(){return"application/json";};log4javascript.JsonLayout=JsonLayout;function HttpPostDataLayout(){this.setKeys();this.customFields=[];this.returnsPostData=true;}
HttpPostDataLayout.prototype=new Layout();HttpPostDataLayout.prototype.allowBatching=function(){return false;};HttpPostDataLayout.prototype.format=function(loggingEvent){var dataValues=this.getDataValues(loggingEvent);var queryBits=[];for(var i=0,len=dataValues.length;i<len;i++){var val=(dataValues[i][1]instanceof Date)?String(dataValues[i][1].getTime()):dataValues[i][1];queryBits.push(urlEncode(dataValues[i][0])+"="+urlEncode(val));}
return queryBits.join("&");};HttpPostDataLayout.prototype.ignoresThrowable=function(loggingEvent){return false;};HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout";};log4javascript.HttpPostDataLayout=HttpPostDataLayout;function formatObjectExpansion(obj,depth,indentation){var objectsExpanded=[];function doFormat(obj,depth,indentation){var i,j,len,childDepth,childIndentation,childLines,expansion,childExpansion;if(!indentation){indentation="";}
function formatString(text){var lines=splitIntoLines(text);for(var j=1,jLen=lines.length;j<jLen;j++){lines[j]=indentation+lines[j];}
return lines.join(newLine);}
if(obj===null){return"null";}else if(typeof obj=="undefined"){return"undefined";}else if(typeof obj=="string"){return formatString(obj);}else if(typeof obj=="object"&&array_contains(objectsExpanded,obj)){try{expansion=toStr(obj);}catch(ex){expansion="Error formatting property. Details: "+getExceptionStringRep(ex);}
return expansion+" [already expanded]";}else if((obj instanceof Array)&&depth>0){objectsExpanded.push(obj);expansion="["+newLine;childDepth=depth-1;childIndentation=indentation+"  ";childLines=[];for(i=0,len=obj.length;i<len;i++){try{childExpansion=doFormat(obj[i],childDepth,childIndentation);childLines.push(childIndentation+childExpansion);}catch(ex){childLines.push(childIndentation+"Error formatting array member. Details: "+
getExceptionStringRep(ex)+"");}}
expansion+=childLines.join(","+newLine)+newLine+indentation+"]";return expansion;}else if(Object.prototype.toString.call(obj)=="[object Date]"){return obj.toString();}else if(typeof obj=="object"&&depth>0){objectsExpanded.push(obj);expansion="{"+newLine;childDepth=depth-1;childIndentation=indentation+"  ";childLines=[];for(i in obj){try{childExpansion=doFormat(obj[i],childDepth,childIndentation);childLines.push(childIndentation+i+": "+childExpansion);}catch(ex){childLines.push(childIndentation+i+": Error formatting property. Details: "+
getExceptionStringRep(ex));}}
expansion+=childLines.join(","+newLine)+newLine+indentation+"}";return expansion;}else{return formatString(toStr(obj));}}
return doFormat(obj,depth,indentation);}
var SimpleDateFormat;(function(){var regex=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/;var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var TEXT2=0,TEXT3=1,NUMBER=2,YEAR=3,MONTH=4,TIMEZONE=5;var types={G:TEXT2,y:YEAR,M:MONTH,w:NUMBER,W:NUMBER,D:NUMBER,d:NUMBER,F:NUMBER,E:TEXT3,a:TEXT2,H:NUMBER,k:NUMBER,K:NUMBER,h:NUMBER,m:NUMBER,s:NUMBER,S:NUMBER,Z:TIMEZONE};var ONE_DAY=24*60*60*1000;var ONE_WEEK=7*ONE_DAY;var DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK=1;var newDateAtMidnight=function(year,month,day){var d=new Date(year,month,day,0,0,0);d.setMilliseconds(0);return d;};Date.prototype.getDifference=function(date){return this.getTime()-date.getTime();};Date.prototype.isBefore=function(d){return this.getTime()<d.getTime();};Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());};Date.prototype.getTimeSince=function(d){return this.getUTCTime()-d.getUTCTime();};Date.prototype.getPreviousSunday=function(){var midday=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0);var previousSunday=new Date(midday.getTime()-this.getDay()*ONE_DAY);return newDateAtMidnight(previousSunday.getFullYear(),previousSunday.getMonth(),previousSunday.getDate());};Date.prototype.getWeekInYear=function(minimalDaysInFirstWeek){if(isUndefined(this.minimalDaysInFirstWeek)){minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK;}
var previousSunday=this.getPreviousSunday();var startOfYear=newDateAtMidnight(this.getFullYear(),0,1);var numberOfSundays=previousSunday.isBefore(startOfYear)?0:1+Math.floor(previousSunday.getTimeSince(startOfYear)/ONE_WEEK);var numberOfDaysInFirstWeek=7-startOfYear.getDay();var weekInYear=numberOfSundays;if(numberOfDaysInFirstWeek<minimalDaysInFirstWeek){weekInYear--;}
return weekInYear;};Date.prototype.getWeekInMonth=function(minimalDaysInFirstWeek){if(isUndefined(this.minimalDaysInFirstWeek)){minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK;}
var previousSunday=this.getPreviousSunday();var startOfMonth=newDateAtMidnight(this.getFullYear(),this.getMonth(),1);var numberOfSundays=previousSunday.isBefore(startOfMonth)?0:1+Math.floor(previousSunday.getTimeSince(startOfMonth)/ONE_WEEK);var numberOfDaysInFirstWeek=7-startOfMonth.getDay();var weekInMonth=numberOfSundays;if(numberOfDaysInFirstWeek>=minimalDaysInFirstWeek){weekInMonth++;}
return weekInMonth;};Date.prototype.getDayInYear=function(){var startOfYear=newDateAtMidnight(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(startOfYear)/ONE_DAY);};SimpleDateFormat=function(formatString){this.formatString=formatString;};SimpleDateFormat.prototype.setMinimalDaysInFirstWeek=function(days){this.minimalDaysInFirstWeek=days;};SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK:this.minimalDaysInFirstWeek;};var padWithZeroes=function(str,len){while(str.length<len){str="0"+str;}
return str;};var formatText=function(data,numberOfLetters,minLength){return(numberOfLetters>=4)?data:data.substr(0,Math.max(minLength,numberOfLetters));};var formatNumber=function(data,numberOfLetters){var dataString=""+data;return padWithZeroes(dataString,numberOfLetters);};SimpleDateFormat.prototype.format=function(date){var formattedString="";var result;var searchString=this.formatString;while((result=regex.exec(searchString))){var quotedString=result[1];var patternLetters=result[2];var otherLetters=result[3];var otherCharacters=result[4];if(quotedString){if(quotedString=="''"){formattedString+="'";}else{formattedString+=quotedString.substring(1,quotedString.length-1);}}else if(otherLetters){}else if(otherCharacters){formattedString+=otherCharacters;}else if(patternLetters){var patternLetter=patternLetters.charAt(0);var numberOfLetters=patternLetters.length;var rawData="";switch(patternLetter){case"G":rawData="AD";break;case"y":rawData=date.getFullYear();break;case"M":rawData=date.getMonth();break;case"w":rawData=date.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":rawData=date.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":rawData=date.getDayInYear();break;case"d":rawData=date.getDate();break;case"F":rawData=1+Math.floor((date.getDate()-1)/7);break;case"E":rawData=dayNames[date.getDay()];break;case"a":rawData=(date.getHours()>=12)?"PM":"AM";break;case"H":rawData=date.getHours();break;case"k":rawData=date.getHours()||24;break;case"K":rawData=date.getHours()%12;break;case"h":rawData=(date.getHours()%12)||12;break;case"m":rawData=date.getMinutes();break;case"s":rawData=date.getSeconds();break;case"S":rawData=date.getMilliseconds();break;case"Z":rawData=date.getTimezoneOffset();break;}
switch(types[patternLetter]){case TEXT2:formattedString+=formatText(rawData,numberOfLetters,2);break;case TEXT3:formattedString+=formatText(rawData,numberOfLetters,3);break;case NUMBER:formattedString+=formatNumber(rawData,numberOfLetters);break;case YEAR:if(numberOfLetters<=3){var dataString=""+rawData;formattedString+=dataString.substr(2,2);}else{formattedString+=formatNumber(rawData,numberOfLetters);}
break;case MONTH:if(numberOfLetters>=3){formattedString+=formatText(monthNames[rawData],numberOfLetters,numberOfLetters);}else{formattedString+=formatNumber(rawData+1,numberOfLetters);}
break;case TIMEZONE:var isPositive=(rawData>0);var prefix=isPositive?"-":"+";var absData=Math.abs(rawData);var hours=""+Math.floor(absData/60);hours=padWithZeroes(hours,2);var minutes=""+(absData%60);minutes=padWithZeroes(minutes,2);formattedString+=prefix+hours+minutes;break;}}
searchString=searchString.substr(result.index+result[0].length);}
return formattedString;};})();log4javascript.SimpleDateFormat=SimpleDateFormat;function PatternLayout(pattern){if(pattern){this.pattern=pattern;}else{this.pattern=PatternLayout.DEFAULT_CONVERSION_PATTERN;}
this.customFields=[];}
PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n";PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n";PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS";PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS";PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS";PatternLayout.prototype=new Layout();PatternLayout.prototype.format=function(loggingEvent){var regex=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/;var formattedString="";var result;var searchString=this.pattern;while((result=regex.exec(searchString))){var matchedString=result[0];var padding=result[1];var truncation=result[2];var conversionCharacter=result[3];var specifier=result[5];var text=result[6];if(text){formattedString+=""+text;}else{var replacement="";switch(conversionCharacter){case"a":case"m":var depth=0;if(specifier){depth=parseInt(specifier,10);if(isNaN(depth)){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character '"+conversionCharacter+"' - should be a number");depth=0;}}
var messages=(conversionCharacter==="a")?loggingEvent.messages[0]:loggingEvent.messages;for(var i=0,len=messages.length;i<len;i++){if(i>0&&(replacement.charAt(replacement.length-1)!==" ")){replacement+=" ";}
if(depth===0){replacement+=messages[i];}else{replacement+=formatObjectExpansion(messages[i],depth);}}
break;case"c":var loggerName=loggingEvent.logger.name;if(specifier){var precision=parseInt(specifier,10);var loggerNameBits=loggingEvent.logger.name.split(".");if(precision>=loggerNameBits.length){replacement=loggerName;}else{replacement=loggerNameBits.slice(loggerNameBits.length-precision).join(".");}}else{replacement=loggerName;}
break;case"d":var dateFormat=PatternLayout.ISO8601_DATEFORMAT;if(specifier){dateFormat=specifier;if(dateFormat=="ISO8601"){dateFormat=PatternLayout.ISO8601_DATEFORMAT;}else if(dateFormat=="ABSOLUTE"){dateFormat=PatternLayout.ABSOLUTETIME_DATEFORMAT;}else if(dateFormat=="DATE"){dateFormat=PatternLayout.DATETIME_DATEFORMAT;}}
replacement=(new SimpleDateFormat(dateFormat)).format(loggingEvent.timeStamp);break;case"f":if(this.hasCustomFields()){var fieldIndex=0;if(specifier){fieldIndex=parseInt(specifier,10);if(isNaN(fieldIndex)){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character 'f' - should be a number");}else if(fieldIndex===0){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character 'f' - must be greater than zero");}else if(fieldIndex>this.customFields.length){handleError("PatternLayout.format: invalid specifier '"+
specifier+"' for conversion character 'f' - there aren't that many custom fields");}else{fieldIndex=fieldIndex-1;}}
var val=this.customFields[fieldIndex].value;if(typeof val=="function"){val=val(this,loggingEvent);}
replacement=val;}
break;case"n":replacement=newLine;break;case"p":replacement=loggingEvent.level.name;break;case"r":replacement=""+loggingEvent.timeStamp.getDifference(applicationStartDate);break;case"%":replacement="%";break;default:replacement=matchedString;break;}
var l;if(truncation){l=parseInt(truncation.substr(1),10);var strLen=replacement.length;if(l<strLen){replacement=replacement.substring(strLen-l,strLen);}}
if(padding){if(padding.charAt(0)=="-"){l=parseInt(padding.substr(1),10);while(replacement.length<l){replacement+=" ";}}else{l=parseInt(padding,10);while(replacement.length<l){replacement=" "+replacement;}}}
formattedString+=replacement;}
searchString=searchString.substr(result.index+result[0].length);}
return formattedString;};PatternLayout.prototype.ignoresThrowable=function(){return true;};PatternLayout.prototype.toString=function(){return"PatternLayout";};log4javascript.PatternLayout=PatternLayout;function AlertAppender(){}
AlertAppender.prototype=new Appender();AlertAppender.prototype.layout=new SimpleLayout();AlertAppender.prototype.append=function(loggingEvent){var formattedMessage=this.getLayout().format(loggingEvent);if(this.getLayout().ignoresThrowable()){formattedMessage+=loggingEvent.getThrowableStrRep();}
alert(formattedMessage);};AlertAppender.prototype.toString=function(){return"AlertAppender";};log4javascript.AlertAppender=AlertAppender;function BrowserConsoleAppender(){}
BrowserConsoleAppender.prototype=new log4javascript.Appender();BrowserConsoleAppender.prototype.layout=new NullLayout();BrowserConsoleAppender.prototype.threshold=Level.DEBUG;BrowserConsoleAppender.prototype.append=function(loggingEvent){var appender=this;var getFormattedMessage=function(){var layout=appender.getLayout();var formattedMessage=layout.format(loggingEvent);if(layout.ignoresThrowable()&&loggingEvent.exception){formattedMessage+=loggingEvent.getThrowableStrRep();}
return formattedMessage;};if((typeof opera!="undefined")&&opera.postError){opera.postError(getFormattedMessage());}else if(window.console&&window.console.log){var formattedMesage=getFormattedMessage();if(window.console.debug&&Level.DEBUG.isGreaterOrEqual(loggingEvent.level)){window.console.debug(formattedMesage);}else if(window.console.info&&Level.INFO.equals(loggingEvent.level)){window.console.info(formattedMesage);}else if(window.console.warn&&Level.WARN.equals(loggingEvent.level)){window.console.warn(formattedMesage);}else if(window.console.error&&loggingEvent.level.isGreaterOrEqual(Level.ERROR)){window.console.error(formattedMesage);}else{window.console.log(formattedMesage);}}};BrowserConsoleAppender.prototype.group=function(name){if(window.console&&window.console.group){window.console.group(name);}};BrowserConsoleAppender.prototype.groupEnd=function(){if(window.console&&window.console.groupEnd){window.console.groupEnd();}};BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender";};log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xmlHttpFactories=[function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}];var getXmlHttp=function(errorHandler){var xmlHttp=null,factory;for(var i=0,len=xmlHttpFactories.length;i<len;i++){factory=xmlHttpFactories[i];try{xmlHttp=factory();getXmlHttp=factory;return xmlHttp;}catch(e){}}
if(errorHandler){errorHandler();}else{handleError("getXmlHttp: unable to obtain XMLHttpRequest object");}};function isHttpRequestSuccessful(xmlHttp){return isUndefined(xmlHttp.status)||xmlHttp.status===0||(xmlHttp.status>=200&&xmlHttp.status<300)||xmlHttp.status==1223;}
function AjaxAppender(url){var appender=this;var isSupported=true;if(!url){handleError("AjaxAppender: URL must be specified in constructor");isSupported=false;}
var timed=this.defaults.timed;var waitForResponse=this.defaults.waitForResponse;var batchSize=this.defaults.batchSize;var timerInterval=this.defaults.timerInterval;var requestSuccessCallback=this.defaults.requestSuccessCallback;var failCallback=this.defaults.failCallback;var postVarName=this.defaults.postVarName;var sendAllOnUnload=this.defaults.sendAllOnUnload;var contentType=this.defaults.contentType;var sessionId=null;var queuedLoggingEvents=[];var queuedRequests=[];var headers=[];var sending=false;var initialized=false;function checkCanConfigure(configOptionName){if(initialized){handleError("AjaxAppender: configuration option '"+
configOptionName+"' may not be set after the appender has been initialized");return false;}
return true;}
this.getSessionId=function(){return sessionId;};this.setSessionId=function(sessionIdParam){sessionId=extractStringFromParam(sessionIdParam,null);this.layout.setCustomField("sessionid",sessionId);};this.setLayout=function(layoutParam){if(checkCanConfigure("layout")){this.layout=layoutParam;if(sessionId!==null){this.setSessionId(sessionId);}}};this.isTimed=function(){return timed;};this.setTimed=function(timedParam){if(checkCanConfigure("timed")){timed=bool(timedParam);}};this.getTimerInterval=function(){return timerInterval;};this.setTimerInterval=function(timerIntervalParam){if(checkCanConfigure("timerInterval")){timerInterval=extractIntFromParam(timerIntervalParam,timerInterval);}};this.isWaitForResponse=function(){return waitForResponse;};this.setWaitForResponse=function(waitForResponseParam){if(checkCanConfigure("waitForResponse")){waitForResponse=bool(waitForResponseParam);}};this.getBatchSize=function(){return batchSize;};this.setBatchSize=function(batchSizeParam){if(checkCanConfigure("batchSize")){batchSize=extractIntFromParam(batchSizeParam,batchSize);}};this.isSendAllOnUnload=function(){return sendAllOnUnload;};this.setSendAllOnUnload=function(sendAllOnUnloadParam){if(checkCanConfigure("sendAllOnUnload")){sendAllOnUnload=extractBooleanFromParam(sendAllOnUnloadParam,sendAllOnUnload);}};this.setRequestSuccessCallback=function(requestSuccessCallbackParam){requestSuccessCallback=extractFunctionFromParam(requestSuccessCallbackParam,requestSuccessCallback);};this.setFailCallback=function(failCallbackParam){failCallback=extractFunctionFromParam(failCallbackParam,failCallback);};this.getPostVarName=function(){return postVarName;};this.setPostVarName=function(postVarNameParam){if(checkCanConfigure("postVarName")){postVarName=extractStringFromParam(postVarNameParam,postVarName);}};this.getHeaders=function(){return headers;};this.addHeader=function(name,value){if(name.toLowerCase()=="content-type"){contentType=value;}else{headers.push({name:name,value:value});}};function sendAll(){if(isSupported&&enabled){sending=true;var currentRequestBatch;if(waitForResponse){if(queuedRequests.length>0){currentRequestBatch=queuedRequests.shift();sendRequest(preparePostData(currentRequestBatch),sendAll);}else{sending=false;if(timed){scheduleSending();}}}else{while((currentRequestBatch=queuedRequests.shift())){sendRequest(preparePostData(currentRequestBatch));}
sending=false;if(timed){scheduleSending();}}}}
this.sendAll=sendAll;function sendAllRemaining(){var sendingAnything=false;if(isSupported&&enabled){var actualBatchSize=appender.getLayout().allowBatching()?batchSize:1;var currentLoggingEvent;var batchedLoggingEvents=[];while((currentLoggingEvent=queuedLoggingEvents.shift())){batchedLoggingEvents.push(currentLoggingEvent);if(queuedLoggingEvents.length>=actualBatchSize){queuedRequests.push(batchedLoggingEvents);batchedLoggingEvents=[];}}
if(batchedLoggingEvents.length>0){queuedRequests.push(batchedLoggingEvents);}
sendingAnything=(queuedRequests.length>0);waitForResponse=false;timed=false;sendAll();}
return sendingAnything;}
this.sendAllRemaining=sendAllRemaining;function preparePostData(batchedLoggingEvents){var formattedMessages=[];var currentLoggingEvent;var postData="";while((currentLoggingEvent=batchedLoggingEvents.shift())){var currentFormattedMessage=appender.getLayout().format(currentLoggingEvent);if(appender.getLayout().ignoresThrowable()){currentFormattedMessage+=currentLoggingEvent.getThrowableStrRep();}
formattedMessages.push(currentFormattedMessage);}
if(batchedLoggingEvents.length==1){postData=formattedMessages.join("");}else{postData=appender.getLayout().batchHeader+
formattedMessages.join(appender.getLayout().batchSeparator)+
appender.getLayout().batchFooter;}
if(contentType==appender.defaults.contentType){postData=appender.getLayout().returnsPostData?postData:urlEncode(postVarName)+"="+urlEncode(postData);if(postData.length>0){postData+="&";}
postData+="layout="+urlEncode(appender.getLayout().toString());}
return postData;}
function scheduleSending(){window.setTimeout(sendAll,timerInterval);}
function xmlHttpErrorHandler(){var msg="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(msg);isSupported=false;if(failCallback){failCallback(msg);}}
function sendRequest(postData,successCallback){try{var xmlHttp=getXmlHttp(xmlHttpErrorHandler);if(isSupported){if(xmlHttp.overrideMimeType){xmlHttp.overrideMimeType(appender.getLayout().getContentType());}
xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){if(isHttpRequestSuccessful(xmlHttp)){if(requestSuccessCallback){requestSuccessCallback(xmlHttp);}
if(successCallback){successCallback(xmlHttp);}}else{var msg="AjaxAppender.append: XMLHttpRequest request to URL "+
url+" returned status code "+xmlHttp.status;handleError(msg);if(failCallback){failCallback(msg);}}
xmlHttp.onreadystatechange=emptyFunction;xmlHttp=null;}};xmlHttp.open("POST",url,true);try{for(var i=0,header;header=headers[i++];){xmlHttp.setRequestHeader(header.name,header.value);}
xmlHttp.setRequestHeader("Content-Type",contentType);}catch(headerEx){var msg="AjaxAppender.append: your browser's XMLHttpRequest implementation"+" does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";handleError(msg);isSupported=false;if(failCallback){failCallback(msg);}
return;}
xmlHttp.send(postData);}}catch(ex){var errMsg="AjaxAppender.append: error sending log message to "+url;handleError(errMsg,ex);isSupported=false;if(failCallback){failCallback(errMsg+". Details: "+getExceptionStringRep(ex));}}}
this.append=function(loggingEvent){if(isSupported){if(!initialized){init();}
queuedLoggingEvents.push(loggingEvent);var actualBatchSize=this.getLayout().allowBatching()?batchSize:1;if(queuedLoggingEvents.length>=actualBatchSize){var currentLoggingEvent;var batchedLoggingEvents=[];while((currentLoggingEvent=queuedLoggingEvents.shift())){batchedLoggingEvents.push(currentLoggingEvent);}
queuedRequests.push(batchedLoggingEvents);if(!timed&&(!waitForResponse||(waitForResponse&&!sending))){sendAll();}}}};function init(){initialized=true;if(sendAllOnUnload){var oldBeforeUnload=window.onbeforeunload;window.onbeforeunload=function(){if(oldBeforeUnload){oldBeforeUnload();}
if(sendAllRemaining()){return"Sending log messages";}};}
if(timed){scheduleSending();}}}
AjaxAppender.prototype=new Appender();AjaxAppender.prototype.defaults={waitForResponse:false,timed:false,timerInterval:1000,batchSize:1,sendAllOnUnload:false,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"};AjaxAppender.prototype.layout=new HttpPostDataLayout();AjaxAppender.prototype.toString=function(){return"AjaxAppender";};log4javascript.AjaxAppender=AjaxAppender;function setCookie(name,value,days,path){var expires;path=path?"; path="+path:"";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();}else{expires="";}
document.cookie=escape(name)+"="+escape(value)+expires+path;}
function getCookie(name){var nameEquals=escape(name)+"=";var ca=document.cookie.split(";");for(var i=0,len=ca.length;i<len;i++){var c=ca[i];while(c.charAt(0)===" "){c=c.substring(1,c.length);}
if(c.indexOf(nameEquals)===0){return unescape(c.substring(nameEquals.length,c.length));}}
return null;}
function getBaseUrl(){var scripts=document.getElementsByTagName("script");for(var i=0,len=scripts.length;i<len;++i){if(scripts[i].src.indexOf("log4javascript")!=-1){var lastSlash=scripts[i].src.lastIndexOf("/");return(lastSlash==-1)?"":scripts[i].src.substr(0,lastSlash+1);}}
return null;}
function isLoaded(win){try{return bool(win.loaded);}catch(ex){return false;}}
var ConsoleAppender;(function(){var getConsoleHtmlLines=function(){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">','<head>','<title>log4javascript</title>','<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />','<!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work -->','<meta http-equiv="X-UA-Compatible" content="IE=7" />','<script type="text/javascript">var isIe = false, isIePre7 = false;</script>','<!--[if IE]><script type="text/javascript">isIe = true</script><![endif]-->','<!--[if lt IE 7]><script type="text/javascript">isIePre7 = true</script><![endif]-->','<script type="text/javascript">','//<![CDATA[','var loggingEnabled=true;var logQueuedEventsTimer=null;var logEntries=[];var logEntriesAndSeparators=[];var logItems=[];var renderDelay=100;var unrenderedLogItemsExist=false;var rootGroup,currentGroup=null;var loaded=false;var currentLogItem=null;var logMainContainer;function copyProperties(obj,props){for(var i in props){obj[i]=props[i];}}','function LogItem(){}','LogItem.prototype={mainContainer:null,wrappedContainer:null,unwrappedContainer:null,group:null,appendToLog:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].appendToLog();}','this.group.update();},doRemove:function(doUpdate,removeFromGroup){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].remove();}','this.unwrappedElementContainer=null;this.wrappedElementContainer=null;this.mainElementContainer=null;}','if(this.group&&removeFromGroup){this.group.removeChild(this,doUpdate);}','if(this===currentLogItem){currentLogItem=null;}},remove:function(doUpdate,removeFromGroup){this.doRemove(doUpdate,removeFromGroup);},render:function(){},accept:function(visitor){visitor.visit(this);},getUnwrappedDomContainer:function(){return this.group.unwrappedElementContainer.contentDiv;},getWrappedDomContainer:function(){return this.group.wrappedElementContainer.contentDiv;},getMainDomContainer:function(){return this.group.mainElementContainer.contentDiv;}};LogItem.serializedItemKeys={LOG_ENTRY:0,GROUP_START:1,GROUP_END:2};function LogItemContainerElement(){}','LogItemContainerElement.prototype={appendToLog:function(){var insertBeforeFirst=(newestAtTop&&this.containerDomNode.hasChildNodes());if(insertBeforeFirst){this.containerDomNode.insertBefore(this.mainDiv,this.containerDomNode.firstChild);}else{this.containerDomNode.appendChild(this.mainDiv);}}};function SeparatorElementContainer(containerDomNode){this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="separator";this.mainDiv.innerHTML="&nbsp;";}','SeparatorElementContainer.prototype=new LogItemContainerElement();SeparatorElementContainer.prototype.remove=function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;};function Separator(){this.rendered=false;}','Separator.prototype=new LogItem();copyProperties(Separator.prototype,{render:function(){var containerDomNode=this.group.contentDiv;if(isIe){this.unwrappedElementContainer=new SeparatorElementContainer(this.getUnwrappedDomContainer());this.wrappedElementContainer=new SeparatorElementContainer(this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new SeparatorElementContainer(this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}','this.content=this.formattedMessage;this.rendered=true;}});function GroupElementContainer(group,containerDomNode,isRoot,isWrapped){this.group=group;this.containerDomNode=containerDomNode;this.isRoot=isRoot;this.isWrapped=isWrapped;this.expandable=false;if(this.isRoot){if(isIe){this.contentDiv=logMainContainer.appendChild(document.createElement("div"));this.contentDiv.id=this.isWrapped?"log_wrapped":"log_unwrapped";}else{this.contentDiv=logMainContainer;}}else{var groupElementContainer=this;this.mainDiv=document.createElement("div");this.mainDiv.className="group";this.headingDiv=this.mainDiv.appendChild(document.createElement("div"));this.headingDiv.className="groupheading";this.expander=this.headingDiv.appendChild(document.createElement("span"));this.expander.className="expander unselectable greyedout";this.expander.unselectable=true;var expanderText=this.group.expanded?"-":"+";this.expanderTextNode=this.expander.appendChild(document.createTextNode(expanderText));this.headingDiv.appendChild(document.createTextNode(" "+this.group.name));this.contentDiv=this.mainDiv.appendChild(document.createElement("div"));var contentCssClass=this.group.expanded?"expanded":"collapsed";this.contentDiv.className="groupcontent "+contentCssClass;this.expander.onclick=function(){if(groupElementContainer.group.expandable){groupElementContainer.group.toggleExpanded();}};}}','GroupElementContainer.prototype=new LogItemContainerElement();copyProperties(GroupElementContainer.prototype,{toggleExpanded:function(){if(!this.isRoot){var oldCssClass,newCssClass,expanderText;if(this.group.expanded){newCssClass="expanded";oldCssClass="collapsed";expanderText="-";}else{newCssClass="collapsed";oldCssClass="expanded";expanderText="+";}','replaceClass(this.contentDiv,newCssClass,oldCssClass);this.expanderTextNode.nodeValue=expanderText;}},remove:function(){if(!this.isRoot){this.headingDiv=null;this.expander.onclick=null;this.expander=null;this.expanderTextNode=null;this.contentDiv=null;this.containerDomNode=null;this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;}},reverseChildren:function(){var node=null;var childDomNodes=[];while((node=this.contentDiv.firstChild)){this.contentDiv.removeChild(node);childDomNodes.push(node);}','while((node=childDomNodes.pop())){this.contentDiv.appendChild(node);}},update:function(){if(!this.isRoot){if(this.group.expandable){removeClass(this.expander,"greyedout");}else{addClass(this.expander,"greyedout");}}},clear:function(){if(this.isRoot){this.contentDiv.innerHTML="";}}});function Group(name,isRoot,initiallyExpanded){this.name=name;this.group=null;this.isRoot=isRoot;this.initiallyExpanded=initiallyExpanded;this.elementContainers=[];this.children=[];this.expanded=initiallyExpanded;this.rendered=false;this.expandable=false;}','Group.prototype=new LogItem();copyProperties(Group.prototype,{addChild:function(logItem){this.children.push(logItem);logItem.group=this;},render:function(){if(isIe){var unwrappedDomContainer,wrappedDomContainer;if(this.isRoot){unwrappedDomContainer=logMainContainer;wrappedDomContainer=logMainContainer;}else{unwrappedDomContainer=this.getUnwrappedDomContainer();wrappedDomContainer=this.getWrappedDomContainer();}','this.unwrappedElementContainer=new GroupElementContainer(this,unwrappedDomContainer,this.isRoot,false);this.wrappedElementContainer=new GroupElementContainer(this,wrappedDomContainer,this.isRoot,true);this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{var mainDomContainer=this.isRoot?logMainContainer:this.getMainDomContainer();this.mainElementContainer=new GroupElementContainer(this,mainDomContainer,this.isRoot,false);this.elementContainers=[this.mainElementContainer];}','this.rendered=true;},toggleExpanded:function(){this.expanded=!this.expanded;for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].toggleExpanded();}},expand:function(){if(!this.expanded){this.toggleExpanded();}},accept:function(visitor){visitor.visitGroup(this);},reverseChildren:function(){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].reverseChildren();}}},update:function(){var previouslyExpandable=this.expandable;this.expandable=(this.children.length!==0);if(this.expandable!==previouslyExpandable){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].update();}}},flatten:function(){var visitor=new GroupFlattener();this.accept(visitor);return visitor.logEntriesAndSeparators;},removeChild:function(child,doUpdate){array_remove(this.children,child);child.group=null;if(doUpdate){this.update();}},remove:function(doUpdate,removeFromGroup){for(var i=0,len=this.children.length;i<len;i++){this.children[i].remove(false,false);}','this.children=[];this.update();if(this===currentGroup){currentGroup=this.group;}','this.doRemove(doUpdate,removeFromGroup);},serialize:function(items){items.push([LogItem.serializedItemKeys.GROUP_START,this.name]);for(var i=0,len=this.children.length;i<len;i++){this.children[i].serialize(items);}','if(this!==currentGroup){items.push([LogItem.serializedItemKeys.GROUP_END]);}},clear:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clear();}}});function LogEntryElementContainer(){}','LogEntryElementContainer.prototype=new LogItemContainerElement();copyProperties(LogEntryElementContainer.prototype,{remove:function(){this.doRemove();},doRemove:function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;this.contentElement=null;this.containerDomNode=null;},setContent:function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=content;}},setSearchMatch:function(isMatch){var oldCssClass=isMatch?"searchnonmatch":"searchmatch";var newCssClass=isMatch?"searchmatch":"searchnonmatch";replaceClass(this.mainDiv,newCssClass,oldCssClass);},clearSearch:function(){removeClass(this.mainDiv,"searchmatch");removeClass(this.mainDiv,"searchnonmatch");}});function LogEntryWrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.mainDiv.className="logentry wrapped "+this.logEntry.level;this.contentElement=this.mainDiv;}','LogEntryWrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryWrappedElementContainer.prototype.setContent=function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=wrappedContent;}};function LogEntryUnwrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry unwrapped "+this.logEntry.level;this.pre=this.mainDiv.appendChild(document.createElement("pre"));this.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.pre.className="unwrapped";this.contentElement=this.pre;}','LogEntryUnwrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryUnwrappedElementContainer.prototype.remove=function(){this.doRemove();this.pre=null;};function LogEntryMainElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry nonielogentry "+this.logEntry.level;this.contentElement=this.mainDiv.appendChild(document.createElement("span"));this.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));}','LogEntryMainElementContainer.prototype=new LogEntryElementContainer();function LogEntry(level,formattedMessage){this.level=level;this.formattedMessage=formattedMessage;this.rendered=false;}','LogEntry.prototype=new LogItem();copyProperties(LogEntry.prototype,{render:function(){var logEntry=this;var containerDomNode=this.group.contentDiv;if(isIe){this.formattedMessage=this.formattedMessage.replace(/\\r\\n/g,"\\r");this.unwrappedElementContainer=new LogEntryUnwrappedElementContainer(this,this.getUnwrappedDomContainer());this.wrappedElementContainer=new LogEntryWrappedElementContainer(this,this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new LogEntryMainElementContainer(this,this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}','this.content=this.formattedMessage;this.rendered=true;},setContent:function(content,wrappedContent){if(content!=this.content){if(isIe&&(content!==this.formattedMessage)){content=content.replace(/\\r\\n/g,"\\r");}','for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setContent(content,wrappedContent);}','this.content=content;}},getSearchMatches:function(){var matches=[];var i,len;if(isIe){var unwrappedEls=getElementsByClass(this.unwrappedElementContainer.mainDiv,"searchterm","span");var wrappedEls=getElementsByClass(this.wrappedElementContainer.mainDiv,"searchterm","span");for(i=0,len=unwrappedEls.length;i<len;i++){matches[i]=new Match(this.level,null,unwrappedEls[i],wrappedEls[i]);}}else{var els=getElementsByClass(this.mainElementContainer.mainDiv,"searchterm","span");for(i=0,len=els.length;i<len;i++){matches[i]=new Match(this.level,els[i]);}}','return matches;},setSearchMatch:function(isMatch){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setSearchMatch(isMatch);}},clearSearch:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clearSearch();}},accept:function(visitor){visitor.visitLogEntry(this);},serialize:function(items){items.push([LogItem.serializedItemKeys.LOG_ENTRY,this.level,this.formattedMessage]);}});function LogItemVisitor(){}','LogItemVisitor.prototype={visit:function(logItem){},visitParent:function(logItem){if(logItem.group){logItem.group.accept(this);}},visitChildren:function(logItem){for(var i=0,len=logItem.children.length;i<len;i++){logItem.children[i].accept(this);}},visitLogEntry:function(logEntry){this.visit(logEntry);},visitSeparator:function(separator){this.visit(separator);},visitGroup:function(group){this.visit(group);}};function GroupFlattener(){this.logEntriesAndSeparators=[];}','GroupFlattener.prototype=new LogItemVisitor();GroupFlattener.prototype.visitGroup=function(group){this.visitChildren(group);};GroupFlattener.prototype.visitLogEntry=function(logEntry){this.logEntriesAndSeparators.push(logEntry);};GroupFlattener.prototype.visitSeparator=function(separator){this.logEntriesAndSeparators.push(separator);};window.onload=function(){if(location.search){var queryBits=unescape(location.search).substr(1).split("&"),nameValueBits;for(var i=0,len=queryBits.length;i<len;i++){nameValueBits=queryBits[i].split("=");if(nameValueBits[0]=="log4javascript_domain"){document.domain=nameValueBits[1];break;}}}','logMainContainer=$("log");if(isIePre7){addClass(logMainContainer,"oldIe");}','rootGroup=new Group("root",true);rootGroup.render();currentGroup=rootGroup;setCommandInputWidth();setLogContainerHeight();toggleLoggingEnabled();toggleSearchEnabled();toggleSearchFilter();toggleSearchHighlight();applyFilters();checkAllLevels();toggleWrap();toggleNewestAtTop();toggleScrollToLatest();renderQueuedLogItems();loaded=true;$("command").value="";$("command").autocomplete="off";$("command").onkeydown=function(evt){evt=getEvent(evt);if(evt.keyCode==10||evt.keyCode==13){evalCommandLine();stopPropagation(evt);}else if(evt.keyCode==27){this.value="";this.focus();}else if(evt.keyCode==38&&commandHistory.length>0){currentCommandIndex=Math.max(0,currentCommandIndex-1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}else if(evt.keyCode==40&&commandHistory.length>0){currentCommandIndex=Math.min(commandHistory.length-1,currentCommandIndex+1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}};$("command").onkeypress=function(evt){evt=getEvent(evt);if(evt.keyCode==38&&commandHistory.length>0&&evt.preventDefault){evt.preventDefault();}};$("command").onkeyup=function(evt){evt=getEvent(evt);if(evt.keyCode==27&&evt.preventDefault){evt.preventDefault();this.focus();}};document.onkeydown=function keyEventHandler(evt){evt=getEvent(evt);switch(evt.keyCode){case 69:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){evalLastCommand();cancelKeyEvent(evt);return false;}','break;case 75:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusSearch();cancelKeyEvent(evt);return false;}','break;case 40:case 76:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusCommandLine();cancelKeyEvent(evt);return false;}','break;}};setTimeout(setLogContainerHeight,20);setShowCommandLine(showCommandLine);doSearch();};window.onunload=function(){if(mainWindowExists()){appender.unload();}','appender=null;};function toggleLoggingEnabled(){setLoggingEnabled($("enableLogging").checked);}','function setLoggingEnabled(enable){loggingEnabled=enable;}','var appender=null;function setAppender(appenderParam){appender=appenderParam;}','function setShowCloseButton(showCloseButton){$("closeButton").style.display=showCloseButton?"inline":"none";}','function setShowHideButton(showHideButton){$("hideButton").style.display=showHideButton?"inline":"none";}','var newestAtTop=false;function LogItemContentReverser(){}','LogItemContentReverser.prototype=new LogItemVisitor();LogItemContentReverser.prototype.visitGroup=function(group){group.reverseChildren();this.visitChildren(group);};function setNewestAtTop(isNewestAtTop){var oldNewestAtTop=newestAtTop;var i,iLen,j,jLen;newestAtTop=Boolean(isNewestAtTop);if(oldNewestAtTop!=newestAtTop){var visitor=new LogItemContentReverser();rootGroup.accept(visitor);if(currentSearch){var currentMatch=currentSearch.matches[currentMatchIndex];var matchIndex=0;var matches=[];var actOnLogEntry=function(logEntry){var logEntryMatches=logEntry.getSearchMatches();for(j=0,jLen=logEntryMatches.length;j<jLen;j++){matches[matchIndex]=logEntryMatches[j];if(currentMatch&&logEntryMatches[j].equals(currentMatch)){currentMatchIndex=matchIndex;}','matchIndex++;}};if(newestAtTop){for(i=logEntries.length-1;i>=0;i--){actOnLogEntry(logEntries[i]);}}else{for(i=0,iLen=logEntries.length;i<iLen;i++){actOnLogEntry(logEntries[i]);}}','currentSearch.matches=matches;if(currentMatch){currentMatch.setCurrent();}}else if(scrollToLatest){doScrollToLatest();}}','$("newestAtTop").checked=isNewestAtTop;}','function toggleNewestAtTop(){var isNewestAtTop=$("newestAtTop").checked;setNewestAtTop(isNewestAtTop);}','var scrollToLatest=true;function setScrollToLatest(isScrollToLatest){scrollToLatest=isScrollToLatest;if(scrollToLatest){doScrollToLatest();}','$("scrollToLatest").checked=isScrollToLatest;}','function toggleScrollToLatest(){var isScrollToLatest=$("scrollToLatest").checked;setScrollToLatest(isScrollToLatest);}','function doScrollToLatest(){var l=logMainContainer;if(typeof l.scrollTop!="undefined"){if(newestAtTop){l.scrollTop=0;}else{var latestLogEntry=l.lastChild;if(latestLogEntry){l.scrollTop=l.scrollHeight;}}}}','var closeIfOpenerCloses=true;function setCloseIfOpenerCloses(isCloseIfOpenerCloses){closeIfOpenerCloses=isCloseIfOpenerCloses;}','var maxMessages=null;function setMaxMessages(max){maxMessages=max;pruneLogEntries();}','var showCommandLine=false;function setShowCommandLine(isShowCommandLine){showCommandLine=isShowCommandLine;if(loaded){$("commandLine").style.display=showCommandLine?"block":"none";setCommandInputWidth();setLogContainerHeight();}}','function focusCommandLine(){if(loaded){$("command").focus();}}','function focusSearch(){if(loaded){$("searchBox").focus();}}','function getLogItems(){var items=[];for(var i=0,len=logItems.length;i<len;i++){logItems[i].serialize(items);}','return items;}','function setLogItems(items){var loggingReallyEnabled=loggingEnabled;loggingEnabled=true;for(var i=0,len=items.length;i<len;i++){switch(items[i][0]){case LogItem.serializedItemKeys.LOG_ENTRY:log(items[i][1],items[i][2]);break;case LogItem.serializedItemKeys.GROUP_START:group(items[i][1]);break;case LogItem.serializedItemKeys.GROUP_END:groupEnd();break;}}','loggingEnabled=loggingReallyEnabled;}','function log(logLevel,formattedMessage){if(loggingEnabled){var logEntry=new LogEntry(logLevel,formattedMessage);logEntries.push(logEntry);logEntriesAndSeparators.push(logEntry);logItems.push(logEntry);currentGroup.addChild(logEntry);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}','logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}','function renderQueuedLogItems(){logQueuedEventsTimer=null;var pruned=pruneLogEntries();var initiallyHasMatches=currentSearch?currentSearch.hasMatches():false;for(var i=0,len=logItems.length;i<len;i++){if(!logItems[i].rendered){logItems[i].render();logItems[i].appendToLog();if(currentSearch&&(logItems[i]instanceof LogEntry)){currentSearch.applyTo(logItems[i]);}}}','if(currentSearch){if(pruned){if(currentSearch.hasVisibleMatches()){if(currentMatchIndex===null){setCurrentMatchIndex(0);}','displayMatches();}else{displayNoMatches();}}else if(!initiallyHasMatches&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}}','if(scrollToLatest){doScrollToLatest();}','unrenderedLogItemsExist=false;}','function pruneLogEntries(){if((maxMessages!==null)&&(logEntriesAndSeparators.length>maxMessages)){var numberToDelete=logEntriesAndSeparators.length-maxMessages;var prunedLogEntries=logEntriesAndSeparators.slice(0,numberToDelete);if(currentSearch){currentSearch.removeMatches(prunedLogEntries);}','var group;for(var i=0;i<numberToDelete;i++){group=logEntriesAndSeparators[i].group;array_remove(logItems,logEntriesAndSeparators[i]);array_remove(logEntries,logEntriesAndSeparators[i]);logEntriesAndSeparators[i].remove(true,true);if(group.children.length===0&&group!==currentGroup&&group!==rootGroup){array_remove(logItems,group);group.remove(true,true);}}','logEntriesAndSeparators=array_removeFromStart(logEntriesAndSeparators,numberToDelete);return true;}','return false;}','function group(name,startExpanded){if(loggingEnabled){initiallyExpanded=(typeof startExpanded==="undefined")?true:Boolean(startExpanded);var newGroup=new Group(name,false,initiallyExpanded);currentGroup.addChild(newGroup);currentGroup=newGroup;logItems.push(newGroup);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}','logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}','function groupEnd(){currentGroup=(currentGroup===rootGroup)?rootGroup:currentGroup.group;}','function mainPageReloaded(){currentGroup=rootGroup;var separator=new Separator();logEntriesAndSeparators.push(separator);logItems.push(separator);currentGroup.addChild(separator);}','function closeWindow(){if(appender&&mainWindowExists()){appender.close(true);}else{window.close();}}','function hide(){if(appender&&mainWindowExists()){appender.hide();}}','var mainWindow=window;var windowId="log4javascriptConsoleWindow_"+new Date().getTime()+"_"+(""+Math.random()).substr(2);function setMainWindow(win){mainWindow=win;mainWindow[windowId]=window;if(opener&&closeIfOpenerCloses){pollOpener();}}','function pollOpener(){if(closeIfOpenerCloses){if(mainWindowExists()){setTimeout(pollOpener,500);}else{closeWindow();}}}','function mainWindowExists(){try{return(mainWindow&&!mainWindow.closed&&mainWindow[windowId]==window);}catch(ex){}','return false;}','var logLevels=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];function getCheckBox(logLevel){return $("switch_"+logLevel);}','function getIeWrappedLogContainer(){return $("log_wrapped");}','function getIeUnwrappedLogContainer(){return $("log_unwrapped");}','function applyFilters(){for(var i=0;i<logLevels.length;i++){if(getCheckBox(logLevels[i]).checked){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}','updateSearchFromFilters();}','function toggleAllLevels(){var turnOn=$("switch_ALL").checked;for(var i=0;i<logLevels.length;i++){getCheckBox(logLevels[i]).checked=turnOn;if(turnOn){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}}','function checkAllLevels(){for(var i=0;i<logLevels.length;i++){if(!getCheckBox(logLevels[i]).checked){getCheckBox("ALL").checked=false;return;}}','getCheckBox("ALL").checked=true;}','function clearLog(){rootGroup.clear();currentGroup=rootGroup;logEntries=[];logItems=[];logEntriesAndSeparators=[];doSearch();}','function toggleWrap(){var enable=$("wrap").checked;if(enable){addClass(logMainContainer,"wrap");}else{removeClass(logMainContainer,"wrap");}','refreshCurrentMatch();}','var searchTimer=null;function scheduleSearch(){try{clearTimeout(searchTimer);}catch(ex){}','searchTimer=setTimeout(doSearch,500);}','function Search(searchTerm,isRegex,searchRegex,isCaseSensitive){this.searchTerm=searchTerm;this.isRegex=isRegex;this.searchRegex=searchRegex;this.isCaseSensitive=isCaseSensitive;this.matches=[];}','Search.prototype={hasMatches:function(){return this.matches.length>0;},hasVisibleMatches:function(){if(this.hasMatches()){for(var i=0;i<this.matches.length;i++){if(this.matches[i].isVisible()){return true;}}}','return false;},match:function(logEntry){var entryText=String(logEntry.formattedMessage);var matchesSearch=false;if(this.isRegex){matchesSearch=this.searchRegex.test(entryText);}else if(this.isCaseSensitive){matchesSearch=(entryText.indexOf(this.searchTerm)>-1);}else{matchesSearch=(entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1);}','return matchesSearch;},getNextVisibleMatchIndex:function(){for(var i=currentMatchIndex+1;i<this.matches.length;i++){if(this.matches[i].isVisible()){return i;}}','for(i=0;i<=currentMatchIndex;i++){if(this.matches[i].isVisible()){return i;}}','return-1;},getPreviousVisibleMatchIndex:function(){for(var i=currentMatchIndex-1;i>=0;i--){if(this.matches[i].isVisible()){return i;}}','for(var i=this.matches.length-1;i>=currentMatchIndex;i--){if(this.matches[i].isVisible()){return i;}}','return-1;},applyTo:function(logEntry){var doesMatch=this.match(logEntry);if(doesMatch){logEntry.group.expand();logEntry.setSearchMatch(true);var logEntryContent;var wrappedLogEntryContent;var searchTermReplacementStartTag="<span class=\\\"searchterm\\\">";var searchTermReplacementEndTag="<"+"/span>";var preTagName=isIe?"pre":"span";var preStartTag="<"+preTagName+" class=\\\"pre\\\">";var preEndTag="<"+"/"+preTagName+">";var startIndex=0;var searchIndex,matchedText,textBeforeMatch;if(this.isRegex){var flags=this.isCaseSensitive?"g":"gi";var capturingRegex=new RegExp("("+this.searchRegex.source+")",flags);var rnd=(""+Math.random()).substr(2);var startToken="%%s"+rnd+"%%";var endToken="%%e"+rnd+"%%";logEntryContent=logEntry.formattedMessage.replace(capturingRegex,startToken+"$1"+endToken);logEntryContent=escapeHtml(logEntryContent);var result;var searchString=logEntryContent;logEntryContent="";wrappedLogEntryContent="";while((searchIndex=searchString.indexOf(startToken,startIndex))>-1){var endTokenIndex=searchString.indexOf(endToken,searchIndex);matchedText=searchString.substring(searchIndex+startToken.length,endTokenIndex);textBeforeMatch=searchString.substring(startIndex,searchIndex);logEntryContent+=preStartTag+textBeforeMatch+preEndTag;logEntryContent+=searchTermReplacementStartTag+preStartTag+matchedText+','preEndTag+searchTermReplacementEndTag;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+','matchedText+searchTermReplacementEndTag;}','startIndex=endTokenIndex+endToken.length;}','logEntryContent+=preStartTag+searchString.substr(startIndex)+preEndTag;if(isIe){wrappedLogEntryContent+=searchString.substr(startIndex);}}else{logEntryContent="";wrappedLogEntryContent="";var searchTermReplacementLength=searchTermReplacementStartTag.length+','this.searchTerm.length+searchTermReplacementEndTag.length;var searchTermLength=this.searchTerm.length;var searchTermLowerCase=this.searchTerm.toLowerCase();var logTextLowerCase=logEntry.formattedMessage.toLowerCase();while((searchIndex=logTextLowerCase.indexOf(searchTermLowerCase,startIndex))>-1){matchedText=escapeHtml(logEntry.formattedMessage.substr(searchIndex,this.searchTerm.length));textBeforeMatch=escapeHtml(logEntry.formattedMessage.substring(startIndex,searchIndex));var searchTermReplacement=searchTermReplacementStartTag+','preStartTag+matchedText+preEndTag+searchTermReplacementEndTag;logEntryContent+=preStartTag+textBeforeMatch+preEndTag+searchTermReplacement;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+','matchedText+searchTermReplacementEndTag;}','startIndex=searchIndex+searchTermLength;}','var textAfterLastMatch=escapeHtml(logEntry.formattedMessage.substr(startIndex));logEntryContent+=preStartTag+textAfterLastMatch+preEndTag;if(isIe){wrappedLogEntryContent+=textAfterLastMatch;}}','logEntry.setContent(logEntryContent,wrappedLogEntryContent);var logEntryMatches=logEntry.getSearchMatches();this.matches=this.matches.concat(logEntryMatches);}else{logEntry.setSearchMatch(false);logEntry.setContent(logEntry.formattedMessage,logEntry.formattedMessage);}','return doesMatch;},removeMatches:function(logEntries){var matchesToRemoveCount=0;var currentMatchRemoved=false;var matchesToRemove=[];var i,iLen,j,jLen;for(i=0,iLen=this.matches.length;i<iLen;i++){for(j=0,jLen=logEntries.length;j<jLen;j++){if(this.matches[i].belongsTo(logEntries[j])){matchesToRemove.push(this.matches[i]);if(i===currentMatchIndex){currentMatchRemoved=true;}}}}','var newMatch=currentMatchRemoved?null:this.matches[currentMatchIndex];if(currentMatchRemoved){for(i=currentMatchIndex,iLen=this.matches.length;i<iLen;i++){if(this.matches[i].isVisible()&&!array_contains(matchesToRemove,this.matches[i])){newMatch=this.matches[i];break;}}}','for(i=0,iLen=matchesToRemove.length;i<iLen;i++){array_remove(this.matches,matchesToRemove[i]);matchesToRemove[i].remove();}','if(this.hasVisibleMatches()){if(newMatch===null){setCurrentMatchIndex(0);}else{var newMatchIndex=0;for(i=0,iLen=this.matches.length;i<iLen;i++){if(newMatch===this.matches[i]){newMatchIndex=i;break;}}','setCurrentMatchIndex(newMatchIndex);}}else{currentMatchIndex=null;displayNoMatches();}}};function getPageOffsetTop(el,container){var currentEl=el;var y=0;while(currentEl&&currentEl!=container){y+=currentEl.offsetTop;currentEl=currentEl.offsetParent;}','return y;}','function scrollIntoView(el){var logContainer=logMainContainer;if(!$("wrap").checked){var logContainerLeft=logContainer.scrollLeft;var logContainerRight=logContainerLeft+logContainer.offsetWidth;var elLeft=el.offsetLeft;var elRight=elLeft+el.offsetWidth;if(elLeft<logContainerLeft||elRight>logContainerRight){logContainer.scrollLeft=elLeft-(logContainer.offsetWidth-el.offsetWidth)/2;}}','var logContainerTop=logContainer.scrollTop;var logContainerBottom=logContainerTop+logContainer.offsetHeight;var elTop=getPageOffsetTop(el)-getToolBarsHeight();var elBottom=elTop+el.offsetHeight;if(elTop<logContainerTop||elBottom>logContainerBottom){logContainer.scrollTop=elTop-(logContainer.offsetHeight-el.offsetHeight)/2;}}','function Match(logEntryLevel,spanInMainDiv,spanInUnwrappedPre,spanInWrappedDiv){this.logEntryLevel=logEntryLevel;this.spanInMainDiv=spanInMainDiv;if(isIe){this.spanInUnwrappedPre=spanInUnwrappedPre;this.spanInWrappedDiv=spanInWrappedDiv;}','this.mainSpan=isIe?spanInUnwrappedPre:spanInMainDiv;}','Match.prototype={equals:function(match){return this.mainSpan===match.mainSpan;},setCurrent:function(){if(isIe){addClass(this.spanInUnwrappedPre,"currentmatch");addClass(this.spanInWrappedDiv,"currentmatch");var elementToScroll=$("wrap").checked?this.spanInWrappedDiv:this.spanInUnwrappedPre;scrollIntoView(elementToScroll);}else{addClass(this.spanInMainDiv,"currentmatch");scrollIntoView(this.spanInMainDiv);}},belongsTo:function(logEntry){if(isIe){return isDescendant(this.spanInUnwrappedPre,logEntry.unwrappedPre);}else{return isDescendant(this.spanInMainDiv,logEntry.mainDiv);}},setNotCurrent:function(){if(isIe){removeClass(this.spanInUnwrappedPre,"currentmatch");removeClass(this.spanInWrappedDiv,"currentmatch");}else{removeClass(this.spanInMainDiv,"currentmatch");}},isOrphan:function(){return isOrphan(this.mainSpan);},isVisible:function(){return getCheckBox(this.logEntryLevel).checked;},remove:function(){if(isIe){this.spanInUnwrappedPre=null;this.spanInWrappedDiv=null;}else{this.spanInMainDiv=null;}}};var currentSearch=null;var currentMatchIndex=null;function doSearch(){var searchBox=$("searchBox");var searchTerm=searchBox.value;var isRegex=$("searchRegex").checked;var isCaseSensitive=$("searchCaseSensitive").checked;var i;if(searchTerm===""){$("searchReset").disabled=true;$("searchNav").style.display="none";removeClass(document.body,"searching");removeClass(searchBox,"hasmatches");removeClass(searchBox,"nomatches");for(i=0;i<logEntries.length;i++){logEntries[i].clearSearch();logEntries[i].setContent(logEntries[i].formattedMessage,logEntries[i].formattedMessage);}','currentSearch=null;setLogContainerHeight();}else{$("searchReset").disabled=false;$("searchNav").style.display="block";var searchRegex;var regexValid;if(isRegex){try{searchRegex=isCaseSensitive?new RegExp(searchTerm,"g"):new RegExp(searchTerm,"gi");regexValid=true;replaceClass(searchBox,"validregex","invalidregex");searchBox.title="Valid regex";}catch(ex){regexValid=false;replaceClass(searchBox,"invalidregex","validregex");searchBox.title="Invalid regex: "+(ex.message?ex.message:(ex.description?ex.description:"unknown error"));return;}}else{searchBox.title="";removeClass(searchBox,"validregex");removeClass(searchBox,"invalidregex");}','addClass(document.body,"searching");currentSearch=new Search(searchTerm,isRegex,searchRegex,isCaseSensitive);for(i=0;i<logEntries.length;i++){currentSearch.applyTo(logEntries[i]);}','setLogContainerHeight();if(currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}else{displayNoMatches();}}}','function updateSearchFromFilters(){if(currentSearch){if(currentSearch.hasMatches()){if(currentMatchIndex===null){currentMatchIndex=0;}','var currentMatch=currentSearch.matches[currentMatchIndex];if(currentMatch.isVisible()){displayMatches();setCurrentMatchIndex(currentMatchIndex);}else{currentMatch.setNotCurrent();var nextVisibleMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextVisibleMatchIndex>-1){setCurrentMatchIndex(nextVisibleMatchIndex);displayMatches();}else{displayNoMatches();}}}else{displayNoMatches();}}}','function refreshCurrentMatch(){if(currentSearch&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(currentMatchIndex);}}','function displayMatches(){replaceClass($("searchBox"),"hasmatches","nomatches");$("searchBox").title=""+currentSearch.matches.length+" matches found";$("searchNav").style.display="block";setLogContainerHeight();}','function displayNoMatches(){replaceClass($("searchBox"),"nomatches","hasmatches");$("searchBox").title="No matches found";$("searchNav").style.display="none";setLogContainerHeight();}','function toggleSearchEnabled(enable){enable=(typeof enable=="undefined")?!$("searchDisable").checked:enable;$("searchBox").disabled=!enable;$("searchReset").disabled=!enable;$("searchRegex").disabled=!enable;$("searchNext").disabled=!enable;$("searchPrevious").disabled=!enable;$("searchCaseSensitive").disabled=!enable;$("searchNav").style.display=(enable&&($("searchBox").value!=="")&&currentSearch&&currentSearch.hasVisibleMatches())?"block":"none";if(enable){removeClass($("search"),"greyedout");addClass(document.body,"searching");if($("searchHighlight").checked){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}','if($("searchFilter").checked){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}','$("searchDisable").checked=!enable;}else{addClass($("search"),"greyedout");removeClass(document.body,"searching");removeClass(logMainContainer,"searchhighlight");removeClass(logMainContainer,"searchfilter");}','setLogContainerHeight();}','function toggleSearchFilter(){var enable=$("searchFilter").checked;if(enable){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}','refreshCurrentMatch();}','function toggleSearchHighlight(){var enable=$("searchHighlight").checked;if(enable){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}}','function clearSearch(){$("searchBox").value="";doSearch();}','function searchNext(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var nextMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextMatchIndex>currentMatchIndex||confirm("Reached the end of the page. Start from the top?")){setCurrentMatchIndex(nextMatchIndex);}}}','function searchPrevious(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var previousMatchIndex=currentSearch.getPreviousVisibleMatchIndex();if(previousMatchIndex<currentMatchIndex||confirm("Reached the start of the page. Continue from the bottom?")){setCurrentMatchIndex(previousMatchIndex);}}}','function setCurrentMatchIndex(index){currentMatchIndex=index;currentSearch.matches[currentMatchIndex].setCurrent();}','function addClass(el,cssClass){if(!hasClass(el,cssClass)){if(el.className){el.className+=" "+cssClass;}else{el.className=cssClass;}}}','function hasClass(el,cssClass){if(el.className){var classNames=el.className.split(" ");return array_contains(classNames,cssClass);}','return false;}','function removeClass(el,cssClass){if(hasClass(el,cssClass)){var existingClasses=el.className.split(" ");var newClasses=[];for(var i=0,len=existingClasses.length;i<len;i++){if(existingClasses[i]!=cssClass){newClasses[newClasses.length]=existingClasses[i];}}','el.className=newClasses.join(" ");}}','function replaceClass(el,newCssClass,oldCssClass){removeClass(el,oldCssClass);addClass(el,newCssClass);}','function getElementsByClass(el,cssClass,tagName){var elements=el.getElementsByTagName(tagName);var matches=[];for(var i=0,len=elements.length;i<len;i++){if(hasClass(elements[i],cssClass)){matches.push(elements[i]);}}','return matches;}','function $(id){return document.getElementById(id);}','function isDescendant(node,ancestorNode){while(node!=null){if(node===ancestorNode){return true;}','node=node.parentNode;}','return false;}','function isOrphan(node){var currentNode=node;while(currentNode){if(currentNode==document.body){return false;}','currentNode=currentNode.parentNode;}','return true;}','function escapeHtml(str){return str.replace(/&/g,"&amp;").replace(/[<]/g,"&lt;").replace(/>/g,"&gt;");}','function getWindowWidth(){if(window.innerWidth){return window.innerWidth;}else if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth;}else if(document.body){return document.body.clientWidth;}','return 0;}','function getWindowHeight(){if(window.innerHeight){return window.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight;}else if(document.body){return document.body.clientHeight;}','return 0;}','function getToolBarsHeight(){return $("switches").offsetHeight;}','function getChromeHeight(){var height=getToolBarsHeight();if(showCommandLine){height+=$("commandLine").offsetHeight;}','return height;}','function setLogContainerHeight(){if(logMainContainer){var windowHeight=getWindowHeight();$("body").style.height=getWindowHeight()+"px";logMainContainer.style.height=""+','Math.max(0,windowHeight-getChromeHeight())+"px";}}','function setCommandInputWidth(){if(showCommandLine){$("command").style.width=""+Math.max(0,$("commandLineContainer").offsetWidth-','($("evaluateButton").offsetWidth+13))+"px";}}','window.onresize=function(){setCommandInputWidth();setLogContainerHeight();};if(!Array.prototype.push){Array.prototype.push=function(){for(var i=0,len=arguments.length;i<len;i++){this[this.length]=arguments[i];}','return this.length;};}','if(!Array.prototype.pop){Array.prototype.pop=function(){if(this.length>0){var val=this[this.length-1];this.length=this.length-1;return val;}};}','if(!Array.prototype.shift){Array.prototype.shift=function(){if(this.length>0){var firstItem=this[0];for(var i=0,len=this.length-1;i<len;i++){this[i]=this[i+1];}','this.length=this.length-1;return firstItem;}};}','if(!Array.prototype.splice){Array.prototype.splice=function(startIndex,deleteCount){var itemsAfterDeleted=this.slice(startIndex+deleteCount);var itemsDeleted=this.slice(startIndex,startIndex+deleteCount);this.length=startIndex;var argumentsArray=[];for(var i=0,len=arguments.length;i<len;i++){argumentsArray[i]=arguments[i];}','var itemsToAppend=(argumentsArray.length>2)?itemsAfterDeleted=argumentsArray.slice(2).concat(itemsAfterDeleted):itemsAfterDeleted;for(i=0,len=itemsToAppend.length;i<len;i++){this.push(itemsToAppend[i]);}','return itemsDeleted;};}','function array_remove(arr,val){var index=-1;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===val){index=i;break;}}','if(index>=0){arr.splice(index,1);return index;}else{return false;}}','function array_removeFromStart(array,numberToRemove){if(Array.prototype.splice){array.splice(0,numberToRemove);}else{for(var i=numberToRemove,len=array.length;i<len;i++){array[i-numberToRemove]=array[i];}','array.length=array.length-numberToRemove;}','return array;}','function array_contains(arr,val){for(var i=0,len=arr.length;i<len;i++){if(arr[i]==val){return true;}}','return false;}','function getErrorMessage(ex){if(ex.message){return ex.message;}else if(ex.description){return ex.description;}','return""+ex;}','function moveCaretToEnd(input){if(input.setSelectionRange){input.focus();var length=input.value.length;input.setSelectionRange(length,length);}else if(input.createTextRange){var range=input.createTextRange();range.collapse(false);range.select();}','input.focus();}','function stopPropagation(evt){if(evt.stopPropagation){evt.stopPropagation();}else if(typeof evt.cancelBubble!="undefined"){evt.cancelBubble=true;}}','function getEvent(evt){return evt?evt:event;}','function getTarget(evt){return evt.target?evt.target:evt.srcElement;}','function getRelatedTarget(evt){if(evt.relatedTarget){return evt.relatedTarget;}else if(evt.srcElement){switch(evt.type){case"mouseover":return evt.fromElement;case"mouseout":return evt.toElement;default:return evt.srcElement;}}}','function cancelKeyEvent(evt){evt.returnValue=false;stopPropagation(evt);}','function evalCommandLine(){var expr=$("command").value;evalCommand(expr);$("command").value="";}','function evalLastCommand(){if(lastCommand!=null){evalCommand(lastCommand);}}','var lastCommand=null;var commandHistory=[];var currentCommandIndex=0;function evalCommand(expr){if(appender){appender.evalCommandAndAppend(expr);}else{var prefix=">>> "+expr+"\\r\\n";try{log("INFO",prefix+eval(expr));}catch(ex){log("ERROR",prefix+"Error: "+getErrorMessage(ex));}}','if(expr!=commandHistory[commandHistory.length-1]){commandHistory.push(expr);if(appender){appender.storeCommandHistory(commandHistory);}}','currentCommandIndex=(expr==commandHistory[currentCommandIndex])?currentCommandIndex+1:commandHistory.length;lastCommand=expr;}','//]]>','</script>','<style type="text/css">','body{background-color:white;color:black;padding:0;margin:0;font-family:tahoma,verdana,arial,helvetica,sans-serif;overflow:hidden}div#switchesContainer input{margin-bottom:0}div.toolbar{border-top:solid #ffffff 1px;border-bottom:solid #aca899 1px;background-color:#f1efe7;padding:3px 5px;font-size:68.75%}div.toolbar,div#search input{font-family:tahoma,verdana,arial,helvetica,sans-serif}div.toolbar input.button{padding:0 5px;font-size:100%}div.toolbar input.hidden{display:none}div#switches input#clearButton{margin-left:20px}div#levels label{font-weight:bold}div#levels label,div#options label{margin-right:5px}div#levels label#wrapLabel{font-weight:normal}div#search label{margin-right:10px}div#search label.searchboxlabel{margin-right:0}div#search input{font-size:100%}div#search input.validregex{color:green}div#search input.invalidregex{color:red}div#search input.nomatches{color:white;background-color:#ff6666}div#search input.nomatches{color:white;background-color:#ff6666}div#searchNav{display:none}div#commandLine{display:none}div#commandLine input#command{font-size:100%;font-family:Courier New,Courier}div#commandLine input#evaluateButton{}*.greyedout{color:gray !important;border-color:gray !important}*.greyedout *.alwaysenabled{color:black}*.unselectable{-khtml-user-select:none;-moz-user-select:none;user-select:none}div#log{font-family:Courier New,Courier;font-size:75%;width:100%;overflow:auto;clear:both;position:relative}div.group{border-color:#cccccc;border-style:solid;border-width:1px 0 1px 1px;overflow:visible}div.oldIe div.group,div.oldIe div.group *,div.oldIe *.logentry{height:1%}div.group div.groupheading span.expander{border:solid black 1px;font-family:Courier New,Courier;font-size:0.833em;background-color:#eeeeee;position:relative;top:-1px;color:black;padding:0 2px;cursor:pointer;cursor:hand;height:1%}div.group div.groupcontent{margin-left:10px;padding-bottom:2px;overflow:visible}div.group div.expanded{display:block}div.group div.collapsed{display:none}*.logentry{overflow:visible;display:none;white-space:pre}span.pre{white-space:pre}pre.unwrapped{display:inline !important}pre.unwrapped pre.pre,div.wrapped pre.pre{display:inline}div.wrapped pre.pre{white-space:normal}div.wrapped{display:none}body.searching *.logentry span.currentmatch{color:white !important;background-color:green !important}body.searching div.searchhighlight *.logentry span.searchterm{color:black;background-color:yellow}div.wrap *.logentry{white-space:normal !important;border-width:0 0 1px 0;border-color:#dddddd;border-style:dotted}div.wrap #log_wrapped,#log_unwrapped{display:block}div.wrap #log_unwrapped,#log_wrapped{display:none}div.wrap *.logentry span.pre{overflow:visible;white-space:normal}div.wrap *.logentry pre.unwrapped{display:none}div.wrap *.logentry span.wrapped{display:inline}div.searchfilter *.searchnonmatch{display:none !important}div#log *.TRACE,label#label_TRACE{color:#666666}div#log *.DEBUG,label#label_DEBUG{color:green}div#log *.INFO,label#label_INFO{color:#000099}div#log *.WARN,label#label_WARN{color:#999900}div#log *.ERROR,label#label_ERROR{color:red}div#log *.FATAL,label#label_FATAL{color:#660066}div.TRACE#log *.TRACE,div.DEBUG#log *.DEBUG,div.INFO#log *.INFO,div.WARN#log *.WARN,div.ERROR#log *.ERROR,div.FATAL#log *.FATAL{display:block}div#log div.separator{background-color:#cccccc;margin:5px 0;line-height:1px}','</style>','</head>','<body id="body">','<div id="switchesContainer">','<div id="switches">','<div id="levels" class="toolbar">','Filters:','<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>','</div>','<div id="search" class="toolbar">','<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','<div id="searchNav">','<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>','</div>','</div>','<div id="options" class="toolbar">','Options:','<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />','</div>','</div>','</div>','<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','<div id="commandLine" class="toolbar">','<div id="commandLineContainer">','<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />','</div>','</div>','</body>','</html>',''];};var defaultCommandLineFunctions=[];ConsoleAppender=function(){};var consoleAppenderIdCounter=1;ConsoleAppender.prototype=new Appender();ConsoleAppender.prototype.create=function(inPage,container,lazyInit,initiallyMinimized,useDocumentWrite,width,height,focusConsoleWindow){var appender=this;var initialized=false;var consoleWindowCreated=false;var consoleWindowLoaded=false;var consoleClosed=false;var queuedLoggingEvents=[];var isSupported=true;var consoleAppenderId=consoleAppenderIdCounter++;initiallyMinimized=extractBooleanFromParam(initiallyMinimized,this.defaults.initiallyMinimized);lazyInit=extractBooleanFromParam(lazyInit,this.defaults.lazyInit);useDocumentWrite=extractBooleanFromParam(useDocumentWrite,this.defaults.useDocumentWrite);var newestMessageAtTop=this.defaults.newestMessageAtTop;var scrollToLatestMessage=this.defaults.scrollToLatestMessage;width=width?width:this.defaults.width;height=height?height:this.defaults.height;var maxMessages=this.defaults.maxMessages;var showCommandLine=this.defaults.showCommandLine;var commandLineObjectExpansionDepth=this.defaults.commandLineObjectExpansionDepth;var showHideButton=this.defaults.showHideButton;var showCloseButton=this.defaults.showCloseButton;var showLogEntryDeleteButtons=this.defaults.showLogEntryDeleteButtons;this.setLayout(this.defaults.layout);var init,createWindow,safeToAppend,getConsoleWindow,open;var appenderName=inPage?"InPageAppender":"PopUpAppender";var checkCanConfigure=function(configOptionName){if(consoleWindowCreated){handleError(appenderName+": configuration option '"+configOptionName+"' may not be set after the appender has been initialized");return false;}
return true;};var consoleWindowExists=function(){return(consoleWindowLoaded&&isSupported&&!consoleClosed);};this.isNewestMessageAtTop=function(){return newestMessageAtTop;};this.setNewestMessageAtTop=function(newestMessageAtTopParam){newestMessageAtTop=bool(newestMessageAtTopParam);if(consoleWindowExists()){getConsoleWindow().setNewestAtTop(newestMessageAtTop);}};this.isScrollToLatestMessage=function(){return scrollToLatestMessage;};this.setScrollToLatestMessage=function(scrollToLatestMessageParam){scrollToLatestMessage=bool(scrollToLatestMessageParam);if(consoleWindowExists()){getConsoleWindow().setScrollToLatest(scrollToLatestMessage);}};this.getWidth=function(){return width;};this.setWidth=function(widthParam){if(checkCanConfigure("width")){width=extractStringFromParam(widthParam,width);}};this.getHeight=function(){return height;};this.setHeight=function(heightParam){if(checkCanConfigure("height")){height=extractStringFromParam(heightParam,height);}};this.getMaxMessages=function(){return maxMessages;};this.setMaxMessages=function(maxMessagesParam){maxMessages=extractIntFromParam(maxMessagesParam,maxMessages);if(consoleWindowExists()){getConsoleWindow().setMaxMessages(maxMessages);}};this.isShowCommandLine=function(){return showCommandLine;};this.setShowCommandLine=function(showCommandLineParam){showCommandLine=bool(showCommandLineParam);if(consoleWindowExists()){getConsoleWindow().setShowCommandLine(showCommandLine);}};this.isShowHideButton=function(){return showHideButton;};this.setShowHideButton=function(showHideButtonParam){showHideButton=bool(showHideButtonParam);if(consoleWindowExists()){getConsoleWindow().setShowHideButton(showHideButton);}};this.isShowCloseButton=function(){return showCloseButton;};this.setShowCloseButton=function(showCloseButtonParam){showCloseButton=bool(showCloseButtonParam);if(consoleWindowExists()){getConsoleWindow().setShowCloseButton(showCloseButton);}};this.getCommandLineObjectExpansionDepth=function(){return commandLineObjectExpansionDepth;};this.setCommandLineObjectExpansionDepth=function(commandLineObjectExpansionDepthParam){commandLineObjectExpansionDepth=extractIntFromParam(commandLineObjectExpansionDepthParam,commandLineObjectExpansionDepth);};var minimized=initiallyMinimized;this.isInitiallyMinimized=function(){return initiallyMinimized;};this.setInitiallyMinimized=function(initiallyMinimizedParam){if(checkCanConfigure("initiallyMinimized")){initiallyMinimized=bool(initiallyMinimizedParam);minimized=initiallyMinimized;}};this.isUseDocumentWrite=function(){return useDocumentWrite;};this.setUseDocumentWrite=function(useDocumentWriteParam){if(checkCanConfigure("useDocumentWrite")){useDocumentWrite=bool(useDocumentWriteParam);}};function QueuedLoggingEvent(loggingEvent,formattedMessage){this.loggingEvent=loggingEvent;this.levelName=loggingEvent.level.name;this.formattedMessage=formattedMessage;}
QueuedLoggingEvent.prototype.append=function(){getConsoleWindow().log(this.levelName,this.formattedMessage);};function QueuedGroup(name,initiallyExpanded){this.name=name;this.initiallyExpanded=initiallyExpanded;}
QueuedGroup.prototype.append=function(){getConsoleWindow().group(this.name,this.initiallyExpanded);};function QueuedGroupEnd(){}
QueuedGroupEnd.prototype.append=function(){getConsoleWindow().groupEnd();};var checkAndAppend=function(){safeToAppend();if(!initialized){init();}else if(consoleClosed&&reopenWhenClosed){createWindow();}
if(safeToAppend()){appendQueuedLoggingEvents();}};this.append=function(loggingEvent){if(isSupported){var formattedMessage=appender.getLayout().format(loggingEvent);if(this.getLayout().ignoresThrowable()){formattedMessage+=loggingEvent.getThrowableStrRep();}
queuedLoggingEvents.push(new QueuedLoggingEvent(loggingEvent,formattedMessage));checkAndAppend();}};this.group=function(name,initiallyExpanded){if(isSupported){queuedLoggingEvents.push(new QueuedGroup(name,initiallyExpanded));checkAndAppend();}};this.groupEnd=function(){if(isSupported){queuedLoggingEvents.push(new QueuedGroupEnd());checkAndAppend();}};var appendQueuedLoggingEvents=function(){var currentLoggingEvent;while(queuedLoggingEvents.length>0){queuedLoggingEvents.shift().append();}
if(focusConsoleWindow){getConsoleWindow().focus();}};this.setAddedToLogger=function(logger){this.loggers.push(logger);if(enabled&&!lazyInit){init();}};this.clear=function(){if(consoleWindowExists()){getConsoleWindow().clearLog();}
queuedLoggingEvents.length=0;};this.focus=function(){if(consoleWindowExists()){getConsoleWindow().focus();}};this.focusCommandLine=function(){if(consoleWindowExists()){getConsoleWindow().focusCommandLine();}};this.focusSearch=function(){if(consoleWindowExists()){getConsoleWindow().focusSearch();}};var commandWindow=window;this.getCommandWindow=function(){return commandWindow;};this.setCommandWindow=function(commandWindowParam){commandWindow=commandWindowParam;};this.executeLastCommand=function(){if(consoleWindowExists()){getConsoleWindow().evalLastCommand();}};var commandLayout=new PatternLayout("%m");this.getCommandLayout=function(){return commandLayout;};this.setCommandLayout=function(commandLayoutParam){commandLayout=commandLayoutParam;};this.evalCommandAndAppend=function(expr){var commandReturnValue={appendResult:true,isError:false};var commandOutput="";try{var result,i;if(!commandWindow.eval&&commandWindow.execScript){commandWindow.execScript("null");}
var commandLineFunctionsHash={};for(i=0,len=commandLineFunctions.length;i<len;i++){commandLineFunctionsHash[commandLineFunctions[i][0]]=commandLineFunctions[i][1];}
var objectsToRestore=[];var addObjectToRestore=function(name){objectsToRestore.push([name,commandWindow[name]]);};addObjectToRestore("appender");commandWindow.appender=appender;addObjectToRestore("commandReturnValue");commandWindow.commandReturnValue=commandReturnValue;addObjectToRestore("commandLineFunctionsHash");commandWindow.commandLineFunctionsHash=commandLineFunctionsHash;var addFunctionToWindow=function(name){addObjectToRestore(name);commandWindow[name]=function(){return this.commandLineFunctionsHash[name](appender,arguments,commandReturnValue);};};for(i=0,len=commandLineFunctions.length;i<len;i++){addFunctionToWindow(commandLineFunctions[i][0]);}
if(commandWindow===window&&commandWindow.execScript){addObjectToRestore("evalExpr");addObjectToRestore("result");window.evalExpr=expr;commandWindow.execScript("window.result=eval(window.evalExpr);");result=window.result;}else{result=commandWindow.eval(expr);}
commandOutput=isUndefined(result)?result:formatObjectExpansion(result,commandLineObjectExpansionDepth);for(i=0,len=objectsToRestore.length;i<len;i++){commandWindow[objectsToRestore[i][0]]=objectsToRestore[i][1];}}catch(ex){commandOutput="Error evaluating command: "+getExceptionStringRep(ex);commandReturnValue.isError=true;}
if(commandReturnValue.appendResult){var message=">>> "+expr;if(!isUndefined(commandOutput)){message+=newLine+commandOutput;}
var level=commandReturnValue.isError?Level.ERROR:Level.INFO;var loggingEvent=new LoggingEvent(null,new Date(),level,[message],null);var mainLayout=this.getLayout();this.setLayout(commandLayout);this.append(loggingEvent);this.setLayout(mainLayout);}};var commandLineFunctions=defaultCommandLineFunctions.concat([]);this.addCommandLineFunction=function(functionName,commandLineFunction){commandLineFunctions.push([functionName,commandLineFunction]);};var commandHistoryCookieName="log4javascriptCommandHistory";this.storeCommandHistory=function(commandHistory){setCookie(commandHistoryCookieName,commandHistory.join(","));};var writeHtml=function(doc){var lines=getConsoleHtmlLines();doc.open();for(var i=0,len=lines.length;i<len;i++){doc.writeln(lines[i]);}
doc.close();};this.setEventTypes(["load","unload"]);var consoleWindowLoadHandler=function(){var win=getConsoleWindow();win.setAppender(appender);win.setNewestAtTop(newestMessageAtTop);win.setScrollToLatest(scrollToLatestMessage);win.setMaxMessages(maxMessages);win.setShowCommandLine(showCommandLine);win.setShowHideButton(showHideButton);win.setShowCloseButton(showCloseButton);win.setMainWindow(window);var storedValue=getCookie(commandHistoryCookieName);if(storedValue){win.commandHistory=storedValue.split(",");win.currentCommandIndex=win.commandHistory.length;}
appender.dispatchEvent("load",{"win":win});};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller);if(!consoleClosed){logLog.debug("really doing unload "+this);consoleClosed=true;consoleWindowLoaded=false;consoleWindowCreated=false;appender.dispatchEvent("unload",{});}};var pollConsoleWindow=function(windowTest,interval,successCallback,errorMessage){function doPoll(){try{if(consoleClosed){clearInterval(poll);}
if(windowTest(getConsoleWindow())){clearInterval(poll);successCallback();}}catch(ex){clearInterval(poll);isSupported=false;handleError(errorMessage,ex);}}
var poll=setInterval(doPoll,interval);};var getConsoleUrl=function(){var documentDomainSet=(document.domain!=location.hostname);return useDocumentWrite?"":getBaseUrl()+"console.html"+
(documentDomainSet?"?log4javascript_domain="+escape(document.domain):"");};if(inPage){var containerElement=null;var cssProperties=[];this.addCssProperty=function(name,value){if(checkCanConfigure("cssProperties")){cssProperties.push([name,value]);}};var windowCreationStarted=false;var iframeContainerDiv;var iframeId=uniqueId+"_InPageAppender_"+consoleAppenderId;this.hide=function(){if(initialized&&consoleWindowCreated){if(consoleWindowExists()){getConsoleWindow().$("command").blur();}
iframeContainerDiv.style.display="none";minimized=true;}};this.show=function(){if(initialized){if(consoleWindowCreated){iframeContainerDiv.style.display="block";this.setShowCommandLine(showCommandLine);minimized=false;}else if(!windowCreationStarted){createWindow(true);}}};this.isVisible=function(){return!minimized&&!consoleClosed;};this.close=function(fromButton){if(!consoleClosed&&(!fromButton||confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?"))){iframeContainerDiv.parentNode.removeChild(iframeContainerDiv);this.unload();}};open=function(){var initErrorMessage="InPageAppender.open: unable to create console iframe";function finalInit(){try{if(!initiallyMinimized){appender.show();}
consoleWindowLoadHandler();consoleWindowLoaded=true;appendQueuedLoggingEvents();}catch(ex){isSupported=false;handleError(initErrorMessage,ex);}}
function writeToDocument(){try{var windowTest=function(win){return isLoaded(win);};if(useDocumentWrite){writeHtml(getConsoleWindow().document);}
if(windowTest(getConsoleWindow())){finalInit();}else{pollConsoleWindow(windowTest,100,finalInit,initErrorMessage);}}catch(ex){isSupported=false;handleError(initErrorMessage,ex);}}
minimized=false;iframeContainerDiv=containerElement.appendChild(document.createElement("div"));iframeContainerDiv.style.width=width;iframeContainerDiv.style.height=height;iframeContainerDiv.style.border="solid gray 1px";for(var i=0,len=cssProperties.length;i<len;i++){iframeContainerDiv.style[cssProperties[i][0]]=cssProperties[i][1];}
var iframeSrc=useDocumentWrite?"":" src='"+getConsoleUrl()+"'";iframeContainerDiv.innerHTML="<iframe id='"+iframeId+"' name='"+iframeId+"' width='100%' height='100%' frameborder='0'"+iframeSrc+" scrolling='no'></iframe>";consoleClosed=false;var iframeDocumentExistsTest=function(win){try{return bool(win)&&bool(win.document);}catch(ex){return false;}};if(iframeDocumentExistsTest(getConsoleWindow())){writeToDocument();}else{pollConsoleWindow(iframeDocumentExistsTest,100,writeToDocument,initErrorMessage);}
consoleWindowCreated=true;};createWindow=function(show){if(show||!initiallyMinimized){var pageLoadHandler=function(){if(!container){containerElement=document.createElement("div");containerElement.style.position="fixed";containerElement.style.left="0";containerElement.style.right="0";containerElement.style.bottom="0";document.body.appendChild(containerElement);appender.addCssProperty("borderWidth","1px 0 0 0");appender.addCssProperty("zIndex",1000000);open();}else{try{var el=document.getElementById(container);if(el.nodeType==1){containerElement=el;}
open();}catch(ex){handleError("InPageAppender.init: invalid container element '"+container+"' supplied",ex);}}};if(pageLoaded&&container&&container.appendChild){containerElement=container;open();}else if(pageLoaded){pageLoadHandler();}else{log4javascript.addEventListener("load",pageLoadHandler);}
windowCreationStarted=true;}};init=function(){createWindow();initialized=true;};getConsoleWindow=function(){var iframe=window.frames[iframeId];if(iframe){return iframe;}};safeToAppend=function(){if(isSupported&&!consoleClosed){if(consoleWindowCreated&&!consoleWindowLoaded&&getConsoleWindow()&&isLoaded(getConsoleWindow())){consoleWindowLoaded=true;}
return consoleWindowLoaded;}
return false;};}else{var useOldPopUp=appender.defaults.useOldPopUp;var complainAboutPopUpBlocking=appender.defaults.complainAboutPopUpBlocking;var reopenWhenClosed=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return useOldPopUp;};this.setUseOldPopUp=function(useOldPopUpParam){if(checkCanConfigure("useOldPopUp")){useOldPopUp=bool(useOldPopUpParam);}};this.isComplainAboutPopUpBlocking=function(){return complainAboutPopUpBlocking;};this.setComplainAboutPopUpBlocking=function(complainAboutPopUpBlockingParam){if(checkCanConfigure("complainAboutPopUpBlocking")){complainAboutPopUpBlocking=bool(complainAboutPopUpBlockingParam);}};this.isFocusPopUp=function(){return focusConsoleWindow;};this.setFocusPopUp=function(focusPopUpParam){focusConsoleWindow=bool(focusPopUpParam);};this.isReopenWhenClosed=function(){return reopenWhenClosed;};this.setReopenWhenClosed=function(reopenWhenClosedParam){reopenWhenClosed=bool(reopenWhenClosedParam);};this.close=function(){logLog.debug("close "+this);try{popUp.close();this.unload();}catch(ex){}};this.hide=function(){logLog.debug("hide "+this);if(consoleWindowExists()){this.close();}};this.show=function(){logLog.debug("show "+this);if(!consoleWindowCreated){open();}};this.isVisible=function(){return safeToAppend();};var popUp;open=function(){var windowProperties="width="+width+",height="+height+",status,resizable";var frameInfo="";try{var frameEl=window.frameElement;if(frameEl){frameInfo="_"+frameEl.tagName+"_"+(frameEl.name||frameEl.id||"");}}catch(e){frameInfo="_inaccessibleParentFrame";}
var windowName="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+consoleAppenderId+frameInfo;if(!useOldPopUp||!useDocumentWrite){windowName=windowName+"_"+uniqueId;}
var checkPopUpClosed=function(win){if(consoleClosed){return true;}else{try{return bool(win)&&win.closed;}catch(ex){}}
return false;};var popUpClosedCallback=function(){if(!consoleClosed){appender.unload();}};function finalInit(){getConsoleWindow().setCloseIfOpenerCloses(!useOldPopUp||!useDocumentWrite);consoleWindowLoadHandler();consoleWindowLoaded=true;appendQueuedLoggingEvents();pollConsoleWindow(checkPopUpClosed,500,popUpClosedCallback,"PopUpAppender.checkPopUpClosed: error checking pop-up window");}
try{popUp=window.open(getConsoleUrl(),windowName,windowProperties);consoleClosed=false;consoleWindowCreated=true;if(popUp&&popUp.document){if(useDocumentWrite&&useOldPopUp&&isLoaded(popUp)){popUp.mainPageReloaded();finalInit();}else{if(useDocumentWrite){writeHtml(popUp.document);}
var popUpLoadedTest=function(win){return bool(win)&&isLoaded(win);};if(isLoaded(popUp)){finalInit();}else{pollConsoleWindow(popUpLoadedTest,100,finalInit,"PopUpAppender.init: unable to create console window");}}}else{isSupported=false;logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender");if(complainAboutPopUpBlocking){handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.");}}}catch(ex){handleError("PopUpAppender.init: error creating pop-up",ex);}};createWindow=function(){if(!initiallyMinimized){open();}};init=function(){createWindow();initialized=true;};getConsoleWindow=function(){return popUp;};safeToAppend=function(){if(isSupported&&!isUndefined(popUp)&&!consoleClosed){if(popUp.closed||(consoleWindowLoaded&&isUndefined(popUp.closed))){appender.unload();logLog.debug("PopUpAppender: pop-up closed");return false;}
if(!consoleWindowLoaded&&isLoaded(popUp)){consoleWindowLoaded=true;}}
return isSupported&&consoleWindowLoaded&&!consoleClosed;};}
this.getConsoleWindow=getConsoleWindow;};ConsoleAppender.addGlobalCommandLineFunction=function(functionName,commandLineFunction){defaultCommandLineFunctions.push([functionName,commandLineFunction]);};function PopUpAppender(lazyInit,initiallyMinimized,useDocumentWrite,width,height){this.create(false,null,lazyInit,initiallyMinimized,useDocumentWrite,width,height,this.defaults.focusPopUp);}
PopUpAppender.prototype=new ConsoleAppender();PopUpAppender.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:false,focusPopUp:false,lazyInit:true,useOldPopUp:true,complainAboutPopUpBlocking:true,newestMessageAtTop:false,scrollToLatestMessage:true,width:"600",height:"400",reopenWhenClosed:false,maxMessages:null,showCommandLine:true,commandLineObjectExpansionDepth:1,showHideButton:false,showCloseButton:true,showLogEntryDeleteButtons:true,useDocumentWrite:true};PopUpAppender.prototype.toString=function(){return"PopUpAppender";};log4javascript.PopUpAppender=PopUpAppender;function InPageAppender(container,lazyInit,initiallyMinimized,useDocumentWrite,width,height){this.create(true,container,lazyInit,initiallyMinimized,useDocumentWrite,width,height,false);}
InPageAppender.prototype=new ConsoleAppender();InPageAppender.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:false,lazyInit:true,newestMessageAtTop:false,scrollToLatestMessage:true,width:"100%",height:"220px",maxMessages:null,showCommandLine:true,commandLineObjectExpansionDepth:1,showHideButton:false,showCloseButton:false,showLogEntryDeleteButtons:true,useDocumentWrite:true};InPageAppender.prototype.toString=function(){return"InPageAppender";};log4javascript.InPageAppender=InPageAppender;log4javascript.InlineAppender=InPageAppender;})();function padWithSpaces(str,len){if(str.length<len){var spaces=[];var numberOfSpaces=Math.max(0,len-str.length);for(var i=0;i<numberOfSpaces;i++){spaces[i]=" ";}
str+=spaces.join("");}
return str;}
(function(){function dir(obj){var maxLen=0;for(var p in obj){maxLen=Math.max(toStr(p).length,maxLen);}
var propList=[];for(p in obj){var propNameStr="  "+padWithSpaces(toStr(p),maxLen+2);var propVal;try{propVal=splitIntoLines(toStr(obj[p])).join(padWithSpaces(newLine,maxLen+6));}catch(ex){propVal="[Error obtaining property. Details: "+getExceptionMessage(ex)+"]";}
propList.push(propNameStr+propVal);}
return propList.join(newLine);}
var nodeTypes={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};var preFormattedElements=["script","pre"];var emptyElements=["br","img","hr","param","link","area","input","col","base","meta"];var indentationUnit="  ";function getXhtml(rootNode,includeRootNode,indentation,startNewLine,preformatted){includeRootNode=(typeof includeRootNode=="undefined")?true:!!includeRootNode;if(typeof indentation!="string"){indentation="";}
startNewLine=!!startNewLine;preformatted=!!preformatted;var xhtml;function isWhitespace(node){return((node.nodeType==nodeTypes.TEXT_NODE)&&/^[ \t\r\n]*$/.test(node.nodeValue));}
function fixAttributeValue(attrValue){return attrValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;");}
function getStyleAttributeValue(el){var stylePairs=el.style.cssText.split(";");var styleValue="";var isFirst=true;for(var j=0,len=stylePairs.length;j<len;j++){var nameValueBits=stylePairs[j].split(":");var props=[];if(!/^\s*$/.test(nameValueBits[0])){props.push(trim(nameValueBits[0]).toLowerCase()+":"+trim(nameValueBits[1]));}
styleValue=props.join(";");}
return styleValue;}
function getNamespace(el){if(el.prefix){return el.prefix;}else if(el.outerHTML){var regex=new RegExp("<([^:]+):"+el.tagName+"[^>]*>","i");if(regex.test(el.outerHTML)){return RegExp.$1.toLowerCase();}}
return"";}
var lt="<";var gt=">";if(includeRootNode&&rootNode.nodeType!=nodeTypes.DOCUMENT_FRAGMENT_NODE){switch(rootNode.nodeType){case nodeTypes.ELEMENT_NODE:var tagName=rootNode.tagName.toLowerCase();xhtml=startNewLine?newLine+indentation:"";xhtml+=lt;var prefix=getNamespace(rootNode);var hasPrefix=!!prefix;if(hasPrefix){xhtml+=prefix+":";}
xhtml+=tagName;for(i=0,len=rootNode.attributes.length;i<len;i++){var currentAttr=rootNode.attributes[i];if(!currentAttr.specified||currentAttr.nodeValue===null||currentAttr.nodeName.toLowerCase()==="style"||typeof currentAttr.nodeValue!=="string"||currentAttr.nodeName.indexOf("_moz")===0){continue;}
xhtml+=" "+currentAttr.nodeName.toLowerCase()+"=\"";xhtml+=fixAttributeValue(currentAttr.nodeValue);xhtml+="\"";}
if(rootNode.style.cssText){var styleValue=getStyleAttributeValue(rootNode);if(styleValue!==""){xhtml+=" style=\""+getStyleAttributeValue(rootNode)+"\"";}}
if(array_contains(emptyElements,tagName)||(hasPrefix&&!rootNode.hasChildNodes())){xhtml+="/"+gt;}else{xhtml+=gt;var childStartNewLine=!(rootNode.childNodes.length===1&&rootNode.childNodes[0].nodeType===nodeTypes.TEXT_NODE);var childPreformatted=array_contains(preFormattedElements,tagName);for(var i=0,len=rootNode.childNodes.length;i<len;i++){xhtml+=getXhtml(rootNode.childNodes[i],true,indentation+indentationUnit,childStartNewLine,childPreformatted);}
var endTag=lt+"/"+tagName+gt;xhtml+=childStartNewLine?newLine+indentation+endTag:endTag;}
return xhtml;case nodeTypes.TEXT_NODE:if(isWhitespace(rootNode)){xhtml="";}else{if(preformatted){xhtml=rootNode.nodeValue;}else{var lines=splitIntoLines(trim(rootNode.nodeValue));var trimmedLines=[];for(var i=0,len=lines.length;i<len;i++){trimmedLines[i]=trim(lines[i]);}
xhtml=trimmedLines.join(newLine+indentation);}
if(startNewLine){xhtml=newLine+indentation+xhtml;}}
return xhtml;case nodeTypes.CDATA_SECTION_NODE:return"<![CDA"+"TA["+rootNode.nodeValue+"]"+"]>"+newLine;case nodeTypes.DOCUMENT_NODE:xhtml="";for(var i=0,len=rootNode.childNodes.length;i<len;i++){xhtml+=getXhtml(rootNode.childNodes[i],true,indentation);}
return xhtml;default:return"";}}else{xhtml="";for(var i=0,len=rootNode.childNodes.length;i<len;i++){xhtml+=getXhtml(rootNode.childNodes[i],true,indentation+indentationUnit);}
return xhtml;}}
function createCommandLineFunctions(){ConsoleAppender.addGlobalCommandLineFunction("$",function(appender,args,returnValue){return document.getElementById(args[0]);});ConsoleAppender.addGlobalCommandLineFunction("dir",function(appender,args,returnValue){var lines=[];for(var i=0,len=args.length;i<len;i++){lines[i]=dir(args[i]);}
return lines.join(newLine+newLine);});ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(appender,args,returnValue){var lines=[];for(var i=0,len=args.length;i<len;i++){var win=appender.getCommandWindow();lines[i]=getXhtml(args[i]);}
return lines.join(newLine+newLine);});ConsoleAppender.addGlobalCommandLineFunction("cd",function(appender,args,returnValue){var win,message;if(args.length===0||args[0]===""){win=window;message="Command line set to run in main window";}else{if(args[0].window==args[0]){win=args[0];message="Command line set to run in frame '"+args[0].name+"'";}else{win=window.frames[args[0]];if(win){message="Command line set to run in frame '"+args[0]+"'";}else{returnValue.isError=true;message="Frame '"+args[0]+"' does not exist";win=appender.getCommandWindow();}}}
appender.setCommandWindow(win);return message;});ConsoleAppender.addGlobalCommandLineFunction("clear",function(appender,args,returnValue){returnValue.appendResult=false;appender.clear();});ConsoleAppender.addGlobalCommandLineFunction("keys",function(appender,args,returnValue){var keys=[];for(var k in args[0]){keys.push(k);}
return keys;});ConsoleAppender.addGlobalCommandLineFunction("values",function(appender,args,returnValue){var values=[];for(var k in args[0]){try{values.push(args[0][k]);}catch(ex){logLog.warn("values(): Unable to obtain value for key "+k+". Details: "+getExceptionMessage(ex));}}
return values;});ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(appender,args,returnValue){var expansionDepth=parseInt(args[0],10);if(isNaN(expansionDepth)||expansionDepth<0){returnValue.isError=true;return""+args[0]+" is not a valid expansion depth";}else{appender.setCommandLineObjectExpansionDepth(expansionDepth);return"Object expansion depth set to "+expansionDepth;}});}
function init(){createCommandLineFunctions();}
init();})();log4javascript.setDocumentReady=function(){pageLoaded=true;log4javascript.dispatchEvent("load",{});};if(window.addEventListener){window.addEventListener("load",log4javascript.setDocumentReady,false);}else if(window.attachEvent){window.attachEvent("onload",log4javascript.setDocumentReady);}else{var oldOnload=window.onload;if(typeof window.onload!="function"){window.onload=log4javascript.setDocumentReady;}else{window.onload=function(evt){if(oldOnload){oldOnload(evt);}
log4javascript.setDocumentReady();};}}
window.log4javascript=log4javascript;return log4javascript;})();

/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;b&&h.mixIn(b);h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)});h.init.prototype=h;h.$super=this;return h},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},
q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[];this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;b=b.sigBytes;this.clamp();if(j%4)for(var g=0;g<b;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;g<b;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);this.sigBytes+=b;return this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<
32-8*(h%4);b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var h=[],a=0;a<b;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16));g.push((k&15).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j+=2)g[j>>>3]|=parseInt(b.substr(j,
2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j++)g[j>>>2]|=(b.charCodeAt(j)&255)<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data");}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},
g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((m|0)-this._minBufferSize,0);b=m*k;j=s.min(4*b,j);if(b){for(var l=0;l<b;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b);a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);
b._data=this._data.clone();return b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){g.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return(new b.init(g)).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return(new k.HMAC.init(b,
g)).finalize(a)}}});var k=m.algo={};return m}(Math);
(function(s){function p(a,k,b,h,l,j,m){a=a+(k&b|~k&h)+l+m;return(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){a=a+(k&h|b&~h)+l+m;return(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){a=a+(k^b^h)+l+m;return(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){a=a+(b^(k|~h))+l+m;return(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),
c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,
d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,
C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0;b[1]=b[1]+d|0;b[2]=b[2]+e|0;b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/
4294967296);k[(h+64>>>9<<4)+15]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360;k[(h+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;a.sigBytes=4*(k.length+1);this._process();a=this._hash;k=a.words;for(b=0;4>b;b++)h=k[b],k[b]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;return a},clone:function(){var a=t.clone.call(this);a._hash=this._hash.clone();return a}});r.MD5=t._createHelper(q);r.HmacMD5=t._createHmacHelper(q)})(Math);

var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,
278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,
271,269,267,265,263,261,259];
var shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,
23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];
function stackBlurCanvasRGBA(pixels,width,height,radius){var top_x=0;var top_y=0;if(isNaN(radius)||radius<1)return;radius|=0;var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,a_sum,r_out_sum,g_out_sum,b_out_sum,a_out_sum,r_in_sum,g_in_sum,b_in_sum,a_in_sum,pr,pg,pb,pa,rbs;var div=radius+radius+1;var w4=width<<2;var widthMinus1=width-1;var heightMinus1=height-1;var radiusPlus1=radius+1;var sumFactor=radiusPlus1*(radiusPlus1+1)/2;var stackStart=new BlurStack;var stack=stackStart;for(i=1;i<div;i++){stack=stack.next=
new BlurStack;if(i==radiusPlus1)var stackEnd=stack}stack.next=stackStart;var stackIn=null;var stackOut=null;yw=yi=0;var mul_sum=mul_table[radius];var shg_sum=shg_table[radius];for(y=0;y<height;y++){r_in_sum=g_in_sum=b_in_sum=a_in_sum=r_sum=g_sum=b_sum=a_sum=0;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);a_out_sum=radiusPlus1*(pa=pixels[yi+3]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;a_sum+=sumFactor*pa;stack=
stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack.a=pa;stack=stack.next}for(i=1;i<radiusPlus1;i++){p=yi+((widthMinus1<i?widthMinus1:i)<<2);r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i);g_sum+=(stack.g=pg=pixels[p+1])*rbs;b_sum+=(stack.b=pb=pixels[p+2])*rbs;a_sum+=(stack.a=pa=pixels[p+3])*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;a_in_sum+=pa;stack=stack.next}stackIn=stackStart;stackOut=stackEnd;for(x=0;x<width;x++){pixels[yi+3]=pa=a_sum*mul_sum>>shg_sum;if(pa!=0){pa=
255/pa;pixels[yi]=(r_sum*mul_sum>>shg_sum)*pa;pixels[yi+1]=(g_sum*mul_sum>>shg_sum)*pa;pixels[yi+2]=(b_sum*mul_sum>>shg_sum)*pa}else pixels[yi]=pixels[yi+1]=pixels[yi+2]=0;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;a_sum-=a_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;a_out_sum-=stackIn.a;p=yw+((p=x+radius+1)<widthMinus1?p:widthMinus1)<<2;r_in_sum+=stackIn.r=pixels[p];g_in_sum+=stackIn.g=pixels[p+1];b_in_sum+=stackIn.b=pixels[p+2];a_in_sum+=stackIn.a=pixels[p+3];
r_sum+=r_in_sum;g_sum+=g_in_sum;b_sum+=b_in_sum;a_sum+=a_in_sum;stackIn=stackIn.next;r_out_sum+=pr=stackOut.r;g_out_sum+=pg=stackOut.g;b_out_sum+=pb=stackOut.b;a_out_sum+=pa=stackOut.a;r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;a_in_sum-=pa;stackOut=stackOut.next;yi+=4}yw+=width}for(x=0;x<width;x++){g_in_sum=b_in_sum=a_in_sum=r_in_sum=g_sum=b_sum=a_sum=r_sum=0;yi=x<<2;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);a_out_sum=radiusPlus1*
(pa=pixels[yi+3]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;a_sum+=sumFactor*pa;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack.a=pa;stack=stack.next}yp=width;for(i=1;i<=radius;i++){yi=yp+x<<2;r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i);g_sum+=(stack.g=pg=pixels[yi+1])*rbs;b_sum+=(stack.b=pb=pixels[yi+2])*rbs;a_sum+=(stack.a=pa=pixels[yi+3])*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;a_in_sum+=pa;stack=stack.next;if(i<heightMinus1)yp+=width}yi=
x;stackIn=stackStart;stackOut=stackEnd;for(y=0;y<height;y++){p=yi<<2;pixels[p+3]=pa=a_sum*mul_sum>>shg_sum;if(pa>0){pa=255/pa;pixels[p]=(r_sum*mul_sum>>shg_sum)*pa;pixels[p+1]=(g_sum*mul_sum>>shg_sum)*pa;pixels[p+2]=(b_sum*mul_sum>>shg_sum)*pa}else pixels[p]=pixels[p+1]=pixels[p+2]=0;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;a_sum-=a_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;a_out_sum-=stackIn.a;p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2;r_sum+=
r_in_sum+=stackIn.r=pixels[p];g_sum+=g_in_sum+=stackIn.g=pixels[p+1];b_sum+=b_in_sum+=stackIn.b=pixels[p+2];a_sum+=a_in_sum+=stackIn.a=pixels[p+3];stackIn=stackIn.next;r_out_sum+=pr=stackOut.r;g_out_sum+=pg=stackOut.g;b_out_sum+=pb=stackOut.b;a_out_sum+=pa=stackOut.a;r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;a_in_sum-=pa;stackOut=stackOut.next;yi+=width}}return pixels}
function stackBlurCanvasRGB(pixels,width,height,radius){var top_x=0;var top_y=0;if(isNaN(radius)||radius<1)return;radius|=0;var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,r_out_sum,g_out_sum,b_out_sum,r_in_sum,g_in_sum,b_in_sum,pr,pg,pb,rbs;var div=radius+radius+1;var w4=width<<2;var widthMinus1=width-1;var heightMinus1=height-1;var radiusPlus1=radius+1;var sumFactor=radiusPlus1*(radiusPlus1+1)/2;var stackStart=new BlurStack;var stack=stackStart;for(i=1;i<div;i++){stack=stack.next=new BlurStack;if(i==radiusPlus1)var stackEnd=
stack}stack.next=stackStart;var stackIn=null;var stackOut=null;yw=yi=0;var mul_sum=mul_table[radius];var shg_sum=shg_table[radius];for(y=0;y<height;y++){r_in_sum=g_in_sum=b_in_sum=r_sum=g_sum=b_sum=0;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next}for(i=1;i<radiusPlus1;i++){p=
yi+((widthMinus1<i?widthMinus1:i)<<2);r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i);g_sum+=(stack.g=pg=pixels[p+1])*rbs;b_sum+=(stack.b=pb=pixels[p+2])*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next}stackIn=stackStart;stackOut=stackEnd;for(x=0;x<width;x++){pixels[yi]=r_sum*mul_sum>>shg_sum;pixels[yi+1]=g_sum*mul_sum>>shg_sum;pixels[yi+2]=b_sum*mul_sum>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=yw+((p=
x+radius+1)<widthMinus1?p:widthMinus1)<<2;r_in_sum+=stackIn.r=pixels[p];g_in_sum+=stackIn.g=pixels[p+1];b_in_sum+=stackIn.b=pixels[p+2];r_sum+=r_in_sum;g_sum+=g_in_sum;b_sum+=b_in_sum;stackIn=stackIn.next;r_out_sum+=pr=stackOut.r;g_out_sum+=pg=stackOut.g;b_out_sum+=pb=stackOut.b;r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=4}yw+=width}for(x=0;x<width;x++){g_in_sum=b_in_sum=r_in_sum=g_sum=b_sum=r_sum=0;yi=x<<2;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+
1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next}yp=width;for(i=1;i<=radius;i++){yi=yp+x<<2;r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i);g_sum+=(stack.g=pg=pixels[yi+1])*rbs;b_sum+=(stack.b=pb=pixels[yi+2])*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;if(i<heightMinus1)yp+=width}yi=x;stackIn=stackStart;stackOut=stackEnd;for(y=0;y<
height;y++){p=yi<<2;pixels[p]=r_sum*mul_sum>>shg_sum;pixels[p+1]=g_sum*mul_sum>>shg_sum;pixels[p+2]=b_sum*mul_sum>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2;r_sum+=r_in_sum+=stackIn.r=pixels[p];g_sum+=g_in_sum+=stackIn.g=pixels[p+1];b_sum+=b_in_sum+=stackIn.b=pixels[p+2];stackIn=stackIn.next;r_out_sum+=pr=stackOut.r;g_out_sum+=pg=stackOut.g;b_out_sum+=pb=stackOut.b;
r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=width}}return pixels}function BlurStack(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null};

!function(){var monthsAbbr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var monthsFull=["January","February","March","April","May","June","July","August","September","October","November","December"];var daysAbbr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var daysFull=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var dayNames={su:0,sun:0,sunday:0,mo:1,mon:1,monday:1,tu:2,tue:2,tuesday:2,we:3,wed:3,wednesday:3,th:4,thu:4,thursday:4,fr:5,fri:5,friday:5,sa:6,sat:6,saturday:6};var monthsAll=monthsFull.concat(monthsAbbr);var daysAll=["su","sun","sunday","mo","mon","monday","tu","tue","tuesday","we","wed","wednesday","th","thu","thursday","fr","fri","friday","sa","sat","saturday"];var monthNames={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11};var daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];function pad(str,length){str=String(str);while(str.length<length){str="0"+str}return str}var isInteger=function(str){if(str.match(/^(\d+)$/)){return true}return false};var getInt=function(str,i,minlength,maxlength){for(var x=maxlength;x>=minlength;x--){var token=str.substring(i,i+x);if(token.length<minlength){return null}if(isInteger(token)){return token}}return null};var origParse=Date.parse;var getDateFromFormat=function(val,format){val=val+"";format=format+"";var iVal=0;var iFormat=0;var c="";var token="";var token2="";var x,y;var now=new Date;var year=now.getYear();var month=now.getMonth()+1;var date=1;var hh=0;var mm=0;var ss=0;var ampm="";while(iFormat<format.length){c=format.charAt(iFormat);token="";while(format.charAt(iFormat)===c&&iFormat<format.length){token+=format.charAt(iFormat++)}if(token==="yyyy"||token==="yy"||token==="y"){if(token==="yyyy"){x=4;y=4}if(token==="yy"){x=2;y=2}if(token==="y"){x=2;y=4}year=getInt(val,iVal,x,y);if(year===null){return NaN}iVal+=year.length;if(year.length===2){if(year>70){year=1900+(year-0)}else{year=2e3+(year-0)}}}else if(token==="MMM"||token==="NNN"){month=0;for(var i=0;i<monthsAll.length;i++){var monthName=monthsAll[i];if(val.substring(iVal,iVal+monthName.length).toLowerCase()===monthName.toLowerCase()){if(token==="MMM"||token==="NNN"&&i>11){month=i+1;if(month>12){month-=12}iVal+=monthName.length;break}}}if(month<1||month>12){return NaN}}else if(token==="EE"||token==="E"){for(var n=0;n<daysAll.length;n++){var dayName=daysAll[n];if(val.substring(iVal,iVal+dayName.length).toLowerCase()===dayName.toLowerCase()){iVal+=dayName.length;break}}}else if(token==="MM"||token==="M"){month=getInt(val,iVal,token.length,2);if(month===null||month<1||month>12){return NaN}iVal+=month.length}else if(token==="dd"||token==="d"){date=getInt(val,iVal,token.length,2);if(date===null||date<1||date>31){return NaN}iVal+=date.length}else if(token==="hh"||token==="h"){hh=getInt(val,iVal,token.length,2);if(hh===null||hh<1||hh>12){return NaN}iVal+=hh.length}else if(token==="HH"||token==="H"){hh=getInt(val,iVal,token.length,2);if(hh===null||hh<0||hh>23){return NaN}iVal+=hh.length}else if(token==="KK"||token==="K"){hh=getInt(val,iVal,token.length,2);if(hh===null||hh<0||hh>11){return NaN}iVal+=hh.length}else if(token==="kk"||token==="k"){hh=getInt(val,iVal,token.length,2);if(hh===null||hh<1||hh>24){return NaN}iVal+=hh.length;hh--}else if(token==="mm"||token==="m"){mm=getInt(val,iVal,token.length,2);if(mm===null||mm<0||mm>59){return NaN}iVal+=mm.length}else if(token==="ss"||token==="s"){ss=getInt(val,iVal,token.length,2);if(ss===null||ss<0||ss>59){return NaN}iVal+=ss.length}else if(token==="a"){if(val.substring(iVal,iVal+2).toLowerCase()==="am"){ampm="AM"}else if(val.substring(iVal,iVal+2).toLowerCase()==="pm"){ampm="PM"}else{return NaN}iVal+=2}else{if(val.substring(iVal,iVal+token.length)!==token){return NaN}else{iVal+=token.length}}}if(iVal!==val.length){return NaN}if(month===2){if(year%4===0&&year%100!==0||year%400===0){if(date>29){return NaN}}else{if(date>28){return NaN}}}if(month===4||month===6||month===9||month===11){if(date>30){return NaN}}if(hh<12&&ampm==="PM"){hh=hh-0+12}else if(hh>11&&ampm==="AM"){hh-=12}var newdate=new Date(year,month-1,date,hh,mm,ss);return newdate.getTime()};Date.parse=function(date,format){if(format){return getDateFromFormat(date,format)}var timestamp=origParse(date),minutesOffset=0,match;if(isNaN(timestamp)&&(match=/^(\d{4}|[+\-]\d{6})-(\d{2})-(\d{2})(?:[T ](\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?))?/.exec(date))){if(match[8]!=="Z"){minutesOffset=+match[10]*60+ +match[11];if(match[9]==="+"){minutesOffset=0-minutesOffset}}match[7]=match[7]||"000";timestamp=Date.UTC(+match[1],+match[2]-1,+match[3],+match[4],+match[5]+minutesOffset,+match[6],+match[7].substr(0,3))}return timestamp};function polyfill(name,func){if(Date.prototype[name]===undefined){Date.prototype[name]=func}}Date.today=function(){return(new Date).clearTime()};Date.UTCtoday=function(){return(new Date).clearUTCTime()};Date.tomorrow=function(){return Date.today().add({days:1})};Date.UTCtomorrow=function(){return Date.UTCtoday().add({days:1})};Date.yesterday=function(){return Date.today().add({days:-1})};Date.UTCyesterday=function(){return Date.UTCtoday().add({days:-1})};Date.validateDay=function(day,year,month){var date=new Date(year,month,day);return date.getFullYear()===year&&date.getMonth()===month&&date.getDate()===day};Date.validateYear=function(year){return year>=0&&year<=9999};Date.validateSecond=function(second){return second>=0&&second<60};Date.validateMonth=function(month){return month>=0&&month<12};Date.validateMinute=function(minute){return minute>=0&&minute<60};Date.validateMillisecond=function(milli){return milli>=0&&milli<1e3};Date.validateHour=function(hour){return hour>=0&&hour<24};Date.compare=function(date1,date2){if(date1.valueOf()<date2.valueOf()){return-1}else if(date1.valueOf()>date2.valueOf()){return 1}return 0};Date.equals=function(date1,date2){return date1.valueOf()===date2.valueOf()};Date.equalsDay=function(date1,date2){return date1.toYMD()===date2.toYMD()};Date.getDayNumberFromName=function(name){return dayNames[name.toLowerCase()]};Date.getMonthNumberFromName=function(name){return monthNames[name.toLowerCase()]};Date.getMonthNameFromNumber=function(number){return monthsFull[number]};Date.getMonthAbbrFromNumber=function(number){return monthsAbbr[number]};Date.isLeapYear=function(year){return new Date(year,1,29).getDate()===29};Date.getDaysInMonth=function(year,month){if(month===1){return Date.isLeapYear(year)?29:28}return daysInMonth[month]};polyfill("getMonthAbbr",function(){return monthsAbbr[this.getMonth()]});polyfill("getMonthName",function(){return monthsFull[this.getMonth()]});polyfill("getLastMonthName",function(){var i=this.getMonth();i=i==0?11:i-1;return monthsFull[i]});polyfill("getUTCOffset",function(){var tz=pad(Math.abs(this.getTimezoneOffset()/.6),4);if(this.getTimezoneOffset()>0){tz="-"+tz}return tz});polyfill("toCLFString",function(){return pad(this.getDate(),2)+"/"+this.getMonthAbbr()+"/"+this.getFullYear()+":"+pad(this.getHours(),2)+":"+pad(this.getMinutes(),2)+":"+pad(this.getSeconds(),2)+" "+this.getUTCOffset()});polyfill("toYMD",function(separator){separator=typeof separator==="undefined"?"-":separator;return this.getFullYear()+separator+pad(this.getMonth()+1,2)+separator+pad(this.getDate(),2)});polyfill("toDBString",function(){return this.getUTCFullYear()+"-"+pad(this.getUTCMonth()+1,2)+"-"+pad(this.getUTCDate(),2)+" "+pad(this.getUTCHours(),2)+":"+pad(this.getUTCMinutes(),2)+":"+pad(this.getUTCSeconds(),2)});polyfill("clearTime",function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this});polyfill("clearUTCTime",function(){this.setUTCHours(0);this.setUTCMinutes(0);this.setUTCSeconds(0);this.setUTCMilliseconds(0);return this});polyfill("add",function(obj){if(obj.milliseconds!==undefined){this.setMilliseconds(this.getMilliseconds()+obj.milliseconds)}if(obj.seconds!==undefined){this.setSeconds(this.getSeconds()+obj.seconds)}if(obj.minutes!==undefined){this.setMinutes(this.getMinutes()+obj.minutes)}if(obj.hours!==undefined){this.setHours(this.getHours()+obj.hours)}if(obj.days!==undefined){this.setDate(this.getDate()+obj.days)}if(obj.weeks!==undefined){this.setDate(this.getDate()+obj.weeks*7)}if(obj.months!==undefined){this.setMonth(this.getMonth()+obj.months)}if(obj.years!==undefined){this.setFullYear(this.getFullYear()+obj.years)}return this});polyfill("addMilliseconds",function(milliseconds){return this.add({milliseconds:milliseconds})});polyfill("addSeconds",function(seconds){return this.add({seconds:seconds})});polyfill("addMinutes",function(minutes){return this.add({minutes:minutes})});polyfill("addHours",function(hours){return this.add({hours:hours})});polyfill("addDays",function(days){return this.add({days:days})});polyfill("addWeeks",function(weeks){return this.add({days:weeks*7})});polyfill("addMonths",function(months){return this.add({months:months})});polyfill("addYears",function(years){return this.add({years:years})});polyfill("setTimeToNow",function(){var n=new Date;this.setMilliseconds(n.getMilliseconds());this.setSeconds(n.getSeconds());this.setMinutes(n.getMinutes());this.setHours(n.getHours())});polyfill("clone",function(){return new Date(this.valueOf())});polyfill("between",function(start,end){return this.valueOf()>=start.valueOf()&&this.valueOf()<=end.valueOf()});polyfill("compareTo",function(date){return Date.compare(this,date)});polyfill("equals",function(date){return Date.equals(this,date)});polyfill("equalsDay",function(date){return Date.equalsDay(this,date)});polyfill("isToday",function(){return Date.equalsDay(this,Date.today())});polyfill("isAfter",function(date){date=date?date:new Date;return this.compareTo(date)>0});polyfill("isBefore",function(date){date=date?date:new Date;return this.compareTo(date)<0});polyfill("getDaysBetween",function(date){return(date.clone().valueOf()-this.valueOf())/864e5|0});polyfill("getHoursBetween",function(date){return(date.clone().valueOf()-this.valueOf())/36e5|0});polyfill("getMinutesBetween",function(date){return(date.clone().valueOf()-this.valueOf())/6e4|0});polyfill("getSecondsBetween",function(date){return(date.clone().valueOf()-this.valueOf())/1e3|0});polyfill("getMillisecondsBetween",function(date){return date.clone().valueOf()-this.valueOf()|0});polyfill("getMonthsBetween",function(date){var daysDiff,daysInMonth,months=Math.ceil(new Date(date-this).getUTCDate()/31),testDate=new Date(this.getTime()),totalDays=Date.getDaysInMonth;testDate.setUTCMonth(testDate.getUTCMonth()+months);while(testDate.getTime()<date.getTime()){testDate.setUTCMonth(testDate.getUTCMonth()+1);months++}if(testDate.getTime()!==date.getTime()){testDate.setUTCMonth(testDate.getUTCMonth()-1);months--}if(date.getUTCMonth()===testDate.getUTCMonth()){daysDiff=new Date(date-testDate).getUTCDate();daysInMonth=totalDays(testDate.getUTCFullYear(),testDate.getUTCMonth());return months+daysDiff/daysInMonth}else{daysInMonth=totalDays(testDate.getUTCFullYear(),testDate.getUTCMonth());daysDiff=daysInMonth-testDate.getUTCDate()+1;return months+ +(daysDiff/daysInMonth).toFixed(5)+ +(date.getUTCDate()/totalDays(date.getUTCFullYear(),date.getUTCMonth())).toFixed(5)}});polyfill("getOrdinalNumber",function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1});polyfill("toFormat",function(format){return toFormat(format,getReplaceMap(this))});polyfill("toUTCFormat",function(format){return toFormat(format,getUTCReplaceMap(this))});var toFormat=function(format,replaceMap){var f=[format],i,l,s;var replace=function(str,rep){var i=0,l=f.length,j,ll,t,n=[];for(;i<l;i++){if(typeof f[i]=="string"){t=f[i].split(str);for(j=0,ll=t.length-1;j<ll;j++){n.push(t[j]);n.push([rep])}n.push(t[ll])}else{n.push(f[i])}}f=n};for(i in replaceMap){replace(i,replaceMap[i])}s="";for(i=0,l=f.length;i<l;i++)s+=typeof f[i]=="string"?f[i]:f[i][0];return f.join("")};var getReplaceMap=function(date){var hours=date.getHours()%12?date.getHours()%12:12;return{YYYY:date.getFullYear(),YY:String(date.getFullYear()).slice(-2),MMMM:monthsFull[date.getMonth()],MMM:monthsAbbr[date.getMonth()],MM:pad(date.getMonth()+1,2),MI:pad(date.getMinutes(),2),M:date.getMonth()+1,DDDD:daysFull[date.getDay()],DDD:daysAbbr[date.getDay()],DD:pad(date.getDate(),2),D:date.getDate(),HH24:pad(date.getHours(),2),HH:pad(hours,2),H:hours,SS:pad(date.getSeconds(),2),PP:date.getHours()>=12?"PM":"AM",P:date.getHours()>=12?"pm":"am",LL:pad(date.getMilliseconds(),3)}};var getUTCReplaceMap=function(date){var hours=date.getUTCHours()%12?date.getUTCHours()%12:12;return{YYYY:date.getUTCFullYear(),YY:String(date.getUTCFullYear()).slice(-2),MMMM:monthsFull[date.getUTCMonth()],MMM:monthsAbbr[date.getUTCMonth()],MM:pad(date.getUTCMonth()+1,2),MI:pad(date.getUTCMinutes(),2),M:date.getUTCMonth()+1,DDDD:daysFull[date.getUTCDay()],DDD:daysAbbr[date.getUTCDay()],DD:pad(date.getUTCDate(),2),D:date.getUTCDate(),HH24:pad(date.getUTCHours(),2),HH:pad(hours,2),H:hours,SS:pad(date.getUTCSeconds(),2),PP:date.getUTCHours()>=12?"PM":"AM",P:date.getUTCHours()>=12?"pm":"am",LL:pad(date.getUTCMilliseconds(),3)}}}();
function PointerEvent(t,e){var n={bubbles:!1,cancelable:!1,view:null,detail:null,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,buttons:void 0,which:0,relatedTarget:null,pointerId:0,width:0,height:0,pressure:0,tiltX:0,tiltY:0,pointerType:"",hwTimestamp:0,isPrimary:!1};for(var i in e)i in n&&(n[i]=e[i]);var r,o=n.which?n.button:-1;r=n.pressure?n.pressure:void 0!==n.buttons?n.buttons?.5:0:o>-1?.5:0;var s;return document.implementation.hasFeature("MouseEvent","4.0")?s=new MouseEvent(t,e):(s=document.createEvent("MouseEvent"),s.initMouseEvent(t,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,o,n.relatedTarget)),Object.defineProperties(s,{pointerId:{value:n.pointerId,enumerable:!0},width:{value:n.width,enumerable:!0},height:{value:n.height,enumerable:!0},pressure:{value:r,enumerable:!0},tiltX:{value:n.tiltX,enumerable:!0},tiltY:{value:n.tiltY,enumerable:!0},pointerType:{value:n.pointerType,enumerable:!0},hwTimestamp:{value:n.hwTimestamp,enumerable:!0},isPrimary:{value:n.isPrimary,enumerable:!0}}),s}(function(){function t(t){return'[touch-action="'+t+'"]'}function e(t){return"{ -ms-touch-action: "+t+"; touch-action: "+t+"; }"}var n=["none","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["scroll","pan-x pan-y","pan-y pan-x"]}],i="";n.forEach(function(n){i+=n+""===n?t(n)+e(n):n.selectors.map(t)+e(n.rule)});var r=document.createElement("style");r.textContent=i,document.head.appendChild(r)})(),function(t){function e(){this.ids=[],this.pointers=[]}t=t||{},e.prototype={set:function(t,e){var n=this.ids.indexOf(t);n>-1?this.pointers[n]=e:(this.ids.push(t),this.pointers.push(e))},has:function(t){return this.ids.indexOf(t)>-1},"delete":function(t){var e=this.ids.indexOf(t);e>-1&&(this.ids.splice(e,1),this.pointers.splice(e,1))},get:function(t){var e=this.ids.indexOf(t);return this.pointers[e]},item:function(t){return this.pointers[t]},get size(){return this.pointers.length}},t.PointerMap=e,window.PointerEventsPolyfill=t}(window.PointerEventsPolyfill),function(t){var e;"undefined"!=typeof WeakMap&&0>navigator.userAgent.indexOf("Firefox/")?e=WeakMap:(e=function(t){this.name="__$"+t+"$__"},e.prototype={set:function(t,e){Object.defineProperty(t,this.name,{value:e,writable:!0})},get:function(t){return t[this.name]}}),t.SideTable=e}(window.PointerEventsPolyfill),function(t){var e={targets:new t.SideTable("target"),handledEvents:new t.SideTable("pointer"),scrollType:new t.SideTable("scrollType"),pointermap:new t.PointerMap,events:[],eventMap:{},eventSources:{},registerSource:function(t,e){var n=e,i=n.events;i&&(this.events=this.events.concat(i),i.forEach(function(t){n[t]&&(this.eventMap[t]=n[t].bind(n))},this),this.eventSources[t]=n)},registerTarget:function(t,e){this.scrollType.set(t,e||"none"),this.listen(this.events,t,this.boundHandler)},unregisterTarget:function(t){this.scrollType.set(t,null),this.unlisten(this.events,t,this.boundHandler)},down:function(t){this.fireEvent("pointerdown",t)},move:function(t){this.fireEvent("pointermove",t)},up:function(t){this.fireEvent("pointerup",t)},enter:function(t){this.fireEvent("pointerenter",t)},leave:function(t){this.fireEvent("pointerleave",t)},over:function(t){this.fireEvent("pointerover",t)},out:function(t){this.fireEvent("pointerout",t)},cancel:function(t){this.fireEvent("pointercancel",t)},eventHandler:function(t){if(!this.handledEvents.get(t)){var e=t.type,n=this.eventMap&&this.eventMap[e];n&&n(t),this.handledEvents.set(t,!0)}},listen:function(t,e,n){t.forEach(function(t){this.addEvent(t,n,!1,e)},this)},unlisten:function(t,e,n){t.forEach(function(t){this.removeEvent(t,n,!1,e)},this)},addEvent:function(t,e,n,i){i.addEventListener(t,e,n)},removeEvent:function(t,e,n,i){i.removeEventListener(t,e,n)},makeEvent:function(t,e){var n=new PointerEvent(t,e);return this.targets.set(n,this.targets.get(e)||e.target),n},fireEvent:function(t,e){var n=this.makeEvent(t,e);return this.dispatchEvent(n)},cloneEvent:function(t){var e={};for(var n in t)e[n]=t[n];return e},getTarget:function(t){return this.captureInfo&&this.captureInfo.id===t.pointerId?this.captureInfo.target:this.targets.get(t)},setCapture:function(t,e){this.captureInfo&&this.releaseCapture(this.captureInfo.id),this.captureInfo={id:t,target:e};var n=new PointerEvent("gotpointercapture",{bubbles:!0});this.implicitRelease=this.releaseCapture.bind(this,t),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease),this.targets.set(n,e),this.asyncDispatchEvent(n)},releaseCapture:function(t){if(this.captureInfo&&this.captureInfo.id===t){var e=new PointerEvent("lostpointercapture",{bubbles:!0}),n=this.captureInfo.target;this.captureInfo=null,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease),this.targets.set(e,n),this.asyncDispatchEvent(e)}},dispatchEvent:function(t){var e=this.getTarget(t);return e?e.dispatchEvent(t):void 0},asyncDispatchEvent:function(t){setTimeout(this.dispatchEvent.bind(this,t),0)}};e.boundHandler=e.eventHandler.bind(e),t.dispatcher=e}(window.PointerEventsPolyfill),function(t){var e=t.dispatcher,n=Array.prototype.forEach.call.bind(Array.prototype.forEach),i=Array.prototype.map.call.bind(Array.prototype.map),r={ATTRIB:"touch-action",SELECTOR:"[touch-action]",EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|scroll$/,OBSERVER_INIT:{subtree:!0,childList:!0,attributes:!0,attributeFilter:["touch-action"]},watchSubtree:function(t){a.observe(t,this.OBSERVER_INIT)},enableOnSubtree:function(t){var e=t||document;this.watchSubtree(t),e===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(e)},installNewSubtree:function(t){n(this.findElements(t),this.addElement,this)},findElements:function(t){var e=t||document;return e.querySelectorAll?e.querySelectorAll(this.SELECTOR):[]},touchActionToScrollType:function(t){var e=t;return e===this.EMITTER?"none":e===this.XSCROLLER?"X":e===this.YSCROLLER?"Y":this.SCROLLER.exec(e)?"XY":void 0},removeElement:function(n){e.unregisterTarget(n);var i=t.targetFinding.shadow(n);i&&e.unregisterTarget(i)},addElement:function(n){var i=n.getAttribute&&n.getAttribute(this.ATTRIB),r=this.touchActionToScrollType(i);if(r){e.registerTarget(n,r);var o=t.targetFinding.shadow(n);o&&e.registerTarget(o,r)}},elementChanged:function(t){this.removeElement(t),this.addElement(t)},concatLists:function(t,e){for(var n,i=0,r=e.length;r>i&&(n=e[i]);i++)t.push(n);return t},installOnLoad:function(){document.addEventListener("DOMContentLoaded",this.installNewSubtree.bind(this,document))},flattenMutationTree:function(t){var e=i(t,this.findElements,this);return e.push(t),e.reduce(this.concatLists,[])},mutationWatcher:function(t){t.forEach(this.mutationHandler,this)},mutationHandler:function(t){var e=t;if("childList"===e.type){var n=this.flattenMutationTree(e.addedNodes);n.forEach(this.addElement,this);var i=this.flattenMutationTree(e.removedNodes);i.forEach(this.removeElement,this)}else"attributes"===e.type&&this.elementChanged(e.target)}},o=r.mutationWatcher.bind(r);t.installer=r,t.register=r.enableOnSubtree.bind(r),t.setTouchAction=function(t,n){var i=this.touchActionToScrollType(n);i?e.registerTarget(t,i):e.unregisterTarget(t)}.bind(r);var s=window.MutationObserver||window.WebKitMutationObserver;if(s)var a=new s(o);else r.watchSubtree=function(){console.warn("PointerEventsPolyfill: MutationObservers not found, touch-action will not be dynamically detected")}}(window.PointerEventsPolyfill),function(t){var e={shadow:function(t){if(t){var e=t.webkitShadowRoot||t.shadowRoot;if(e&&e.elementFromPoint)return e}},searchRoot:function(t,e,n){if(t){var i,r,o,s=t.elementFromPoint(e,n);for(r=this.shadow(s);r;){if(i=r.elementFromPoint(e,n)){var a=this.shadow(i);return this.searchRoot(a,e,n)||i}o=r.querySelector("shadow"),r=o&&o.olderShadowRoot}return s}},findTarget:function(t){var e=t.clientX,n=t.clientY;return this.searchRoot(document,e,n)}};t.targetFinding=e,t.findTarget=e.findTarget.bind(e)}(window.PointerEventsPolyfill),function(t){var e=t.dispatcher,n=t.installer,i=t.findTarget,r=e.pointermap,o=Array.prototype.map.call.bind(Array.prototype.map),s=2500,a=25,u={events:["touchstart","touchmove","touchend","touchcancel"],POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(t){return this.firstTouch===t.identifier},setPrimaryTouch:function(t){null===this.firstTouch&&(this.firstTouch=t.identifier,this.firstXY={X:t.clientX,Y:t.clientY},this.scrolling=!1)},removePrimaryTouch:function(t){this.isPrimaryTouch(t)&&(this.firstTouch=null,this.firstXY=null)},touchToPointer:function(t){var n=e.cloneEvent(t);return n.pointerId=t.identifier+2,n.target=i(n),n.bubbles=!0,n.cancelable=!0,n.button=0,n.buttons=1,n.isPrimary=this.isPrimaryTouch(t),n.pointerType=this.POINTER_TYPE,n},processTouches:function(t,e){var n=t.changedTouches,i=o(n,this.touchToPointer,this);i.forEach(e,this)},shouldScroll:function(t){if(this.firstXY){var n,i=e.scrollType.get(t.currentTarget);if("none"===i)n=!1;else if("XY"===i)n=!0;else{var r=t.changedTouches[0],o=i,s="Y"===i?"X":"Y",a=Math.abs(r["client"+o]-this.firstXY[o]),u=Math.abs(r["client"+s]-this.firstXY[s]);n=a>=u}return this.firstXY=null,n}},findTouch:function(t,e){for(var n,i=0,r=t.length;r>i&&(n=t[i]);i++)if(n.identifier===e)return!0},vacuumTouches:function(t){var e=t.touches;if(r.size>=e.length){var n=[];r.ids.forEach(function(t){if(1!==t&&!this.findTouch(e,t-2)){var i=r.get(t).out;n.push(this.touchToPointer(i))}},this),n.forEach(this.cancelOut,this)}},touchstart:function(t){this.vacuumTouches(t),this.setPrimaryTouch(t.changedTouches[0]),this.scrolling||this.processTouches(t,this.overDown)},overDown:function(t){r.set(t.pointerId,{target:t.target,out:t,outTarget:t.target}),e.over(t),e.down(t)},touchmove:function(t){this.scrolling||(this.shouldScroll(t)?(this.scrolling=!0,this.touchcancel(t)):(t.preventDefault(),this.processTouches(t,this.moveOverOut)))},moveOverOut:function(t){var n=t,i=r.get(n.pointerId),o=i.out,s=i.outTarget;e.move(n),o&&s!==n.target&&(o.relatedTarget=n.target,n.relatedTarget=s,o.target=s,e.out(o),e.over(n)),i.out=n,i.outTarget=n.target},touchend:function(t){this.dedupSynthMouse(t),this.processTouches(t,this.upOut)},upOut:function(t){this.scrolling||(e.up(t),e.out(t)),this.cleanUpPointer(t)},touchcancel:function(t){this.processTouches(t,this.cancelOut)},cancelOut:function(t){e.cancel(t),e.out(t),this.cleanUpPointer(t)},cleanUpPointer:function(t){r.delete(t.pointerId),this.removePrimaryTouch(t)},dedupSynthMouse:function(t){var e=c.lastTouches,n=t.changedTouches[0];if(this.isPrimaryTouch(n)){var i={x:n.clientX,y:n.clientY};e.push(i);var r=function(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}.bind(null,e,i);setTimeout(r,s)}}},c={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],global:["mousedown","mouseup","mouseover","mouseout"],lastTouches:[],mouseHandler:e.eventHandler.bind(e),isEventSimulatedFromTouch:function(t){for(var e,n=this.lastTouches,i=t.clientX,r=t.clientY,o=0,s=n.length;s>o&&(e=n[o]);o++){var u=Math.abs(i-e.x),c=Math.abs(r-e.y);if(a>=u&&a>=c)return!0}},prepareEvent:function(t){var n=e.cloneEvent(t);return n.pointerId=this.POINTER_ID,n.isPrimary=!0,n.pointerType=this.POINTER_TYPE,n},mousedown:function(t){if(!this.isEventSimulatedFromTouch(t)){var n=r.has(this.POINTER_ID);if(n&&(this.cancel(t),n=!1),!n){var i=this.prepareEvent(t);r.set(this.POINTER_ID,t),e.down(i),e.listen(this.global,document,this.mouseHandler)}}},mousemove:function(t){if(!this.isEventSimulatedFromTouch(t)){var n=this.prepareEvent(t);e.move(n)}},mouseup:function(t){if(!this.isEventSimulatedFromTouch(t)){var n=r.get(this.POINTER_ID);if(n&&n.button===t.button){var i=this.prepareEvent(t);e.up(i),this.cleanupMouse()}}},mouseover:function(t){if(!this.isEventSimulatedFromTouch(t)){var n=this.prepareEvent(t);e.over(n)}},mouseout:function(t){if(!this.isEventSimulatedFromTouch(t)){var n=this.prepareEvent(t);e.out(n)}},cancel:function(t){var n=this.prepareEvent(t);e.cancel(n),this.cleanupMouse()},cleanupMouse:function(){r.delete(this.POINTER_ID),e.unlisten(this.global,document,this.mouseHandler)}},h={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(t){var n=e.cloneEvent(t);return n.pointerType=this.POINTER_TYPES[t.pointerType],n},MSPointerDown:function(t){var n=this.prepareEvent(t);e.down(n)},MSPointerMove:function(t){var n=this.prepareEvent(t);e.move(n)},MSPointerUp:function(t){var n=this.prepareEvent(t);e.up(n)},MSPointerOut:function(t){var n=this.prepareEvent(t);e.out(n)},MSPointerOver:function(t){var n=this.prepareEvent(t);e.over(n)},MSPointerCancel:function(t){var n=this.prepareEvent(t);e.cancel(n)},MSLostPointerCapture:function(t){var n=e.makeEvent("lostpointercapture",t);e.dispatchEvent(n)},MSGotPointerCapture:function(t){var n=e.makeEvent("gotpointercapture",t);e.dispatchEvent(n)}};if(void 0===window.navigator.pointerEnabled){if(window.navigator.msPointerEnabled){var l=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:l,enumerable:!0}),e.registerSource("ms",h),e.registerTarget(document)}else e.registerSource("mouse",c),"ontouchstart"in window&&e.registerSource("touch",u),n.enableOnSubtree(document),e.listen(["mousemove"],document);Object.defineProperty(window.navigator,"pointerEnabled",{value:!0,enumerable:!0})}}(window.PointerEventsPolyfill),function(t){var e,n,i=t.dispatcher,r=window.navigator,o=function(t){if(!i.pointermap.has(t))throw Error("InvalidPointerId");return!0};r.msPointerEnabled?(e=Element.prototype.msSetPointerCapture,n=Element.prototype.msReleasePointerCapture):(e=function(t){o(t)&&i.setCapture(t,this)},n=function(t){o(t)&&i.releaseCapture(t,this)}),Element.prototype.setPointerCapture||Object.defineProperties(Element.prototype,{setPointerCapture:{value:e},releasePointerCapture:{value:n}})}(window.PointerEventsPolyfill);

/*! Hammer.JS - v1.0.6dev - 2013-04-10
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

(function(t,e){"use strict";function n(){if(!i.READY){i.event.determineEventTypes();for(var t in i.gestures)i.gestures.hasOwnProperty(t)&&i.detection.register(i.gestures[t]);i.event.onTouch(i.DOCUMENT,i.EVENT_MOVE,i.detection.detect),i.event.onTouch(i.DOCUMENT,i.EVENT_END,i.detection.detect),i.READY=!0}}var i=function(t,e){return new i.Instance(t,e||{})};i.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&navigator.userAgent.match(i.MOBILE_REGEX),i.EVENT_TYPES={},i.DIRECTION_DOWN="down",i.DIRECTION_LEFT="left",i.DIRECTION_UP="up",i.DIRECTION_RIGHT="right",i.POINTER_MOUSE="mouse",i.POINTER_TOUCH="touch",i.POINTER_PEN="pen",i.EVENT_START="start",i.EVENT_MOVE="move",i.EVENT_END="end",i.DOCUMENT=document,i.plugins={},i.READY=!1,i.Instance=function(t,e){var r=this;return n(),this.element=t,this.enabled=!0,this.options=i.utils.extend(i.utils.extend({},i.defaults),e||{}),this.options.stop_browser_behavior&&i.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),i.event.onTouch(t,i.EVENT_START,function(t){r.enabled&&i.detection.startDetect(r,t)}),this},i.Instance.prototype={on:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.addEventListener(n[i],e,!1);return this},off:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.removeEventListener(n[i],e,!1);return this},trigger:function(t,e){var n=i.DOCUMENT.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e;var r=this.element;return i.utils.hasParent(e.target,r)&&(r=e.target),r.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this}};var r=null,o=!1,s=!1;i.event={bindDom:function(t,e,n){for(var i=e.split(" "),r=0;i.length>r;r++)t.addEventListener(i[r],n,!1)},onTouch:function(t,e,n){var a=this;this.bindDom(t,i.EVENT_TYPES[e],function(c){var u=c.type.toLowerCase();if(!u.match(/mouse/)||!s){u.match(/touch/)||u.match(/pointerdown/)||u.match(/mouse/)&&1===c.which?o=!0:u.match(/mouse/)&&1!==c.which&&(o=!1),u.match(/touch|pointer/)&&(s=!0);var h=0;o&&(i.HAS_POINTEREVENTS&&e!=i.EVENT_END?h=i.PointerEvent.updatePointer(e,c):u.match(/touch/)?h=c.touches.length:s||(h=u.match(/up/)?0:1),h>0&&e==i.EVENT_END?e=i.EVENT_MOVE:h||(e=i.EVENT_END),h||null===r?r=c:c=r,n.call(i.detection,a.collectEventData(t,e,c)),i.HAS_POINTEREVENTS&&e==i.EVENT_END&&(h=i.PointerEvent.updatePointer(e,c))),h||(r=null,o=!1,s=!1,i.PointerEvent.reset())}})},determineEventTypes:function(){var t;t=i.HAS_POINTEREVENTS?i.PointerEvent.getEvents():i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],i.EVENT_TYPES[i.EVENT_START]=t[0],i.EVENT_TYPES[i.EVENT_MOVE]=t[1],i.EVENT_TYPES[i.EVENT_END]=t[2]},getTouchList:function(t){return i.HAS_POINTEREVENTS?i.PointerEvent.getTouchList():t.touches?t.touches:[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]},collectEventData:function(t,e,n){var r=this.getTouchList(n,e),o=i.POINTER_TOUCH;return(n.type.match(/mouse/)||i.PointerEvent.matchType(i.POINTER_MOUSE,n))&&(o=i.POINTER_MOUSE),{center:i.utils.getCenter(r),timeStamp:(new Date).getTime(),target:n.target,touches:r,eventType:e,pointerType:o,srcEvent:n,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return i.detection.stopDetect()}}}},i.PointerEvent={pointers:{},getTouchList:function(){var t=this,e=[];return Object.keys(t.pointers).sort().forEach(function(n){e.push(t.pointers[n])}),e},updatePointer:function(t,e){return t==i.EVENT_END?this.pointers={}:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e),Object.keys(this.pointers).length},matchType:function(t,e){if(!e.pointerType)return!1;var n={};return n[i.POINTER_MOUSE]=e.pointerType==e.MSPOINTER_TYPE_MOUSE||e.pointerType==i.POINTER_MOUSE,n[i.POINTER_TOUCH]=e.pointerType==e.MSPOINTER_TYPE_TOUCH||e.pointerType==i.POINTER_TOUCH,n[i.POINTER_PEN]=e.pointerType==e.MSPOINTER_TYPE_PEN||e.pointerType==i.POINTER_PEN,n[t]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},i.utils={extend:function(t,n,i){for(var r in n)t[r]!==e&&i||(t[r]=n[r]);return t},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){for(var e=[],n=[],i=0,r=t.length;r>i;i++)e.push(t[i].pageX),n.push(t[i].pageY);return{pageX:(Math.min.apply(Math,e)+Math.max.apply(Math,e))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(t,e,n){return{x:Math.abs(e/t)||0,y:Math.abs(n/t)||0}},getAngle:function(t,e){var n=e.pageY-t.pageY,i=e.pageX-t.pageX;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){var n=Math.abs(t.pageX-e.pageX),r=Math.abs(t.pageY-e.pageY);return n>=r?t.pageX-e.pageX>0?i.DIRECTION_LEFT:i.DIRECTION_RIGHT:t.pageY-e.pageY>0?i.DIRECTION_UP:i.DIRECTION_DOWN},getDistance:function(t,e){var n=e.pageX-t.pageX,i=e.pageY-t.pageY;return Math.sqrt(n*n+i*i)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==i.DIRECTION_UP||t==i.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,e){var n,i=["webkit","khtml","moz","ms","o",""];if(e&&t.style){for(var r=0;i.length>r;r++)for(var o in e)e.hasOwnProperty(o)&&(n=o,i[r]&&(n=i[r]+n.substring(0,1).toUpperCase()+n.substring(1)),t.style[n]=e[o]);"none"==e.userSelect&&(t.onselectstart=function(){return!1})}}},i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:i.utils.extend({},e),lastEvent:!1,name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);for(var e=this.current.inst.options,n=0,r=this.gestures.length;r>n;n++){var o=this.gestures[n];if(!this.stopped&&e[o.name]!==!1&&o.handler.call(o,t,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=t),t.eventType==i.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t}},stopDetect:function(){this.previous=i.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var e=this.current.startEvent;if(e&&(t.touches.length!=e.touches.length||t.touches===e.touches)){e.touches=[];for(var n=0,r=t.touches.length;r>n;n++)e.touches.push(i.utils.extend({},t.touches[n]))}var o=t.timeStamp-e.timeStamp,s=t.center.pageX-e.center.pageX,a=t.center.pageY-e.center.pageY,c=i.utils.getVelocity(o,s,a);return i.utils.extend(t,{deltaTime:o,deltaX:s,deltaY:a,velocityX:c.x,velocityY:c.y,distance:i.utils.getDistance(e.center,t.center),angle:i.utils.getAngle(e.center,t.center),direction:i.utils.getDirection(e.center,t.center),scale:i.utils.getScale(e.touches,t.touches),rotation:i.utils.getRotation(e.touches,t.touches),startEvent:e}),t},register:function(t){var n=t.defaults||{};return n[t.name]===e&&(n[t.name]=!0),i.utils.extend(i.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}},i.gestures=i.gestures||{},i.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,e){switch(t.eventType){case i.EVENT_START:clearTimeout(this.timer),i.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==i.detection.current.name&&e.trigger("hold",t)},e.options.hold_timeout);break;case i.EVENT_MOVE:t.distance>e.options.hold_threshold&&clearTimeout(this.timer);break;case i.EVENT_END:clearTimeout(this.timer)}}},i.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,e){if(t.eventType==i.EVENT_END){var n=i.detection.previous,r=!1;if(t.deltaTime>e.options.tap_max_touchtime||t.distance>e.options.tap_max_distance)return;n&&"tap"==n.name&&t.timeStamp-n.lastEvent.timeStamp<e.options.doubletap_interval&&t.distance<e.options.doubletap_distance&&(e.trigger("doubletap",t),r=!0),(!r||e.options.tap_always)&&(i.detection.current.name="tap",e.trigger(i.detection.current.name,t))}}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,e){if(t.eventType==i.EVENT_END){if(e.options.swipe_max_touches>0&&t.touches.length>e.options.swipe_max_touches)return;(t.velocityX>e.options.swipe_velocity||t.velocityY>e.options.swipe_velocity)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},i.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,n){if(i.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),this.triggered=!1,e;if(!(n.options.drag_max_touches>0&&t.touches.length>n.options.drag_max_touches))switch(t.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:if(t.distance<n.options.drag_min_distance&&i.detection.current.name!=this.name)return;i.detection.current.name=this.name,(i.detection.current.lastEvent.drag_locked_to_axis||n.options.drag_lock_to_axis&&n.options.drag_lock_min_distance<=t.distance)&&(t.drag_locked_to_axis=!0);var r=i.detection.current.lastEvent.direction;t.drag_locked_to_axis&&r!==t.direction&&(t.direction=i.utils.isVertical(r)?0>t.deltaY?i.DIRECTION_UP:i.DIRECTION_DOWN:0>t.deltaX?i.DIRECTION_LEFT:i.DIRECTION_RIGHT),this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),n.trigger(this.name+t.direction,t),(n.options.drag_block_vertical&&i.utils.isVertical(t.direction)||n.options.drag_block_horizontal&&!i.utils.isVertical(t.direction))&&t.preventDefault();break;case i.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},i.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,n){if(i.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),this.triggered=!1,e;if(!(2>t.touches.length))switch(n.options.transform_always_block&&t.preventDefault(),t.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:var r=Math.abs(1-t.scale),o=Math.abs(t.rotation);if(n.options.transform_min_scale>r&&n.options.transform_min_rotation>o)return;i.detection.current.name=this.name,this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),o>n.options.transform_min_rotation&&n.trigger("rotate",t),r>n.options.transform_min_scale&&(n.trigger("pinch",t),n.trigger("pinch"+(1>t.scale?"in":"out"),t));break;case i.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},i.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,n){return n.options.prevent_mouseevents&&t.pointerType==i.POINTER_MOUSE?(t.stopDetect(),e):(n.options.prevent_default&&t.preventDefault(),t.eventType==i.EVENT_START&&n.trigger(this.name,t),e)}},i.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==i.EVENT_END&&e.trigger(this.name,t)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=i:(t.Hammer=i,"function"==typeof t.define&&t.define.amd&&t.define("hammer",[],function(){return i}))})(this);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||(navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator))||(function(h){"use strict";var r=h.document,l=function(){return h.URL||h.webkitURL||h},e=h.URL||h.webkitURL||h,n=r.createElementNS("http://www.w3.org/1999/xhtml","a"),g=!h.externalHost&&"download" in n,j=function(t){var s=r.createEvent("MouseEvents");s.initMouseEvent("click",true,false,h,0,0,0,0,0,false,false,false,false,0,null);t.dispatchEvent(s)},o=h.webkitRequestFileSystem,p=h.requestFileSystem||o||h.mozRequestFileSystem,m=function(s){(h.setImmediate||h.setTimeout)(function(){throw s},0)},c="application/octet-stream",k=0,b=[],i=function(){var t=b.length;while(t--){var s=b[t];if(typeof s==="string"){e.revokeObjectURL(s)}else{s.remove()}}b.length=0},q=function(t,s,w){s=[].concat(s);var v=s.length;while(v--){var x=t["on"+s[v]];if(typeof x==="function"){try{x.call(t,w||t)}catch(u){m(u)}}}},f=function(t,u){var v=this,B=t.type,E=false,x,w,s=function(){var F=l().createObjectURL(t);b.push(F);return F},A=function(){q(v,"writestart progress write writeend".split(" "))},D=function(){if(E||!x){x=s(t)}if(w){w.location.href=x}else{window.open(x,"_blank")}v.readyState=v.DONE;A()},z=function(F){return function(){if(v.readyState!==v.DONE){return F.apply(this,arguments)}}},y={create:true,exclusive:false},C;v.readyState=v.INIT;if(!u){u="download"}if(g){x=s(t);n.href=x;n.download=u;j(n);v.readyState=v.DONE;A();return}if(h.chrome&&B&&B!==c){C=t.slice||t.webkitSlice;t=C.call(t,0,t.size,c);E=true}if(o&&u!=="download"){u+=".download"}if(B===c||o){w=h}if(!p){D();return}k+=t.size;p(h.TEMPORARY,k,z(function(F){F.root.getDirectory("saved",y,z(function(G){var H=function(){G.getFile(u,y,z(function(I){I.createWriter(z(function(J){J.onwriteend=function(K){w.location.href=I.toURL();b.push(I);v.readyState=v.DONE;q(v,"writeend",K)};J.onerror=function(){var K=J.error;if(K.code!==K.ABORT_ERR){D()}};"writestart progress write abort".split(" ").forEach(function(K){J["on"+K]=v["on"+K]});J.write(t);v.abort=function(){J.abort();v.readyState=v.DONE};v.readyState=v.WRITING}),D)}),D)};G.getFile(u,{create:false},z(function(I){I.remove();H()}),z(function(I){if(I.code===I.NOT_FOUND_ERR){H()}else{D()}}))}),D)}),D)},d=f.prototype,a=function(s,t){return new f(s,t)};d.abort=function(){var s=this;s.readyState=s.DONE;q(s,"abort")};d.readyState=d.INIT=0;d.WRITING=1;d.DONE=2;d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null;h.addEventListener("unload",i,false);return a}(self));
/*
 RequireJS 2.1.6 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var requirejs,require,define;
(function(ba){function J(b){return"[object Function]"===N.call(b)}function K(b){return"[object Array]"===N.call(b)}function z(b,c){if(b){var d;for(d=0;d<b.length&&(!b[d]||!c(b[d],d,b));d+=1);}}function O(b,c){if(b){var d;for(d=b.length-1;-1<d&&(!b[d]||!c(b[d],d,b));d-=1);}}function t(b,c){return ha.call(b,c)}function m(b,c){return t(b,c)&&b[c]}function H(b,c){for(var d in b)if(t(b,d)&&c(b[d],d))break}function S(b,c,d,m){c&&H(c,function(c,l){if(d||!t(b,l))m&&"string"!==typeof c?(b[l]||(b[l]={}),S(b[l],
c,d,m)):b[l]=c});return b}function v(b,c){return function(){return c.apply(b,arguments)}}function ca(b){throw b;}function da(b){if(!b)return b;var c=ba;z(b.split("."),function(b){c=c[b]});return c}function B(b,c,d,m){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=m;d&&(c.originalError=d);return c}function ia(b){function c(a,f,C){var e,n,b,c,d,T,k,g=f&&f.split("/");e=g;var l=j.map,h=l&&l["*"];if(a&&"."===a.charAt(0))if(f){e=m(j.pkgs,f)?g=[f]:g.slice(0,g.length-
1);f=a=e.concat(a.split("/"));for(e=0;f[e];e+=1)if(n=f[e],"."===n)f.splice(e,1),e-=1;else if(".."===n)if(1===e&&(".."===f[2]||".."===f[0]))break;else 0<e&&(f.splice(e-1,2),e-=2);e=m(j.pkgs,f=a[0]);a=a.join("/");e&&a===f+"/"+e.main&&(a=f)}else 0===a.indexOf("./")&&(a=a.substring(2));if(C&&l&&(g||h)){f=a.split("/");for(e=f.length;0<e;e-=1){b=f.slice(0,e).join("/");if(g)for(n=g.length;0<n;n-=1)if(C=m(l,g.slice(0,n).join("/")))if(C=m(C,b)){c=C;d=e;break}if(c)break;!T&&(h&&m(h,b))&&(T=m(h,b),k=e)}!c&&
T&&(c=T,d=k);c&&(f.splice(0,d,c),a=f.join("/"))}return a}function d(a){A&&z(document.getElementsByTagName("script"),function(f){if(f.getAttribute("data-requiremodule")===a&&f.getAttribute("data-requirecontext")===k.contextName)return f.parentNode.removeChild(f),!0})}function p(a){var f=m(j.paths,a);if(f&&K(f)&&1<f.length)return d(a),f.shift(),k.require.undef(a),k.require([a]),!0}function g(a){var f,b=a?a.indexOf("!"):-1;-1<b&&(f=a.substring(0,b),a=a.substring(b+1,a.length));return[f,a]}function l(a,
f,b,e){var n,D,i=null,d=f?f.name:null,l=a,h=!0,j="";a||(h=!1,a="_@r"+(N+=1));a=g(a);i=a[0];a=a[1];i&&(i=c(i,d,e),D=m(r,i));a&&(i?j=D&&D.normalize?D.normalize(a,function(a){return c(a,d,e)}):c(a,d,e):(j=c(a,d,e),a=g(j),i=a[0],j=a[1],b=!0,n=k.nameToUrl(j)));b=i&&!D&&!b?"_unnormalized"+(O+=1):"";return{prefix:i,name:j,parentMap:f,unnormalized:!!b,url:n,originalName:l,isDefine:h,id:(i?i+"!"+j:j)+b}}function s(a){var f=a.id,b=m(q,f);b||(b=q[f]=new k.Module(a));return b}function u(a,f,b){var e=a.id,n=m(q,
e);if(t(r,e)&&(!n||n.defineEmitComplete))"defined"===f&&b(r[e]);else if(n=s(a),n.error&&"error"===f)b(n.error);else n.on(f,b)}function w(a,f){var b=a.requireModules,e=!1;if(f)f(a);else if(z(b,function(f){if(f=m(q,f))f.error=a,f.events.error&&(e=!0,f.emit("error",a))}),!e)h.onError(a)}function x(){U.length&&(ja.apply(I,[I.length-1,0].concat(U)),U=[])}function y(a){delete q[a];delete W[a]}function G(a,f,b){var e=a.map.id;a.error?a.emit("error",a.error):(f[e]=!0,z(a.depMaps,function(e,c){var d=e.id,
g=m(q,d);g&&(!a.depMatched[c]&&!b[d])&&(m(f,d)?(a.defineDep(c,r[d]),a.check()):G(g,f,b))}),b[e]=!0)}function E(){var a,f,b,e,n=(b=1E3*j.waitSeconds)&&k.startTime+b<(new Date).getTime(),c=[],i=[],g=!1,l=!0;if(!X){X=!0;H(W,function(b){a=b.map;f=a.id;if(b.enabled&&(a.isDefine||i.push(b),!b.error))if(!b.inited&&n)p(f)?g=e=!0:(c.push(f),d(f));else if(!b.inited&&(b.fetched&&a.isDefine)&&(g=!0,!a.prefix))return l=!1});if(n&&c.length)return b=B("timeout","Load timeout for modules: "+c,null,c),b.contextName=
k.contextName,w(b);l&&z(i,function(a){G(a,{},{})});if((!n||e)&&g)if((A||ea)&&!Y)Y=setTimeout(function(){Y=0;E()},50);X=!1}}function F(a){t(r,a[0])||s(l(a[0],null,!0)).init(a[1],a[2])}function L(a){var a=a.currentTarget||a.srcElement,b=k.onScriptLoad;a.detachEvent&&!Z?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=k.onScriptError;(!a.detachEvent||Z)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function M(){var a;for(x();I.length;){a=
I.shift();if(null===a[0])return w(B("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));F(a)}}var X,$,k,P,Y,j={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},q={},W={},aa={},I=[],r={},V={},N=1,O=1;P={require:function(a){return a.require?a.require:a.require=k.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?a.exports:a.exports=r[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){var b=
m(j.pkgs,a.map.id);return(b?m(j.config,a.map.id+"/"+b.main):m(j.config,a.map.id))||{}},exports:r[a.map.id]}}};$=function(a){this.events=m(aa,a.id)||{};this.map=a;this.shim=m(j.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};$.prototype={init:function(a,b,c,e){e=e||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=v(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=
!0;this.ignore=e.ignore;e.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;k.startTime=(new Date).getTime();var a=this.map;if(this.shim)k.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],v(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=
this.map.url;V[a]||(V[a]=!0,k.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var e=this.exports,n=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(J(n)){if(this.events.error&&this.map.isDefine||h.onError!==ca)try{e=k.execCb(c,n,b,e)}catch(d){a=d}else e=k.execCb(c,n,b,e);this.map.isDefine&&((b=this.module)&&void 0!==b.exports&&b.exports!==
this.exports?e=b.exports:void 0===e&&this.usingExports&&(e=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",w(this.error=a)}else e=n;this.exports=e;if(this.map.isDefine&&!this.ignore&&(r[c]=e,h.onResourceLoad))h.onResourceLoad(k,this.map,this.depMaps);y(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=
!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=l(a.prefix);this.depMaps.push(d);u(d,"defined",v(this,function(e){var n,d;d=this.map.name;var g=this.map.parentMap?this.map.parentMap.name:null,C=k.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(e.normalize&&(d=e.normalize(d,function(a){return c(a,g,!0)})||""),e=l(a.prefix+"!"+d,this.map.parentMap),u(e,"defined",v(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),
d=m(q,e.id)){this.depMaps.push(e);if(this.events.error)d.on("error",v(this,function(a){this.emit("error",a)}));d.enable()}}else n=v(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),n.error=v(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];H(q,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&y(a.map.id)});w(a)}),n.fromText=v(this,function(e,c){var d=a.name,g=l(d),i=Q;c&&(e=c);i&&(Q=!1);s(g);t(j.config,b)&&(j.config[d]=j.config[b]);try{h.exec(e)}catch(D){return w(B("fromtexteval",
"fromText eval for "+b+" failed: "+D,D,[b]))}i&&(Q=!0);this.depMaps.push(g);k.completeLoad(d);C([d],n)}),e.load(a.name,C,n,j)}));k.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){W[this.map.id]=this;this.enabling=this.enabled=!0;z(this.depMaps,v(this,function(a,b){var c,e;if("string"===typeof a){a=l(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=m(P,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;u(a,"defined",v(this,function(a){this.defineDep(b,
a);this.check()}));this.errback&&u(a,"error",v(this,this.errback))}c=a.id;e=q[c];!t(P,c)&&(e&&!e.enabled)&&k.enable(a,this)}));H(this.pluginMaps,v(this,function(a){var b=m(q,a.id);b&&!b.enabled&&k.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){z(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};k={config:j,contextName:b,registry:q,defined:r,urlFetched:V,defQueue:I,Module:$,makeModuleMap:l,
nextTick:h.nextTick,onError:w,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=j.pkgs,c=j.shim,e={paths:!0,config:!0,map:!0};H(a,function(a,b){e[b]?"map"===b?(j.map||(j.map={}),S(j[b],a,!0,!0)):S(j[b],a,!0):j[b]=a});a.shim&&(H(a.shim,function(a,b){K(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn)a.exportsFn=k.makeShimExports(a);c[b]=a}),j.shim=c);a.packages&&(z(a.packages,function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,
location:a.location||a.name,main:(a.main||"main").replace(ka,"").replace(fa,"")}}),j.pkgs=b);H(q,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=l(b))});if(a.deps||a.callback)k.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(ba,arguments));return b||a.exports&&da(a.exports)}},makeRequire:function(a,f){function d(e,c,g){var i,j;f.enableBuildCallback&&(c&&J(c))&&(c.__requireJsBuild=!0);if("string"===typeof e){if(J(c))return w(B("requireargs",
"Invalid require call"),g);if(a&&t(P,e))return P[e](q[a.id]);if(h.get)return h.get(k,e,a,d);i=l(e,a,!1,!0);i=i.id;return!t(r,i)?w(B("notloaded",'Module name "'+i+'" has not been loaded yet for context: '+b+(a?"":". Use require([])"))):r[i]}M();k.nextTick(function(){M();j=s(l(null,a));j.skipMap=f.skipMap;j.init(e,c,g,{enabled:!0});E()});return d}f=f||{};S(d,{isBrowser:A,toUrl:function(b){var d,f=b.lastIndexOf("."),g=b.split("/")[0];if(-1!==f&&(!("."===g||".."===g)||1<f))d=b.substring(f,b.length),b=
b.substring(0,f);return k.nameToUrl(c(b,a&&a.id,!0),d,!0)},defined:function(b){return t(r,l(b,a,!1,!0).id)},specified:function(b){b=l(b,a,!1,!0).id;return t(r,b)||t(q,b)}});a||(d.undef=function(b){x();var c=l(b,a,!0),d=m(q,b);delete r[b];delete V[c.url];delete aa[b];d&&(d.events.defined&&(aa[b]=d.events),y(b))});return d},enable:function(a){m(q,a.id)&&s(a).enable()},completeLoad:function(a){var b,c,e=m(j.shim,a)||{},d=e.exports;for(x();I.length;){c=I.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===
a&&(b=!0);F(c)}c=m(q,a);if(!b&&!t(r,a)&&c&&!c.inited){if(j.enforceDefine&&(!d||!da(d)))return p(a)?void 0:w(B("nodefine","No define call for "+a,null,[a]));F([a,e.deps||[],e.exportsFn])}E()},nameToUrl:function(a,b,c){var d,g,l,i,k,p;if(h.jsExtRegExp.test(a))i=a+(b||"");else{d=j.paths;g=j.pkgs;i=a.split("/");for(k=i.length;0<k;k-=1)if(p=i.slice(0,k).join("/"),l=m(g,p),p=m(d,p)){K(p)&&(p=p[0]);i.splice(0,k,p);break}else if(l){a=a===l.name?l.location+"/"+l.main:l.location;i.splice(0,k,a);break}i=i.join("/");
i+=b||(/\?/.test(i)||c?"":".js");i=("/"===i.charAt(0)||i.match(/^[\w\+\.\-]+:/)?"":j.baseUrl)+i}return j.urlArgs?i+((-1===i.indexOf("?")?"?":"&")+j.urlArgs):i},load:function(a,b){h.load(k,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||la.test((a.currentTarget||a.srcElement).readyState))R=null,a=L(a),k.completeLoad(a.id)},onScriptError:function(a){var b=L(a);if(!p(b.id))return w(B("scripterror","Script error for: "+b.id,a,[b.id]))}};k.require=k.makeRequire();
return k}var h,x,y,E,L,F,R,M,s,ga,ma=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,na=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,fa=/\.js$/,ka=/^\.\//;x=Object.prototype;var N=x.toString,ha=x.hasOwnProperty,ja=Array.prototype.splice,A=!!("undefined"!==typeof window&&navigator&&window.document),ea=!A&&"undefined"!==typeof importScripts,la=A&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Z="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),G={},u={},U=[],Q=
!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(J(requirejs))return;u=requirejs;requirejs=void 0}"undefined"!==typeof require&&!J(require)&&(u=require,require=void 0);h=requirejs=function(b,c,d,p){var g,l="_";!K(b)&&"string"!==typeof b&&(g=b,K(c)?(b=c,c=d,d=p):b=[]);g&&g.context&&(l=g.context);(p=m(G,l))||(p=G[l]=h.s.newContext(l));g&&p.configure(g);return p.require(b,c,d)};h.config=function(b){return h(b)};h.nextTick="undefined"!==typeof setTimeout?function(b){setTimeout(b,
4)}:function(b){b()};require||(require=h);h.version="2.1.6";h.jsExtRegExp=/^\/|:|\?|\.js$/;h.isBrowser=A;x=h.s={contexts:G,newContext:ia};h({});z(["toUrl","undef","defined","specified"],function(b){h[b]=function(){var c=G._;return c.require[b].apply(c,arguments)}});if(A&&(y=x.head=document.getElementsByTagName("head")[0],E=document.getElementsByTagName("base")[0]))y=x.head=E.parentNode;h.onError=ca;h.load=function(b,c,d){var h=b&&b.config||{},g;if(A)return g=h.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml",
"html:script"):document.createElement("script"),g.type=h.scriptType||"text/javascript",g.charset="utf-8",g.async=!0,g.setAttribute("data-requirecontext",b.contextName),g.setAttribute("data-requiremodule",c),g.attachEvent&&!(g.attachEvent.toString&&0>g.attachEvent.toString().indexOf("[native code"))&&!Z?(Q=!0,g.attachEvent("onreadystatechange",b.onScriptLoad)):(g.addEventListener("load",b.onScriptLoad,!1),g.addEventListener("error",b.onScriptError,!1)),g.src=d,M=g,E?y.insertBefore(g,E):y.appendChild(g),
M=null,g;if(ea)try{importScripts(d),b.completeLoad(c)}catch(l){b.onError(B("importscripts","importScripts failed for "+c+" at "+d,l,[c]))}};A&&O(document.getElementsByTagName("script"),function(b){y||(y=b.parentNode);if(L=b.getAttribute("data-main"))return s=L,u.baseUrl||(F=s.split("/"),s=F.pop(),ga=F.length?F.join("/")+"/":"./",u.baseUrl=ga),s=s.replace(fa,""),h.jsExtRegExp.test(s)&&(s=L),u.deps=u.deps?u.deps.concat(s):[s],!0});define=function(b,c,d){var h,g;"string"!==typeof b&&(d=c,c=b,b=null);
K(c)||(d=c,c=null);!c&&J(d)&&(c=[],d.length&&(d.toString().replace(ma,"").replace(na,function(b,d){c.push(d)}),c=(1===d.length?["require"]:["require","exports","module"]).concat(c)));if(Q){if(!(h=M))R&&"interactive"===R.readyState||O(document.getElementsByTagName("script"),function(b){if("interactive"===b.readyState)return R=b}),h=R;h&&(b||(b=h.getAttribute("data-requiremodule")),g=G[h.getAttribute("data-requirecontext")])}(g?g.defQueue:U).push([b,c,d])};define.amd={jQuery:!0};h.exec=function(b){return eval(b)};
h(u)}})(this);

/*
 RequireJS text 2.0.7 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/text for details
*/
define("env/Settings",[],function(){return{MANIFEST_KEY:"SkitchJS",MANIFEST_CREATOR:"skitchjs",VERSION:"1.0.0.185",USER_AGENT:"Skitch",APP_DATA_PATH:".skitch",STAMP_DEFAULT_WIDTH:100,STAMP_DEFAULT_HEIGHT:100,IMAGE_LOADER_PROXY_URL_PREFIX:"",SURFACE_BUFFER_EXPORT_DELAY_MS:800,LOG_FILE_INTERVAL_SECONDS:1,SESSION_TRACKING_INTERVAL_MINUTES:15,MARKETING_URL:"http://evernote.com/",TERMS_OF_SERVICE_URL:"http://evernote.com/tos/",PRIVACY_POLICY_URL:"http://evernote.com/privacy/",PRIVACY_POLICY_URL_JP:"http://evernote.com/intl/jp/legal/privacy.php",
SUPPORT_URL:"http://evernote.com/contact/support/",DISCUSSION_FORUM_URL:"http://discussion.evernote.com/forum/122-skitch-for-metro/",CHECKOUT_LOGIN_URL:"https://www.evernote.com/Login.action?targetUrl=%2FCheckout.action&layout=win&offer=accountView",CHECKOUT_URL:"https://www.evernote.com/Checkout.action?layout=win&offer=accountView",RELATIVE_CHECKOUT_URL:"/Checkout.action?layout=win&offer=accountView",AUTH_TOKEN_URL:"https://www.evernote.com/SetAuthToken.action",SKITCH_DESKTOP_URL:"http://evernote.com/skitch",
ENABLE_CANVAS_BUTTON_TEXT:!0,ENABLE_KEY_HANDLERS:!0,CROP_MARGIN:60,IS_EMBEDDED:!1,ENABLE_ANALYTICS:!0,SUPPORTS_TWO_FACTOR:!0,ANALYTICS_ACCOUNT:"UA-285778-57",SKITCH_NOTEBOOK_NAME:"Skitch",ACCEPTED_LANGUAGES:"*/*",DEFAULT_DB_NAME:"skitchdb",NOTE_TITLES:{blank:"",photo:"",camera:"",map:"",clipboard:"",pdf:"","default":""},FORCE_VERSION_UPDATE_PROMPT:!1,MIN_CROP_SIZE:1,JPEG_QUALITY:0.95,UPLOAD_WARNING_LIMIT:0.95,UPLOAD_MAXIMUM_LIMIT:1,ARROW_STROKE_WIDTH:2,ARROW_STROKE_COLOR:"rgba(0, 0, 0, 0.1)",MODAL_OVERLAY_COLOR:"rgba(0, 0, 0, 0.4)",
BACKGROUND_SHADOW_COLOR:"rgba(0, 0, 0, 0.2)",DEFAULT_SURFACE_BACKGROUND_COLOR:"#e0dede",BACKGROUND_SHADOW_SIZE:10,ENABLE_CANVAS_APPBAR:!0,ENABLE_CANVAS_BACK_BUTTON:!0,EDAM_APPLICATION_NAME:"Evernote Skitch Touch",EDAM_CONTENT_CLASS:"evernote.skitch",EDAM_CONSUMER_KEY:"en-win-skitch-new",ENABLE_CANVAS_DISCARD_BUTTON:!0,EDAM_CONTENT:'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">\n<en-note>\n<en-media type="${mime}" hash="${contentHash}"/>\n</en-note>',
MAX_RECTANGLE_CORNER_RADIUS:30,EVERNOTE_HOST:"www.evernote.com",EVERNOTE_STAGING_HOST:"stage.evernote.com",USE_EVERNOTE_STAGING_HOST:!1,EVERNOTE_INTL_BOOTSTRAP_HOST:"www.evernote.com",EVERNOTE_CHINA_BOOTSTRAP_HOST:"app.yinxiang.com",SKITCH_MARGIN:25,SKITCH_MIN_MARGIN:20,STORE_URI:"undefined"===typeof Windows?"":"ms-windows-store:PDP?PFN="+Windows.ApplicationModel.Package.current.id.familyName,MAX_TEXT_LENGTH:Infinity,TEXT_LINE_HEIGHT_PADDING:8,CANVAS_SCREEN_OPEN_DELAY:300,MAX_POINTERS_FOR_GESTURE:2,
SELECTION_STROKE_WIDTH:5,HIGHLIGHT_ALPHA:0.4,HANDLE_RADIUS:6,HANDLE_HIT_RADIUS:6,HANDLE_STROKE_WIDTH:2,HANDLE_STROKE_COLOR:"rgba(0, 0, 0, 1)",DEFAULT_PREFIX:"skitch-id",SAVE_DELAY:5E3,PAN_STEP:10,PAN_STEP_LARGE:100,PAN_STEP_SMALL:1,ZOOM_STEP:0.1,ZOOM_STEP_LARGE:0.5,ZOOM_STEP_SMALL:0.01,ZOOM_MIN:0.25,ZOOM_MAX:4,SHADOW_COLOR:"rgba(0, 0, 0, 0.4)",ENABLE_INFINITE_CANVAS:!1,INFINITE_CANVAS_PADDING:80,INFINITE_CANVAS_GUTTER:16,THUMBNAIL_WIDTH:470,THUMBNAIL_HEIGHT:470,MIN_INPUT_FILE_SIZE:1,MAX_INPUT_FILE_SIZE:26214400,
DEFAULT_FILE_TYPE:"jpg",EXPORT_FILE_TYPES_ALLOWED:[".png",".jpg"],FILE_TYPES_ALLOWED:".png .jpg .jpeg .jpe .gif .bmp .pdf".split(" "),COLORS:{yellow:"rgba(255, 247, 0, 1)",orange:"rgba(255, 128, 23, 1)",blue:"rgba(25, 119, 255, 1)",white:"rgba(255, 255, 255, 1)",green:"rgba(0, 232, 0, 1)",pink:"rgba(252, 12, 89, 1)",red:"rgba(255, 0, 0, 1)",black:"rgba(0, 0, 0, 1)",transparent:"rgba(0, 0, 0, 0)"},TEXT_STROKE_COLORS:{yellow:"#000000",orange:"#000000",blue:"#ffffff",white:"#000000",green:"#000000",
pink:"#ffffff",red:"#ffffff",black:"#ffffff"},STROKE_SIZES:{"size-1":2,"size-2":4,"size-3":8,"size-4":16,"size-5":32},FONT_SIZES:{"size-1":8,"size-2":16,"size-3":24,"size-4":32,"size-5":40},ARROW_SIZES:{"size-1":16,"size-2":24,"size-3":32,"size-4":48,"size-5":78},USE_HAMMER:!0,EVENTS:{pointerdown:"pointerdown",pointerup:"pointerup",pointermove:"pointermove",pointerover:"pointerover",pointerout:"pointerout",doubleclick:"dblclick",contextmenu:"contextmenu",tap:"tap",doubletap:"doubletap",hold:"hold",
dragstart:"dragstart",drag:"drag",dragend:"dragend",gesturestart:"transformstart",gesturechange:"transform",gestureend:"transformend",inertiastart:"MSInertiaStart",keydown:"keydown",keyup:"keyup",keypress:"keypress",mousewheel:"mousewheel",resize:"resize",paste:"paste",dragover:"dragover",drop:"drop"}}});
define("util/Obj",["require","env/Settings"],function(b){function a(){}b("env/Settings");var l=Array.prototype.slice.call.bind(Array.prototype.slice);a.merge=function(){return $.extend.apply($,l(arguments,0))};a.functions=function(a){var b={},i;for(i in a)"function"==typeof a[i]&&(b[i]=a[i]);return b};a.having=function(a,b){function i(a,k){if(null==a||"object"!=typeof k)return!1;var d=!0;Object.keys(k).forEach(function(e){d=d&&a[e]===k[e]});return d}var g=[];if(!Array.isArray(a))return i(a,b)?a:null;
a.forEach(function(a){i(a,b)&&g.push(a)});return g};a.copyProperties=function(a,b,i,g){i=i||[];g=g||{includeNull:!1};Array.isArray(i)||(i=[i]);i.forEach(function(i){if(null!=a[i]||g.includeNull)b[i]=a[i]})};a.removeFunctions=function(b){var h={};if(!b||Array.isArray(b)||b&&b.buffer instanceof ArrayBuffer||"object"!==typeof b)return b;for(var i in b)try{b[i]&&"object"===typeof b[i]?h[i]=Array.isArray(b[i])?b[i].map(function(b){return a.removeFunctions(b)}):a.removeFunctions(b[i]):"function"!==typeof b[i]&&
(h[i]=b[i])}catch(g){}return h};a.defaults=function(a,b){var i=a||{};Array.prototype.slice.call(arguments,1).forEach(function(a){null!=a&&Object.keys(a).forEach(function(b){null==i[b]&&(i[b]=a[b])})});return i};a.simple=function(a){return JSON.parse(JSON.stringify(a))};return a});
define("util/Func",[],function(){function b(){}var a=Array.prototype.slice;b.after=function(b,c){return function(){var h=a.call(arguments,1),h=[b.apply(null,h)].concat(a.call(arguments,0));return c.apply(this,h)}};b.drain=function(b){for(;0<b.length;)b.shift().apply(null,a.call(arguments,1))};b.getFunctionName=function(a){return(a=Function.prototype.toString.call(a).match(/function\s+([^\(\s]+)\(/))&&1<a.length?a[1]:null};return b});
define("mixin/Publisher",["require"],function(){function b(){this.events=[];this.subscriptions={}}b.prototype.registerEvents=function(){if(void 0===this.events||null===this.events)this.events=[];this.events.push.apply(this.events,arguments)};b.prototype.fire=function(a){var b,c=this.subscriptions[a]&&this.subscriptions[a].slice(0),h=Array.prototype.slice.call(arguments,1);if(!c)return this;for(b=0;b<c.length;b++)this.handleSubscription(c[b],h);return this};b.prototype.handleSubscription=function(a,
b){var c=Date.now(),h=a.invokeTime,i=a.defer,g=a.buffer,f=a.throttle,k=this.invokeSubscription.bind(this,a,b);if(0<g)clearTimeout(a.invokeId),a.invokeId=setTimeout(k,g);else if(0<i)a.invokeId=setTimeout(k,i);else if(!h||f<c-h)return k()};b.prototype.invokeSubscription=function(a,b){var c;c=a.handler.apply(a.scope,b);a.invokeId=null;a.invokeCount++;a.invokeTime=(new Date).getTime();!0===a.single&&this.off(a.name,a);return c};b.prototype.on=function(a,b,c,h){a&&(b&&0<=this.events.indexOf(a))&&(this.subscriptions[a]=
this.subscriptions[a]||[],this.subscriptions[a].push({name:a,handler:b.handler||b,scope:c||b.scope||this,single:h&&h.single||b.single||!1,defer:h&&h.defer||b.defer||0,buffer:h&&h.buffer||b.buffer||0,throttle:h&&h.throttle||b.throttle||0,invokeId:null,invokeTime:null,invokeCount:0,fireTime:null}));return this};b.prototype.off=function(a,b,c){var h,i;a&&b&&(h=this.subscriptions[a],i=b.handler||b,$(h).each(function(a){if(i===h[a].handler&&(void 0===c||c&&c==h[a].scope))return clearTimeout(h[a].invokeId),
h.splice(a,1),!1}));return this};b.prototype.once=function(a,b,c,h){h=$.extend(h,{single:!0});this.on(a,b,c,h)};return b});
define("util/Class",["require","util/Obj","util/Func","mixin/Publisher"],function(b){function a(){}function l(){return this.$id&&this.$class?this.$class+" ["+this.$id+"]":Object.prototype.toString.call(this)}var c=b("util/Obj"),h=b("util/Func"),i=b("mixin/Publisher"),g=0,f=Array.prototype.slice.call.bind(Array.prototype.slice);a.define=function(a,d,e){var b,j,m,d=d||Object,e=[i].concat(e||[]);j=h.getFunctionName(a);m=e.concat(a);b=function(m){var i=this instanceof b?this:new b,r=f(arguments,0);i.$id=
i.$id||++g;i.$class=i.$class||j;i.$mixins=i.$mixins||[];d.apply(i,r);e.forEach(function(a){var d=h.getFunctionName(a);i.$mixins.some(function(a){return a===d})||(a.apply(i,r),i.$mixins.push(d))});var l=a.apply(i,r);"object"===typeof l?i=l:c.merge(!0,i,m);i.constructor===b&&i.initialize();return i};b.Original=a;a.prototype.initialize||(a.prototype.initialize=d===Object?function(){}:d.prototype.initialize);c.merge(b,a);b.prototype=Object.create(d.prototype);m.forEach(function(a){c.merge(b.prototype,
a.prototype);Object.keys(a.prototype).forEach(function(d){var j=Object.getOwnPropertyDescriptor(a.prototype,d);(j.get!=null||j.set!=null)&&Object.defineProperty(b.prototype,d,j)})});b.prototype.parent=d.prototype;b.prototype.constructor=b;b.prototype.$class=j;b.prototype.toString=l;b.$class=j;b.parent=d;a.parent=d;return b};a.createClassByName=function(a,d){var e,b=a.split("."),j=window;for(e=0;e<b.length;e++)j=j[b[e]];return new j(d)};return a});
define("util/Geometry",["require"],function(){function b(){}b.lineIntersectsLine=function(a,l){var c=b.lineEquation(a),h=b.lineEquation(l),i=c.a,g=c.b,c=c.c,f=h.a,k=h.b,h=h.c,d=i*k-f*g,e=!1;0!=d&&(i={x:(k*c-g*h)/d,y:(i*h-f*c)/d},e=b.pointIntersectsLine(i,a)&&b.pointIntersectsLine(i,l));return e};b.lineEquation=function(a){var b={a:a.y2-a.y1,b:a.x1-a.x2,c:null};b.c=b.a*a.x1+b.b*a.y1;return b};b.pointIntersectsLine=function(a,b){return Math.min(b.x1,b.x2)<=a.x&&a.x<=Math.max(b.x1,b.x2)&&Math.min(b.y1,
b.y2)<=a.y&&a.y<=Math.max(b.y1,b.y2)};b.rotateLockPoint=function(a,b){var c=Math.sqrt(Math.pow(b.y-a.y,2)+Math.pow(b.x-a.x,2)),h=Math.atan2(b.x-a.x,b.y-a.y),h=-Math.round(h/(Math.PI/4))*(Math.PI/4)+Math.PI/2,i=b.clone();i.x=a.x+Math.cos(h)*c;i.y=a.y+Math.sin(h)*c;return i};return b});
define("util/Matrix",[],function(){function b(){}function a(a){if(Array.isArray(a)&&!Array.isArray(a[0]))for(var b=0;b<a.length;b++)a[b]=[a[b]];return a}b.multiply=function(b,c){var h,i,g,f,k,d,e=[],o;if(!c)return b;b=a(b);c=a(c);f=b.length;k=c.length;d=c[0].length;for(h=0;h<f;h++){e[h]=[];for(g=0;g<d;g++){for(i=o=0;i<k;i++)o+=b[h][i]*c[i][g];e[h][g]=o}}return e};b.determinant=function(a){var b=a[0],h=a[1],a=a[2];return b[0]*(h[1]*a[2]-a[1]*h[2])+b[1]*(a[0]*h[2]-h[0]*a[2])+b[2]*(h[0]*a[1]-a[0]*h[1])};
b.adjoint=function(a){var b=a[0],h=a[1],i=a[2],a=b[0],g=b[1],b=b[2],f=h[0],k=h[1],h=h[2],d=i[0],e=i[1],i=i[2];return[[k*i-e*h,e*b-i*g,g*h-k*b],[d*h-i*f,a*i-b*d,b*f-h*a],[f*e-k*d,g*d-a*e,a*k-g*f]]};b.inverse=function(a){var c=b.determinant(a),a=b.adjoint(a);return[[a[0][0]/c,a[0][1]/c,a[0][2]/c],[a[1][0]/c,a[1][1]/c,a[1][2]/c],[a[2][0]/c,a[2][1]/c,a[2][2]/c]]};return b});
define("util/Transformer",["require","util/Matrix"],function(b){function a(){}function l(a,b){for(var h=0;6>h;h++)b[h]=a[h]}function c(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]}var h=b("util/Matrix");a.toArray=function(a){return[a.a,a.b,a.c,a.d,a.e,a.f]};a.identity=function(){return[1,0,0,1,0,0]};a.transformPoint=function(a,b){return{x:a[0]*b.x+a[2]*b.y+a[4],y:a[1]*b.x+a[3]*b.y+a[5]}};a.inverseTransformPoint=
function(b,h){var c=a.inverse(b);return a.transformPoint(c,h)};a.transformBy=function(a,b){return c(a,b)};a.translateBy=function(b,h,c){l(a.transformBy(b,[1,0,0,1,h,c]),b);return a};a.scaleBy=function(b,h,c,k,d){h=[h,0,0,c,0,0];k=k||0;d=d||0;a.translateBy(b,k,d);l(a.transformBy(b,h),b);a.translateBy(b,-k,-d);return a};a.rotateBy=function(b,h,c,k){var d=Math.cos(h),h=Math.sin(h),d=[d,-h,h,d,0,0],c=c||0,k=k||0;a.translateBy(b,c,k);l(a.transformBy(b,d),b);a.translateBy(b,-c,-k);return a};a.inverse=function(a){a=
h.inverse([[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]]);return[a[0][0],a[1][0],a[0][1],a[1][1],a[0][2],a[1][2]]};a.multiply=function(a,b){return c(a,b)};return a});
define("util/Box",["require","util/Geometry","util/Transformer","env/Settings"],function(b){function a(){}var l=b("util/Geometry"),c=b("util/Transformer");b("env/Settings");a.containsPoints=function(a,b,c){var f=0,k,d,e;Array.isArray(b)||(b=[b]);c=c||b.length;for(k=0;f<c&&k<b.length;k++)d=b[k].x,e=b[k].y,d>a.left&&(d<a.left+a.width&&e>a.top&&e<a.top+a.height)&&f++;return f>=c};a.fromPoints=function(a){if(a&&!(2>a.length)){var b=0,c=0,f=0,k=0;a.forEach(function(a){b=Math.min(b,a.x);c=Math.min(c,a.y);
f=Math.max(f,a.x);k=Math.max(k,a.y)});return{left:b,top:c,width:f-b,height:k-c}}};a.getArea=function(a){return(a.width||0)*(a.height||0)};a.transform=function(a,b){var g={x:a.left,y:a.top},f={x:a.left+a.width,y:a.top+a.height},g=c.transformPoint(b,g);a.left=g.x;a.top=g.y;f=c.transformPoint(b,f);a.width=f.x-g.x;a.height=f.y-g.y;return a};a.intersectsLine=function(b,i){var c=a.sides(b),f;for(f=0;f<c.length;f++)if(l.lineIntersectsLine(c[f],i))return!0;return!1};a.intersectsBox=function(a,b){return!(b.left>
a.left+a.width||b.left+b.width<a.left||b.top>a.top+a.height||b.top+b.height<a.top)};a.intersection=function(b,i){var c={left:0,top:0,width:0,height:0};a.intersectsBox(b,i)&&(c.left=Math.max(b.left,i.left),c.top=Math.max(b.top,i.top),c.width=Math.min(b.left-c.left+b.width,i.left-c.left+i.width),c.height=Math.min(b.top-c.top+b.height,i.top-c.top+i.height));return c};a.lineIntersection=function(b,c){var g=null,f={x:c.x1,y:c.y1},k={x:c.x2,y:c.y2},d,e,o;if(!a.containsPoints(b,f)){if(!a.containsPoints(b,
k))return g;g=k;k=f;f=g}g=f.x<k.x?Math.min:Math.max;d=f.y<k.y?Math.min:Math.max;e=f.x<k.x?b.left+b.width:b.left;o=f.y<k.y?b.top+b.height:b.top;return g={x1:f.x,y1:f.y,x2:g(k.x,e),y2:d(k.y,o)}};a.containsBox=function(b,c){var g=a.vertices(c);return a.containsPoints(b,g)?!0:!1};a.sides=function(a){return[{x1:a.left,y1:a.top,x2:a.left+a.width,y2:a.top},{x1:a.left+a.width,y1:a.top,x2:a.left+a.width,y2:a.top+a.height},{x1:a.left+a.width,y1:a.top+a.height,x2:a.left,y2:a.top+a.height},{x1:a.left,y1:a.top+
a.height,x2:a.left,y2:a.top}]};a.vertices=function(a){return[{x:a.left,y:a.top},{x:a.left+a.width,y:a.top},{x:a.left+a.width,y:a.top+a.height},{x:a.left,y:a.top+a.height}]};a.center=function(a,b){return{left:Math.floor((a.width-b.width)/2),top:Math.floor((a.height-b.height)/2),width:b.width,height:b.height}};a.union=function(a,b){var c,f,k,d,e={left:0,top:0,width:0,height:0},o=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments,0);if(0===o.length)return e;for(var e=o[0],
j=1;j<o.length;j++)c=o[j],f=Math.min(e.left,c.left),k=Math.min(e.top,c.top),d=Math.max(e.left+e.width,c.left+c.width),c=Math.max(e.top+e.height,c.top+c.height),e={left:f,top:k,width:d-f,height:c-k};return e};a.fit=function(a,b,c,f){var k,d,c=c||f,f=Math.max(c,(a.width-b.width)/2),c=Math.max(c,(a.height-b.height)/2);k=b.width;d=b.height;k>a.width-2*f&&(f=(a.width-2*f)/k,k*=f,d*=f);d>a.height-2*c&&(f=(a.height-2*c)/d,k*=f,d*=f);return{top:b.top,left:b.left,width:Math.ceil(k),height:Math.ceil(d)}};return a});
define("mixin/Transformable",["require","env/Settings","util/Transformer"],function(b){function a(){this.transformation=l.identity();this.translation={x:0,y:0};this.scaling={x:1,y:1};this.rotation=0;this.registerEvents("transformed")}b("env/Settings");var l=b("util/Transformer");a.prototype={setTransformation:function(a){if(a)return this.transformation=a.concat(),this.translation={x:this.transformation[4],y:this.transformation[5]},this.scaling={x:Math.sqrt(this.transformation[0]*this.transformation[0]+
this.transformation[1]*this.transformation[1]),y:Math.sqrt(this.transformation[2]*this.transformation[2]+this.transformation[3]*this.transformation[3])},this.rotation=0,this.fire("transformed",this.transformation),this},resetTransformation:function(){this.setTransformation(l.identity());this.translation.x=0;this.translation.y=0;this.scaling.x=1;this.scaling.y=1;this.rotation=0;this.fire("transformed",this.transformation);return this},getInverseTransformation:function(){return l.inverse(this.transformation)},
transformPoint:function(a){return l.transformPoint(this.transformation,a)},inverseTransformPoint:function(a){return l.inverseTransformPoint(this.transformation,a)},transformBy:function(a){this.transformation=l.transformBy(this.transformation,a);this.fire("transformed",this.transformation);return this},translateBy:function(a,b){this.translation.x+=a;this.translation.y+=b;l.translateBy(this.transformation,a,b);this.fire("transformed",this.transformation);return this},scaleBy:function(a,b,i,g){this.scaling.x*=
a;this.scaling.y*=b;l.scaleBy(this.transformation,a,b,i,g);this.fire("transformed",this.transformation);return this},rotateBy:function(a){this.rotation+=a;l.rotateBy(this.transformation,a);this.fire("transformed",this.transformation);return this}};return a});
define("log/Layout",["require","util/Class"],function(b){function a(){this.patternLayout=new log4javascript.PatternLayout("%d %p [%c] ")}b=b("util/Class");a.prototype={initialize:function(){},format:function(a){var b=this.patternLayout.format(a);a.messages.forEach(function(a){var i;a instanceof Error&&(a={message:a.message,stack:a.stack&&a.stack.split("\n")});if("object"===typeof a&&null!==a)try{i=JSON.stringify(a,null,"  ")}catch(g){i="Unable to JSON stringify message: "+(a.toString&&a.toString()||
Object.prototype.toString.call(a))}else i=a;b+=i});return b},toString:function(){return"Default Layout with Object to JSON conversion"}};return a=b.define(a,log4javascript.Layout)});define("log/Appender",["require","util/Class","log/Layout"],function(b){function a(){this.layout=new c("%d %p [%c] %m")}var l=b("util/Class"),c=b("log/Layout");a.prototype={initialize:function(){},append:function(){},toString:function(){return"Appender"}};return a=l.define(a,log4javascript.Appender)});
define("log/ConsoleAppender",["require","util/Class","log/Appender"],function(b){function a(){this.console=console;null==this.console&&(this.append=function(){})}var l=b("util/Class"),b=b("log/Appender"),c=log4javascript.Level;a.prototype={initialize:function(){},append:function(a){var b=this.layout.format(a);a.level==c.ERROR&&this.console.error?this.console.error(b):a.level==c.DEBUG&&this.console.debug?this.console.debug(b):this.console.log(b)},toString:function(){return"ConsoleAppender"}};return a=
l.define(a,b)});define("log/FileAppender",["require","util/Class","log/Appender"],function(b){function a(){}var l=b("util/Class"),c=b("log/Appender"),h;a.prototype={initialize:function(){},initAsync:function(){h=b("async/Promise");return(new h).resolve()},append:function(){},flushAsync:function(){return(new h).resolve()},toString:function(){return"FileAppender"}};return a=l.define(a,c)});
define("log/Logger",["require","util/Class","log/ConsoleAppender","log/FileAppender"],function(b){function a(){throw Error("Use Logger.instance() instead of new Logger() to obtain a logger");}var l=b("util/Class"),c=b("log/ConsoleAppender"),h=b("log/FileAppender"),i=!1;a.Level=log4javascript.Level;a.instance=function(a){return log4javascript.getLogger(a)};a.root=function(){return log4javascript.getRootLogger()};a.reset=function(){log4javascript.getRootLogger().setLevel(a.Level.DEBUG);a.removeAllAppenders(log4javascript.getRootLogger(),
!0)};a.removeAllAppenders=function(b,c){c&&b.children.forEach(function(b){a.removeAllAppenders(b,c)});b.removeAllAppenders()};a.initAsync=function(){var c=b("async/Promise"),f=new c,k=[];if(i)return f.resolve();i=!0;log4javascript.Logger=a;log4javascript.Logger.prototype.flushAsync=function(){var a=[];this.getEffectiveAppenders().forEach(function(d){d.flushAsync&&a.push(d.flushAsync())});return c.join(a)};var d=new Date,e=d.getFullYear();9>d.getMonth()&&(e+="0");var e=e+(d.getMonth()+1),o=new h({filename:"log-"+
e+".txt"});k.push(o.initAsync());var j=new h({filename:"error-"+e+".txt"});j.setThreshold(a.Level.WARN);k.push(j.initAsync());c.join(k).done(function(){a.root().addAppender(o);a.root().addAppender(j);f.resolve()});return f};a.root().addAppender(new c);return a=l.define(a)});
define("async/Promise",["require","util/Func","util/Class","log/Logger"],function(b){function a(){this.donequeue=[];this.failqueue=[];this.progressqueue=[];this.state=this.data=this.name=null;try{throw Error("Ignore this error - capturing call stack");}catch(a){this.stack=a.stack||"",this.stack=this.stack.split("\n")}}var l=b("util/Func"),c=b("util/Class"),h=b("log/Logger").instance("async.Promise");a.toggleAbort=function(b,c){"function"==typeof b&&(c=b,b=!0);a.abortRequested=!!b;a.aborting=c};a.abortRequested=
!1;a.aborting=null;a.ondone=function(a){return function(){a.resolve.apply(a,arguments)}};a.onfail=function(a){return function(){a.reject.apply(a,arguments)}};a.join=a.all=function(b){var c=new a,f,k,d=b.length,e=[];if(!b||0==b.length)return(new a).resolve(e);for(f=0;f<b.length;f++)k=b[f],k.done(function(){d--;var a=Array.prototype.slice.call(arguments,0);0==a.length?a=void 0:1==a.length&&(a=a[0]);e.push(a);0==d&&c.resolve(e)}).fail(function(){c.reject.apply(c,arguments)});return c};a.wrap=function(b,
c,f,k){var d=new a;null!=b&&b.then&&b.done&&b.fail?d=b:null!=b&&b.then?b.then(d.resolve.bind(d),d.reject.bind(d),d.progress.bind(d)):d.resolve(b);null!=c&&d.done(c);null!=f&&d.fail(f);null!=k&&d.incremental(k);return d};a.prototype={initialize:function(){this.name=this.name||"anonymous";this.state=null==this.data?"unfulfilled":"fulfilled"},then:function(b,c,f){var k=new a({name:"Promise.then wrapper for "+this.name});b&&this.done(function(){var a=null;try{a=b.apply(null,arguments)}catch(e){h.error(e);
k.reject.call(k,e);return}a&&a.done&&a.fail&&a.incremental?(a.done(function(){k.resolve.apply(k,arguments)}),a.fail(function(){k.reject.apply(k,arguments)}),a.incremental(function(){k.progress.apply(k,arguments)})):k.resolve(a)});this.fail(function(){c&&c.apply(null,arguments);k.reject.apply(k,arguments)});f&&this.progressqueue.push(f);return k},done:function(a){this.donequeue.push(a);"fulfilled"==this.state&&this.resolve();return this},incremental:function(a){this.progressqueue.push(a);return this},
fail:function(a){this.failqueue.push(a);"failed"==this.state&&this.reject("Promise is already in failed state, calling fail callback");return this},forward:function(b){return this.then(function(){return a.wrap(b)})},progress:function(a){this.progressqueue.forEach(function(b){b(a)})},resolve:function(){if(a.abortRequested)return a.aborting&&a.aborting(),a.aborting=null,this.reject({aborted:!0}),this;var b;"unfulfilled"==this.state&&(this.state="fulfilled",this.data=Array.prototype.slice.call(arguments,
0));if("fulfilled"!=this.state)return this;Array.isArray(this.data)?(b=this.data.slice(0),b.unshift(this.donequeue),l.drain.apply(null,b)):l.drain(this.donequeue,this.data);return this},reject:function(){h.warn.apply(h,arguments);h.warn("Existing stack history:\n"+this.stack.slice(4).join("\n"));"unfulfilled"==this.state&&(this.state="failed",this.data=Array.prototype.slice.call(arguments,0));if("failed"!=this.state)return h.warn("Cannot reject a promise that has already been resolved.  Fail callback will not be called."),
this;var a=this.data.slice(0);a.unshift(this.failqueue);l.drain.apply(null,a);return this},link:function(a){a.done(this.resolve.bind(this));a.fail(this.reject.bind(this));a.incremental(this.progress.bind(this));return this},isResolved:function(){return this.isFulfilled()||this.isRejected()},isFulfilled:function(){return"fulfilled"==this.state},isRejected:function(){return"failed"==this.state}};return a=c.define(a)});
define("util/Binary",["require","async/Promise","log/Logger"],function(b){function a(){}var l=b("async/Promise"),c=b("log/Logger").instance("util.Binary");a.fromHex=function(a){var b,c=a.length/2,f=new Uint8Array(c);for(b=0;b<c;b++)f[b]=parseInt(a.substr(2*b,2),16);return f};a.toHex=function(a,b,g){var f="",k,d,e;try{b=b||0;g=g||a.length;d=b+g;for(k=b;k<d;k++)e=a[k].toString(16),1==e.length&&(e="0"+e),f+=e}catch(o){c.error(o)}return f};a.fromText=function(a){var b,c=a.length,f=new Uint8Array(c);for(b=
0;b<c;b++)f[b]=a.charCodeAt(b);return f};a.fromTextAsync=function(a){var b=new l,a=new Blob([a]),c=new FileReader;c.onload=function(a){b.resolve(new Uint8Array(a.target.result))};c.onerror=b.reject.bind(b);c.readAsArrayBuffer(a);return b};a.slice=function(a,b,c){return!b&&"number"!==typeof b?a:"number"===typeof c&&0<=c?a.subarray(b,b+c):a.subarray(b)};a.toText=function(b,c,g){var f="",k=[];Array.prototype.slice.call(a.slice(b,c,g),0).forEach(function(a){k.push(String.fromCharCode(a))});return f=k.join("")};
a.toTextAsync=function(b,c,g){var f=new l;if("undefined"===typeof FileReader){var k=a.toText(b,c,g);f.resolve(k)}else k=new FileReader,c&&(g=g||b.length,b=b.subarray(c,g)),b=new Blob([b]),k.onload=function(a){f.resolve(a.target.result)},k.onerror=f.reject.bind(f),k.readAsText(b);return f};a.msFromBase64Async=function(a){var b=new l,a=Windows.Security.Cryptography.CryptographicBuffer.decodeFromBase64String(a);b.resolve(Windows.Security.Cryptography.CryptographicBuffer.copyToByteArray(a));return b};
a.msToBase64Async=function(a){var b=new l,a=Windows.Security.Cryptography.CryptographicBuffer.createFromByteArray(a);b.resolve(Windows.Security.Cryptography.CryptographicBuffer.encodeToBase64String(a));return b};a.w3FromBase64Async=function(b){var c=new l;c.resolve(a.fromText(atob(b)));return c};a.w3ToBase64Async=function(b){var c=new l;a.toTextAsync(b).done(function(a){c.resolve(btoa(a))});return c};a.toObjectURL=function(a,b,c){a instanceof Blob||(b&&(c=c||a.length,a=a.subarray(b,c)),a=new Blob([a]));
return URL.createObjectURL(a)};a.toDataURL=function(b,c){var g;g=a.toText(b);return"data:"+c+";base64,"+btoa(g)};a.toUint32=function(a,b,c){return"number"===typeof b&&"number"===typeof c&&(new DataView(a.buffer,a.byteOffset,a.byteLength)).getUint32(b,!1)};a.loadAsync=function(a){var b=new l,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){var a=new Uint8Array(c.response);b.resolve(a)};c.onerror=function(a){b.reject(a)};c.send(null);return b};a.concat=function(a,
b,c){var f,k=0,d=0,e=Array.prototype.slice.call(arguments,0),k=e.reduce(function(a,b){return a+b.byteLength},0);f=new Uint8Array(k);e.forEach(function(a){f.set(a,d);d+=a.byteLength});return f};a.fromBase64Async="undefined"!==typeof window&&window.Windows?a.msFromBase64Async:a.w3FromBase64Async;a.toBase64Async="undefined"!==typeof window&&window.Windows?a.msToBase64Async:a.w3ToBase64Async;return a});
define("util/Mime",["require"],function(){function b(){}var a={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp"};b.extToMime=function(b){if(b)return a[b&&b.toLowerCase()]};b.mimeToExt=function(b){if(b)for(var c in a)if(a[c].toLowerCase()===b.toLowerCase())return c};return b});
define("util/Num",["require"],function(){function b(){}b.fixed=function(a,b){return parseFloat(parseFloat(a).toFixed(b||3))};b.zeroOrOne=function(a,b){null==a&&(a=b);return a?1:0};b.getNearestNumber=function(a,b){for(var c=Number.MAX_VALUE,h=null,i=0;i<a.length;i++){var g=Math.abs(a[i]-b);g<=c&&(c=g,h=a[i])}return h};return b});
define("graphics/Space",["require","util/Class","mixin/Transformable","util/Transformer"],function(b){function a(){this.transformable=this.name=null;this.transformation=h.identity()}var l=b("util/Class"),c=b("mixin/Transformable"),h=b("util/Transformer");a.prototype={initialize:function(){if(this.transformable)this.transformable.on("transformed",this.onTransformed,this)},onTransformed:function(a){this.transformation=a}};return a=l.define(a,Object,[c])});
define("graphics/Point",["require","util/Class","util/Transformer","graphics/Space","util/Obj"],function(b){function a(b,c,f){var k=this instanceof a?this:new a,b=b&&"object"==typeof b?b:{x:b,y:c,space:f};b.space&&Array.isArray(b.space)&&(b.space=new h({name:"custom",transformation:b.space}));k.x=b.x;k.y=b.y;k.space=b.space;return k}var l=b("util/Class"),c=b("util/Transformer"),h=b("graphics/Space");b("util/Obj");a.spaces={};a.prototype.relativeTo=function(b){var g=a.spaces,f=g[this.space]?g[this.space]:
this.space,g=g[b]?g[b]:new h({name:"custom",transformation:b}),f=c.multiply(c.inverse(g.transformation),f?f.transformation:c.identity()),f=c.transformPoint(f,this);return a(f.x,f.y,b)};a.prototype.distance=function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))};a.prototype.print=function(){return this.x+", "+this.y+" "+this.space};a.prototype.clone=function(){return new a(this.x,this.y,this.space)};return a=l.define(a)});
define("graphics/CanvasGraphics","require util/Class util/Num mixin/Transformable util/Transformer graphics/Point log/Logger".split(" "),function(b){function a(){this.context=null;this.snapshots=[];this.fontcss=null}var l=b("util/Class");b("util/Num");var c=b("mixin/Transformable"),h=b("util/Transformer"),i=b("graphics/Point"),g=b("log/Logger").instance("graphics.CanvasGraphics"),f=document.createElement("canvas").getContext("2d");a.pixelRatio=(window.devicePixelRatio||1)/(f.backingStorePixelRatio||
f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||1);a.identity=h.identity();a.create=function(b,d){var e=new a;e.setWidth(b);e.setHeight(d);return e};a.prototype={initialize:function(){this.context=document.createElement("canvas").getContext("2d");this.resetTransformation();this.fontcss=this.context.font},getWidth:function(){return parseInt(this.context.canvas.style.width)},getHeight:function(){return parseInt(this.context.canvas.style.height)},
setWidth:function(b){var b=b||0,d=this.context.canvas;d.width=b*a.pixelRatio;d.style.width=b+"px";this.resetTransformation()},setHeight:function(b){var b=b||0,d=this.context.canvas;d.height=b*a.pixelRatio;d.style.height=b+"px";this.resetTransformation()},snapshot:function(){return{transformation:this.transformation.concat(),translation:{x:this.translation.x,y:this.translation.y},scaling:{x:this.scaling.x,y:this.scaling.y},rotation:this.rotation,fontcss:this.fontcss}},save:function(){this.snapshots.push(this.snapshot());
return this.context.save.apply(this.context,arguments)},restore:function(){if(this.snapshots.length>0){var a=this.snapshots.pop();this.transformation=a.transformation;this.translation=a.translation;this.scaling=a.scaling;this.rotation=a.rotation;this.fontcss=a.fontcss}return this.context.restore.apply(this.context,arguments)},scale:function(a,b){this.scaleBy(a,b)},rotate:function(a){this.rotateBy(a)},translate:function(a,b){this.translateBy(a,b)},transform:function(a,b,e,c,j,m){this.transformBy([a,
b,e,c,j,m]);this.scaling.x=this.transformation[0];this.scaling.y=this.transformation[3];this.translation.x=this.transformation[4];this.translation.y=this.transformation[5]},setTransform:function(a,b,e,c,j,m){this.resetTransformation();this.transform(a,b,e,c,j,m)},globalAlpha:function(a){if(a!=null)this.context.globalAlpha=a;return this.context.globalAlpha},globalCompositeOperation:function(a){if(a!=null)this.context.globalCompositeOperation=a;return this.context.globalCompositeOperation},strokeStyle:function(a){if(a!=
null)this.context.strokeStyle=a;return this.context.strokeStyle},fillStyle:function(a){if(a!=null)this.context.fillStyle=a;return this.context.fillStyle},createLinearGradient:function(b,d,e,c){b=this.pointRelativeTo(b,d,a.identity);e=this.pointRelativeTo(e,c,a.identity);return this.context.createLinearGradient(b.x,b.y,e.x,e.y)},createRadialGradient:function(b,d,e,c,j,m){b=this.pointRelativeTo(b,d,a.identity);e=this.scaling.x*e;c=this.pointRelativeTo(c,j,a.identity);return this.context.createRadialGradient(b.x,
b.y,e,c.x,c.y,this.scaling.x*m)},createPattern:function(a,b){return this.context.createPattern.apply(this.context,arguments)},lineWidth:function(a){if(a!=null)this.context.lineWidth=a;return this.context.lineWidth},lineCap:function(a){if(a!=null)this.context.lineCap=a;return this.context.lineCap},lineJoin:function(a){if(a!=null)this.context.lineJoin=a;return this.context.lineJoin},miterLimit:function(a){if(a!=null)this.context.miterLimit=a;return this.context.miterLimit},shadowOffsetX:function(a){if(a!=
null)this.context.shadowOffsetX=a;return this.context.shadowOffsetX},shadowOffsetY:function(a){if(a!=null)this.context.shadowOffsetY=a;return this.context.shadowOffsetY},shadowBlur:function(a){if(a!=null)this.context.shadowBlur=a;return this.context.shadowBlur},shadowColor:function(a){if(a!=null)this.context.shadowColor=a;return this.context.shadowColor},clearRect:function(b,d,e,c){b=this.boxRelativeTo(b,d,e,c,a.identity);return this.context.clearRect(b.left,b.top,b.width,b.height)},fillRect:function(b,
d,e,c){b=this.boxRelativeTo(b,d,e,c,a.identity);return this.context.fillRect(b.left,b.top,b.width,b.height)},strokeRect:function(b,d,e,c){b=this.boxRelativeTo(b,d,e,c,a.identity);this.context.save();this.context.lineWidth=this.context.lineWidth*this.scaling.x;b=this.context.strokeRect(b.left,b.top,b.width,b.height);this.context.restore();return b},beginPath:function(){return this.context.beginPath.apply(this.context,arguments)},closePath:function(){return this.context.closePath.apply(this.context,
arguments)},moveTo:function(b,d){var e=this.pointRelativeTo(b,d,a.identity);return this.context.moveTo(e.x,e.y)},lineTo:function(b,d){var e=this.pointRelativeTo(b,d,a.identity);return this.context.lineTo(e.x,e.y)},quadraticCurveTo:function(b,d,e,c){b=this.pointRelativeTo(b,d,a.identity);e=this.pointRelativeTo(e,c,a.identity);return this.context.quadraticCurveTo(b.x,b.y,e.x,e.y)},bezierCurveTo:function(b,d,e,c,j,m){b=this.pointRelativeTo(b,d,a.identity);e=this.pointRelativeTo(e,c,a.identity);j=this.pointRelativeTo(j,
m,a.identity);return this.context.bezierCurveTo(b.x,b.y,e.x,e.y,j.x,j.y)},arcTo:function(b,d,e,c,j){d=this.pointRelativeTo(b,c,a.identity);b=this.pointRelativeTo(b,c,a.identity);return this.context.arcTo(d.x,d.y,b.x,b.y,this.scaling.x*j)},rect:function(b,d,e,c){b=this.boxRelativeTo(b,d,e,c,a.identity);return this.context.rect(b.left,b.top,b.width,b.height)},arc:function(b,d,e,c,j,m){b=this.pointRelativeTo(b,d,a.identity);return this.context.arc(b.x,b.y,this.scaling.x*e,c,j,m)},fill:function(a){if(a!=
null){g.error("fill with path argument not supported by PDF");throw Error("fill with path argument not supported by PDF");}return this.context.fill.apply(this.context,arguments)},stroke:function(a){if(a!=null){g.error("stroke with path argument not yet implemented in pdf/CanvasGraphics");throw Error("stroke with path argument not yet implemented in pdf/CanvasGraphics");}this.context.save();this.context.lineWidth=this.context.lineWidth*this.scaling.x;var b=this.context.stroke.apply(this.context,arguments);
this.context.restore();return b},clip:function(){return this.context.clip.apply(this.context,arguments)},isPointInPath:function(a,b){var e=this.pointRelativeTo(a,b,this.identity);return this.context.isPointInPath(e.x,e.y)},drawFocusRing:function(b,d,e,c){d=this.pointRelativeTo(d,e,a.identity);return this.context.drawFocusRing(b,d.x,d.y,c)},font:function(a){if(a!=null){this.fontcss=a;this.context.font=a}return this.fontcss},textAlign:function(a){if(a!=null)this.context.textAlign=a;return this.context.textAlign},
textBaseline:function(a){if(a!=null)this.context.textBaseline=a;return this.context.textBaseline},fillText:function(b,d,e,c){var j=this.pointRelativeTo(d,e,a.identity),c=this.scaling.x*c;this.context.save();this.context.font=a.scaleFont(this.font(),this.scaling.x);this.context.lineWidth=this.context.lineWidth*this.scaling.x;j=arguments.length===4?this.context.fillText(b,j.x,j.y,c):this.context.fillText(b,j.x,j.y);this.context.restore();return j},strokeText:function(b,d,e,c){var j=this.pointRelativeTo(d,
e,a.identity),c=this.scaling.x*c;this.context.save();this.context.font=a.scaleFont(this.font(),this.scaling.x);this.context.lineWidth=this.context.lineWidth*this.scaling.x;j=arguments.length===4?this.context.strokeText(b,j.x,j.y,c):this.context.strokeText(b,j.x,j.y);this.context.restore();return j},measureText:function(a){return{width:this.context.measureText(a).width}},drawImage:function(b,d,e,c,j,m,p,n,f){var g=Array.prototype.slice.call(arguments,1),h=this.scaling.x,i=this.scaling.y;if(b instanceof
a){b=b.context.canvas;h=h/a.pixelRatio;i=i/a.pixelRatio}if(g.length===2){g=this.pointRelativeTo(d,e,a.identity);return this.context.drawImage(b,g.x,g.y,b.width*h,b.height*i)}if(g.length===4){g=this.pointRelativeTo(d,e,a.identity);return this.context.drawImage(b,g.x,g.y,c*h,j*i)}if(g.length===8){g=this.pointRelativeTo(m,p,a.identity);return this.context.drawImage(b,d,e,c,j,g.x,g.y,n*h,f*i)}},createImageData:function(a,b){return this.context.createImageData.apply(this.context,arguments)},getImageData:function(b,
d,e,c){if(a.pixelRatio===1)return this.context.getImageData(b,d,e,c);f.canvas.width=this.getWidth();f.canvas.height=this.getHeight();f.drawImage(this.context.canvas,0,0,f.canvas.width,f.canvas.height);return f.getImageData(b,d,e,c)},putImageData:function(a,b,e,c,j,m,p){return this.context.putImageData.apply(this.context,arguments)},pointRelativeTo:function(a,b,e){return i(a,b,this.transformation).relativeTo(e)},boxRelativeTo:function(a,b,e,c,j){var m=i(a,b,this.transformation).relativeTo(j),a=i(a+
e,b+c,this.transformation).relativeTo(j);return{left:m.x,top:m.y,width:a.x-m.x,height:a.y-m.y}},resetTransformation:function(){c.prototype.resetTransformation.apply(this,arguments);this.scaleBy(a.pixelRatio,a.pixelRatio)},renderGrid:function(a){a=a||"#777777";this.save();this.beginPath();this.fillStyle(a);this.font("12px Arial");for(var b=-1E4;b<=1E4;b=b+100){this.fillText(b,b+2,12);this.fillText(b,2,b-2);this.moveTo(b,-1E4);this.lineTo(b,1E4);this.moveTo(-1E4,b);this.lineTo(1E4,b)}this.strokeStyle(a);
this.lineWidth(2);this.stroke();this.beginPath();this.lineWidth(3);this.strokeStyle("#ff0000");this.moveTo(0,-1E4);this.lineTo(0,1E4);this.moveTo(-1E4,0);this.lineTo(1E4,0);this.stroke();this.restore()}};a.scaleFont=function(a,b){return a.replace(/([^0-9]*)([0-9\.]+)([a-z]+)(\s+.*)/i,function(a,c,j,m,p){return""+c+j*b+m+p})};return a=l.define(a,Object,[c])});
define("util/Img","require util/Binary util/Mime async/Promise env/Settings graphics/CanvasGraphics log/Logger".split(" "),function(b){function a(){}function l(a){var b=HTMLCanvasElement.prototype.msToBlob.call(this);a(b)}var c=b("util/Binary"),h=b("util/Mime"),i=b("async/Promise"),g=b("env/Settings"),f=b("graphics/CanvasGraphics");b("log/Logger").instance("util.Img");a.loadAsync=function(a){var b=new i,e=document.createElement("img");e.onload=function(){b.resolve(e)};e.onerror=function(){b.reject()};
e.src=a;return b};a.convertImageToDataURL=function(a){var b=f.create(a.width,a.height);b.drawImage(a,0,0);return b.context.canvas.toDataURL()};a.convertAsync=function(b,d){var e=new i;d?a.toImageElementAsync(b).then(function(b){return a.toBytesAsync(b,d)}).done(function(a){e.resolve(a)}):e.reject("Could not convert image - MIME is required");return e};a.toImageElementAsync=function(b){b=c.toObjectURL(b);return a.loadAsync(b)};a.toBytesAsync=function(b,d){var e=new i,c,j,m;j=b.naturalWidth||b.width||
b.getWidth&&b.getWidth();m=b.naturalHeight||b.height||b.getHeight&&b.getHeight();if(j>0&&m>0){c=f.create(j,m);c.clearRect(0,0,j,m);c.drawImage(b,0,0);a.fromCanvasAsync(c.context.canvas,d).done(function(a){e.resolve(a)})}else e.reject("Could not convert to bytes - DOM element is not valid - "+typeof b);return e};a.fromCanvasAsync=function(b,d){var e=new i,o,j=h.mimeToExt(d)||g.DEFAULT_FILE_TYPE.toLowerCase();if(b.toBlob===l){var m,d=h.extToMime(j);m=b.toDataURL(d,g.JPEG_QUALITY).split(",").pop();return c.fromBase64Async(m).done(function(a){e.resolve(a)}).fail(function(){e.reject.apply(e,
arguments)})}b.toBlob(function(d){o=new FileReader;o.onload=function(d){var m;m=h.extToMime(j);d=new Uint8Array(d.target.result);if(a.is(j,d))e.resolve(d);else{m=b.toDataURL(m,g.JPEG_QUALITY).split(",").pop();c.fromBase64Async(m).done(function(a){e.resolve(a)}).fail(function(){e.reject.apply(e,arguments)})}};o.onerror=e.reject.bind(e);o.readAsArrayBuffer(d)});return e};a.is=function(b,d){var e=a["is"+b.toUpperCase()];return typeof e==="function"?e.call(a,d):false};a.getBox=function(a){var b=a.width,
e=a.height*b,c=0,j=-1,m=0,p=-1,n=e,a=a.data,f,g;g=0;for(f=false;g<e&&!f;g++)if(a[g*4+3]>0){j=c=Math.floor(g/b);p=m=g%b;n=g;f=true}g=e-1;for(f=false;g>n&&!f;g--)if(a[g*4+3]>0){j=Math.floor(g/b);m=Math.min(g%b,m);p=Math.max(g%b,p);f=true}g=c*b;for(f=false;g%b<m&&!f;){if(a[g*4+3]>0){m=g%b;f=true}g=g+b;g/b>j&&(g=g%b+1+c*b)}g=(c+1)*b-1;for(f=false;g>-1&&g%b>p&&!f;){if(a[g*4+3]>0){p=g%b;f=true}g=g+b;g/b>j&&(g=g%b-1+c*b)}return{left:m,top:c,width:p-m+1,height:j-c+1}};if(typeof HTMLCanvasElement!=="undefined")HTMLCanvasElement.prototype.toBlob=
HTMLCanvasElement.prototype.toBlob||l;return a});
define("util/Color",["require","util/Class","util/Num","env/Settings"],function(b){function a(a,b,c,f){this.a=this.b=this.g=this.r=0;if(void 0!==a){if(null==b&&null==c&&null==f)if(null!=a.r)this.r=parseInt(a.r,10),this.g=parseInt(a.g,10),this.b=parseInt(a.b,10),this.a=parseFloat(a.a);else if(null!=a.red)this.r=parseInt(a.red,10),this.g=parseInt(a.green,10),this.b=parseInt(a.blue,10),this.a=parseFloat(a.alpha);else if(0==a.indexOf("#"))a=a.replace("#","").match(/(.{2})/g),this.r=parseInt(a[0],16),
this.g=parseInt(a[1],16),this.b=parseInt(a[2],16),this.a=3<a.length?l.fixed(parseInt(a[3],16)/255):1;else if(0==a.indexOf("rgb("))a=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/.exec(a),this.r=parseInt(a[2],10),this.g=parseInt(a[3],10),this.b=parseInt(a[4],10),this.a=1;else if(0==a.indexOf("rgba("))a=/(.*?)rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\d\.]+)\)/.exec(a),this.r=parseInt(a[2],10),this.g=parseInt(a[3],10),this.b=parseInt(a[4],10),this.a=parseFloat(a[5]);else throw"Invalid color string";else this.r=a,this.g=
b,this.b=c,this.a=f||1;if(void 0===this.r||void 0===this.g||void 0===this.b||void 0===this.a)throw"Error parsing color";}}b("util/Class");var l=b("util/Num"),c=b("env/Settings");a.getStrokeColor=function(b){return a.isDark(b)?c.COLORS.white:c.COLORS.black};a.isDark=function(b){b=b instanceof a?b:new a(b);return 0.5>0.299*(b.r/255)+0.587*(b.g/255)+0.114*(b.b/255)};a.getOfficialColorName=function(b){var i=null,g;for(g in c.COLORS)if((new a(c.COLORS[g])).equalsRGB(b)){i=g;break}return i};a.toHex=function(b,
c,g,f){return null==b?b:(new a(b,c,g,f)).toHex()};a.toRGB=function(b,c,g,f){return null==b?b:(new a(b,c,g,f)).toRGB()};a.toRGBA=function(b,c,g,f){return null==b?b:(new a(b,c,g,f)).toRGBA()};a.prototype.equals=function(b){return b instanceof a?this.r==b.r&&this.g==b.g&&this.b==b.b&&this.a==b.a:(new a(b)).equals(this)};a.prototype.equalsRGB=function(b){return b instanceof a?this.r==b.r&&this.g==b.g&&this.b==b.b:(new a(b)).equalsRGB(this)};a.prototype.toHex=function(){var a=this.r.toString(16);1==a.length&&
(a="0"+a);var b=this.g.toString(16);1==b.length&&(b="0"+b);var c=this.b.toString(16);1==c.length&&(c="0"+c);return"#"+a+b+c};a.prototype.toInteger=function(){var a=this.r.toString(16);1==a.length&&(a="0"+a);var b=this.g.toString(16);1==b.length&&(b="0"+b);var c=this.b.toString(16);1==c.length&&(c="0"+c);return parseInt(a+b+c,16)};a.prototype.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};a.prototype.toRGBArray=function(){return[this.r,this.g,this.b]};a.prototype.toRGBA=function(){return"rgba("+
this.r+", "+this.g+", "+this.b+", "+this.a+")"};return a});
define("surface/Serializer",["require","util/Class","util/Num","util/Color"],function(b){function a(){this.surface=null}var l=b("util/Class"),c=b("util/Num"),h=b("util/Color");a.serializePoint=function(a){return{x:c.fixed(a.x),y:c.fixed(a.y)}};a.serializeColor=function(a){a=new h(a);return{red:a.r,green:a.g,blue:a.b,alpha:c.fixed(a.a)}};a.serializeSize=function(a){return{width:c.fixed(a.width),height:c.fixed(a.height)}};a.serializeStyle=function(a){return{shadowColor:a.shadowColor,shadowOffset:a.shadowOffset,
shadowRadius:a.shadowRadius}};a.serializeBox=function(a){return{x:c.fixed(a.left),y:c.fixed(a.top),width:c.fixed(a.width),height:c.fixed(a.height)}};a.serializeFont=function(a){return{name:a.name,size:a.size}};return a=l.define(a)});
define("util/Security",["require"],function(){function b(){}b.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};b.MD5=function(a){if("string"!==typeof a&&a.buffer){if(window.Windows)return a=Windows.Security.Cryptography.Core.HashAlgorithmProvider.openAlgorithm("MD5").hashData(Windows.Security.Cryptography.CryptographicBuffer.createFromByteArray(a)),Windows.Security.Cryptography.CryptographicBuffer.encodeToHexString(a);
for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);a=CryptoJS.enc.Latin1.parse(b);return CryptoJS.MD5(a).toString()}return CryptoJS.MD5((a||"").toString()).toString()};return b});
define("surface/element/Element","require util/Obj env/Settings mixin/Transformable util/Transformer surface/Serializer util/Class util/Color util/Num util/Img util/Security graphics/CanvasGraphics util/Box graphics/Point".split(" "),function(b){function a(){this.uuid=this.graphics=this.hitgraphics=null;this.type="Element";this.hidden=false;this.layer=null;this.order=0;this.depth=1;this.hit=this.selected=false;this.handles={};this.activeHandle=null;this.removed=false;this.box={left:null,top:null,
width:null,height:null};this.opacity=1;this.stroke={color:l.COLORS.black,alpha:1,width:1,style:"round",join:"round"};this.fill={color:l.COLORS.transparent};this.shadow={offset:{x:0,y:3},blur:4,color:l.COLORS.transparent};this.editing=false;this.registerEvents("added","removed","selected","unselected","action","boxchanged","moved","manipulated")}b("util/Obj");var l=b("env/Settings"),c=b("mixin/Transformable"),h=b("util/Transformer"),i=b("surface/Serializer"),g=b("util/Class"),f=b("util/Color"),k=b("util/Num");
b("util/Img");var d=b("util/Security"),e=b("graphics/CanvasGraphics"),o=b("util/Box");b("graphics/Point");a.prototype={initialize:function(){this.hitgraphics=new e;this.hitgraphics.globalCompositeOperation("source-out");if(!this.uuid)this.uuid=d.uuid();this.on("added",this.onAdded,this);this.on("removed",this.onRemoved,this)},clone:function(){var a=new this.constructor;a.deserialize(null,this.serialize([1,0,0,1,0,0]));a.recreateId();return a},recreateId:function(){this.uuid=d.uuid()},serialize:function(){var a=
i.serializeStyle({shadowColor:i.serializeColor({r:0,g:0,b:0,a:0}),shadowOffset:i.serializeSize({width:0,height:0}),shadowRadius:this.shadow.blur}),b={type:"Node",guid:this.uuid};if(a)b.style=a;return b},deserialize:function(a,b){$.extend(true,this,{uuid:b.guid,stroke:{color:b.strokeColor&&f.toRGBA(b.strokeColor),width:b.lineWidth},fill:{color:b.fillColor&&f.toRGBA(b.fillColor)},shadow:{color:b.style&&f.toRGBA(b.style.shadowColor),blur:b.style&&b.style.shadowRadius,offset:{x:b.style&&b.style.shadowOffset&&
b.style.shadowOffset.width,y:b.style&&b.style.shadowOffset&&b.style.shadowOffset.height}}});this.setTransformation(b.transform?h.toArray(b.transform):b.transform);return this},hitTest:function(a,b,d){var e;e=this.hitgraphics;var c=false,k,f;if(!o.intersectsBox(this.box,{left:a.x-25,top:a.y-25,width:50,height:50}))return false;e.setWidth(this.layer.graphics.getWidth());e.setHeight(this.layer.graphics.getHeight());k=this.shadow.color;this.shadow.color=l.COLORS.transparent;e.save();e.transform.apply(e,
this.layer.transformation);f=l.HANDLE_RADIUS;if(!d)l.HANDLE_RADIUS=l.HANDLE_HIT_RADIUS;b!=null?b(e):this.render(e);l.HANDLE_RADIUS=f;b=a.relativeTo(h.identity());a=Math.min(Math.max(0,b.x-3),e.getWidth());b=Math.min(Math.max(0,b.y-3),e.getHeight());a=e.getImageData(a,b,6,6).data;e.restore();this.shadow.color=k;for(e=3;e<a.length;e=e+4)if(a[e]!==0){c=true;break}return c},processHit:function(){},getHandle:function(a,b){for(var d in this.handles)if(this.hitTest(a,function(a){this.renderHandle(a,d)}.bind(this),
b))return d},getStyle:function(){return{stroke:{color:this.stroke.color,width:this.stroke.width},fill:{color:this.fill.color}}},onAdded:function(a){this.graphics=a.graphics;this.layer=a;this.removed=false},remove:function(){this.layer&&this.layer.removeElement(this);return this},manipulate:function(){this.calculateBox()},handle:function(a){this.activeHandle=a},unhandle:function(){this.activeHandle=null},onRemoved:function(){this.removed=true},getSurface:function(){return this.surface||this.layer&&
this.layer.surface},hide:function(){this.hidden=true;this.layer&&this.layer.render()},show:function(){this.hidden=false;this.layer&&this.layer.render()},initGraphics:function(a){a=a||this.graphics;a.fillStyle(this.fill.color);a.strokeStyle(this.stroke.color);a.lineWidth(this.stroke.width);a.lineCap(this.stroke.style);a.lineJoin(this.stroke.join);a.shadowOffsetX(this.shadow.offset.x);a.shadowOffsetY(this.shadow.offset.y);a.shadowBlur(this.shadow.blur);a.shadowColor(this.selected?l.COLORS.transparent:
this.shadow.color);a.transform.apply(a,this.transformation);return this},render:function(a,b,d){a=a||this.graphics||this.layer.graphics;d=d||this.layer.surface;a.save();this.initGraphics(a);this.selected&&this.renderSelected(a,d);b?b.call(this,a,d):this.draw(a,d);a.restore();this.selected&&this.renderHandles(a)},renderSelected:function(a,b){a=a||this.graphics;a.save();this.setSelectedStyles(a);this.drawSelection?this.drawSelection(a):this.draw(a,null,b);a.restore()},renderHandle:function(a,b){var a=
a||this.graphics,d=b&&typeof b==="object"?b:this.handles[b];a.save();this.initGraphics(a);this.setSelectedStyles(a);this.drawHandle(a,d);a.restore()},renderHandles:function(a){var b,a=a||this.graphics;for(b in this.handles)this.renderHandle(a,this.handles[b])},setSelectedStyles:function(a){a.lineWidth(a.lineWidth()+l.SELECTION_STROKE_WIDTH/this.layer.surface.scaling.x/this.scaling.x);this.fill.color===l.COLORS.white||this.stroke.color===l.COLORS.white?a.strokeStyle("rgba(0, 0, 0, 0.1)"):a.strokeStyle(l.COLORS.white);
a.shadowColor(l.SHADOW_COLOR);a.globalAlpha(this.opacity)},draw:function(){},drawHandle:function(a,b){var a=a||this.graphics,d,e;d=l.HANDLE_RADIUS/this.layer.surface.scaling.x/this.scaling.x;e=(l.HANDLE_RADIUS+l.HANDLE_STROKE_WIDTH)/this.layer.surface.scaling.x/this.scaling.x;a.beginPath();a.fillStyle(l.COLORS.white);a.shadowColor(l.SHADOW_COLOR);a.shadowOffsetY(2);a.arc(b.x,b.y,e,0,2*Math.PI,true);a.fill();a.beginPath();a.fillStyle("rgba(5, 131, 209, 1)");a.shadowColor(l.COLORS.transparent);a.arc(b.x,
b.y,d,0,2*Math.PI,true);a.fill()},select:function(a){this.selected=true;this.layer.render();this.fire("selected",this,a)},unselect:function(){this.selected=false;this.layer&&this.layer.render();this.fire("unselected",this)},getSelectedBox:function(){return this.box},getBox:function(){var a=this.selected?this.getSelectedBox():this.box,b=this.stroke.width+Math.max(this.shadow.offset.x,this.shadow.offset.y)+50;return{left:a.left-b,top:a.top-b,width:a.width+b*2,height:a.height+b*2}},setBox:function(a,
b,d,e){var c=this.box,o=c.left!==a||c.top!==b||c.width!==d||c.height!==e;c.left=a;c.top=b;c.width=d;c.height=e;o&&this.fire("boxchanged",this,this.box)},move:function(a){this.calculateBox();this.fire("moved",this,a)},rotate:function(){},translate:function(){},scale:function(){},applyTransformation:function(){},getSizeLevel:function(a){a=a||this.stroke.width;if(a!=null){var b=[],d;for(d in l.STROKE_SIZES)b.push(l.STROKE_SIZES[d]);a=k.getNearestNumber(b,a);for(d in l.STROKE_SIZES)if(a==l.STROKE_SIZES[d])return d}return null}};
return a=g.define(a,Object,c)});define("surface/action/DeleteAction",["require","util/Class"],function(b){function a(){this.elements=null}b=b("util/Class");a.prototype.undo=function(){var a;$(this.elements).each(function(b,h){var i=h.layer;a=a||i.surface;a.disableRender();i.add(h,!0)});a&&(a.enableRender(),a.render())};a.prototype.run=function(){var a;$(this.elements).each(function(b,h){var i=h.layer;a=a||i.surface;a.disableRender();i.remove(h,!0)});a&&(a.enableRender(),a.render())};return b.define(a)});
define("util/Text",["require"],function(){function b(){}var a="undefined"===typeof document?void 0:document.createElement("div");b.encodeUTF8=function(a){return unescape(encodeURIComponent(a))};b.decodeUTF8=function(a){try{return decodeURIComponent(escape(a))}catch(b){return a}};b.trim=function(a){return b.ltrim(b.rtrim(a))};b.ltrim=function(a){if(null!=a)return String.prototype.replace.call(a,/^\s+/g,"")};b.rtrim=function(a){if(null!=a)return String.prototype.replace.call(a,/\s+$/g,"")};b.stripHtml=
function(b){if(null==b||!a)return b;a.innerHTML=b;return a.innerText};b.escapeRegex=function(a){var b;b=RegExp("([\\\\\\^\\$\\*\\+\\?\\.\\(\\)\\[\\]\\{\\}\\|])","g");return a.replace("\\","\\\\").replace(b,"\\$1")};b.lpad=function(a,c,h){return b.pad("left",a,c,h)};b.rpad=function(a,c,h){return b.pad("right",a,c,h)};b.pad=function(a,b,h,i){b+="";b.length<h&&(h=Array(h-b.length+1).join(i||" "),b="left"==a?h+b:b+h);return b};return b});
define("surface/element/Text","require util/Obj util/Color env/Settings surface/element/Element surface/Serializer surface/action/DeleteAction util/Num util/Text util/Transformer util/Img util/Class graphics/CanvasGraphics graphics/Point log/Logger".split(" "),function(b){function a(){this.alignment="left";this.direction="leftToRight";this.previousValue=this.value="";this.width=null;this.position={x:0,y:0};this.depth=3;this.font={name:"Helvetica,Arial,sans-serif",size:12,weight:""};this.baseline=
"alphabetic";this.handles={br:{x:0,y:0}};this.dashedLineWidth=1;this.editor=this.dashPattern=null;this.selectOnFocus=true;this.originalAllowZoom=null}var l=b("util/Obj"),c=b("util/Color"),h=b("env/Settings"),i=b("surface/element/Element"),g=b("surface/Serializer");b("surface/action/DeleteAction");var f=b("util/Num"),k=b("util/Text"),d=b("util/Transformer");b("util/Img");var e=b("util/Class"),o=b("graphics/CanvasGraphics");b("graphics/Point");b("log/Logger").instance("surface.element.Text");a.measurementGraphics=
o.create(1,1);a.prototype.initialize=function(){this.shadow.color=h.SHADOW_COLOR;this.selected&&this.calculateBox();a.parent.prototype.initialize.apply(this,arguments)};a.prototype.getLineWidth=function(){return Math.min(Infinity,0.2*this.font.size)};a.prototype.getMaxLineWidth=function(){return Math.min(Infinity,51.2)};a.prototype.getMinLineWidth=function(){return Math.min(Infinity,1.6)};a.prototype.initGraphics=function(b){b=b||this.graphics;a.parent.prototype.initGraphics.apply(this,arguments);
b.font(this.getFontCss());b.textAlign(this.alignment);b.textBaseline(this.baseline);return this};a.prototype.hasText=function(){return this.value!=null&&this.value.length>0};a.prototype.drawText=function(a,b,d,e){a.fillText(b,d,e)};a.prototype.draw=function(a,b,d){var e=a||this.graphics,a=k.decodeUTF8(this.value).split(/\r?\n/),c=this.position.x,o=this.position.y,f=this.font.size*1.1;this.getLineWidth();var g=0;a.forEach(function(a,b){var m=(b-1)*f;e.shadowColor(this.shadow.color);d!==true&&this.drawText(e,
a,c,o+f+m);g=Math.max(g,e.measureText(a).width)}.bind(this));this.handles.br={x:this.box.left+this.box.width,y:this.box.top+this.box.height}};a.prototype.drawSelection=function(a){a=a||this.graphics;a.lineWidth(3/this.layer.surface.scaling.x);a.shadowColor(this.shadow.color);a.strokeStyle(h.COLORS.white);a.strokeRect(this.box.left,this.box.top,this.box.width,this.box.height)};a.prototype.getStyle=function(){return l.merge(true,a.parent.prototype.getStyle.apply(this,arguments),{font:{size:this.font.size}})};
a.prototype.manipulate=function(b,d){if(this.activeHandle==="br"){var e=Math.max(this.minWidth,Math.min(this.maxWidth,d.x-this.box.left));this.box.height=this.box.height*(e/this.box.width);this.box.width=e;this.font.size=Math.max(8,Math.min(256,8+248*((e-this.minWidth)/(this.maxWidth-this.minWidth))));a.parent.prototype.manipulate.apply(this,arguments)}};a.prototype.getSizeLevel=function(b){return a.parent.prototype.getSizeLevel.call(this,b||this.font.size)};a.prototype.move=function(b){this.position.x=
this.position.x+b.x;this.position.y=this.position.y+b.y;a.parent.prototype.move.apply(this,arguments)};a.prototype.applyTransformation=function(a){this.position=d.transformPoint(this.position,a)};a.prototype.updateText=function(){};a.prototype.getTextMetrics=function(b){var b=b||this.value,d=null,e=a.measurementGraphics,b=k.decodeUTF8(b).split(/\r?\n/),c=0,o=this.font.size;e.save();this.surface&&e.transform.apply(e,this.surface.transformation);e.font(this.getFontCss());e.lineWidth(this.stroke.width);
b.forEach(function(a){a=e.measureText(a);c=c+(a.height!=null&&a.height>0?a.height:o)*1.1;d==null&&(d=a);a.width>d.width&&(d=a)});d==null?d={width:0,height:o*1.1}:d.height=c;e.restore();return d};a.prototype.calculateBox=function(){var a=this.position.x,b=this.position.y,d=this.getLineWidth();this.box.left=a-d;this.box.top=b-d;return this.box};a.prototype.getFontCss=function(a){a=a||this.font;return[a.weight,a.size+"px",a.name].join(" ").trim()};a.prototype.getMinFontCss=function(a){a=a||this.font;
return[a.weight,"8px",a.name].join(" ").trim()};a.prototype.getMaxFontCss=function(a){a=a||this.font;return[a.weight,"256px",a.name].join(" ").trim()};a.prototype.serialize=function(b){var e=a.parent.prototype.serialize.call(this,b),p=g.serializeFont({name:this.font.name,size:f.fixed(this.font.size)});e.style.shadowColor=g.serializeColor(this.shadow.color);e.style.shadowOffset=g.serializeSize({width:this.shadow.offset.x,height:this.shadow.offset.y});e.style.shadowRadius=this.shadow.blur;b=d.transformPoint(b,
this.position);return $.extend(e,{type:"Text",textStyle:this.textStyle,text:this.value,origin:g.serializePoint(b),font:p,strokeColor:g.serializeColor(c.getStrokeColor(this.fill.color)),fillColor:g.serializeColor(this.fill.color),lineWidth:f.fixed(this.stroke.width),alignment:this.alignment,direction:this.direction})};a.prototype.deserialize=function(b,d){$.extend(true,this,{textStyle:d.textStyle||this.textStyle,alignment:d.alignment||this.alignment,direction:d.direction||this.direction,position:{x:d.origin.x,
y:d.origin.y},value:d.text,font:{name:"Helvetica,Arial",size:d.font.size,weight:this.font.weight}});a.parent.prototype.deserialize.apply(this,arguments);return this};return a=e.define(a,i)});
define("surface/element/LabelText","require env/Settings surface/element/Text util/Text util/Class graphics/Point graphics/CanvasGraphics log/Logger".split(" "),function(b){function a(){this.font={name:"Helvetica,Arial,sans-serif",size:15,weight:""};this.maxWidth=100;this.stroke.width=0;this.fill.color=l.COLORS.white;this.shadow.offsetX=0;this.shadow.offsetY=0;this.shadow.blur=0;this.shadow.color=l.COLORS.transparent}var l=b("env/Settings"),c=b("surface/element/Text");b("util/Text");var h=b("util/Class");
b("graphics/Point");b("graphics/CanvasGraphics");b("log/Logger").instance("surface.element.LabelText");a.prototype.getLineWidth=function(){return this.stroke.width};a.prototype.drawText=function(a,b,c,k){a.fillText(b,c,k)};a.prototype.drawSelection=function(){};a.prototype.serialize=function(b){b=a.parent.prototype.serialize.call(this,b);b.textStyle="labelText";return b};return a=h.define(a,c)});
define("util/Trig",["require"],function(){function b(){}b.rad=function(a){return a*Math.PI/180};b.deg=function(a){return 180*a/Math.PI};return b});
define("surface/action/StampLabelAction",["require","util/Class"],function(b){function a(){this.layer=this.newValue=this.oldValue=this.element=null}b=b("util/Class");a.prototype.undo=function(){(this.element.text?this.element.text:this.element).value=this.oldValue;this.layer.render()};a.prototype.run=function(){(this.element.text?this.element.text:this.element).value=this.newValue;this.layer.render()};return b.define(a)});
define("surface/element/stamp/StampLabel","require util/Class surface/element/Element surface/element/LabelText util/Trig env/Settings util/Transformer graphics/CanvasGraphics log/Logger surface/action/StampLabelAction".split(" "),function(b){function a(){this.text=this.defaultText=this.stamp=null;this.innerPadding=15;this.offset={x:0,y:0};this.stroke={style:"butt",width:2,color:i.COLORS.white};this.fill={color:"rgba(0, 0, 0, 0.8)",alpha:0.8};this.shadow={offset:{x:0,y:3},color:"rgba(0, 0, 0, 0.4)",
blur:3};this.minWidth=10;this.maxWidth=180}var l=b("util/Class"),c=b("surface/element/Element"),h=b("surface/element/LabelText");b("util/Trig");var i=b("env/Settings");b("util/Transformer");var g=b("graphics/CanvasGraphics");b("log/Logger").instance("surface.element.stamp.StampLabel");var f=b("surface/action/StampLabelAction");a.buttonText="a";a.defaultHeight=32;a.measurementGraphics=g.create(1,1);a.prototype={initialize:function(){a.parent.prototype.initialize.apply(this,arguments);this.text=this.text||
new h({textStyle:"labelText",font:{name:"Helvetica,Arial",size:15*this.stamp.contentScaleFactor,weight:""},alignment:"left",direction:"leftToRight",baseline:"top",hidden:true,offset:{x:0,y:0},maxWidth:this.maxWidth-this.innerPadding-a.defaultHeight/2,layer:this.stamp.layer});this.calculateBox()},hasText:function(){return this.text.hasText()},getText:function(){return this.hasText()?this.text.value:""},setText:function(a){this.text.value=a;this.calculateBox()},direction:function(){return this.stamp.tail===
false||this.stamp.angle>90&&this.stamp.angle<270?"right":"left"},processHit:function(a){!this.text.editing&&this.hasText()&&this.hitTestHandle(a)?this.deleteLabel():this.hitTest(a)&&this.showInput()},hitTestHandle:function(b){var d=this;this.calculateBox();this.layer=this.stamp.layer;b=a.parent.prototype.hitTest.call(this,b,function(a){a.save();d.initGraphics(a);a.translate(d.stamp.position.x,d.stamp.position.y);d.drawHandle(a);a.restore()});this.layer=null;return b},hitTest:function(b){this.calculateBox();
this.layer=this.stamp.layer;b=a.parent.prototype.hitTest.call(this,b);this.layer=null;return b},showInput:function(){this.calculatePosition();this.stamp.layer.surface.foreground.render()},calculatePosition:function(){var b=this.stamp.contentScaleFactor,d=a.defaultHeight,e=this.text.editing||this.hasText()?this.stamp.radius:this.stamp.selectionRadius,c=a.defaultHeight/2;this.offset.x=Math.sqrt(Math.pow(e,2)-Math.pow(d/2,2))*b;this.offset.y=-d/2*b;e=this.direction()=="left";this.text.offset.x=(this.offset.x+
this.innerPadding*b)*(e?-1:1);this.text.offset.y=this.offset.y+(d*b-this.text.font.size*1.2)/2;this.text.position.x=this.stamp.position.x+(this.text.offset.x-(e?this.maxWidth-this.innerPadding-c:0)*b);this.text.position.y=this.stamp.position.y+this.text.offset.y},calculateBox:function(){this.calculatePosition();var b=a.defaultHeight/2,d=this.maxWidth-this.innerPadding-b,e=this.text.getTextMetrics(this.getText()||a.buttonText).width,c=this.direction()=="left",j=this.offset.x,m=this.offset.y,p=this.stamp.contentScaleFactor,
b=b*p+this.innerPadding*p+(this.text.editing?d*p:Math.min(Math.max(this.minWidth*p,e),d*p));this.setBox(this.stamp.position.x+(c?-j-b:j),this.stamp.position.y+m,b,a.defaultHeight*p);return this.box},draw:function(b){var b=b||this.graphics,d=this.calculateBox(),e=this.stamp.contentScaleFactor,c=d.width/e,d=d.height/e,j=d/2,m=(this.text.editing||this.hasText()?this.stamp.radius:this.stamp.selectionRadius)/e,p=this.offset.x/e,n=this.offset.y/e,f=this.direction()=="left";b.save();b.translate(this.stamp.position.x,
this.stamp.position.y);b.scale(this.stamp.contentScaleFactor,this.stamp.contentScaleFactor);b.save();f&&b.rotate(Math.PI);b.beginPath();b.moveTo(p,n);b.lineTo(p+c-j,n);b.arc(p+c-j,n+j,j,Math.PI*(f?0.5:1.5),Math.PI*(f?1.5:0.5));b.lineTo(p,n+d);b.arc(p-this.offset.x,n+d/2,m,Math.acos(this.offset.x/m)+(f?Math.PI:0),-Math.acos(this.offset.x/m)+(f?Math.PI:0),true);b.closePath();b.fill();b.beginPath();b.moveTo(p,n);b.lineTo(p+c-j,n);b.arc(p+c-j,n+j,j,Math.PI*(f?0.5:1.5),Math.PI*(f?1.5:0.5));b.lineTo(p,
n+d);b.stroke();b.restore();if(!this.text.editing){b.save();b.scale(1/e,1/e);this.stamp.selected&&this.hasText()&&this.drawHandle(b);b.font(this.text.getFontCss());b.textBaseline("top");f&&b.textAlign("right");b.fillStyle("rgba(255, 255, 255, 1)");b.fillText(this.text.value||a.buttonText,this.text.offset.x,this.text.offset.y);b.restore()}b.restore()},deleteLabel:function(){var a;a=new f({element:this,layer:this.stamp.layer,oldValue:this.text.value,newValue:""});this.text.value="";a&&this.stamp.layer.surface.controller.activeTool.fire("action",
this,a);this.stamp.layer.render()},drawHandle:function(a){a=a||this.graphics;this.calculatePosition();var b=this.offset.x+this.box.width,e=this.offset.y+this.box.height/2,c=3/this.stamp.layer.surface.scaling.x;a.save();a.lineWidth(a.lineWidth()/this.stamp.layer.surface.scaling.x);this.direction()=="left"&&a.rotate(Math.PI);a.beginPath();a.strokeStyle(i.COLORS.white);a.fillStyle("rgba(5, 131, 209, 1)");a.shadowColor(i.SHADOW_COLOR);a.shadowOffsetY(2);a.arc(b,e,i.HANDLE_RADIUS/this.stamp.layer.surface.scaling.x+
a.lineWidth(),0,Math.PI*2);a.fill();a.stroke();a.strokeStyle(i.COLORS.white);a.beginPath();a.moveTo(b-c,e-c);a.lineTo(b+c,e+c);a.moveTo(b+c,e-c);a.lineTo(b-c,e+c);a.closePath();a.stroke();a.restore()}};return a=l.define(a,c)});
define("surface/element/stamp/Stamp","require util/Class surface/element/stamp/StampLabel surface/element/Element util/Trig env/Settings util/Box util/Security util/Transformer log/Logger".split(" "),function(b){function a(){this.angle=180;this.tail=false;this.radius=26;this.selectionRadius=Math.max(g.STAMP_DEFAULT_WIDTH,g.STAMP_DEFAULT_HEIGHT)*0.75;this.label=this.defaultText=null;this.depth=2;this.position={x:0,y:0};this.contentScaleFactor=1;this.shadow={offset:{x:0,y:3},blur:4,color:"rgba(0, 0, 0, 0.2)"};
this.handles={t1:{x:0,y:0}}}var l=b("util/Class"),c=b("surface/element/stamp/StampLabel"),h=b("surface/element/Element"),i=b("util/Trig"),g=b("env/Settings"),f=b("util/Box"),k=b("util/Security"),d=b("util/Transformer");b("log/Logger").instance("surface.element.stamp.Stamp");var b=Math.PI,e=2*b,o=180/b,j=b/4;a.buttonText="a";a.prototype={initialize:function(){a.parent.prototype.initialize.apply(this,arguments);this.stroke.color=g.COLORS.transparent;this.stroke.style="round";this.stroke.join="miter";
this.label=this.label||new c({stamp:this});this.calculateBox()},hasText:function(){return this.label.hasText()},getText:function(){return this.label.getText()},setText:function(a){this.label.setText(a)},remove:function(){this.layer&&this.layer.removeElement(this.label.text);return a.parent.prototype.remove.apply(this,arguments)},updateAngle:function(a){var b=this.angle;if(Math.sqrt(a.x*a.x+a.y*a.y)>28){this.angle=this.getAngle(a);this.tail=true}else{this.tail=false;this.angle=180}this.angle!=b&&this.calculateBox()},
getAngle:function(a){a=Math.atan2(a.y,a.x);a<0&&(a=e+a);a=a%j>j/2?Math.ceil(a/j)*j:Math.floor(a/j)*j;return a*o},calculateBox:function(){var a={left:this.position.x-this.selectionRadius*this.contentScaleFactor,top:this.position.y-this.selectionRadius*this.contentScaleFactor,width:this.selectionRadius*2*this.contentScaleFactor,height:this.selectionRadius*2*this.contentScaleFactor},b=this.label.calculateBox(),a=f.union(a,b);this.setBox(a.left,a.top,a.width,a.height);return this.box},initGraphics:function(b){a.parent.prototype.initGraphics.apply(this,
arguments);var d=b||this.graphics;d.miterLimit(4);d.shadowColor(this.shadow.color)},renderSelected:function(a,b){var d=a||this.graphics;!this.editing&&!this.hasText()&&this.label.render(d,null,b);d.save();d.translate(this.position.x,this.position.y);d.scale(this.contentScaleFactor,this.contentScaleFactor);d.beginPath();d.strokeStyle(g.COLORS.white);d.lineWidth(2);d.arc(0,0,this.selectionRadius,0,2*Math.PI,false);d.stroke();d.closePath();d.restore()},draw:function(a,b){var d=a||this.graphics;(this.label.editing||
this.hasText())&&this.label.render(d,null,b);this.drawRing(d);this.drawIcon(d);this.calculateHandles()},drawHandle:function(a,b){h.prototype.drawHandle.call(this,a,b);if(!this.tail){var a=a||this.graphics,d;d=g.HANDLE_RADIUS/this.layer.surface.scaling.x/this.scaling.x;a.fillStyle("white");a.fillRect(b.x-d*0.2,b.y-d*0.45,d*0.4,d*0.9);a.fillRect(b.x-d*0.45,b.y-d*0.2,d*0.9,d*0.4)}},calculateHandles:function(){this.handles.t1.x=this.position.x+this.selectionRadius*this.contentScaleFactor*Math.cos(i.rad(this.angle));
this.handles.t1.y=this.position.y+this.selectionRadius*this.contentScaleFactor*Math.sin(i.rad(this.angle))},move:function(b){this.position.x=this.position.x+b.x;this.position.y=this.position.y+b.y;a.parent.prototype.move.apply(this,arguments)},processHit:function(a){this.label.layer=this.layer;this.label.processHit(a);this.label.layer=null},show:function(){a.parent.prototype.show.apply(this,arguments);this.label.show()},hide:function(){a.parent.prototype.hide.apply(this,arguments);this.label.hide()},
showInput:function(){this.label.showInput()},drawIcon:function(){},drawRing:function(a){a=a||this.graphics;a.save();a.translate(this.position.x,this.position.y);a.scale(this.contentScaleFactor,this.contentScaleFactor);a.rotate(-i.rad(this.angle));a.fillStyle(this.fill.color);a.shadowColor("rgba(0, 0, 0, 0)");a.shadowOffsetX(0);a.shadowOffsetY(3);a.shadowBlur(3);a.strokeStyle("rgba(255, 255, 255, 1)");a.lineWidth(2);a.lineCap("butt");a.lineJoin("miter");a.miterLimit(4);a.save();a.beginPath();a.arc(0,
0,18,0,Math.PI*2);a.closePath();a.fillStyle("rgba(255, 255, 255, 0.95)");a.fill();a.restore();a.save();a.beginPath();if(this.tail){var b=22.24859546128699,d=-17;a.arc(0,0,28,i.rad(38+this.angle),i.rad(322+this.angle));a.lineTo(b,d);a.lineTo(b+14,d);a.lineTo(b+14+14,0);a.lineTo(b+14,-d);a.lineTo(b,-d);a.closePath()}else a.arc(0,0,28,0,Math.PI*2);a.arc(0,0,24,0,Math.PI*2,true);a.shadowColor("rgba(0, 0, 0, 0.35)");a.fillStyle("rgba(255, 255, 255, 1)");a.fill();a.beginPath();a.rotate(i.rad(this.angle));
a.arc(0,0,22,0,Math.PI*2);a.arc(0,0,17,0,Math.PI*2,true);a.fill();a.restore();a.save();a.beginPath();if(this.tail){b=21.236760581595302;d=-15;a.arc(0,0,26,i.rad(40+this.angle),i.rad(320+this.angle));a.lineTo(b,d);a.lineTo(b+14,d);a.lineTo(b+14+12,0);a.lineTo(b+14,-d);a.lineTo(b,-d);a.closePath()}else a.arc(0,0,26,0,Math.PI*2);a.arc(0,0,19,0,Math.PI*2,true);a.fill();a.restore();a.restore()},serialize:function(b){var e=a.parent.prototype.serialize.call(this,b),b=d.transformPoint(b,this.position),c=
g.STAMP_DEFAULT_WIDTH*this.contentScaleFactor,j=g.STAMP_DEFAULT_HEIGHT*this.contentScaleFactor;e.type="Stamp";e.stampName=this.name;if(this.tail)e.tailAngleInDegrees=this.angle;e.frame={x:b.x-c/2,y:b.y-j/2,width:c,height:j};if(this.hasText()){e.guid=k.uuid();e.labelGuid=k.uuid();e.text=this.getText();e.textPosition=this.label.text.position}return e},deserialize:function(b,d){a.parent.prototype.deserialize.apply(this,arguments);this.position.x=d.frame.x+d.frame.width/2;this.position.y=d.frame.y+d.frame.height/
2;this.width=g.STAMP_DEFAULT_WIDTH;this.height=g.STAMP_DEFAULT_HEIGHT;this.contentScaleFactor=Math.max(d.frame.width/g.STAMP_DEFAULT_WIDTH,d.frame.height/g.STAMP_DEFAULT_HEIGHT);this.label.text.font.size=this.contentScaleFactor*15;d.text&&this.setText(d.text);if(d.tailAngleInDegrees){this.angle=d.tailAngleInDegrees;this.tail=true;this.calculateHandles()}return this}};return a=l.define(a,h)});
define("surface/element/Vector","require env/Settings surface/Serializer util/Transformer util/Color util/Num surface/element/Element util/Class".split(" "),function(b){function a(){this.path=null;this.operations=[];this.points=null;this.closed=false;this.visible=true}var l=b("env/Settings"),c=b("surface/Serializer"),h=b("util/Transformer"),i=b("util/Color"),g=b("util/Num"),f=b("surface/element/Element"),b=b("util/Class"),k={ABSOLUTE:{MOVETO:"M",CLOSEPATH:"Z",LINETO:"L",HORIZONTAL_LINETO:"H",VERTICAL_LINETO:"V",
CUBIC_CURVETO:"C",CUBIC_SHORTHAND_CURVETO:"S",QUADRATIC_CURVETO:"Q",QUADRATIC_SHORTHAND_CURVETO:"T",ARC:"A"},RELATIVE:{MOVETO:"m",CLOSEPATH:"z",LINETO:"l",HORIZONTAL_LINETO:"h",VERTICAL_LINETO:"v",CUBIC_CURVETO:"c",CUBIC_SHORTHAND_CURVETO:"s",QUADRATIC_CURVETO:"q",QUADRATIC_SHORTHAND_CURVETO:"t",ARC:"a"},M:"moveTo",Z:"closePath",L:"lineTo",C:"bezierCurveTo",Q:"quadraticCurveTo",A:"arc"};a.transform=function(a,b){var c,j,m,f,n,k;c=a.slice(0);c.splice(4,2,0,0);b=b.replace(/[\s+,]+/g," ");b=b.replace(/([a-z])(\S)/gi,
"$1 $2");if((m=b.match(/[a-z][^a-z]*/gi))&&m.length>0){for(n=0;n<m.length;n++){f=$.trim(m[n]).split(" ");if(/^(M|L|C|Q)$/i.test(f[0]))for(k=1;k<f.length;k=k+2){j=f[0]==f[0].toUpperCase()?a:c;j=h.transformPoint(j,{x:f[k],y:f[k+1]});f[k]=g.fixed(j.x);f[k+1]=g.fixed(j.y)}m[n]=f.join(" ")}b=m.join(" ")}return b};a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,arguments)};a.prototype.deserialize=function(b,e){var c,j,m;this.path=e.path.replace(/[\s+,]+/g," ");this.path=this.path.replace(/([a-z])(\S)/gi,
"$1 $2");if((m=this.path.match(/[a-z][^a-z]*/gi))&&m.length>0){this.operations=[];for(c=0;c<m.length;c++){j=$.trim(m[c]).split(" ");this.operations.push(j)}}a.parent.prototype.deserialize.apply(this,arguments);this.stroke.alpha=(new i(this.stroke.color)).a;return this};a.prototype.invokeOperation=function(a,b){var c=k[a[0]],j=a.slice(1);j.push(b||this.graphics);this[c].apply(this,j)};a.prototype.updateBoxFromPoint=function(a,b){var c=this.box,j,m,f;if(c){a=Number(a);b=Number(b);j=c.left===0?0:c.left||
a;m=c.top===0?0:c.top||b;f=c.width||0;c=c.height||0;f=j+f;c=m+c;j=Math.min(j,a);m=Math.min(m,b);f=Math.max(f,a);c=Math.max(c,b);this.setBox(j,m,f-j,c-m)}};a.prototype.resetBox=function(){this.box.left=null;this.box.top=null;this.box.width=null;this.box.height=null};a.prototype.draw=function(a){if(this.points==null){var b,c,j,a=a||this.graphics;this.resetBox();j=this.operations.slice(0);this.beginPath(a);if(j&&j.length)for(b=0;b<j.length;b++){c=j[b];this.invokeOperation(c,a)}a.stroke();this.closed&&
a.fill()}else if(this.visible){a.beginPath();for(c=0;c<this.points.length;c++){j=this.points[c];if(j.length>0){b=j[0];a.moveTo(b.x,b.y);for(b=1;b<j.length;b++){var m=j[b];a.lineTo(m.x,m.y)}}}a.stroke()}};a.prototype.calculateBox=function(){for(var a=null,b=null,c=null,j=null,m,f,n,g=0;g<this.operations.length;g++){f=this.operations[g];switch(f[0]){case "M":m=[{x:f[1],y:f[2]}];break;case "L":m=[{x:f[1],y:f[2]}];break;case "C":m=[{x:f[5],y:f[6]}];break;case "Q":m=[{x:f[5],y:f[6]}];break;case "A":m=
[{x:f[1]-f[3],y:f[2]-f[3]},{x:f[1]+f[3],y:f[2]+f[3]}]}for(var k=0,i=m.length;k<i;k++){f=m[k].x;n=m[k].y;a==null&&(a=f);c==null&&(c=f);j==null&&(j=n);a=Math.min(a,f);b=Math.min(a,n);c=Math.max(c,f);j=Math.max(j,n)}}this.setBox(a,b,c-a,j-b);return this.box};a.prototype.move=function(b){var c,f,j,m,g;g=this.operations;c=0;for(j=g.length;c<j;c++){m=g[c];if(/^(M|L|C|Q)$/.test(m[0]))for(f=1;f<m.length;f=f+2){m[f]=+m[f]+b.x;m[f+1]=+m[f+1]+b.y}}a.parent.prototype.move.apply(this,arguments)};a.prototype.applyTransformation=
function(b){var c,f,j,m,g,n;g=this.operations;c=0;for(j=g.length;c<j;c++){m=g[c];if(/^(M|L|C|Q)$/i.test(m[0]))for(f=1;f<m.length;f=f+2){n=h.transformPoint(b,{x:m[f],y:m[f+1]});m[f]=n.x;m[f+1]=n.y}}a.parent.prototype.applyTransformation.apply(this,arguments)};a.prototype.toPath=function(){var a,b,c,j=[],m;for(a=0;a<this.operations.length;a++){c=this.operations[a].slice(0);for(b=1;b<c.length;b++){m=c[b];m!==Math.round(m)&&(m=g.fixed(m).toString());c[b]=m}j.push(c.join(" "))}return j.join(" ")};a.prototype.beginPath=
function(a){a.beginPath();this.operations.splice(0);this.closed=false};a.prototype.closePath=function(a){a.closePath();this.operations.push([k.ABSOLUTE.CLOSEPATH]);this.closed=true};a.prototype.rotate=function(a,b){b.rotate(a)};a.prototype.translate=function(a,b,c){c.translate(a,b)};a.prototype.scale=function(a,b,c){c.scale(a,b)};a.prototype.transform=function(a,b,c,j,m,f,n){n.transform(a,b,c,j,m,f)};a.prototype.setTransform=function(a,b,c,j,m,f,n){n.setTransform(a,b,c,j,m,f)};a.prototype.moveTo=
function(a,b,c){c.moveTo(a,b);this.updateBoxFromPoint(a,b);this.operations.push([k.ABSOLUTE.MOVETO,a,b])};a.prototype.lineTo=function(a,b,c){c.lineTo(a,b);this.updateBoxFromPoint(a,b);this.operations.push([k.ABSOLUTE.LINETO,a,b])};a.prototype.quadraticCurveTo=function(a,b,c,j,m){m.quadraticCurveTo(a,b,c,j);this.updateBoxFromPoint(c,j);this.operations.push([k.ABSOLUTE.QUADRATIC_CURVETO,a,b,c,j])};a.prototype.bezierCurveTo=function(a,b,c,j,m,f,n){n.bezierCurveTo(a,b,c,j,m,f);this.updateBoxFromPoint(m,
f);this.operations.push([k.ABSOLUTE.CUBIC_CURVETO,a,b,c,j,m,f])};a.prototype.arcTo=function(a,b,c,j,m,f){f.arcTo(a,b,c,j,m)};a.prototype.rect=function(a,b,c,j,m){m.rect(a,b,c,j);this.operations.push([k.ABSOLUTE.MOVETO,a,b]);this.operations.push([k.ABSOLUTE.LINETO,a+c,b]);this.operations.push([k.ABSOLUTE.LINETO,a+c,b+j]);this.operations.push([k.ABSOLUTE.LINETO,a,b+j]);this.operations.push([k.ABSOLUTE.LINETO,a,b])};a.prototype.ellipse=function(a,b,c){var j=a.x-b.x,m=a.y-b.y,f=b.x*0.5522848,n=b.y*0.5522848,
g=j+b.x*2,b=m+b.y*2,k=a.x,a=a.y;this.moveTo(j,a,c);this.bezierCurveTo(j,a-n,k-f,m,k,m,c);this.bezierCurveTo(k+f,m,g,a-n,g,a,c);this.bezierCurveTo(g,a+n,k+f,b,k,b,c);this.bezierCurveTo(k-f,b,j,a+n,j,a,c)};a.prototype.getEstimatedSize=function(){return(new i(this.stroke.color)).a<1?this.stroke.width/2/l.MAX_STROKE_WIDTH/this.layer.surface.contentScaleFactor:this.stroke.width/l.MAX_STROKE_WIDTH/this.layer.surface.contentScaleFactor};a.prototype.serialize=function(b){var e=a.parent.prototype.serialize.call(this,
b),f=this.toPath(),f=a.transform(b,f),b=g.fixed(this.stroke.width),j=this.stroke.color,m=this.fill.color;e.style.shadowColor=c.serializeColor(this.shadow.color);e.style.shadowOffset=c.serializeSize({width:this.shadow.offset.x,height:this.shadow.offset.y});e.style.shadowRadius=this.shadow.blur;e=$.extend(e,{type:"Vector",path:f,lineWidth:b});j&&(new i(j)).a!=0?e.strokeColor=c.serializeColor(j):delete e.strokeColor;m&&(new i(m)).a!=0?e.fillColor=c.serializeColor(m):delete e.fillColor;return e};return a=
b.define(a,f)});
define("surface/element/Polygon",["require","util/Class","surface/element/Vector","util/Transformer"],function(b){function a(){this.vertices=[];this.closed=!0}var l=b("util/Class"),c=b("surface/element/Vector"),h=b("util/Transformer");a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,arguments)};a.prototype.deserialize=function(b,c){this.vertices=c.extension.vertices||[];a.parent.prototype.deserialize.apply(this,arguments);return this};a.prototype.move=function(b){var c,f;
for(c=0;c<this.vertices.length;c++)f=this.vertices[c],f.x+=b.x,f.y+=b.y;a.parent.prototype.move.apply(this,arguments)};a.prototype.applyTransformation=function(b){var c;for(c=0;c<this.vertices.length;c++)this.vertices[c]=h.transformPoint(b,this.vertices[c]);a.parent.prototype.applyTransformation.apply(this,arguments)};a.prototype.toVertices=function(){return this.vertices};a.prototype.serialize=function(b){for(var c=this.toVertices(),f=0;f<c.length;f++)c[f]=h.transformPoint(b,c[f]);b=$.extend(a.parent.prototype.serialize.call(this,
b),{extension:{type:"Polygon",vertices:c}});b.fillColor&&delete b.fillColor;return b};return a=l.define(a,c)});
define("surface/element/Pixelate","require util/Transformer util/Num env/Settings surface/element/Polygon util/Class graphics/CanvasGraphics util/Color util/Box util/Num graphics/Point".split(" "),function(b){function a(){this.pixelizedImage=this.height=this.width=this.top=this.left=null;this.depth=0;this.activePos=this.startPos=null}b("util/Transformer");b("util/Num");var l=b("env/Settings"),c=b("surface/element/Polygon"),h=b("util/Class");b("graphics/CanvasGraphics");b("util/Color");var i=b("util/Box");
b("util/Num");b("graphics/Point");a.sizes=[];a.images=[];a.prototype.draw=function(a,b){var c=b.background.getBitmap();if(c){var d=this.getPixelatedImage(Math.min(this.width,this.height)),e=d.width/c.width,o=i.intersection(c,this),c=o.left*e,j=o.top*e,m=o.width*e||1,e=o.height*e||1,p=o.left,n=o.top,r=o.width||1,o=o.height||1,a=a||this.graphics;a.shadowColor(l.COLORS.transparent);a.context.imageSmoothingEnabled=false;a.context.webkitImageSmoothingEnabled=false;a.context.mozImageSmoothingEnabled=false;
a.drawImage(d,c,j,m,e,p,n,r,o);this.pixelizedImage=d;this.setBox(this.left,this.top,this.width,this.height)}};a.prototype.getPixelatedImage=function(b){var c=a.images;return b<=8?c[0]:b<=16?c[1]:b<=24?c[2]:b<=48?c[3]:b<=64?c[4]:c[5]};a.prototype.select=function(){return false};a.prototype.hitTest=function(){return false};return a=h.define(a,c)});
define("surface/layer/Layer","require util/Class env/Settings util/Img mixin/Transformable util/Obj surface/element/stamp/Stamp surface/element/Text surface/action/DeleteAction surface/element/Pixelate graphics/CanvasGraphics graphics/Point util/Box".split(" "),function(b){function a(){this.graphics=this.dom=this.surface=null;this.elements=[];this.dirty=false;this.pointer=null;this.doRender=true;this.bgcolor=c.COLORS.transparent;this.registerEvents("render","elementadded","elementremoved","elementmoved",
"elementmanipulated","added","removed","paste","boxchanged")}var l=b("util/Class"),c=b("env/Settings");b("util/Img");var h=b("mixin/Transformable");b("util/Obj");var i=b("surface/element/stamp/Stamp"),g=b("surface/element/Text"),f=b("surface/action/DeleteAction"),k=b("surface/element/Pixelate"),d=b("graphics/CanvasGraphics");b("graphics/Point");var e=b("util/Box");a.id={BACKGROUND:"__background__",ANNOTATION:"__annotation__",TEXT:"__text__"};a.prototype.initialize=function(){var a=this.surface?this.surface.getWidth():
0,b=this.surface?this.surface.getHeight():0,a=d.create(a,b),b=a.context.canvas;$(b).attr("touch-action","none").addClass("skitch-layer").css({display:"block",position:"absolute",top:"0px",left:"0px"});this.dom=b;this.graphics=a;this.initEvents()};a.prototype.initEvents=function(){this.on("added",this.onAdded,this);this.on("removed",this.onRemoved,this);this.on("elementadded",this.onElementAdded,this)};a.prototype.getElement=function(a,b){var c,d,e=[],f=[];this.elements.forEach(function(a){a.selected?
e.push(a):f.push(a)});for(c=e.length;c--;){d=e[c];if(d.hitTest(a,null,b))return d}for(c=f.length;c--;){d=f[c];if(d.hitTest(a,null,b))return d}};a.prototype.onElementAdded=function(a,b){b.on("moved",this.onElementMoved,this);b.on("manipulated",this.onElementManipulated,this)};a.prototype.onElementMoved=function(a,b){this.fire("elementmoved",a,b)};a.prototype.onElementManipulated=function(a,b,c){this.fire("elementmanipulated",a,b,c)};a.prototype.isEmpty=function(){return this.elements.length===0};a.prototype.hide=
function(){this.hidden=true};a.prototype.show=function(){this.hidden=false};a.prototype.isDirty=function(){return this.dirty};a.prototype.getBox=function(){var a=this.elements.map(function(a){return a.box});return e.union(a)};a.prototype.translateElements=function(a){var b,c,d=this.elements;for(b=0;b<d.length;b++){c=d[b];c.move(a)}};a.prototype.onAdded=function(){};a.prototype.onRemoved=function(){this.surface=null};a.prototype.getCanvas=function(){return this.graphics&&this.graphics.context.canvas};
a.prototype.getElementByUuid=function(a){var b;for(b=0;b<this.elements.length;b++)if(a===this.elements[b].uuid)return this.elements[b]};a.prototype.containsElement=function(a){var b;for(b=0;b<this.elements.length;b++)if(a===this.elements[b]||a.uuid&&a.uuid===this.elements[b].uuid)return true;return false};a.prototype.add=function(a){return this.addElement(a)};a.prototype.addElement=function(a){if(this.containsElement(a))return false;var b=a.depth,c,d=false;for(c=this.elements.length-1;c>=0;c--)if(this.elements[c].depth<=
b){this.elements.splice(c+1,0,a);d=true;break}if(!d){c=0;this.elements.splice(c,0,a)}for(;c<this.elements.length;c++)this.elements[c].order=c;this.dirty=true;a.layer=this;a.on("boxchanged",this.onElementBoxChanged,this);this.fire("elementadded",this,a);a.fire("added",this);return true};a.prototype.onElementBoxChanged=function(){this.fire("boxchanged",this,this.getBox())};a.prototype.remove=function(a){return this.removeElement(a)};a.prototype.removeElement=function(a){var b,c=this.elements;for(b=
0;b<c.length;b++)if(c[b]===a){c.splice(b,1);a.order=null}this.fire("elementremoved",this,a);a.fire("removed",this);this.fire("boxchanged",this,this.getBox());return a};a.prototype.renderElement=function(a){this.addElement(a);this.render()};a.prototype.initGraphics=function(a){a=a||this.graphics;a.transform.apply(a,this.transformation);this.clip();return this};a.prototype.clip=function(){var a=this.graphics,b=this.surface.clipRect;a.beginPath();a.rect(b.left,b.top,b.width,b.height);a.clip()};a.prototype.render=
function(){if(this.doRender){var a,b=[],c=[],d;this.elements.forEach(function(a){a.selected?b.push(a):c.push(a)});this.clear();this.graphics.save();this.initGraphics();this.onBeforeRenderElements();this.showGrid&&this.renderGrid();for(d=0;d<c.length;d++){a=c[d];a.layer===this&&a.hidden||a.render()}for(d=0;d<b.length;d++){a=b[d];a.layer===this&&a.hidden||a.render()}this.graphics.restore();this.fire("render",this);return this}};a.prototype.onBeforeRenderElements=function(){};a.prototype.fillWithColor=
function(a){var b=this.graphics;b.save();b.fillStyle(a);b.setTransform(1,0,0,1,0,0);b.fillRect(0,0,b.getWidth(),b.getHeight());b.restore();return this};a.prototype.clear=function(){var a=this.graphics;a.save();a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,a.getWidth(),a.getHeight());a.restore();return this};a.prototype.empty=function(a){var b=this,c=[];this.clear();$(this.elements).each(function(d,e){(!a||a&&e.selected)&&c.push(b.remove(e,true))});this.render();c.length>0&&b.fire("action",new f({elements:c}));
return c};a.prototype.toDataURL=function(a){return this.getCanvas().toDataURL(a)};a.prototype.resize=function(a,b){if(a&&b){this.graphics.setWidth(a);this.graphics.setHeight(b);this.render()}return this};a.prototype.getCenter=function(){return{x:this.graphics.getWidth()/2,y:this.graphics.getHeight()/2}};a.prototype.renderGrid=function(a){a=a||this.graphics;a.save();this.initGraphics(a);a.renderGrid();a.restore()};a.prototype.pan=function(a){a&&this.translateBy(a.x,a.y).render()};a.prototype.zoom=
function(a,b){b=b||this.getCenter();this.scaleBy(a,a,b.x,b.y).render()};a.prototype.copy=function(a,b,c,d){var f=this.graphics,a=a||0,b=b||0,c=c||f.getWidth(),d=d||f.getHeight(),a=e.transform({left:a,top:b,width:c,height:d},this.transformation);return f.getImageData(a.left,a.top,a.width,a.height)};a.prototype.paste=function(b,c,e,f){var n,g=this.graphics,c=c||0,e=e||0;if(b.nodeType===1&&/img|canvas|video/i.test(b.nodeName))n=b;else{if(b instanceof a){n=b.elements;this.fillWithColor(b.bgcolor);g.save();
g.setTransformation(this.transformation);g.translateBy(-c,-e);for(b=0;b<n.length;b++){e=n[b];c=e.selected;if(!f)e.selected=false;e.render(g);e.selected=c}g.restore();this.fire("paste",this);return this}if(b.data){f=d.create(b.width,b.height);f.putImageData(b,0,0);n=f.context.canvas}}if(n){g.drawImage(n,c,e);this.fire("paste",this)}return this};a.prototype.serialize=function(b,c){var d,e,f=[];for(d=0;d<this.elements.length;d++){e=this.elements[d];e instanceof k||c==a.id.ANNOTATION&&(e instanceof g||
e instanceof i)||c==a.id.TEXT&&!(e instanceof g)&&!(e instanceof i)||f.push(e.serialize(b))}return{type:"Layer",layerId:c,children:f}};return a=l.define(a,Object,h)});
define("surface/layer/Buffer",["require","util/Class","surface/layer/Layer"],function(b){function a(){}var l=b("util/Class"),b=b("surface/layer/Layer");a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,arguments);$(this.dom).hide();$(this.dom).addClass("skitch-layer-buffer")};a.prototype.empty=function(){var b=this.graphics;a.parent.prototype.empty.apply(this,arguments);b.save();b.fillStyle("#ffffff");b.fillRect(0,0,b.getWidth(),b.getHeight());b.restore();return this};a.prototype.clip=
function(){};return a=l.define(a,b)});
define("surface/element/Bitmap","require env/Settings surface/Serializer async/Promise surface/element/Element surface/element/Pixelate util/Binary util/Img util/Box util/Transformer util/Class log/Logger graphics/CanvasGraphics".split(" "),function(b){function a(){this.src=this.dom=null;this.height=this.width=this.top=this.left=0;this.clipRect={left:0,top:0,width:0,height:0};this.registerEvents("loaded")}var l=b("env/Settings"),c=b("surface/Serializer"),h=b("async/Promise"),i=b("surface/element/Element"),
g=b("surface/element/Pixelate"),f=b("util/Binary"),k=b("util/Img"),d=b("util/Box"),e=b("util/Transformer"),o=b("util/Class"),j=b("log/Logger").instance("surface.element.Bitmap"),m=b("graphics/CanvasGraphics");a.contentMode={NONE:0,ASPECT_FIT:1,ASPECT_FILL:2,FILL:3};a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,arguments);this.stroke.width=0;this.shadow.offset.x=0;this.shadow.offset.y=0;this.shadow.blur=0;this.shadow.color=l.COLORS.transparent;if(this.dom){this.width=this.dom.width;
this.height=this.dom.height;this.setBox(this.left,this.top,this.width,this.height);this.clipRect.left=this.left;this.clipRect.top=this.top;this.clipRect.width=this.width;this.clipRect.height=this.height;this.initDomPixels()}else this.createDOM();this.setSrcAsync(this.src)};a.prototype.toBytesAsync=function(a,b,c,d){var e=m.create(c,d),f=this.layer.surface.foreground;e.save();e.fillStyle(l.COLORS.white);e.fillRect(0,0,e.getWidth(),e.getHeight());e.restore();e.drawImage(this.dom,a,b,c,d,0,0,c,d);for(d=
0;d<f.elements.length;d++){c=f.elements[d];c instanceof g&&this.pixelate(e,a,b,c)}return k.toBytesAsync(e)};a.prototype.pixelate=function(a,b,c,e){var f=e.pixelizedImage,j=f.width/this.width,m=d.intersection(this,e),e=m.left*j,g=m.top*j,k=m.width*j||1,j=m.height*j||1,b=m.left-b,c=m.top-c,i=m.width||1,m=m.height||1;a.shadowColor(l.COLORS.transparent);a.context.imageSmoothingEnabled=false;a.context.webkitImageSmoothingEnabled=false;a.context.mozImageSmoothingEnabled=false;a.drawImage(f,e,g,k,j,b,c,
i,m)};a.prototype.setSrcAsync=function(a){var b=new h;if(a&&(this.dom==null||a!=this.dom.src)){this.domPixels=this.dom=this.src=null;k.loadAsync(a).done(function(a){this.dom=a;this.width=a.naturalWidth||a.width;this.height=a.naturalHeight||a.height;this.setBox(this.left,this.top,this.width,this.height);this.clipRect.left=this.left;this.clipRect.top=this.top;this.clipRect.width=this.width;this.clipRect.height=this.height;this.initDomPixels();this.fire("loaded",this,a);b.resolve()}.bind(this)).fail(function(a){b.reject.apply(b,
arguments)})}else b.resolve();return b};a.prototype.initDomPixels=function(){if(!this.domPixels){var a=m.create(this.width,this.height);a.drawImage(this.dom,0,0);this.domPixels=a.getImageData(0,0,this.width,this.height).data}};a.prototype.createDOM=function(){return this.dom=document.createElement("img")};a.prototype.move=function(b){this.left=this.left+b.x;this.top=this.top+b.y;this.clipRect.left=this.clipRect.left+b.x;this.clipRect.top=this.clipRect.top+b.y;this.setBox(this.left,this.top,this.width,
this.height);a.parent.prototype.move.apply(this,arguments)};a.prototype.initGraphics=function(b){b=b||this.graphics;a.parent.prototype.initGraphics.apply(this,arguments);this.clip(b);return this};a.prototype.clip=function(a){if(l.ENABLE_INFINITE_CANVAS){var b=this.clipRect,a=a||this.graphics;a.beginPath();a.rect(b.left,b.top,b.width,b.height);a.clip()}};a.prototype.draw=function(a){a=a||this.graphics;this.width!=0&&this.height!=0&&a.drawImage(this.dom,this.left,this.top,this.width,this.height)};a.prototype.applyTransformation=
function(a){var b=e.transformPoint(a,{x:this.left,y:this.top}),a=a[0];this.left=b.x;this.top=b.y;this.width=this.width*a;this.height=this.height*a};a.prototype.serialize=function(b){var e="skitch+uuid:///"+this.uuid,f=a.contentMode.NONE,j=d.transform({left:this.clipRect.left,top:this.clipRect.top,width:this.clipRect.width,height:this.clipRect.height},b),j=c.serializeBox(j);return $.extend(a.parent.prototype.serialize.call(this,b),{type:"Bitmap",uri:e,frame:j,contentMode:f})};a.prototype.deserialize=
function(b,c){var d,e,g,i,o=c.frame,l=new h;a.parent.prototype.deserialize.apply(this,arguments);this.uuid=d=c.uri.split("///")[1];for(var C in b.resources)if(d.toLowerCase()===C.toLowerCase()){e=b.resources[C];break}i=c.cropRect||o;d=i.x>o.x||i.y>o.y||i.width<o.width||i.height<o.height;this.left=Math.max(i.x,o.x);this.top=Math.max(i.y,o.y);this.width=Math.min(i.width,o.width);this.height=Math.min(i.height,o.height);if(e){g=f.toObjectURL(e);d?k.loadAsync(g).done(function(a){var b=m.create(a.naturalWidth||
a.width,a.naturalHeight||a.height);b.drawImage(a,i.x-o.x,i.y-o.y,i.width,i.height,0,0,i.width,i.height);g=b.context.canvas.toDataURL();l.resolve(g)}.bind(this)).fail(function(a){l.reject.apply(l,arguments)}):l.resolve(g)}else{j.warn("resource binary was not found embedded in image... something wrong loading bitmap.... falling back to transparent bg");g=m.create(this.width,this.height).context.canvas.toDataURL("image/png")}l.done(function(a){this.setSrcAsync(a)}.bind(this))};return a=o.define(a,i)});
define("surface/layer/Background","require util/Class surface/layer/Layer util/Img util/Binary async/Promise env/Settings util/Box surface/element/Bitmap".split(" "),function(b){function a(){this.bgcolor=h.COLORS.white;this.registerEvents("loaded","bitmapcreated")}var l=b("util/Class"),c=b("surface/layer/Layer");b("util/Img");b("util/Binary");b("async/Promise");var h=b("env/Settings");b("util/Box");var i=b("surface/element/Bitmap");a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,
arguments);$(this.dom).addClass("skitch-layer-background")};a.prototype.onElementAdded=function(b,c){a.parent.prototype.onElementAdded.apply(this,arguments);if(c instanceof i)if(c.dom&&c.dom.width>0)this.fire("loaded",this);else c.once("loaded",function(){this.fire("loaded",this)},this)};a.prototype.getBitmap=function(){return this.hasBitmap()?this.elements[0]:null};a.prototype.hasBitmap=function(){return this.elements.length>0};a.prototype.onBeforeRenderElements=function(){this.fillWithColor(this.bgcolor)};
return a=l.define(a,c)});
define("surface/layer/Foreground",["require","util/Class","surface/layer/Layer"],function(b){function a(){this.registerEvents("elementselectionschanged")}var l=b("util/Class"),b=b("surface/layer/Layer");a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,arguments);$(this.dom).addClass("skitch-layer-foreground")};a.prototype.onAdded=function(b){a.parent.prototype.onAdded.apply(this,arguments)};a.prototype.getSelectedElements=function(){var a=[],b;for(b in this.elements)this.elements[b].selected&&a.push(this.elements[b]);
return a};a.prototype.addElement=function(b){if(0<=b.box.height&&0<=b.box.width)return b.on("selected",this.onElementSelectionChanged,this),b.on("unselected",this.onElementSelectionChanged,this),a.parent.prototype.addElement.apply(this,arguments)};a.prototype.removeElement=function(b){b.off("selected",this.onElementSelectionChanged);b.off("unselected",this.onElementSelectionChanged);return a.parent.prototype.removeElement.apply(this,arguments)};a.prototype.onElementSelectionChanged=function(a){this.fire("elementselectionschanged",
a)};return a=l.define(a,b)});define("surface/layer/Tool",["require","util/Class","surface/layer/Layer"],function(b){function a(){}var l=b("util/Class"),b=b("surface/layer/Layer");a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,arguments);$(this.dom).addClass("skitch-layer-tool")};a.prototype.clip=function(){};return a=l.define(a,b)});
define("surface/element/BubbleText","require env/Settings util/Color surface/element/Text util/Text util/Class graphics/Point graphics/CanvasGraphics log/Logger".split(" "),function(b){function a(){this.font={name:"Helvetica,Arial,sans-serif",size:60,weight:"bold"};this.baseline="top";this.scratchCanvas=null}b("env/Settings");var l=b("util/Color"),c=b("surface/element/Text"),h=b("util/Text"),i=b("util/Class");b("graphics/Point");var g=b("graphics/CanvasGraphics");b("log/Logger").instance("surface.element.BubbleText");
a.prototype.initGraphics=function(b){b=b||this.graphics;a.parent.prototype.initGraphics.apply(this,arguments);b.strokeStyle(l.getStrokeColor(this.fill.color));b.lineWidth(this.getLineWidth());return this};a.prototype.drawText=function(a,b,c,e){a.save();a.shadowOffsetX(this.shadow.offset.x);a.shadowOffsetY(this.shadow.offset.y);a.shadowBlur(this.shadow.blur);a.strokeText(b,c,e);a.shadowOffsetX(0);a.shadowOffsetY(0);a.shadowBlur(0);a.fillText(b,c,e);a.restore()};a.prototype.updateText=function(){var a=
this.scratchCanvas||g.create(100,100),b=this.position.x,c=this.position.y,e=this.font.size*1.1,i=h.decodeUTF8(this.value).split(/\r?\n/),j=this.getLineWidth(),m=0,p=0,n=0;a.font(this.getFontCss());i.forEach(function(b){m=Math.max(m,a.measureText(b).width)});a.font(this.getMinFontCss());i.forEach(function(b){p=Math.max(p,a.measureText(b).width)});a.font(this.getMaxFontCss());i.forEach(function(b){n=Math.max(n,a.measureText(b).width)});this.minWidth=p+this.getMinLineWidth()*2;this.maxWidth=n+this.getMaxLineWidth()*
2;this.setBox(b-j,c-j,m+j*2,e*i.length+j*2)};c.prototype.calculateBox=function(){this.updateText();return this.box};return a=i.define(a,c)});
define("surface/element/Arrow","require util/Class surface/element/Vector env/Settings surface/Serializer util/Transformer util/Geometry".split(" "),function(b){function a(){this.from={x:0,y:0};this.to={x:0,y:0};this.handles={from:{x:0,y:0},to:{x:0,y:0}};this.size=0;this.stroke={color:h.COLORS.transparent,join:"miter"}}var l=b("util/Class"),c=b("surface/element/Vector"),h=b("env/Settings"),i=b("surface/Serializer"),g=b("util/Transformer"),f=b("util/Geometry");a.prototype.initialize=function(){this.shadow.color=
h.SHADOW_COLOR;a.parent.prototype.initialize.apply(this,arguments)};a.prototype.deserialize=function(b,c){a.parent.prototype.deserialize.apply(this,arguments);$.extend(true,this,{from:c.extension.startPoint,to:c.extension.endPoint,size:c.extension.toolArrowSize});return this};a.prototype.initGraphics=function(b){var b=b||this.graphics,c=h.ARROW_STROKE_WIDTH;a.parent.prototype.initGraphics.apply(this,arguments);b.strokeStyle(h.COLORS.transparent);this.layer&&(c=c/(this.layer.surface.scaling.x/this.scaling.x));
b.lineWidth(c);return this};a.prototype.setSelectedStyles=function(b,c){a.parent.prototype.setSelectedStyles.apply(this,arguments);b.lineWidth(h.SELECTION_STROKE_WIDTH/this.layer.surface.scaling.x/this.scaling.x)};a.prototype.draw=function(a){var a=a||this.graphics,b=this.from,c=this.to,f=this.size,j,m,g;m=c.x-b.x;g=c.y-b.y;j=Math.atan2(-g,m);m=Math.sqrt(m*m+g*g);this.handles.from={x:b.x,y:b.y};this.handles.to={x:c.x,y:c.y};c=m*m<f*f*25?m/5:f;a.translate(b.x,b.y);a.rotate(j);this.beginPath(a);f=Math.sqrt((m-
0)*(m-0)+0);j=(c-1.5)*0.7;var b=j*2,n=b*1.1,i=j/2,h=Math.max(c*0.08,1.5),c=0+f,b=c-b;j=c-n;var f=(0+f/2+b)/2,l=(h+i)/2;m=b-(b-0)/2;var z=((h+i)/2+h)/2;g=0-i;var B=0-n/2,n=0+n/2,i=0+i,t=0-h,C=0-z,A=0+h,z=0+z,u={x:0-b,y:t-g},v=u.x*u.x+u.y*u.y;if(v<=0)u={x:0,y:0};else{v=1/Math.sqrt(v);u.x=u.x*v;u.y=u.y*v}var u={x:0+u.x*h*1.5,y:t+u.y*h*1.5},h=u.x,v=-u.y,x=0-l,l=0+l;this.moveTo(0,t,a);a.bezierCurveTo(m,C,f,x,b,g);this.lineTo(j,B,a);this.lineTo(c,0,a);this.lineTo(j,n,a);this.lineTo(b,i,a);a.bezierCurveTo(f,
l,m,z,0,A);a.bezierCurveTo(h,v,u.x,u.y,0,t);this.closePath(a);a.fill();this.selected&&a.stroke();this.calculateBox()};a.prototype.calculateBox=function(){this.setBox(Math.min(this.from.x,this.to.x),Math.min(this.from.y,this.to.y),Math.abs(this.to.x-this.from.x),Math.abs(this.to.y-this.from.y));return this.box};a.prototype.manipulate=function(b,c){if(this.layer.surface.controller.activeTool.isShiftDown)if(this.activeHandle==="from")this.from=f.rotateLockPoint(this.to,c);else{if(this.activeHandle===
"to")this.to=f.rotateLockPoint(this.from,c)}else if(this.activeHandle==="from")this.from=c;else if(this.activeHandle==="to")this.to=c;a.parent.prototype.manipulate.apply(this,arguments)};a.prototype.getEstimatedSize=function(){return this.stroke.width?this.stroke.width/h.MAX_STROKE_WIDTH/this.layer.surface.contentScaleFactor:this.size/32};a.prototype.move=function(b){this.from.x=this.from.x+b.x;this.from.y=this.from.y+b.y;this.to.x=this.to.x+b.x;this.to.y=this.to.y+b.y;a.parent.prototype.move.apply(this,
arguments)};a.prototype.applyTransformation=function(a){this.from=g.transformPoint(a,this.from);this.to=g.transformPoint(a,this.to)};a.prototype.serialize=function(b){var c=g.transformPoint(b,this.from),e=g.transformPoint(b,this.to),f=this.size,b=a.parent.prototype.serialize.call(this,b);$.extend(b,{extension:{type:"Arrow",startPoint:i.serializePoint(c),endPoint:i.serializePoint(e),toolArrowSize:f}});b.strokeColor&&delete b.strokeColor;return b};return a=l.define(a,c)});
define("surface/element/Ellipse","require util/Class surface/element/Vector env/Settings util/Transformer surface/Serializer util/Num".split(" "),function(b){function a(){this.center={x:0,y:0};this.radius={x:0,y:0};this.handles={left:{x:0,y:0},top:{x:0,y:0},right:{x:0,y:0},bottom:{x:0,y:0}}}var l=b("util/Class"),c=b("surface/element/Vector"),h=b("env/Settings"),i=b("util/Transformer"),g=b("surface/Serializer"),f=b("util/Num");a.prototype.initialize=function(){this.shadow.color=h.SHADOW_COLOR;a.parent.prototype.initialize.apply(this,
arguments)};a.prototype.deserialize=function(b,c){$.extend(true,this,{center:c.extension.center,radius:{x:c.extension.xradius,y:c.extension.yradius}});a.parent.prototype.deserialize.apply(this,arguments);return this};a.prototype.draw=function(a){var a=a||this.graphics,b=this.center,c=this.radius;if(c.x>0&&c.y>0){this.handles.left={x:b.x-c.x,y:b.y};this.handles.right={x:b.x+c.x,y:b.y};this.handles.top={x:b.x,y:b.y-c.y};this.handles.bottom={x:b.x,y:b.y+c.y};Math.max(c.x,c.y);this.beginPath(a);this.ellipse(b,
c,a);a.stroke()}this.calculateBox()};a.prototype.calculateBox=function(){this.setBox(this.center.x-this.radius.x,this.center.y-this.radius.y,2*this.radius.x,2*this.radius.y);return this.box};a.prototype.manipulate=function(b,c){var e;if(this.activeHandle==="left")if(c.x<this.box.left+this.box.width-1){e=this.center.x+this.radius.x;this.radius.x=Math.abs(e-c.x)/2;this.center.x=Math.abs(c.x+this.radius.x)}else{this.center.x=this.box.left+this.box.width-1;this.radius.x=1}else if(this.activeHandle===
"right")if(c.x>this.box.left+1){e=this.center.x-this.radius.x;this.radius.x=Math.abs(c.x-e)/2;this.center.x=Math.abs(e+this.radius.x)}else{this.center.x=this.box.left+1;this.radius.x=1}else if(this.activeHandle==="top")if(c.y<this.box.top+this.box.height-1){e=this.center.y+this.radius.y;this.radius.y=Math.abs(e-c.y)/2;this.center.y=Math.abs(c.y+this.radius.y)}else{this.center.y=this.box.top+this.box.height-1;this.radius.y=1}else if(this.activeHandle==="bottom")if(c.y>this.box.top+1){e=this.center.y-
this.radius.y;this.radius.y=Math.abs(c.y-e)/2;this.center.y=Math.abs(e+this.radius.y)}else{this.center.y=this.box.top+1;this.radius.y=1}a.parent.prototype.manipulate.apply(this,arguments)};a.prototype.move=function(b){this.center.x=this.center.x+b.x;this.center.y=this.center.y+b.y;a.parent.prototype.move.apply(this,arguments)};a.prototype.applyTransformation=function(a){this.center=i.transformPoint(a,this.center);this.radius.x=this.radius.x*a[0];this.radius.y=this.radius.y*a[3]};a.prototype.serialize=
function(b){var c=i.transformPoint(b,this.center),e=this.radius.x*b[0],h=this.radius.y*b[3],b=a.parent.prototype.serialize.call(this,b);$.extend(b,{extension:{type:"Ellipse",center:g.serializePoint(c),xradius:f.fixed(e),yradius:f.fixed(h)}});b.fillColor&&delete b.fillColor;return b};return a=l.define(a,c)});
define("surface/element/Line","require util/Class util/Geometry surface/element/Vector util/Transformer surface/Serializer".split(" "),function(b){function a(){this.to=this.from=null;this.shadow={offset:{x:0,y:0},blur:0};this.handles={from:{x:0,y:0},to:{x:0,y:0}}}var l=b("util/Class"),c=b("util/Geometry"),h=b("surface/element/Vector"),i=b("util/Transformer"),g=b("surface/Serializer");a.prototype.deserialize=function(b,c){$.extend(true,this,{from:c.extension.startPoint,to:c.extension.endPoint});a.parent.prototype.deserialize.apply(this,
arguments);return this};a.prototype.draw=function(a){var a=a||this.graphics,b=this.from,c=this.to;this.handles.from={x:b.x,y:b.y};this.handles.to={x:c.x,y:c.y};this.beginPath(a);this.moveTo(b.x,b.y,a);this.lineTo(c.x,c.y,a);a.stroke();this.calculateBox()};a.prototype.calculateBox=function(){this.setBox(Math.min(this.from.x,this.to.x),Math.min(this.from.y,this.to.y),Math.abs(this.to.x-this.from.x),Math.abs(this.to.y-this.from.y));return this.box};a.prototype.manipulate=function(b,g){if(this.layer.surface.controller.activeTool.isShiftDown)if(this.activeHandle===
"from")this.from=c.rotateLockPoint(this.to,g);else{if(this.activeHandle==="to")this.to=c.rotateLockPoint(this.from,g)}else if(this.activeHandle==="from")this.from=g;else if(this.activeHandle==="to")this.to=g;a.parent.prototype.manipulate.apply(this,arguments)};a.prototype.move=function(b){this.from.x=this.from.x+b.x;this.from.y=this.from.y+b.y;this.to.x=this.to.x+b.x;this.to.y=this.to.y+b.y;a.parent.prototype.move.apply(this,arguments)};a.prototype.applyTransformation=function(a){this.from=i.transformPoint(a,
this.from);this.to=i.transformPoint(a,this.to)};a.prototype.serialize=function(b){var c=i.transformPoint(b,this.from),d=i.transformPoint(b,this.to),b=$.extend(a.parent.prototype.serialize.call(this,b),{extension:{type:"Line",startPoint:g.serializePoint(c),endPoint:g.serializePoint(d)}});b.fillColor&&delete b.fillColor;return b};return a=l.define(a,h)});
define("surface/element/Rectangle","require util/Transformer util/Num env/Settings surface/element/Polygon util/Class".split(" "),function(b){function a(){this.height=this.width=this.top=this.left=null;this.handles={tl:{x:0,y:0},tr:{x:0,y:0},bl:{x:0,y:0},br:{x:0,y:0}};this.cornerRadius=0}var l=b("util/Transformer"),c=b("util/Num"),h=b("env/Settings"),i=b("surface/element/Polygon"),b=b("util/Class");a.prototype.initialize=function(){this.shadow.color=h.SHADOW_COLOR;this.vertices=[{x:0,y:0},{x:0,y:0},
{x:0,y:0},{x:0,y:0}];a.parent.prototype.initialize.apply(this,arguments)};a.prototype.deserialize=function(b,c){var i,d=c.extension.vertices,e,h,j,m;e=d[0];for(i=1;i<d.length;i++){h=d[i];h.x!=e.x&&(j=Math.abs(h.x-e.x));h.y!=e.y&&(m=Math.abs(h.y-e.y));e.x+e.y>h.x+h.y&&(e=h)}$.extend(true,this,{left:e.x,top:e.y,width:j,height:m,cornerRadius:c.extension.extension.cornerRadius||0});a.parent.prototype.deserialize.apply(this,arguments);return this};a.prototype.draw=function(a){var a=a||this.graphics,b=
this.left,c=this.top,d=this.width,e=this.height,i=this.cornerRadius;this.handles.tl={x:this.left,y:this.top};this.handles.tr={x:this.left+this.width,y:this.top};this.handles.bl={x:this.left,y:this.top+this.height};this.handles.br={x:this.left+this.width,y:this.top+this.height};this.beginPath(a);if(i==0)this.rect(b,c,d,e,a);else{i>0&&(i=Math.max(1,Math.min(this.cornerRadius,Math.min(d,e)/3)));this.moveTo(b+i,c,a);this.lineTo(b+d-i,c,a);this.quadraticCurveTo(b+d,c,b+d,c+i,a);this.lineTo(b+d,c+e-i,a);
this.quadraticCurveTo(b+d,c+e,b+d-i,c+e,a);this.lineTo(b+i,c+e,a);this.quadraticCurveTo(b,c+e,b,c+e-i,a);this.lineTo(b,c+i,a);this.quadraticCurveTo(b,c,b+i,c,a)}a.stroke();this.calculateBox()};a.prototype.calculateBox=function(){this.setBox(this.left,this.top,this.width,this.height);return this.box};a.prototype.manipulate=function(b,c){if(this.activeHandle==="tl"){if(c.x<this.left+this.width-1){this.width=this.width+(this.left-c.x);this.left=c.x}else{this.left=this.left+(this.width-1);this.width=
1}if(c.y<this.top+this.height-1){this.height=this.height+(this.top-c.y);this.top=c.y}else{this.top=this.top+(this.height-1);this.height=1}}else if(this.activeHandle==="tr"){this.width=c.x>this.left+1?Math.abs(c.x-this.left):1;if(c.y<this.top+this.height-1){this.height=this.height+(this.top-c.y);this.top=c.y}else{this.top=this.top+(this.height-1);this.height=1}}else if(this.activeHandle==="bl"){if(c.x<this.left+this.width-1){this.width=this.width+(this.left-c.x);this.left=c.x}else{this.left=this.left+
(this.width-1);this.width=1}this.height=c.y>this.top+1?Math.abs(c.y-this.top):1}else if(this.activeHandle==="br"){this.width=c.x>this.left+1?Math.abs(c.x-this.left):1;this.height=c.y>this.top+1?Math.abs(c.y-this.top):1}a.parent.prototype.manipulate.apply(this,arguments)};a.prototype.move=function(b){this.left=this.left+b.x;this.top=this.top+b.y;a.parent.prototype.move.apply(this,arguments)};a.prototype.applyTransformation=function(a){var b=l.transformPoint(a,{x:this.left,y:this.top});this.left=b.x;
this.top=b.y;this.width=this.width*a[0];this.height=this.height*a[3];this.cornerRadius=this.cornerRadius*a[0]};a.prototype.toVertices=function(){return[{x:c.fixed(this.left),y:c.fixed(this.top)},{x:c.fixed(this.left+this.width),y:c.fixed(this.top)},{x:c.fixed(this.left+this.width),y:c.fixed(this.top+this.height)},{x:c.fixed(this.left),y:c.fixed(this.top+this.height)}]};a.prototype.serialize=function(b){b=a.parent.prototype.serialize.call(this,b);b.extension.extension={type:"Rectangle"};if(this.cornerRadius>
0)b.extension.extension.cornerRadius=this.cornerRadius;return b};return a=b.define(a,i)});
define("surface/element/stamp/ApproveStamp",["require","util/Class","surface/element/stamp/Stamp"],function(b){function a(){this.defaultIconWidth=23;this.defaultIconHeight=17.5;this.defaultText="Approved";this.name="com.evernote.skitch.approved"}var l=b("util/Class"),b=b("surface/element/stamp/Stamp");a.prototype={initialize:function(){a.parent.prototype.initialize.apply(this,arguments);this.fill.color="#00BC2F"},drawIcon:function(a){a=a||this.graphics;a.save();a.translate(this.position.x,this.position.y);
a.scale(this.contentScaleFactor,this.contentScaleFactor);a.translate(-1*(this.defaultIconWidth/2),-1*(this.defaultIconHeight/2));a.shadowColor("rgba(0, 0, 0, 0)");a.beginPath();a.moveTo(8.287,17.527);a.bezierCurveTo(7.686000000000001,17.527,7.113000000000001,17.283,6.7010000000000005,16.848000000000003);a.lineTo(0.6050000000000004,10.454000000000002);a.bezierCurveTo(-0.22999999999999954,9.577000000000002,-0.19699999999999962,8.189000000000002,0.6790000000000004,7.354000000000003);a.bezierCurveTo(1.5550000000000004,
6.5180000000000025,2.943,6.553000000000003,3.7760000000000002,7.428000000000003);a.lineTo(8.285,12.157000000000004);a.lineTo(19.223,0.679);a.bezierCurveTo(20.058,-0.19599999999999995,21.445,-0.22999999999999998,22.322,0.6040000000000001);a.bezierCurveTo(23.197,1.439,23.232,2.826,22.396,3.701);a.lineTo(9.871,16.847);a.bezierCurveTo(9.458,17.281,8.885,17.527,8.287,17.527);a.closePath();a.fill();a.restore()}};return a=l.define(a,b)});
define("surface/element/stamp/ExclaimStamp",["require","util/Class","surface/element/stamp/Stamp"],function(b){function a(){this.defaultIconWidth=5.6;this.defaultIconHeight=22;this.defaultText="Wow!";this.name="com.evernote.skitch.exclaim"}var l=b("util/Class"),b=b("surface/element/stamp/Stamp");a.prototype={initialize:function(){a.parent.prototype.initialize.apply(this,arguments);this.fill.color="#FF8214"},drawIcon:function(a){a=a||this.graphics;a.save();a.translate(this.position.x,this.position.y);
a.scale(this.contentScaleFactor,this.contentScaleFactor);a.translate(-1*(this.defaultIconWidth/2),-1*(this.defaultIconHeight/2));a.shadowColor("rgba(0, 0, 0, 0)");a.beginPath();a.moveTo(2.822,17.484);a.bezierCurveTo(1.575,17.484,0.5640000000000001,18.495,0.5640000000000001,19.742);a.bezierCurveTo(0.564,20.988,1.575,22,2.822,22);a.bezierCurveTo(4.068,22,5.077,20.988,5.077,19.742);a.bezierCurveTo(5.078,18.495,4.07,17.484,2.822,17.484);a.closePath();a.moveTo(2.822,0);a.bezierCurveTo(1.3010000000000002,
0,0.06200000000000028,1.214,0.004999999999999893,2.735);a.lineTo(0.004999999999999893,2.855);a.bezierCurveTo(0.004999999999999893,3.113,0.037999999999999895,3.364,0.1039999999999999,3.601);a.lineTo(1.2449999999999999,13.635000000000002);a.lineTo(1.25,13.635000000000002);a.bezierCurveTo(1.31,14.461000000000002,1.9889999999999999,15.117,2.825,15.117);a.bezierCurveTo(3.6590000000000003,15.117,4.3420000000000005,14.461,4.399,13.635000000000002);a.lineTo(4.404,13.635000000000002);a.lineTo(5.544,3.601);
a.bezierCurveTo(5.606,3.376,5.637,3.138,5.641,2.893);a.bezierCurveTo(5.562,1.386,4.332,0,2.822,0);a.closePath();a.fill();a.restore()}};return a=l.define(a,b)});
define("surface/element/stamp/PerfectStamp",["require","util/Class","surface/element/stamp/Stamp"],function(b){function a(){this.defaultIconWidth=20;this.defaultIconHeight=19;this.defaultText="Perfect.";this.name="com.evernote.skitch.perfect"}var l=b("util/Class"),b=b("surface/element/stamp/Stamp");a.prototype={initialize:function(){a.parent.prototype.initialize.apply(this,arguments);this.fill.color="#ff1e64"},drawIcon:function(a){a=a||this.graphics;a.save();a.translate(this.position.x,this.position.y);
a.scale(this.contentScaleFactor,this.contentScaleFactor);a.translate(-1*(this.defaultIconWidth/2),-1*(this.defaultIconHeight/2));a.shadowColor("rgba(0, 0, 0, 0)");a.beginPath();a.moveTo(5.052,5.498);a.bezierCurveTo(5.566,5.506,5.99,5.379,6.337,5.104);a.bezierCurveTo(6.742999999999999,4.782,7.143,4.433,7.478,4.04);a.bezierCurveTo(9.035,2.202,10.828,0.7120000000000002,13.23,0.14400000000000013);a.bezierCurveTo(15.627,-0.4239999999999998,18.348,0.7540000000000001,19.486,2.833);a.bezierCurveTo(20.033,
3.833,20.083000000000002,4.913,19.919,6.021000000000001);a.bezierCurveTo(19.73,7.283000000000001,19.229,8.417000000000002,18.490000000000002,9.445);a.bezierCurveTo(17.855,10.332,17.165000000000003,11.177,16.523000000000003,12.059000000000001);a.bezierCurveTo(15.530000000000003,13.422,14.711000000000004,14.877,14.260000000000003,16.519000000000002);a.bezierCurveTo(14.101000000000003,17.1,14.084000000000003,17.689,14.133000000000003,18.287000000000003);a.bezierCurveTo(14.149000000000003,18.467000000000002,
14.142000000000003,18.653000000000002,14.112000000000002,18.834000000000003);a.bezierCurveTo(14.036000000000001,19.328000000000003,13.688000000000002,19.635,13.184000000000001,19.676000000000002);a.bezierCurveTo(12.662,19.717000000000002,12.155000000000001,19.615000000000002,11.667000000000002,19.441000000000003);a.bezierCurveTo(9.669000000000002,18.719,7.725000000000001,17.881000000000004,5.907000000000002,16.764000000000003);a.bezierCurveTo(4.469000000000002,15.879000000000003,3.155000000000002,
14.850000000000003,2.0460000000000016,13.573000000000004);a.bezierCurveTo(0.9820000000000015,12.348000000000004,0.20700000000000163,10.973000000000004,0.0410000000000017,9.331000000000003);a.bezierCurveTo(-0.174,7.174,0.41,5.275,2.034,3.781);a.bezierCurveTo(2.939,2.947,4.008,2.617,5.231,2.9370000000000003);a.bezierCurveTo(5.389,2.978,5.545,3.0420000000000003,5.694,3.115);a.bezierCurveTo(6.106,3.314,6.383,3.624,6.421,4.096);a.bezierCurveTo(6.46,4.584,6.183,4.906000000000001,5.804,5.142);a.bezierCurveTo(5.586,
5.279,5.336,5.365,5.052,5.498);a.closePath();a.fill();a.restore()}};return a=l.define(a,b)});
define("surface/element/stamp/QuestionStamp",["require","util/Class","surface/element/stamp/Stamp"],function(b){function a(){this.defaultIconWidth=14;this.defaultIconHeight=22;this.defaultText="What?";this.name="com.evernote.skitch.question"}var l=b("util/Class"),b=b("surface/element/stamp/Stamp");a.prototype={initialize:function(){a.parent.prototype.initialize.apply(this,arguments);this.fill.color="#367BD9"},drawIcon:function(a){a=a||this.graphics;a.save();a.translate(this.position.x,this.position.y);
a.scale(this.contentScaleFactor,this.contentScaleFactor);a.translate(-1*(this.defaultIconWidth/2),-1*(this.defaultIconHeight/2));a.shadowColor("rgba(0, 0, 0, 0)");a.beginPath();a.moveTo(6.46,17.601);a.bezierCurveTo(5.27,17.601,4.306,18.587,4.306,19.802);a.bezierCurveTo(4.306,21.015,5.27,22,6.46,22);a.bezierCurveTo(7.648,22,8.612,21.015,8.612,19.802);a.bezierCurveTo(8.614,18.587,7.65,17.601,6.46,17.601);a.closePath();a.moveTo(6.462,0);a.bezierCurveTo(4.156,0,2.018,0.894,0.583,2.454);a.bezierCurveTo(-0.23099999999999998,
3.3390000000000004,-0.18800000000000006,4.731,0.6809999999999999,5.564);a.bezierCurveTo(1.5459999999999998,6.396,2.9090000000000003,6.353,3.725,5.466);a.bezierCurveTo(4.335,4.799,5.362,4.4,6.462,4.4);a.bezierCurveTo(8.181,4.4,9.690999999999999,5.428000000000001,9.690999999999999,6.601000000000001);a.bezierCurveTo(9.690999999999999,7.773000000000001,8.181,8.801000000000002,6.461999999999999,8.801000000000002);a.bezierCurveTo(5.272999999999999,8.801000000000002,4.305999999999999,9.786000000000001,4.305999999999999,
11.001000000000001);a.lineTo(4.305999999999999,13.199000000000002);a.bezierCurveTo(4.305999999999999,14.416000000000002,5.272999999999999,15.400000000000002,6.459999999999999,15.400000000000002);a.bezierCurveTo(7.647999999999999,15.400000000000002,8.611999999999998,14.416000000000002,8.611999999999998,13.199000000000002);a.lineTo(8.611999999999998,12.927000000000001);a.bezierCurveTo(11.709999999999997,12.113000000000001,13.998999999999999,9.587000000000002,13.998999999999999,6.601000000000002);a.bezierCurveTo(13.999,
2.961,10.618,0,6.462,0);a.closePath();a.fill();a.restore()}};return a=l.define(a,b)});
define("surface/element/stamp/RejectStamp",["require","util/Class","surface/element/stamp/Stamp"],function(b){function a(){this.defaultIconHeight=this.defaultIconWidth=17;this.defaultText="Rejected";this.name="com.evernote.skitch.rejected"}var l=b("util/Class"),b=b("surface/element/stamp/Stamp");a.prototype={initialize:function(){a.parent.prototype.initialize.apply(this,arguments);this.fill.color="#ED1E1E"},drawIcon:function(a){a=a||this.graphics;a.save();a.translate(this.position.x,this.position.y);
a.scale(this.contentScaleFactor,this.contentScaleFactor);a.translate(-1*(this.defaultIconWidth/2),-1*(this.defaultIconHeight/2));a.shadowColor("rgba(0, 0, 0, 0)");a.beginPath();a.moveTo(11.506,8.501);a.lineTo(16.379,3.6279999999999992);a.bezierCurveTo(17.209,2.7989999999999995,17.209,1.4529999999999994,16.379,0.6229999999999993);a.bezierCurveTo(15.549000000000003,-0.20700000000000074,14.203000000000001,-0.20700000000000063,13.373000000000001,0.6229999999999993);a.lineTo(8.501,5.496);a.lineTo(3.628,
0.623);a.bezierCurveTo(2.798,-0.20699999999999996,1.4530000000000003,-0.20699999999999996,0.6230000000000002,0.623);a.bezierCurveTo(-0.20699999999999974,1.4529999999999998,-0.20699999999999974,2.7990000000000004,0.6230000000000002,3.628);a.lineTo(5.495,8.501000000000001);a.lineTo(0.6219999999999999,13.372000000000002);a.bezierCurveTo(-0.20800000000000007,14.201000000000002,-0.20800000000000007,15.548000000000002,0.6219999999999999,16.378);a.bezierCurveTo(1.0379999999999998,16.793,1.5819999999999999,
17.001,2.126,17.001);a.bezierCurveTo(2.669,17.001,3.213,16.793000000000003,3.627,16.378);a.lineTo(8.5,11.506);a.lineTo(13.373000000000001,16.378);a.bezierCurveTo(13.787,16.793,14.332,17.001,14.877,17.001);a.bezierCurveTo(15.418000000000001,17.001,15.963000000000001,16.793000000000003,16.377000000000002,16.378);a.bezierCurveTo(17.207,15.548,17.207,14.201,16.377000000000002,13.372);a.lineTo(11.506,8.501);a.closePath();a.fill();a.restore()}};return a=l.define(a,b)});
define("surface/element/ElementFactory","require util/Class surface/layer/Background surface/layer/Foreground surface/element/Bitmap surface/element/BubbleText surface/element/Vector surface/element/Arrow surface/element/Ellipse surface/element/Line surface/element/Rectangle surface/element/stamp/ApproveStamp surface/element/stamp/ExclaimStamp surface/element/stamp/PerfectStamp surface/element/stamp/QuestionStamp surface/element/stamp/RejectStamp".split(" "),function(b){function a(){}var l=b("util/Class"),
c=b("surface/layer/Background"),h=b("surface/layer/Foreground"),i=b("surface/element/Bitmap"),g=b("surface/element/BubbleText"),f=b("surface/element/Vector"),k=b("surface/element/Arrow"),d=b("surface/element/Ellipse"),e=b("surface/element/Line"),o=b("surface/element/Rectangle"),j=b("surface/element/stamp/ApproveStamp"),m=b("surface/element/stamp/ExclaimStamp"),p=b("surface/element/stamp/PerfectStamp"),n=b("surface/element/stamp/QuestionStamp"),b=b("surface/element/stamp/RejectStamp"),r={Layer:{BACKGROUND_LAYER_ID:c,
ANNOTATION_LAYER_ID:h,TEXT_LAYER_ID:h},Bitmap:i,Text:g,Vector:f,Highlighter:f,"Vector.Arrow":k,"Vector.Ellipse":d,"Vector.Line":e,"Vector.Polygon.Rectangle":o},w={"com.evernote.skitch.approved":j,"com.evernote.skitch.exclaim":m,"com.evernote.skitch.perfect":p,"com.evernote.skitch.question":n,"com.evernote.skitch.rejected":b};a.createFrom=function(a,b){var c,d;d=a.type;for(c=a.extension;c;){c.type&&(d=d+("."+c.type));c=c.extension}c=d=="Stamp"?w[a.stampName]:r[d]||f;d==="Layer"&&(c=c[a.layerId]);/^Bitmap/.test(d)&&
(b=$.extend(b,{uuid:a.uri&&a.uri.split("///")[1]}));return new c(b)};return a=l.define(a)});
define("surface/action/StyleAction",["require","util/Class","util/Color","surface/element/Vector"],function(b){function a(){this.oldStyles=[];this.newStyle={stroke:{color:null,width:null},fill:{color:null},font:{size:null}}}var l=b("util/Class"),c=b("util/Color"),h=b("surface/element/Vector");a.prototype.undo=function(){var a,b,f;for(a=0;a<this.oldStyles.length;a++){b=this.oldStyles[a].style;f=this.oldStyles[a].element;b.size&&(f.size=b.size);if(b.stroke&&b.stroke.color){var k=new c(f.stroke.color),
d=new c(b.stroke.color);k.r=d.r;k.g=d.g;k.b=d.b;f.stroke.color=k.toRGBA()}b.stroke&&b.stroke.width&&(f.stroke.width=b.stroke.width,f.stroke.width=f instanceof h&&1>(new c(f.stroke.color)).a?2*b.stroke.width:b.stroke.width);b.fill&&b.fill.color&&(k=new c(f.fill.color),d=new c(b.fill.color),k.r=d.r,k.g=d.g,k.b=d.b,f.fill.color=k.toRGBA());f.font&&(b.font&&b.font.size)&&(f.font.size=b.font.size);f.layer.render()}};a.prototype.run=function(){var a,b=this.newStyle,f;for(a=0;a<this.oldStyles.length;a++){f=
this.oldStyles[a].element;b.size&&(f.size=b.size);if(b.stroke&&b.stroke.color){var k=new c(f.stroke.color),d=new c(b.stroke.color);k.r=d.r;k.g=d.g;k.b=d.b;f.stroke.color=k.toRGBA()}b.stroke&&b.stroke.width&&(f.stroke.width=b.stroke.width,f.stroke.width=f instanceof h&&1>(new c(f.stroke.color)).a?2*b.stroke.width:b.stroke.width);b.fill&&b.fill.color&&(k=new c(f.fill.color),d=new c(b.fill.color),k.r=d.r,k.g=d.g,k.b=d.b,f.fill.color=k.toRGBA());f.font&&(b.font&&b.font.size)&&(f.font.size=b.font.size);
f.layer.render()}};return l.define(a)});
define("surface/tool/Tool",["require","util/Class","util/Geometry"],function(b){function a(){this.name=null;this.started=!1;this.cursor=this.size=this.color=this.surface=null;this.isShiftKeyDown=!1;this.registerEvents("started","updated","stopped","afterstop","action")}var l=b("util/Class"),c=b("util/Geometry");a.prototype.onPointerDown=function(){};a.prototype.onPointerMove=function(){};a.prototype.onPointerUp=function(){};a.prototype.onPointerOut=function(){};a.prototype.onPointerOver=function(){};
a.prototype.onDoubleClick=function(){};a.prototype.onTap=function(){};a.prototype.onDoubleTap=function(){};a.prototype.onHold=function(){};a.prototype.onDragStart=function(){};a.prototype.onDrag=function(){};a.prototype.onDragEnd=function(){};a.prototype.onGestureStart=function(){};a.prototype.onGestureChange=function(){};a.prototype.onGestureEnd=function(){};a.prototype.onInertiaStart=function(){};a.prototype.onMouseWheel=function(){};a.prototype.onKeyDown=function(){};a.prototype.onKeyUp=function(){};
a.prototype.onKeyPress=function(){};a.prototype.onResize=function(){};a.prototype.start=function(){this.started=!0;this.fire("started",this)};a.prototype.stop=function(){this.started=!1;this.fire("stopped",this)};a.prototype.update=function(){this.fire("updated",this)};a.prototype.afterStop=function(){this.fire("afterstop",this)};a.prototype.cancel=function(){this.started=!1};a.prototype.use=function(){};a.prototype.release=function(){};a.prototype.rotateLockPoint=function(a,b){return c.rotateLockPoint(a,
b)};return a=l.define(a)});
define("surface/action/CropAction",["require","util/Class","util/Box"],function(b){function a(){this.surface=null;this.lastClip={top:0,left:0,width:0,height:0};this.clip={top:0,left:0,width:0,height:0}}var l=b("util/Class"),c=b("util/Box");a.prototype.undo=function(){this.surface.setClip(this.lastClip);if(this.surface.background.hasBitmap()){var a=this.surface.background.getBitmap();a.clipRect=c.intersection(a.box,this.lastClip)}this.surface.fit()};a.prototype.run=function(){this.surface.setClip(this.clip);this.surface.removeElementsOutsideClip(this.clip);
this.surface.fit()};return l.define(a)});
define("surface/tool/CropTool","require util/Class surface/tool/Tool util/Box env/Settings graphics/CanvasGraphics graphics/Point surface/action/CropAction".split(" "),function(b){function a(){this.element=null;this.isCropping=false;this.clipBottomRight=this.clipTopLeft=null;this.CROP_APPLY_TEXT="Apply";this.CROP_CANCEL_TEXT="Cancel"}var l=b("util/Class"),c=b("surface/tool/Tool"),h=b("util/Box"),i=b("env/Settings"),g=b("graphics/CanvasGraphics"),f=b("graphics/Point"),k=b("surface/action/CropAction");
a.isCropping=false;a.prototype.use=function(a){this.enterCropMode(a)};a.prototype.release=function(a){this.exitCropMode(a)};a.prototype.enterCropMode=function(){function a(b,c){var d=0,e=0,j=0,m=0;do{d=d+(c.offsetLeft-c.scrollLeft);e=e+(c.offsetTop-c.scrollTop)}while(c=c.offsetParent);j=b.pageX-d;m=b.pageY-e;return{x:j,y:m}}if(!this.isCropping){this.isCropping=true;if(!this.element){this.started=true;var b=this.surface.margin;this.surface.margin=i.CROP_MARGIN;this.surface.fit();this.surface.margin=
b;var c=this.surface.getClip(),j=(new f(c.left,c.top,"surface")).relativeTo("dom"),m=(new f(c.left+c.width,c.top+c.height,"surface")).relativeTo("dom");this.clipTopLeft=j;this.clipBottomRight=m;var b=$(this.surface.dom).width(),k=$(this.surface.dom).height(),n=g.create(b,k),r=n.context.canvas;$(r).attr("touch-action","none").addClass("skitch-layer").css({display:"block",position:"absolute",top:"0px",left:"0px"});var l=false,y="TopLeft",z=0,B=0,t={x:0,y:0};$(n.context.canvas).on(i.EVENTS.pointerdown,
function(b){t=a(b.originalEvent,r);l=true;var c=Math.min(j.x,m.x),e=Math.max(j.x,m.x),f=Math.min(j.y,m.y),b=Math.max(j.y,m.y),c=Math.round(c),f=Math.round(f),e=Math.round(e),b=Math.round(b);if(Math.sqrt(Math.pow(t.x-c,2)+Math.pow(t.y-f,2))<20)y="TopLeft";else if(Math.sqrt(Math.pow(t.x-e,2)+Math.pow(t.y-b,2))<20)y="BottomRight";else if(Math.sqrt(Math.pow(t.x-e,2)+Math.pow(t.y-f,2))<20)y="TopRight";else if(Math.sqrt(Math.pow(t.x-c,2)+Math.pow(t.y-b,2))<20)y="BottomLeft";else if(t.x>=c&&t.x<=e&&t.y>=
f&&t.y<=b){y="Drag";z=t.x-c;B=t.y-f}else y="None";j.x=c;j.y=f;m.x=e;m.y=b});$(n.context.canvas).on(i.EVENTS.pointermove,function(b){t=a(b.originalEvent,r);if(l){var b=Math.min(j.x,m.x),e=Math.max(j.x,m.x),n=Math.min(j.y,m.y),g=Math.max(j.y,m.y);j.x=Math.round(b);j.y=Math.round(n);m.x=Math.round(e);m.y=Math.round(g);b=(new f(c.left,c.top,"surface")).relativeTo("dom");e=(new f(c.left+c.width,c.top+c.height,"surface")).relativeTo("dom");n=function(a,b,c){return Math.min(Math.max(a,b),c)};if(y=="TopLeft"){j.x=
n(t.x,b.x,e.x);j.y=n(t.y,b.y,e.y)}else if(y=="BottomRight"){m.x=n(t.x,b.x,e.x);m.y=n(t.y,b.y,e.y)}else if(y=="TopRight"){m.x=n(t.x,b.x,e.x);j.y=n(t.y,b.y,e.y)}else if(y=="BottomLeft"){j.x=n(t.x,b.x,e.x);m.y=n(t.y,b.y,e.y)}else if(y=="Drag"){n=m.x-j.x;g=m.y-j.y;j.x=t.x-z;j.y=t.y-B;m.x=j.x+n;m.y=j.y+g;if(!h.containsPoints({top:b.y,left:b.x,width:e.x-b.x,height:e.y-b.y},[j,m])){if(j.x<b.x){j.x=b.x;m.x=j.x+n}if(j.y<b.y){j.y=b.y;m.y=j.y+g}if(m.x>e.x){m.x=e.x;j.x=m.x-n}if(m.y>e.y){m.y=e.y;j.y=m.y-g}}}}C()});
$(n.context.canvas).on(i.EVENTS.pointerup,function(){l=false});var C=function(){var a=n.context.canvas.width,b=n.context.canvas.height;n.clearRect(0,0,a,b);n.fillStyle("rgba(0,0,0,.35)");n.globalAlpha(1);var c=Math.min(j.x,m.x),d=Math.max(j.x,m.x),e=Math.min(j.y,m.y),f=Math.max(j.y,m.y),c=Math.round(c),e=Math.round(e),d=Math.round(d),f=Math.round(f);n.fillRect(0,0,Math.round(c),b);n.fillRect(Math.round(d),0,Math.round(a-d),Math.round(b));n.fillRect(Math.round(c),0,Math.round(d-c),Math.round(e));n.fillRect(Math.round(c),
Math.round(f),Math.round(d-c),Math.round(b-f));n.lineWidth(1);n.globalAlpha(0.25);var a=function(a,b,c,d){n.beginPath();n.moveTo(a,b);n.lineTo(c,d);n.stroke()},b=Math.floor((d-c)/3),g=Math.floor((f-e)/3);n.strokeStyle("rgb(0,0,0)");n.strokeRect(c+1+0.5,e+1+0.5,b-2,g-2);n.strokeRect(c+b+1+0.5,e+1+0.5,b-2,g-2);n.strokeRect(c+b+b+1+0.5,e+1+0.5,c+0.5+d-c-1-(c+b+b+1+0.5)-1,g-2);n.strokeRect(c+1+0.5,e+g+1+0.5,b-2,g-2);n.strokeRect(c+b+1+0.5,e+g+1+0.5,b-2,g-2);n.strokeRect(c+b+b+1+0.5,e+g+1+0.5,c+0.5+d-
c-1-(c+b+b+1+0.5)-1,g-2);n.strokeRect(c+1+0.5,e+g+g+1+0.5,b-2,e+0.5+f-e-1-(e+g+g+1)-1);n.strokeRect(c+b+1+0.5,e+g+g+1+0.5,b-2,e+0.5+f-e-1-(e+g+g+1)-1);n.strokeRect(c+b+b+1+0.5,e+g+g+1+0.5,c+0.5+d-c-1-(c+b+b+1+0.5)-1,e+0.5+f-e-1-(e+g+g+1)-1);n.globalAlpha(0.5);n.strokeStyle("rgb(255,255,255)");a(c+b+0.5,e+0.5,c+b+0.5,f-1.5);a(c+b+b+0.5,e+0.5,c+b+b+0.5,f-1.5);a(c+1.5,e+g+0.5,c+b,e+g+0.5);a(c+1+b,e+g+0.5,c+b+b,e+g+0.5);a(c+1.5+b+b,e+g+0.5,d-0.5,e+g+0.5);a(c+1.5,e+g+g+0.5,c+b,e+g+g+0.5);a(c+1+b,e+g+g+
0.5,c+b+b,e+g+g+0.5);a(c+1.5+b+b,e+g+g+0.5,d-0.5,e+g+g+0.5);n.strokeRect(c+0.5,e+0.5,d-c-1,f-e-1);n.globalAlpha(1);a=false;if(!a&&Math.sqrt(Math.pow(t.x-c,2)+Math.pow(t.y-e,2))<20){n.fillStyle("rgba(153, 153, 153, 1)");a=true}else n.fillStyle("rgba(100, 100, 100, 1)");n.beginPath();n.moveTo(c-3,e-3);n.lineTo(c-3+16,e-3);n.lineTo(c-3+16,e-3+8-1);n.lineTo(c-3+8-1,e-3+8-1);n.lineTo(c-3+8-1,e-3+16);n.lineTo(c-3,e-3+16);n.closePath();n.fill();n.fillStyle("rgba(255, 255, 255, 1)");n.lineWidth(2);n.stroke();
if(!a&&Math.sqrt(Math.pow(t.x-d,2)+Math.pow(t.y-e,2))<20){n.fillStyle("rgba(153, 153, 153, 1)");a=true}else n.fillStyle("rgba(100, 100, 100, 1)");n.beginPath();n.moveTo(d+3,e-3);n.lineTo(d+3,e-3+16);n.lineTo(d+3-8+1,e-3+16);n.lineTo(d+3-8+1,e-3+8-1);n.lineTo(d+3-16,e-3+8-1);n.lineTo(d+3-16,e-3);n.closePath();n.fill();n.fillStyle("rgba(255, 255, 255, 1)");n.lineWidth(2);n.stroke();if(!a&&Math.sqrt(Math.pow(t.x-d,2)+Math.pow(t.y-f,2))<20){n.fillStyle("rgba(153, 153, 153, 1)");a=true}else n.fillStyle("rgba(100, 100, 100, 1)");
n.beginPath();n.moveTo(d+3,f+3);n.lineTo(d+3-16,f+3);n.lineTo(d+3-16,f+3-8+1);n.lineTo(d+3-8+1,f+3-8+1);n.lineTo(d+3-8+1,f+3-16);n.lineTo(d+3,f+3-16);n.closePath();n.fill();n.fillStyle("rgba(255, 255, 255, 1)");n.lineWidth(2);n.stroke();if(!a&&Math.sqrt(Math.pow(t.x-c,2)+Math.pow(t.y-f,2))<20){n.fillStyle("rgba(153, 153, 153, 1)");a=true}else n.fillStyle("rgba(100, 100, 100, 1)");n.beginPath();n.moveTo(c-3,f+3);n.lineTo(c-3,f+3-16);n.lineTo(c-3+8-1,f+3-16);n.lineTo(c-3+8-1,f+3-8+1);n.lineTo(c-3+16,
f+3-8+1);n.lineTo(c-3+16,f+3);n.closePath();n.fill();n.fillStyle("rgba(255, 255, 255, 1)");n.lineWidth(2);n.stroke()};this.resizeHandler=function(a,b){var c=(new f(j.x,j.y,"dom")).relativeTo("surface"),d=(new f(m.x,m.y,"dom")).relativeTo("surface"),e=A.surface.margin;A.surface.margin=i.CROP_MARGIN;A.surface.fit();A.surface.margin=e;c=c.relativeTo("dom");d=d.relativeTo("dom");j.x=c.x;j.y=c.y;m.x=d.x;m.y=d.y;n.setWidth(a);n.setHeight(b);C()};this.surface.on("resize",this.resizeHandler);C();$(this.surface.dom).append(n.context.canvas);
this.cropCanvas=n.context.canvas;this.previousTool=this.surface.controller.previousTool;if(!this.previousTool)this.previousTool=this.surface.controller.tools.arrow;this.cropDiv=$('<div class="skitchCropOptions skitchVisible"><div class="skitchVisible"><div  class="skitchVisible" id="skitchCancelCrop">'+this.CROP_CANCEL_TEXT+'</div><div  class="skitchVisible" id="skitchApplyCrop">'+this.CROP_APPLY_TEXT+"</div></div></div>").get(0);var A=this;$("#skitchApplyCrop",this.cropDiv).click(function(){A.applyCrop()});
$("#skitchCancelCrop",this.cropDiv).click(function(){A.cancelCrop()});$(this.surface.dom).append(this.cropDiv)}}};a.prototype.applyCrop=function(){var a=Math.min(this.clipTopLeft.x,this.clipBottomRight.x),b=Math.max(this.clipTopLeft.x,this.clipBottomRight.x),c=Math.min(this.clipTopLeft.y,this.clipBottomRight.y),j=Math.max(this.clipTopLeft.y,this.clipBottomRight.y),m={},g={};m.x=a;m.y=c;g.x=b;g.y=j;m=(new f(m.x,m.y,"dom")).relativeTo("surface");g=(new f(g.x,g.y,"dom")).relativeTo("surface");b={top:m.y,
left:m.x,width:g.x-m.x,height:g.y-m.y};a=this.surface.getClip();h.intersectsBox(a,b);if(b.width>i.MIN_CROP_SIZE||b.height>i.MIN_CROP_SIZE){b=h.intersection(a,b);this.fire("action",this,new k({surface:this.surface,lastClip:a,clip:b}));this.surface.setClip(b);this.surface.removeElementsOutsideClip(b)}this.removeAndResetView();this.surface.zoomEnabled=true;this.surface.controller.useTool(this.previousTool)};a.prototype.cancelCrop=function(){this.removeAndResetView();this.surface.zoomEnabled=true;this.surface.controller.useTool(this.previousTool)};
a.prototype.exitCropMode=function(){this.cropDiv&&this.removeAndResetView();c.prototype.stop.call(this);if(this.resizeHandler){this.surface.off("resize",this.resizeHandler);this.resizeHandler=null}this.started=false};a.prototype.removeAndResetView=function(){$(this.cropDiv).remove();$(this.cropCanvas).remove();this.cropDiv=null;this.surface.fit().render();this.isCropping=false};a.prototype.start=function(){};a.prototype.stop=function(){};return a=l.define(a,c)});
define("surface/tool/ZoomTool","require util/Class util/Transformer util/Box graphics/CanvasGraphics surface/layer/Buffer env/Settings graphics/Point surface/tool/Tool".split(" "),function(b){function a(){this.to=this.from=this.offset=null}var l=b("util/Class");b("util/Transformer");b("util/Box");var c=b("graphics/CanvasGraphics");b("surface/layer/Buffer");b("env/Settings");var h=b("graphics/Point"),b=b("surface/tool/Tool");a.prototype.onPointerDown=function(){};a.prototype.onPointerMove=function(a,
b){this.started?this.update(a,b):this.start(a)};a.prototype.onPointerUp=function(a){this.started&&this.stop(a)};a.prototype.start=function(b){var g=this.surface,f=g.buffer,k=g.getClip();this.from=b;this.offset=h(0,0,"clip").relativeTo("surface");f.resize(k.width/c.pixelRatio,k.height/c.pixelRatio);f.resetTransformation();f.translateBy(-this.offset.x,-this.offset.y);f.paste(g.background,0,0,true);f.paste(g.foreground,0,0,true);this.update(b,1);this.hideLayers();a.parent.prototype.start.apply(this,
arguments)};a.prototype.stop=function(b){this.surface.active.clear();this.surface.setTransformation(this.surface.active.transformation);this.surface.render();this.showLayers();a.parent.prototype.stop.apply(this,arguments)};a.prototype.update=function(b,c){var f=this.surface.active,h=this.surface.constrainPan({x:b.x-this.from.x,y:b.y-this.from.y});this.to=b;c&&f.scaleBy(c,c,b.x,b.y);f.translateBy(h.x,h.y);f.clear();f.graphics.save();f.graphics.transform.apply(f.graphics,f.transformation);f.graphics.drawImage(this.surface.buffer.graphics.context.canvas,
this.offset.x,this.offset.y);f.graphics.restore();a.parent.prototype.update.apply(this,arguments);this.from=b};a.prototype.hideLayers=function(){$(this.surface.background.dom).hide();$(this.surface.foreground.dom).hide()};a.prototype.showLayers=function(){$(this.surface.background.dom).show();$(this.surface.foreground.dom).show()};return a=l.define(a,b)});
define("surface/action/ManipulateAction",["require","util/Class","surface/element/Text","surface/element/stamp/Stamp"],function(b){function a(){this.handle=this.element=null;this.from={x:0,y:0};this.to={x:0,y:0}}var l=b("util/Class"),c=b("surface/element/Text"),h=b("surface/element/stamp/Stamp");a.prototype.manipulate=function(a,b,f,k,d){this.element.activeHandle=this.handle;this.element.manipulate(a,b);this.element instanceof c&&f&&(this.element.font.size=f);this.element instanceof h&&"undefined"!=
k&&(this.element.angle=k,this.element.tail=d);this.element.activeHandle=null;this.element.layer.render()};a.prototype.undo=function(){this.manipulate(this.to,this.from,this.fromFontSize,this.fromAngle,this.fromTail)};a.prototype.run=function(){this.manipulate(this.from,this.to,this.toFontSize,this.toAngle,this.toTail)};return l.define(a)});
define("surface/action/MoveAction",["require","util/Class"],function(b){function a(){this.elements=null;this.from={x:0,y:0};this.to={x:0,y:0}}b=b("util/Class");a.prototype.move=function(a){var b,h=this.elements||[],i;for(b=0;b<h.length;b++)i=h[b],i.move({x:a.x,y:a.y}),i.layer.render()};a.prototype.undo=function(){this.move({x:this.from.x-this.to.x,y:this.from.y-this.to.y})};a.prototype.run=function(){this.move({x:this.to.x-this.from.x,y:this.to.y-this.from.y})};return b.define(a)});
define("surface/tool/SelectTool","require env/Settings util/Obj surface/tool/Tool util/Color surface/action/ManipulateAction surface/action/DeleteAction surface/layer/Buffer surface/action/MoveAction util/Num util/Box surface/element/BubbleText surface/element/stamp/Stamp surface/element/Vector util/Class graphics/Point".split(" "),function(b){function a(){this.toFontSize=this.fromFontSize=this.manipulating=this.elements=this.handle=this.element=this.active=this.buffer=null;this.preventSelectChange=
this.multiSelect=this.moved=false}var l=b("env/Settings");b("util/Obj");var c=b("surface/tool/Tool"),h=b("util/Color"),i=b("surface/action/ManipulateAction"),g=b("surface/action/DeleteAction"),f=b("surface/layer/Buffer"),k=b("surface/action/MoveAction"),d=b("util/Num"),e=b("util/Box"),o=b("surface/element/BubbleText"),j=b("surface/element/stamp/Stamp"),m=b("surface/element/Vector"),p=b("util/Class");b("graphics/Point");a.prototype.initialize=function(){this.elements=[];this.to=this.from=this.startPoint=
null;this.active=this.surface.active;this.buffer=new f({surface:this.surface})};a.prototype.onPointerDown=function(a){this.element=this.surface.controller.activeElement;this.handle=this.surface.controller.activeHandle;this.multiSelect=this.surface.controller.shiftKey;if(this.element instanceof j&&this.element.selected&&a.distance(this.element.handles.t1)<l.HANDLE_RADIUS*2){this.preventSelectChange=this.element.tail=true;this.surface.render()}};a.prototype.onPointerMove=function(a,b){if(this.started)this.update(a,
b);else{if(this.element&&!this.element.selected){(!this.multiSelect||this.moved)&&this.unselectAll();this.select(this.element);this.surface.foreground.render()}this.start(a)}this.moved=true};a.prototype.onPointerUp=function(a){var b=false;this.started&&this.stop(a);if(this.multiSelect)this.element&&!this.moved&&this.toggle(this.element);else if(this.element){b=this.element.selected;if(!this.moved){this.unselectAll();b?this.unselect(this.element):this.select(this.element)}}this.preventSelectChange=
this.moved=false};a.prototype.toggle=function(a){a.selected?this.unselect(a):this.select(a)};a.prototype.start=function(b){this.from=this.startPoint=b;this.surface.getBox();this.to={x:0,y:0};this.manipulating=this.handle&&this.element;var c=this.elements.map(function(a){return a.getBox()});this.union=e.union(c);if(this.manipulating){if(this.manipulating instanceof o)this.toFontSize=this.fromFontSize=this.manipulating.font.size;else this.toFontSize=this.fromFontSize=null;if(this.manipulating instanceof
j){this.toAngle=this.fromAngle=this.manipulating.angle;this.toTail=this.fromTail=this.manipulating.tail}else this.toTail=this.fromTail=this.toAngle=this.fromAngle=null;this.manipulating.handle(this.handle);this.manipulating.hide();this.drawElement(this.manipulating)}else{this.copySelectedElementsToBuffer();this.drawBuffer({x:this.union.left,y:this.union.top});this.hideSelectedElements()}a.parent.prototype.start.apply(this,arguments)};a.prototype.stop=function(b){var c,e,j=this.elements.slice(0),m;
this.to=b;if(this.manipulating){this.manipulating.fire("manipulated",this.manipulating,this.from,this.to);this.manipulating.show();c=new i({element:this.manipulating,handle:this.manipulating.activeHandle,from:this.startPoint,to:this.to,fromFontSize:this.fromFontSize,toFontSize:this.toFontSize,fromAngle:this.fromAngle,toAngle:this.toAngle,fromTail:this.fromTail,toTail:this.toTail});this.manipulating=null}else{for(c=0;c<j.length;c++){e=j[c];m={x:d.fixed((this.to.x-this.startPoint.x)/e.scaling.x),y:d.fixed((this.to.y-
this.startPoint.y)/e.scaling.y)};e.hidden=false;e.move(m)}this.buffer.clear();c=new k({elements:j,from:this.startPoint,to:this.to})}this.fire("action",this,c);$(this.surface.foreground.dom).show();a.parent.prototype.stop.apply(this,arguments);this.active.clear();this.surface.foreground.render();this.active.setTransformation(this.surface.transformation);this.from=null};a.prototype.update=function(b){this.to=b;if(this.manipulating){if(this.manipulating instanceof o)this.toFontSize=this.manipulating.font.size;
else if(this.manipulating instanceof j){this.manipulating.updateAngle({x:this.to.x-this.manipulating.position.x,y:this.to.y-this.manipulating.position.y});this.toAngle=this.manipulating.angle;this.toTail=this.manipulating.tail}this.manipulating.manipulate(this.from,this.to);this.drawElement(this.manipulating)}else this.drawBuffer({x:this.union.left+this.to.x-this.startPoint.x,y:this.union.top+this.to.y-this.startPoint.y});this.from=b;a.parent.prototype.update.apply(this,arguments)};a.prototype.drawElement=
function(a){this.active.graphics.save();this.active.clear();this.active.initGraphics();a.render(this.active.graphics);this.active.graphics.restore()};a.prototype.drawBuffer=function(a){this.active.graphics.save();this.active.clear();this.active.initGraphics();this.active.graphics.drawImage(this.buffer.graphics.context.canvas,a.x,a.y,this.buffer.graphics.getWidth()/this.surface.scaling.x,this.buffer.graphics.getHeight()/this.surface.scaling.y);this.active.graphics.restore()};a.prototype.copySelectedElementsToBuffer=
function(){var a=this.union,b=this.surface,c=this.buffer;c.resize(a.width*b.scaling.x,a.height*b.scaling.y);c.resetTransformation();c.translateBy(-a.left,-a.top);c.scaleBy(b.scaling.x,b.scaling.y,a.left,a.top);c.initGraphics();this.elements.forEach(function(a){a.render(c.graphics)})};a.prototype.hasSelection=function(){return this.elements.length>0};a.prototype.select=function(a){if(!this.preventSelectChange){var b;for(b=0;b<this.elements.length;b++)if(this.elements[b]===a)return;a.select()!==false&&
this.elements.push(a);this.elements.sort(function(a,b){return a.order-b.order})}};a.prototype.unselect=function(a){if(!this.preventSelectChange)for(var b=this.elements.slice(0),c=0;c<b.length;c++)if(b[c]===a){a.show();this.elements.splice(c,1);a.unselect();return a}};a.prototype.selectAll=function(){if(!this.preventSelectChange){var a,b=this.surface.foreground.elements;this.surface.disableRender();for(var c=0;c<b.length;c++){a=b[c];a.selected||this.select(a)}this.surface.enableRender();this.surface.render()}};
a.prototype.unselectAll=function(){if(!this.preventSelectChange){var a=this.surface.foreground.elements,b=false;this.surface.disableRender();this.elements.splice(0);for(var c=0;c<a.length;c++)if(a[c].selected){a[c].selected=false;b=true}this.surface.enableRender();if(b){this.surface.foreground.render();this.surface.foreground.fire("elementselectionschanged")}}};a.prototype.hideSelectedElements=function(){var a;a=this.elements;this.surface.disableRender();for(var b=0;b<a.length;b++)a[b].hide();this.surface.enableRender();
this.surface.foreground.render()};a.prototype.deleteSelectedElements=function(){var a,b;this.surface.disableRender();b=this.elements.slice(0);for(var c=0;c<b.length;c++){a=b[c];this.unselect(a);a.remove()}this.surface.enableRender();this.surface.controller.activeTool.fire("action",this,new g({elements:b}));this.surface.foreground.render();return b};a.prototype.getSelectedElementStyles=function(){var a,b,c,d;d=[];c=this.elements.slice(0);for(a=0;a<c.length;a++){b=c[a];var e=b.stroke.width;b instanceof
m&&(new h(b.stroke.color)).a<1&&(e=b.stroke.width/2);d.push({element:b,style:{size:b.size,stroke:{color:b.stroke.color,width:e},fill:{color:b.fill.color},font:{size:b.font&&b.font.size}}})}return d};a.prototype.updateSelectedElementStyles=function(a){var b,c,d,e=false;d=this.elements.slice(0);for(b=0;b<d.length;b++){c=d[b];if(!(c instanceof j)){if(a.size&&typeof c.size!=="undefined"&&c.size!=a.size){c.size=a.size;e=true}if(a.stroke){if(a.stroke.width)if(c instanceof m&&(new h(c.stroke.color)).a<1){if(c.stroke.width!=
a.stroke.width*2){c.stroke.width=a.stroke.width*2;e=true}}else if(c.stroke.width!=a.stroke.width){c.stroke.width=a.stroke.width;e=true}if(a.stroke.color){var f=new h(c.stroke.color),g=new h(a.stroke.color);if(!f.equals(g)){g.a=f.a;c.stroke.color=g.toRGBA();e=true}}}if(a.fill&&a.fill.color){f=new h(c.fill.color);g=new h(a.fill.color);if(!f.equals(g)){g.a=f.a;c.fill.color=g.toRGBA();e=true}}if(c.font&&a.font&&a.font.size&&c.font.size!=a.font.size){c.font.size=a.font.size;e=true}}}this.surface.foreground.render();
return e};return a=p.define(a,c)});define("surface/action/DrawAction",["require","util/Class"],function(b){function a(){this.element=null}b=b("util/Class");a.prototype.run=function(){this.element.layer.renderElement(this.element)};a.prototype.undo=function(){this.element.remove();this.element.layer&&this.element.layer.render()};return b.define(a)});
define("surface/tool/ElementTool","require env/Settings surface/tool/Tool surface/action/DrawAction util/Box util/Class".split(" "),function(b){function a(){this.startpos=this.element=null}var l=b("env/Settings"),c=b("surface/tool/Tool"),h=b("surface/action/DrawAction");b("util/Box");b=b("util/Class");a.prototype.onPointerDown=function(){};a.prototype.onPointerMove=function(a,b){this.started?this.update(a,b):this.start(a)};a.prototype.onPointerUp=function(a){this.started&&this.stop(a)};a.prototype.start=
function(b){this.startpos=b;if(this.element){this.element.stroke.color=this.color;this.element.stroke.width=l.STROKE_SIZES[this.size]*this.surface.contentScaleFactor}this.onStart(b);a.parent.prototype.start.apply(this,arguments)};a.prototype.update=function(b){this.onUpdate(b);a.parent.prototype.update.apply(this,arguments)};a.prototype.stop=function(b){this.onStop(b);this.element=null;a.parent.prototype.stop.apply(this,arguments)};a.prototype.onStart=function(){this.element&&this.surface.active.renderElement(this.element)};
a.prototype.onUpdate=function(){this.element&&this.surface.active.render()};a.prototype.onStop=function(){if(this.element){var a=new h({element:this.element});this.surface.active.clear();this.surface.active.removeElement(this.element);this.surface.foreground.addElement(this.element);this.fire("action",this,a)}};return a=b.define(a,c)});
define("surface/tool/ArrowTool","require util/Class surface/tool/ElementTool util/Box env/Settings surface/element/Arrow".split(" "),function(b){function a(){this.name="arrow";this.transformation=null}var l=b("util/Class"),c=b("surface/tool/ElementTool");b("util/Box");var h=b("env/Settings"),i=b("surface/element/Arrow");a.prototype.start=function(b){this.element=new i({from:b,to:b,size:h.ARROW_SIZES[this.size]*this.surface.contentScaleFactor});this.element.fill.color=this.color;a.parent.prototype.start.apply(this,
arguments)};a.prototype.update=function(b){this.isShiftDown&&(b=this.rotateLockPoint(this.element.from,b));this.element.to=b;a.parent.prototype.update.apply(this,arguments)};a.prototype.stop=function(b){this.isShiftDown&&(b=this.rotateLockPoint(this.element.from,b));var c=this.element;a.parent.prototype.stop.apply(this,arguments);Math.sqrt(Math.pow(c.to.x-c.from.x,2)+Math.pow(c.to.y-c.from.y,2))<48&&this.surface.controller.undo()};a.prototype.run=function(a){this.element=new i({from:a.from,to:a.to,
size:a.size});this.element.stroke.width=16;this.element.fill.color=a.color;var a=this.element.to.x-this.element.from.x,b=this.element.to.y-this.element.from.y;this.element.setBox(Math.min(this.element.from.x,this.element.to.x),Math.min(this.element.from.y,this.element.to.y),Math.abs(a),Math.abs(b));this.surface.foreground.renderElement(this.element)};return a=l.define(a,c)});
define("surface/tool/EllipseTool",["require","util/Class","surface/tool/ElementTool","surface/element/Ellipse"],function(b){function a(){}var l=b("util/Class"),c=b("surface/tool/ElementTool"),h=b("surface/element/Ellipse"),i;a.prototype.start=function(b){i=b;this.element=new h({center:{},radius:{}});a.parent.prototype.start.apply(this,arguments)};a.prototype.update=function(b){var c=this.element,h,d,e={},o={};h=Math.min(i.y,b.y);d=Math.min(i.x,b.x);o.x=Math.abs(b.x-i.x)/2;o.y=Math.abs(b.y-i.y)/2;
Math.max(o.x,o.y);e.x=d+o.x;e.y=h+o.y;c.radius=o;c.center=e;a.parent.prototype.update.apply(this,arguments)};return a=l.define(a,c)});
define("surface/tool/Smoother",["require","util/Class"],function(b){function a(){}var b=b("util/Class"),l,c,h,i,g,f,k,d,e,o,j;a.quickSmooth=function(a){var b=a.length,c=a[b-1],d=a[b-2];a[b-1]={x:0.3*c.x+0.7*d.x,y:0.3*c.y+0.7*d.y}};a.smooth=function(b,p){var n,r,w=[];l=[];for(n=0;n<b.length;n++)l.push({x:b[n].x,y:b[n].y});c=[];h=[];i=l.length;g=0;f=20;k=10;d=90;e=1.5;o=4;j=!1;k=p/2;f=p;e=Math.sqrt(p/5);r=a.path();w.push(r[0]);for(n=1;n<r.length;n+=3)w.push({cp1:{x:r[n].x,y:r[n].y},cp2:{x:r[n+1].x,
y:r[n+1].y},to:{x:r[n+2].x,y:r[n+2].y}});return w};a.path=function(){var b=[],d=[];a.detectCorners();var j,f;j=0;do if(c[j]){for(f=j+1;f<i&&!c[f];f++);f==i?f-=1:a.filterPoints(l,j,f,o,!1);a.fitBeziers(b,l,j,f,e);j=f}while(j<i-1);var g=b.length;if(0<g){j=0;d[j++]=b[0].pt1;for(f=0;f<g;++f){var h=b[f];d[j++]=h.cp1;d[j++]=h.cp2;d[j++]=h.pt2}}else if(0<i){b=l[0].x;g=l[0].y;j=0;d[j++]={x:b,y:g};for(f=1;f<i;f++){var h=(l[f].x+b)/2,k=(l[f].y+g)/2,b=l[f].x,g=l[f].y;d[j++]={x:h,y:k};d[j++]={x:h,y:k};d[j++]=
{x:b,y:g}}}return d};a.detectCorners=function(){var a=[],b=[],e=[];a[0]=0;b[0]=0;for(var r=1;r<i;r++)a[r]=l[r].x-l[r-1].x,b[r]=l[r].y-l[r-1].y,e[r]=Math.sqrt(a[r]*a[r]+b[r]*b[r]),c[r]=!1;var w;c[0]=!0;c[i-1]=!0;for(var y=2,z=-1,B=0,r=1;r<i-1;r++){var t=0,C=0,A=0;for(w=r;1<=w&&!(t+=e[w],C+=a[w],A+=b[w],t>=k);w--);if(!(0>=w)){var u=t=0,v=0;for(w=r+1;w<i&&!(t+=e[w],u+=a[w],v+=b[w],t>=k);w++);w>=i||(w=C*u+A*v,C=Math.sqrt(C*C+A*A),u=Math.sqrt(u*u+v*v),w/=C*u,u=180*(Math.acos(w)/Math.PI),u>d?u>B&&(B=u,
z=r):(-1!=z&&(c[z]=!0,y++,z=-1),B=0))}}g=0;h=[];for(r=1;r<i-1;r++)h[r]=j?o+2*Math.floor(f/e[r]):o,h[r]>g&&(g=h[r]);return y};a.filterPoints=function(a,b,c,d,e){if(!(2>=c-b))for(;0<d;d--){var j=a[b].x,f=a[b].y,g=j,i=f;e&&(a[b].x=0.25*a[c].x+0.5*j+0.25*a[b+1].x,a[b].y=0.25*a[c].y+0.5*f+0.25*a[b+1].y);for(var k=b+1;k<c;k++)if(h[k]>d){var o=a[k].x,l=a[k].y;a[k].x=0.25*g+0.5*a[k].x+0.25*a[k+1].x;a[k].y=0.25*i+0.5*a[k].y+0.25*a[k+1].y;g=o;i=l}e&&(a[c].x=0.25*g+0.5*a[c].x+0.25*j,a[c].y=0.25*i+0.5*a[c].y+
0.25*f)}};a.normalize=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);0<b&&(a.x/=b,a.y/=b)};a.fitBeziers=function(b,c,d,e,j){var f={x:0,y:0},g={x:0,y:0};1<=e-d&&(f={x:c[d+1].x-c[d].x,y:c[d+1].y-c[d].y},a.normalize(f),g={x:c[e-1].x-c[e].x,y:c[e-1].y-c[e].y},a.normalize(g));a.recrFit(b,c,d,e,f,g,j,0)};a.createBezierSegment=function(a,b,c,d,e,j,f,g){return{pt1:{x:a,y:b},cp1:{x:c,y:d},cp2:{x:e,y:j},pt2:{x:f,y:g}}};a.recrFit=function(b,c,d,e,j,f,g,h){if(2>e-d)g=c[e].x-c[d].x,h=c[e].y-c[d].y,g=Math.sqrt(g*
g+h*h)/3,b[b.length]=a.createBezierSegment(c[d].x,c[d].y,c[d].x+g*j.x,c[d].y+g*j.y,c[e].x+g*f.x,c[e].y+g*f.y,c[e].x,c[e].y);else{for(var i=a.parameterizePoints(c,d,e),k=[1],o=0;10>o;o++){var l=a.generateBezier(c,d,e,i,j,f),v=a.calcMaxError(c,d,e,l,i,k);if(v<=g){b[b.length]=l;return}if(v>10*g)break;else a.improveParameters(c,d,e,i,l)}i=a.middleTangent(c,k[0]);a.recrFit(b,c,d,k[0],j,i,g,h+1);i.x*=-1;i.y*=-1;a.recrFit(b,c,k[0],e,i,f,g,h+1)}};a.parameterizePoints=function(a,b,c){for(var d=[0],e=b+1;e<=
c;e++)d[e-b]=d[e-b-1]+Math.sqrt(a[e].x*a[e].x+a[e].y*a[e].y);a=d[c-b];for(e=b+1;e<=c;e++)d[e-b]/=a;return d};a.generateBezier=function(b,c,d,e,j,f){for(var g,i,h=0,k=0,o=g=0,l=0,v=c;v<=d;v++){var x=1-e[v-c],s=x*x,D=e[v-c]*e[v-c],E=x*s,s=3*s*e[v-c],x=3*x*D,q=e[v-c]*D,D=j.x*s,F=j.y*s,G=f.x*x,H=f.y*x,h=h+(D*D+F*F),k=k+(D*G+F*H);g+=G*G+H*H;var I=b[v].x-(b[c].x*(E+s)+b[d].x*(x+q)),E=b[v].y-(b[c].y*(E+s)+b[d].y*(x+q)),o=o+(D*I+F*E),l=l+(G*I+H*E)}e=h*g-k*k;1.0E-6>e&&-1.0E-6<e?(h+=k,1.0E-6<h||-1.0E-6>h?g=
i=o/h:(k+=g,g=1.0E-6<k||-1.0E-6>k?i=l/k:i=0)):(g=(o*g-l*k)/e,i=(h*l-k*o)/e);if(1.0E-6>g||1.0E-6>i)i=b[d].x-b[c].x,l=b[d].y-b[c].y,g=i=Math.sqrt(i*i+l*l)/3;return a.createBezierSegment(b[c].x,b[c].y,b[c].x+g*j.x,b[c].y+g*j.y,b[d].x+i*f.x,b[d].y+i*f.y,b[d].x,b[d].y)};a.evaluatePoint=function(a,b,c,d,e){var j=1-a,f=a*a,g=j*j,i=g*j,g=3*g*a,j=3*j*f,a=a*f;return{x:i*b.x+g*c.x+j*d.x+a*e.x,y:i*b.y+g*c.y+j*d.y+a*e.y}};a.evaluateBezPoint=function(b,c){return a.evaluatePoint(b,c.pt1,c.cp1,c.cp2,c.pt2)};a.calcMaxError=
function(b,c,d,e,j,f){var g=0;f[0]=(d-c)/2;for(var i={x:0,y:0},h=c+1;h<d;h++){var i=a.evaluatePoint(j[h-c],e.pt1,e.cp1,e.cp2,e.pt2),k=i.x-b[h].x,i=i.y-b[h].y,k=Math.sqrt(k*k+i*i);k>g&&(g=k,f[0]=h)}return g};a.improveParameters=function(b,c,d,e,j){var f,g,i,h,k,o,l,v,x,s;f=3*(j.cp1.x-j.pt1.x);g=3*(j.cp1.y-j.pt1.y);i=3*(j.cp2.x-j.cp1.x);h=3*(j.cp2.y-j.cp1.y);k=3*(j.pt2.x-j.cp2.x);o=3*(j.pt2.y-j.cp2.y);l=2*(i-f);v=2*(h-g);x=2*(k-i);s=2*(o-h);for(var D=c;D<=d;D++)e[D-c]=a.newtonRaphson(j,b[D].x,b[D].y,
e[D-c],f,g,i,h,k,o,l,v,x,s);b=e[0];j=e[d-c]-b;for(D=0;D<d-c+1;D++)e[D]=(e[D]-b)/j};a.newtonRaphson=function(b,c,d,e,j,f,g,i,h,k,o,l,v,x){var s={x:0,y:0},s=a.evaluateBezPoint(e,b),b=1-e,j=b*b*j+2*e*b*g+e*e*h,f=b*b*f+2*e*b*i+e*e*k,c=s.x-c,d=s.y-d,o=j*j+f*f+c*(b*o+e*v)+d*(b*l+e*x);return 1.0E-8<o||-1.0E-8>o?e-(c*j+d*f)/o:e};a.middleTangent=function(b,c){var d={x:b[c-1].x-b[c].x,y:b[c-1].y-b[c].y},e={x:b[c].x-b[c+1].x,y:b[c].y-b[c+1].y};a.normalize(d);a.normalize(e);d.x+=e.x;d.y+=e.y;a.normalize(d);return d};
return a=b.define(a)});
define("surface/tool/HighlighterTool","require util/Class surface/tool/ElementTool util/Box surface/tool/Smoother surface/element/Vector surface/element/Line util/Color env/Settings surface/action/DrawAction".split(" "),function(b){function a(){this.points=null}var l=b("util/Class"),c=b("surface/tool/ElementTool");b("util/Box");var h=b("surface/tool/Smoother"),i=b("surface/element/Vector"),g=b("surface/element/Line"),f=b("util/Color"),k=b("env/Settings"),d=b("surface/action/DrawAction");a.prototype.use=
function(){};a.prototype.onPointerUp=function(b){var c=this.started;if(!this.surface.controller.moved&&!this.surface.controller.selectionChanged){c||this.start(b);this.update({x:b.x,y:b.y+1},this.surface.controller.activeScale);if(!c){this.stop({x:b.x,y:b.y+1});this.afterStop()}}return a.parent.prototype.onPointerUp.apply(this,arguments)};a.prototype.start=function(b){if(this.isShiftDown)this.element=new g({from:b,to:b});else{this.from=b;this.points=[b];this.element=new i}a.parent.prototype.start.apply(this,
arguments);var c=new f(this.element.stroke.color);c.a=k.HIGHLIGHT_ALPHA;this.element.stroke.width=this.element.stroke.width*2;this.element.stroke.color=c.toRGBA();this.element.stroke.alpha=c.a;this.straightHighlighter=this.isShiftDown};a.prototype.stop=function(b){this.surface.active.clear();if(!this.straightHighlighter&&this.element){var c=this.element,d,f,g,i;i=[];g=h.smooth(this.points,this.element.stroke.width);d=g.shift();i.push(["M",d.x,d.y]);for(d=0;d<g.length;d++){f=g[d];f=["C",f.cp1.x,f.cp1.y,
f.cp2.x,f.cp2.y,f.to.x,f.to.y];i.push(f)}c.operations=i}a.parent.prototype.stop.apply(this,arguments)};a.prototype.update=function(b){if(this.straightHighlighter){this.isShiftDown&&(b=this.rotateLockPoint(this.element.from,b));var c=this.surface.active,d=c.graphics;this.element.to=b;c.clear();d.save();d.transform.apply(d,c.transformation);this.element.initGraphics(d);this.element.render(d,null,this.surface)}else{var f,g=this.points,c=this.surface.active,d=c.graphics;g.push(b);c.clear();d.save();d.transform.apply(d,
c.transformation);this.element.initGraphics(d);d.beginPath();d.moveTo(this.from.x,this.from.y);for(c=1;c<g.length;c++){f=g[c];d.lineTo(f.x,f.y)}d.stroke();i.prototype.updateBoxFromPoint.call(this.element,b.x,b.y)}d.restore();a.parent.prototype.update.apply(this,arguments)};a.prototype.onStart=function(){};a.prototype.onUpdate=function(){};a.prototype.onStop=function(){if(this.element){var a=new d({element:this.element});this.surface.active.clear();this.surface.active.removeElement(this.element);this.surface.foreground.renderElement(this.element);
this.fire("action",this,a)}};return a=l.define(a,c)});
define("surface/tool/LineTool",["require","util/Class","util/Box","surface/tool/ElementTool","surface/element/Line"],function(b){function a(){}var l=b("util/Class");b("util/Box");var c=b("surface/tool/ElementTool"),h=b("surface/element/Line");a.prototype.start=function(b){this.element=new h({from:b,to:b});a.parent.prototype.start.apply(this,arguments)};a.prototype.update=function(b){this.isShiftDown&&(b=this.rotateLockPoint(this.element.from,b));this.element.to=b;a.parent.prototype.update.apply(this,
arguments)};return a=l.define(a,c)});
define("surface/tool/PenTool","require util/Class surface/tool/ElementTool util/Box surface/tool/Smoother surface/action/DrawAction util/Color util/Transformer surface/element/Vector surface/element/Line util/Obj".split(" "),function(b){function a(){this.name="marker";this.from={x:null,y:null};this.points=[[]];a.Initialized=false}function l(b){if(a.WetUses!=0&&a.UsingTool==false){var c=(new Date).getTime()-a.StrokeTime;a.WetAlpha=e+(1-e)*c/1E3;a.WetAlpha=Math.min(1,a.WetAlpha);var d=b.surface.active,
c=d.graphics,g,i=b.points[b.points.length-1],i=new f(a.LastUsed.stroke.color);d.clear();c.save();d.initGraphics();b.element.initGraphics(c);c.strokeStyle("rgba("+i.r+","+i.g+","+i.b+","+a.WetAlpha+")");c.beginPath();for(d=0;d<b.points.length;d++){i=b.points[d];if(i.length>0){g=i[0];c.moveTo(g.x,g.y);for(g=1;g<i.length;g++){var h=i[g];c.lineTo(h.x,h.y)}}}c.stroke();c.restore()}else a.WetAlpha=e;requestAnimationFrame(l.bind(this,b))}var c=b("util/Class"),h=b("surface/tool/ElementTool");b("util/Box");
var i=b("surface/tool/Smoother"),g=b("surface/action/DrawAction"),f=b("util/Color");b("util/Transformer");var k=b("surface/element/Vector"),d=b("surface/element/Line");b("util/Obj");var e=0.4;a.Initialized=false;a.LastUsed=null;a.WetUses=0;a.WetAlpha=e;a.UsingTool=false;a.StrokeTime=null;a.prototype.onPointerUp=function(b){var c=this.started;if(!this.surface.controller.moved&&!this.surface.controller.selectionChanged){c||this.start(b);this.update({x:b.x,y:b.y+1},this.surface.controller.activeScale);
if(!c){this.stop({x:b.x,y:b.y+1});this.afterStop()}}return a.parent.prototype.onPointerUp.apply(this,arguments)};a.prototype.start=function(b){var c;if(this.isShiftDown){if(a.LastUsed!=null){a.WetUses=0;a.WetAlpha=e;a.Initialized=false;this.complete()}this.element=new d({from:b,to:b});a.parent.prototype.start.apply(this,arguments);this.straightHighlighter=true}else{a.UsingTool=true;if(!a.Initialized){a.Initialized=true;l(this);var g=this;c=function(){a.UsingTool&&g.stop();a.WetUses=0;a.WetAlpha=e;
a.Initialized=false;a.LastUsed!=null&&g.complete()};this.surface.controller.on("toolchanged",c);this.surface.on("presave",c)}this.from=b;c=this.points[this.points.length-1];c.push(b);if(a.LastUsed!=null){this.element=a.LastUsed;c=new f(a.LastUsed.stroke.color);c.a=1;a.LastUsed.stroke.color=c.toRGBA();this.surface.foreground.render()}else{this.element=new k;this.element.editing=true;this.element.points=this.points}a.WetAlpha=1;a.WetUses=a.WetUses+1;a.parent.prototype.start.apply(this,arguments);c=
new f(this.element.stroke.color);c.a=e;this.element.stroke.color=c.toRGBA();this.element.visible=true;this.straightHighlighter=false}};a.prototype.stop=function(b){if(this.straightHighlighter){a.parent.prototype.stop.apply(this,arguments);this.surface.render()}else{var c=new f(this.element.stroke.color);c.a=0;this.element.stroke.color=c.toRGBA();a.StrokeTime=(new Date).getTime();a.UsingTool=false;this.element.points=[];for(c=0;c<this.points.length;c++)this.element.points.push(this.points[c]);this.points.push([]);
c=this.element;a.parent.prototype.stop.apply(this,arguments);this.element=c;var d=this;setTimeout(function(){if(a.WetUses>0)a.WetUses=a.WetUses-1;if(a.WetUses==0){a.UsingTool=false;d.complete()}},1E3);a.LastUsed=c;this.element.visible=false}};a.prototype.update=function(b){var c=this.surface.active,d=c.graphics;if(this.straightHighlighter){this.isShiftDown&&(b=this.rotateLockPoint(this.element.from,b));this.element.to=b;c.clear();d.save();d.transform.apply(d,c.transformation);this.element.initGraphics(d);
this.element.render(d,null,this.surface);d.restore()}else{var e,c=this.surface.active,d=c.graphics,f=this.points[this.points.length-1];f.push(b);i.quickSmooth(f);d.save();c.clear();c.initGraphics();this.element.initGraphics(d);d.beginPath();for(c=0;c<this.points.length;c++){f=this.points[c];if(f.length>0){e=f[0];d.moveTo(e.x,e.y);for(e=1;e<f.length;e++){b=f[e];d.lineTo(b.x,b.y)}}}d.stroke();d.restore();k.prototype.updateBoxFromPoint.call(this.element,b.x,b.y)}a.parent.prototype.update.apply(this,
arguments)};a.prototype.complete=function(){if(a.LastUsed!=null){for(var b=0;b<this.points.length;b++){var c=this.points[b];if(c.length>0){var d=void 0,e=void 0,h=void 0,k=e=d=void 0,k=[],h=i.smooth(c,a.LastUsed.stroke.width),d=h.shift();k.push(["M",d.x,d.y]);for(d=0;d<h.length;d++){e=h[d];e=["C",e.cp1.x,e.cp1.y,e.cp2.x,e.cp2.y,e.to.x,e.to.y];k.push(e)}c=k;for(h=0;h<c.length;h++)a.LastUsed.operations.push(c[h])}}b=new f(a.LastUsed.stroke.color);b.a=1;a.LastUsed.stroke.color=b.toRGBA();a.LastUsed.points=
null;a.LastUsed.editing=false;a.LastUsed=null;this.points=[[]];this.surface.render();this.fire("action",this,new g({element:this.element}));this.element=null}};a.prototype.onStart=function(){};a.prototype.onUpdate=function(){};a.prototype.onStop=function(){if(this.element){this.surface.active.clear();this.surface.active.removeElement(this.element);this.surface.foreground.addElement(this.element)}};return a=c.define(a,h)});
define("surface/layer/Pixelate",["require","util/Class","surface/layer/Layer"],function(b){function a(){this.registerEvents("elementselectionschanged")}var l=b("util/Class"),b=b("surface/layer/Layer");a.prototype.initialize=function(){a.parent.prototype.initialize.apply(this,arguments);$(this.dom).addClass("skitch-layer-pixelate")};a.prototype.onAdded=function(b){a.parent.prototype.onAdded.apply(this,arguments);b.layers.background.on("loaded",this.onBackgroundLayerLoaded,this)};a.prototype.onBackgroundLayerLoaded=
function(){this.render()};a.prototype.getSelectedElements=function(){var a=[],b;for(b in this.elements)this.elements[b].selected&&a.push(this.elements[b]);return a};a.prototype.addElement=function(b){if(0<=b.box.height&&0<=b.box.width)return b.on("selected",this.onElementSelectionChanged,this),b.on("unselected",this.onElementSelectionChanged,this),a.parent.prototype.addElement.apply(this,arguments)};a.prototype.removeElement=function(b){b.off("selected",this.onElementSelectionChanged);b.off("unselected",
this.onElementSelectionChanged);return a.parent.prototype.removeElement.apply(this,arguments)};a.prototype.onElementSelectionChanged=function(a){this.fire("elementselectionschanged",a)};return a=l.define(a,b)});
define("surface/tool/PixelateTool","require env/Settings util/Box util/Num util/Class graphics/CanvasGraphics surface/tool/ElementTool surface/element/Pixelate surface/layer/Pixelate".split(" "),function(b){function a(){this.element=null}b("env/Settings");b("util/Box");b("util/Num");var l=b("util/Class"),c=b("graphics/CanvasGraphics"),h=b("surface/tool/ElementTool"),i=b("surface/element/Pixelate"),g=b("surface/layer/Pixelate");a.prototype.start=function(b){this.element=new i({top:b.y,left:b.x,width:0,
height:0});this.surface.removeLayer("pixelate");var c=this.surface.addLayerAfter("pixelate",new g({surface:this.surface}),true,"background");c.setTransformation(this.surface.transformation);a.parent.prototype.start.apply(this,arguments);var d=[],e=this.surface.foreground.elements;this.element.layer.removeElement(this.element);for(var h=0;h<e.length;h++){var j=e[h];j.constructor==i&&d.push(j)}for(e=0;e<d.length;e++){j=d[e];j.layer.removeElement(j);c.addElement(j)}c.addElement(this.element)};a.prototype.stop=
function(b){var c=this.element;a.parent.prototype.stop.apply(this,arguments);for(var d=this.surface.layers.pixelate.elements,e=[],g=0;g<d.length;g++){var j=d[g];j.constructor==i&&e.push(j)}for(d=0;d<e.length;d++){j=e[d];j.layer.removeElement(c);this.surface.foreground.addElement(j)}this.surface.removeLayer("pixelate");this.surface.layers.foreground.render()};a.prototype.update=function(b){var c=b,d=this.element,e=this.startpos;this.element.activePos=b;d.top=Math.min(e.y,c.y);d.left=Math.min(e.x,c.x);
d.width=Math.abs(c.x-e.x);d.height=Math.abs(c.y-e.y);a.parent.prototype.update.apply(this,arguments);this.surface.layers.pixelate.render()};a.prototype.generatePixelatedImages=function(){var a=this.surface.background.getBitmap(),a=a&&a.dom,b,d=[4,6,10,12,14,16];i.sizes.splice(0);i.images.splice(0);for(var e=0;e<d.length;e++){b=d[e]*c.pixelRatio;i.sizes.push(b);i.images.push(this.generatePixelatedImage(a,a.width/b,a.height/b))}};a.prototype.generatePixelatedImage=function(a,b,d){var e=c.create(b,d);
e.drawImage(a,0,0,b,d);return e.context.canvas};return a=l.define(a,h)});
define("surface/tool/RectangleTool",["require","util/Class","surface/tool/ElementTool","surface/element/Rectangle","util/Box"],function(b){function a(){this.element=null}var l=b("util/Class"),c=b("surface/tool/ElementTool"),h=b("surface/element/Rectangle");b("util/Box");a.prototype.start=function(b){this.element=new h({top:b.y,left:b.x,width:0,height:0});a.parent.prototype.start.apply(this,arguments)};a.prototype.update=function(b){var c=b,f=this.element,h=this.startpos;f.top=Math.min(h.y,c.y);f.left=
Math.min(h.x,c.x);f.width=Math.abs(c.x-h.x);f.height=Math.abs(c.y-h.y);a.parent.prototype.update.apply(this,arguments)};return a=l.define(a,c)});
define("surface/tool/RoundedRectangleTool",["require","util/Class","surface/tool/ElementTool","surface/element/Rectangle","env/Settings"],function(b){function a(){this.element=null}var l=b("util/Class"),c=b("surface/tool/ElementTool"),h=b("surface/element/Rectangle"),i=b("env/Settings");a.prototype.start=function(b){this.element=new h({top:b.y,left:b.x,width:0,height:0,cornerRadius:i.MAX_RECTANGLE_CORNER_RADIUS*this.surface.contentScaleFactor*this.surface.scaling.x});a.parent.prototype.start.apply(this,
arguments)};a.prototype.update=function(b){var c=this.element,h=this.startpos;c.top=Math.min(h.y,b.y);c.left=Math.min(h.x,b.x);c.width=Math.abs(b.x-h.x);c.height=Math.abs(b.y-h.y);this.surface.active.clear();c.render(this.surface.active.graphics);a.parent.prototype.update.apply(this,arguments)};a.prototype.stop=function(){a.parent.prototype.stop.apply(this,arguments)};return a=l.define(a,c)});
define("surface/action/TextChangeAction",["require","util/Class"],function(b){function a(){this.newValue=this.oldValue=this.element=null}b=b("util/Class");a.prototype.undo=function(){this.element.value=this.oldValue;this.element.layer.render()};a.prototype.run=function(){this.element.value=this.newValue;this.element.layer.render()};return b.define(a)});
define("surface/tool/TextTool","require util/Obj util/Class util/Box util/Text util/Transformer env/Settings surface/action/DrawAction surface/action/TextChangeAction surface/action/StampLabelAction surface/element/Text surface/element/BubbleText surface/element/LabelText surface/tool/ElementTool graphics/Point log/Logger".split(" "),function(b){function a(){this.name="text";this.element=this.previousSize=this.previousColor=null;this.registerEvents("beforeedit","edit")}b("util/Obj");var l=b("util/Class");
b("util/Box");var c=b("util/Text");b("util/Transformer");var h=b("env/Settings"),i=b("surface/action/DrawAction"),g=b("surface/action/TextChangeAction");b("surface/action/StampLabelAction");var f=b("surface/element/Text"),k=b("surface/element/BubbleText"),d=b("surface/element/LabelText"),e=b("surface/tool/ElementTool"),o=b("graphics/Point");b("log/Logger").instance("surface.tool.TextTool");a.prototype.onPointerDown=function(){if(this.started&&!this.editor)this.started=false};a.prototype.onPointerMove=
function(){};a.prototype.onPointerUp=function(a){var b=this.surface.controller.activeElement;if(!this.surface.controller.editingOnLastPointerDown&&!this.surface.controller.selectionChanged){if(b&&b.label&&b.label.text)b=b.label.text;if(b&&b instanceof f)this.element=b;(!this.element||this.element instanceof d)&&!this.started&&this.start(a)}};a.prototype.onDoubleClick=function(a){if(!this.started){var b=this.surface.controller.activeElement;this.element=b&&b instanceof f?b:null;this.start(a)}};a.prototype.start=
function(b){var c=this.surface.controller;this.previousColor=this.color;this.previousSize=this.size;if(this.element){this.color=this.element.fill.color;this.size=this.element.getSizeLevel()}else this.element=new k({surface:this.surface,selectOnFocus:true,textStyle:"bubbleText",value:"",position:{x:b.x,y:b.y=b.y-h.FONT_SIZES[this.size]},font:{size:h.FONT_SIZES[this.size]*this.surface.contentScaleFactor},fill:{color:this.color}});if(c.activeElement!=this.element&&this.element instanceof k){if(c.activeElement)c.activeElement.selected=
false;c.activeElement=null}a.parent.prototype.start.apply(this,arguments);this.showInput()};a.prototype.stop=function(){if(this.started&&this.element){this.size=this.previousSize;this.color=this.previousColor;this.started=false;this.surface.foreground.render();this.surface.active.clear();this.fire("stopped",this)}};a.prototype.onStart=function(){};a.prototype.onUpdate=function(){};a.prototype.onStop=function(){};a.prototype.showInput=function(){var a=this.surface,b=a.controller.activeElement,c=b?
b.label:null;this.element.previousValue=this.element.value;if(c){c.text.editing=true;c.calculateBox();c.text.editing=false;if(!c.text.hasText())c.text.value=b.defaultText}b=this.createEditor();this.element.hide();this.editor=b;this.element.editing=true;this.originalAllowZoom=a.controller.allowZoom;a.controller.allowZoom=false;this.updateValue(true);setTimeout(this.focusInput.bind(this),100);a.foreground.render()};a.prototype.focusInput=function(){this.editor&&this.editor.focus()};a.prototype.hideInput=
function(){var a=this.surface,b=this.editor,e,f,h=a.controller.activeElement;e=c.encodeUTF8(b.val());if(this.element)if($.trim(e).length===0)this.element.remove();else{if(this.element instanceof d)e!==this.element.previousValue&&(f=new g({element:this.element,oldValue:this.element.previousValue,newValue:e}));else if(this.element.layer)e!==this.element.previousValue&&(f=new g({element:this.element,oldValue:this.element.previousValue,newValue:e}));else{a.foreground.addElement(this.element);f=new i({element:this.element})}this.element.value=
e;this.element.updateText()}f&&a.controller.tools.text.fire("action",this,f);this.editor=null;b.remove();a.controller.allowZoom=this.originalAllowZoom;if(this.element){this.element.editing=false;this.element.show()}this.stop();h&&h.calculateBox();a.active.clear();a.foreground.render();this.element=null};a.prototype.updateValue=function(a){if(this.element){var b=this.element,d=this.editor,e=d.val(),f=this.surface,g=f.active,h=b.selected;e.toLowerCase()=="null"&&console.log("<|");if(a||b.value!==e){a=
b.getTextMetrics(e);if(e==="")a.width=0;d.css({width:a.width*f.scaling.x+10+"px",height:(a.height+10)*f.scaling.x+"px"});g.clear();g.graphics.save();g.initGraphics();b.value=c.encodeUTF8(e);b.updateText();b.selected=false;b.render(g.graphics,null,f);b.selected=h;g.graphics.restore()}}};a.prototype.createEditor=function(){var a=document.createElement("textarea"),b=this.surface,e=this.element,f=e.font,g=f.size,i=g*1.1,k=o(e.position.x,e.position.y,"surface").relativeTo("dom"),l=e.getTextMetrics(),l=
Math.max(l.width,10),B=e instanceof d?1:3;return $(a).on("change",this.onChange.bind(this)).on("focus",this.onFocus.bind(this)).on("blur",this.onBlur.bind(this)).on("cut",this.onCut.bind(this)).on("paste",this.onPaste.bind(this)).on("keydown",this.onKeydown.bind(this)).on("keypress",this.onKeypress.bind(this)).on("keyup",this.onKeyup.bind(this)).val(c.decodeUTF8(this.element.value)).addClass("skitch-tool-element-text-editor").appendTo(b.dom).attr({maxlength:h.MAX_TEXT_LENGTH,wrap:"off",spellcheck:false}).css({display:"block",
resize:"none","z-index":"99999","min-width":"0px","min-height":"0px",overflow:"hidden","word-break":"keep-all","white-space":"pre",background:"transparent",padding:"0px",margin:"0px",outline:"none",border:"0px solid #000000","-webkit-box-shadow":"none","box-shadow":"none",position:"absolute",width:l*b.scaling.x+"px",color:e.fill.color,height:i*b.scaling.x+"px","font-family":f.name,"font-weight":f.weight,"font-size":g*b.scaling.x+"px","line-height":i*b.scaling.x+"px","letter-spacing":"0.005em",left:k.x+
"px",top:k.y+B+"px","-webkit-text-fill-color":"transparent"})};a.prototype.onChange=function(){this.updateValue()};a.prototype.onFocus=function(){if(this.editor){var a=this.editor.get(0);if(this.element.selectOnFocus)a.select();else{a.value=a.value;if(typeof a.selectionStart=="number")a.selectionStart=a.selectionEnd=a.value.length;else if(typeof a.createTextRange!="undefined"){a.focus();a=a.createTextRange();a.collapse(false);a.select()}}this.updateValue()}};a.prototype.onBlur=function(){this.hideInput()};
a.prototype.onCut=function(){this.updateValue()};a.prototype.onPaste=function(a){this.updateValue();var b=c.encodeUTF8(this.editor.val());this.element instanceof d&&this.element.getTextMetrics(b).width>=this.element.maxWidth*this.surface.contentScaleFactor&&a.preventDefault()};a.prototype.onKeydown=function(a){a.stopPropagation();if(a.which===9){a.preventDefault();this.onBlur(a)}a.ctrlKey&&a.keyCode===90&&a.preventDefault()};a.prototype.onKeypress=function(a){var b=c.encodeUTF8(this.editor.val());
this.updateValue();this.element instanceof d&&this.element.getTextMetrics(b).width>=this.element.maxWidth*this.surface.contentScaleFactor&&a.preventDefault();if(a.which===9){a.preventDefault();this.editor.blur()}this.element instanceof d&&(a.which===13||a.which===10)&&a.preventDefault();a.stopPropagation()};a.prototype.onKeyup=function(a){this.updateValue();if(a.which===9){a.preventDefault();this.editor.blur()}a.stopPropagation()};return a=l.define(a,e)});
define("surface/tool/StampTool",["require","util/Class","util/Box","util/Transformer","surface/tool/ElementTool"],function(b){function a(){this.type=this.icon=null}var l=b("util/Class");b("util/Box");b("util/Transformer");b=b("surface/tool/ElementTool");a.prototype.onPointerDown=function(a){(this.element=this.surface.controller.activeElement)&&this.element.selected?this.element.processHit(a):this.start(a)};a.prototype.onPointerMove=function(a,b){this.started&&this.update(a,b)};a.prototype.onPointerUp=
function(a){this.started&&this.stop(a)};a.prototype.onDoubleClick=function(a){(this.element=this.surface.controller.activeElement)&&this.element.processHit(a)};a.prototype.start=function(b){this.element=new this.type({position:b,icon:this.icon,contentScaleFactor:this.surface.contentScaleFactor,layer:this.surface.foreground});a.parent.prototype.start.apply(this,arguments)};a.prototype.update=function(b){this.element.updateAngle({x:b.x-this.element.position.x,y:b.y-this.element.position.y});a.parent.prototype.update.apply(this,
arguments)};return a=l.define(a,b)});
define("surface/element/Measurement",["require","util/Class","surface/element/Vector","util/Transformer","surface/Serializer"],function(b){function a(){this.value=this.to=this.from=null;this.shadow={offset:{x:0,y:0},blur:0};this.handles={from:{x:0,y:0},to:{x:0,y:0}}}var l=b("util/Class"),c=b("surface/element/Vector"),h=b("util/Transformer"),i=b("surface/Serializer");a.prototype.deserialize=function(b,c){$.extend(!0,this,{from:c.extension.startPoint,to:c.extension.endPoint,vale:c.extension.value});
a.parent.prototype.deserialize.apply(this,arguments);return this};a.prototype.draw=function(a){var a=a||this.graphics,b=this.from,c=this.to,d=c.x-b.x,e=c.y-b.y,h=Math.atan2(-e,d),d=Math.sqrt(d*d+e*e);this.handles.from={x:b.x,y:b.y};this.handles.to={x:c.x,y:c.y};a.translateBy(b.x,b.y);a.rotateBy(h);this.beginPath(a);this.moveTo(0,-50,a);this.lineTo(0,50,a);this.moveTo(0,0,a);this.lineTo(d,0,a);this.moveTo(d,-50,a);this.lineTo(d,50,a);a.stroke();this.setBox(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.abs(c.x-
b.x),Math.abs(c.y-b.y))};a.prototype.manipulate=function(b,c){"from"===this.activeHandle?this.from=c:"to"===this.activeHandle&&(this.to=c);a.parent.prototype.manipulate.apply(this,arguments)};a.prototype.move=function(b){this.from.x+=b.x;this.from.y+=b.y;this.to.x+=b.x;this.to.y+=b.y;a.parent.prototype.move.apply(this,arguments)};a.prototype.applyTransformation=function(a){this.from=h.transformPoint(a,this.from);this.to=h.transformPoint(a,this.to)};a.prototype.serialize=function(b){var c=h.transformPoint(b,
this.from),k=h.transformPoint(b,this.to),b=$.extend(a.parent.prototype.serialize.call(this,b),{extension:{type:"Measurement",startPoint:i.serializePoint(c),endPoint:i.serializePoint(k),value:this.value}});b.fillColor&&delete b.fillColor;return b};return a=l.define(a,c)});
define("surface/tool/MeasurementTool",["require","util/Class","util/Box","surface/tool/ElementTool","surface/element/Measurement"],function(b){function a(){}var l=b("util/Class");b("util/Box");var c=b("surface/tool/ElementTool"),h=b("surface/element/Measurement");a.prototype.start=function(b){this.element=new h({from:b,to:b});a.parent.prototype.start.apply(this,arguments)};a.prototype.update=function(b){this.element.to=b;a.parent.prototype.update.apply(this,arguments)};return a=l.define(a,c)});
define("env/Device",["require","util/Class","env/Settings"],function(b){function a(){}var l=b("util/Class");b("env/Settings");a.getRegion=function(){return"undefined"!==typeof Windows?Windows.System.UserProfile.GlobalizationPreferences.homeGeographicRegion:"en-US"};a.getHostName=function(){var a,b;"undefined"!==typeof Windows&&(b=Windows.Networking.Connectivity.NetworkInformation.getHostNames(),0<b.length&&(a=b[0].displayName));return a};a.getDeviceDescription=function(){return a.getHostName()||"Windows 8 Device"};
a.getDeviceIdentifier=function(){return a.getDiskSerialNumber()};a.getDiskSerialNumber=function(){var a,b=-1;if("undefined"!==typeof Windows){a=Windows.System.Profile.HardwareIdentification.getPackageSpecificToken(null).id;a=Windows.Security.Cryptography.CryptographicBuffer.copyToByteArray(a);for(var i=0;i<a.length;i+=4)if(3===a[i]&&0===a[i+1]){b=(a[i+2]<<8)+a[i+3];break}}return b};a.isHiDpi=function(){return null!=window.devicePixelRatio&&1<window.devicePixelRatio};a.prototype={};return a=l.define(a)});
define("surface/cursor/CursorData",["require"],function(){function b(){}b.forName=function(b){return a[b]||{}};var a=b.urls={};a.marker={};a.marker.blackOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAErklEQVRoQ+2ZfWhVZRzHvSsNtiYTktCJsVyB0jVBWVqzzbb+UDOEyAmmk2SEkAbVAsUMX8pof5gmDRwqK0UnpjGdpW3YUMKWSDBBytnqj/Wiqcux4cy3z3ecI8eze8/Lvefcq7IDHx7v3XPO8/3+nuf5Pb9zjQy6x6/IPa5/0ICBAGZQQVwLL8FXsAZuen1uumdA42+A52E1vAP/wEK47MVEOg1YxS9B7N8wFBbDZHgFfnEzkS4DGvczeA4k/lf4DzJhJLwGC6AUTjuZSIcBU/wzCHsL2uAiXAP97WHIhXnwOkyCv+KZSLUBjbcJCmCpIf6SId7UqD5ZMAregCnwAvTEMpFKAxrrc3gatFkVebt4u4nRfKEMpRl4E/plp1QZMMWPR8TbcBY6bZG3B1j3aFO/CB9BFHpjdYo1M0F+9wAP2wxPwruGeEX+ussgMjABvob1UAPdqTZgih/DwJXQDl7Fa6lJvM6JPaA0+38qDQw2Ip9niP+NVsvGa+T30fdTUKvD7UqsGQtrD0j8VngUllsif8PDsplIH5UUWjZ7DfH91r75nDAMWMUvY6DfjWXjR3wV99S7iZeJoA08xDO/AGWPFUbktWy8iFf5sAs8iw/agIIhATqE3oc/wK/4ddxz0Evkw1hC44w1O59Wh5RqG7fIZ9BHkd8JEt8A5yDumjeFh2FARdgPoLL4S+iX8myDS3whbIcPjcj7Eh/0EiqxCJ/Nv3+GeC8mVvGr6HfYb+SDnoFneaC5AbUHFsEsUD1vNyHxKs6UZiX+kCH+qn15ePkcRBZ6kIFOgMqF70Cf54LK4VdtM2GK38b3ylJNyYgPagnpJeQo/ATvgU5a1fMSr7crVZEHQBtaLyhbghIfhAHz5aSYh6nGqYbdoPNAm1qV5EbQqfojqDTQ4XYk2chLfLIGJP4TQ6RKZEVYZa8irMzyCNRBB6ivirOVcAzOQ0Jr3hQehAFF+aQR1W8NQY/RquxV1TkM9CKiFKnXRV062P4FtxRr1xn3czKbWGu/DD6G46DZ0C8JM0EVpC7NhipJCdZYirppxrNIp47JGFC2GQ4jYA4o6+hNS2v8Aqj81cu6XkI8/1Dl15Wjgc7OzmFZWVlju7u7T+fk5GiT2i+ZyAYtF82IIq313QXaEyI08RLjaKC9vb04Ly/vCO002u/jREfPkJEhhmDVMW41kN9Ax+3vZCDS3Nw8vaioqIF2Ju03YUczEVdOBjIaGxtnlJaW7qedRasyN2WR9WpmwIDXSIXVr28GzGxjHaSrqyujo6PjqWg0Wt3a2ro4Nzf3VHZ29h1LyCE7haW333P7DJjZxu+oLtnJ7+MS6i8DkcrKysfz8/MLe3p6VB7cvkZylZWVfVBXV7fqTy7r3zIzM3vb2tqOVVVV6feeUHO9kzNzE+sQ0i8JyufmFamtrZ1aXl6+g3YerUpmq1CVBPpflJi/GicUzgRusmahvtmwPCOjqalpeklJST3ty7Q6B6x7QGbSFvnbUXYwPXAOJLAifN9yXx9kkYqKiicKCgomt7S0HK+pqTlzN6x5+xS5vQ8oOwllmrRmm3hry82A7lOftGebZAz43lipvMHLDKRSj++xbgEjI2lAthR+XwAAAABJRU5ErkJggg==";
a.marker.whiteOutline="data:image/png;base64,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";
a.marker.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAC00lEQVRoQ+2XS2gTURSG/zuTpElMqGJK8YWFVtO0bgQ31U1XlSqCj0Zd6rqCiJTig7oJuqmoCysKdVubVAVBBRfSpeIDFc1k4xNBGkQlMTWtyRxvogkltE2m904GYbKZzZyT7///c+7MMOrYT/iPf8wWYHF6dgJyAtCvYjZzVHc1nlGgnzDS0/oEiK5Ai/UzoHiYUEdfL6Dcq1WEtQIII9CiR0rwJWgK7dkEOF6AMbWaEOsEUP4CtJvHK+HLItoPbATT49VEWCOgCnxZRHDfFqjqk8VSqLsAHco5JX7j1ELOV8Lmgn2HVVW5vpCI+grQc2eRuHW6VvjiUrcccsM7/ct6AaRHoE0MGYLvDLugY5LvQZe1AghD/LSJLAH+EYffbO0OmAhfEGb2DgwgHj1vyPm23gY4fc+4853VngFmCxhg8ehwLRDlY9MgvHkCiB1j2vhFQ/CF08aTeVqr86Xe8keI9H6mTYwYh0+/AlM3GKmTnwDRfabFdhiBoLVhD/z6y6XAyxfAO/6c+d3sf3s7WYsIWr3Li0Z34X1nfS33z3eP3BEifOXPzo9QsJW9ic0uBiUDXm4CRF8w8z2UIa97mcc9xo/PHn585uYTQU3dPgSaXos4L32JUyla2fg59q34/tK2uxVO5yhPoqcyib/wgQSYsmapYzO3Tt4I6Ww7S4w/KDWfbj24zuPK302l0V0WFtzmh7JKkwUvb4SIjRZmP5PNXvO9vzNVfjC1dC+HN5AE5XemCc/9zMmdR0CG8/JG6N83bbFhR3g4m8Ulz7vYJ/6By9C+NwLFcVImcGUv8RGaTq5gHyZ/FGe/AB0Kj/HLY0Bv5qMyaCa8nBEiyoNoEFnf5VxDqsuhOh6aDW3OEteTes5/iY+QReDyltgWIOaAPUJi/olX2wmIeyjWwU5AzD/xajsBcQ/FOtgJiPknXm0nIO6hWAc7ATH/xKvtBMQ9FOvwB59LVOBheDwxAAAAAElFTkSuQmCC";
a.highlighter={};a.highlighter.blackOutline="data:image/png;base64,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";
a.highlighter.whiteOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAIK0lEQVRoQ+2ZfUyVVRzHr164CCKEvWGC9qpSUbdEUbMmhdXUmWw6sdLSwj/C5pbTln9oM7em6dYs1nxZiqy3yXTqnE1JKUAtLFCqKVkbaJgRYYmEvPb93J2Hrni53PuAYzbP9t157vOcc57v73d+b8+5fRzXeOtzjfN3dFuAGTNmONPT09MGDBgwtn///iOioqLiw8LCYvr16xceEhIS5nK5QtU71fqAvn37eqDmsGApkd9tbW0OPXe0trY6Ll682FxQULBm8uTJb3SmaFsCbN682T169OhP4+Li7oqMjAzhhVerIcj27duXSVFv+XqHHQFc58+fr4+Ojnb2MOkWrfeXUC38Ldwk3ME7zpw5Ux8fHx+jy8aO7wxagPXr1y+aP3/+miDIQ+wXoVyoEH4SjgtVwgWhXvhHuCQTarPWlSndr+vvhNCGhgZHeHh4rK7PdVcAp7YzLy0tbYJZCHKHhLJAiQUquAQYrLE/ClGY0YEDBwq1E/Pmzp2LAtpbsDvg2r17d/GUKVMeMCuguThp7s9AiQU6TgIM1NiTAqbkaTLd5piYmP66bDelYAUI37FjR9G0adMeMmv+rn64BDjfFTERgsidZlwTO6Z5dbofputoAXu/VcDWIT9OeNxcty+/cePGpTLht60bQQuQnZ39+Zw5cx4zC/yqPkFEsGWfTQQhVCDcJ2ByrUKoGfyF+qmaX69xcHEJ4UKEgM0jhFvgffcwZ+fOnV9JgQjGWkHnAdeqVas+XLJkyXOGwFn17wvfCjjoHwLbawFSvwlon93aLVwU7hKeFohkPwiJ3g5s1m7vJNzD+nFECN27d+/xSZMmjTLvCFoApyZn7Nmz5wOzOrafJuBsmEWzF9B0vFBixm5Tv0BEm0UITecLY82zgbpf25G49dsIUKjf4dqBMu1Asq7xv6AFYM64pqamImVXtnC+XvyhnxfjcDcIZLoaTMWL1E5dTzW/B+kZO+WzSYBH9OBzITI3N/eokhomZVsAtwQokQCXtMhMvRgifptxVJwUU5qOEgTMwGpXCGB8Al8YKizmXUK4qoD8efPmTeqOAIktLS3HVT4gQJ6wQMD2MZ8mCeRxLpohkanL9wTuozXi+H4hxUuITndAaxChDgt3C6Hr1q3LXbhwIT7oCaXBRiHmuCVAiQSAEJlyl3BKIEueEbBliIJHhXwjz0vqc4ULOKzaWl2/Zp75EwAT/F4gsTmWL1+etWLFCubZFmCkXn5UC+C0T4qMRdBw+a/TOBwXk0HYaI0lAnmanh1Qxy7Q/AlATkCAQQxUDliqXLDarGlrB0ZqB45qB9DwEyLF9vpsIrlPDyaahykIq3sh+p0u5HhN8uUDjOsnUBPhZ7cwPiUlJT0/P5+dtJUHWMOt4qpENT8CTBEpNNmZAM93IGqNs8zPcmTKEZLiFU0CY0I/C+yEIyEh4akTJ06gGE+z4wP3nj17tiw2NhYn/kTYI1BKUArTYyaYFySjhHeEZwRKBu7nC9gw83cYHu9KgE0++GNqZGYc3+MDGjdaXXF3BLi9uLi4NCkpiRBHSVwpEN8hh2N5opFBnXocnSxKjc8z8gF9l81EMUIvhAmnCJCkjszvaXZ2YODq1as/W7x4carmo2XIkHUxKcIq5QJZs9rbabtkqwEmQ6OYOIGKd5hADUXiuqWxsdEh0+22AK7k5OQXjxw5st6QQttjhBJ/9UxHAUSWOohMfaPwoCF7m3qKP+ye+/TYPggrKiq6MH78eN5F6eJpdnbAkZGR8eqGDRvWmTWw+ySRx9F8Nq+sOkADiCpoloKOJAVhq4TGZxhD9MFnKEGczc3NDimsQTXQ6zU1Nfgdn522BXBOmDBh+sGDBz/1EiBTAnxsLSrCEEC7ZM8EQ9hbm2gUsgiAyVBeEzbbv7MVqh2nT59u1alErT5jv5T2yd6U33yetmd7WzugBUbV1dV9o2MUOGP7JCy+kyE7XCBmQ87afvpIIxRRBc16tGsJDeFz5861nTx58pKUU6Gah09ISnQAaSIRJUs7eebaFWDE4cOHi8eMGQMpFiQS8RLKZIsspgBZNHsZWV4sBXDa0KKYXictV+bk5HxdXV1NLuC7gcr0tOmt0uQy4pbgdgW4edasWW9u2bLlFR1csRaOTCS6QrM81LcsZJtPnTpVf+zYsd/37dv346FDh/jehRz2DGk+jmoYjnzCFUcoFmnv3q4AbH3y7Nmzl61cuXLi4MGD++rUzcHxB2ZQWVnZKLJ/l5SUVO3atet4RUUFmoUYBPkIgjC9lfgww4AIdxTCrwC1tbXuiIiIZ+vr6z/WaUBph8nY+EhhlA65hsgfIqqqqrBRvo8hZhHmHlmaREaWhizm4NMkfGnZ3z2/AkiT7w8ZMiRTfZZ66v6ODRsnUxKziSQQJCtD1iJqS7OBCuJPAGdhYWG2Esdz6j9S/0JPaS1QcoGM8yeAS+Esm/KVmK8eAa6qNgMhHIwPXBfAjkaDneMxISvaeE9WSHTKeR9NTEwcVVZWViwnLtCfFpdFjk6iU7AcujXeI4AVbYJdyU90CnYp2+MRwLlo0aL0YcOGZUijFGHtTf/AxOoQaei2bdsqlEkvO3hSfmgoLy/fuHbtWoq6HonpdqSwohBHgByeEtet5ty6desCHeROVL9fPWeg3kStMx5qll5r3mGU8sD7byNXXl7eptTU1JnqP1P/sp57h9Eey6bdkf56HuiO9npi7v96B5yZmZkvuN3u2aWlpTlZWVnZvRltOtutrr4HiE6cFHD+06vRxq4AzCMy9Vqc78pPutqBrub3+vNrXoB/Aa+xPl5pYtkUAAAAAElFTkSuQmCC";
a.highlighter.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFb0lEQVRoQ+1Xa2scVRh+z5lJdmY3k02228baaG8x7ab1gihoxdJ6KRZqpdBNRfwgCH5pPwn+ChUE/SgiCBVJbLX1Rq0SsGpBbMFLeknUtvRq2iabze5sds6c43NmkxjqbjIkO0hhDwxze+ec53mf9znnDFM9vYpu48YaBP5n9RoK1E0ApXxilCNFI8TYOCmVxnn1fP1Hr4AGRvJPIn6WiJ3HMSRk+RdT8csuTebtUmuReLNL596fZAT4U01ldm0kZpzAd01zkVgcgQAc/QBQv4YFNl9Gp98Xu3essI34IFRpjZKAO56nzuTFvpthgYWNy3VmU60OOwMC6egIkPqbiiPr2LmBsfmAjXc/m3bIWhPEmYZHI1eH2MjAhOraHptQVrIlxleTrzqIme0AnSKmNiHyCSibio6AkpdIXsmwM9/naw2i7n6hnRLedzDkBhgTRlVypq6V+oZypZ3s8uEiip9R1/ZmEq5djDXF4zx1Bym5iRh/gEhshh/uqTbGYj1wBYDeIcl/Jumfz1P5uiNFmURHGaYsY0BGmd6rlTKAWoofJsUKxPy1ePcMSBkg9Tud6rt3toFvBaoyex7EN8erGXpxBEjdFIrtcn130BGuRwUuyDEEDX8pAEKW1mTvsiw6WQGk+miwfx+ACrUh20ySBkDg0eDVhJliF/aP1lRREyB5DPH2rTELJ4By8Jl8xRz8+L2aA3dsS7jJ5jbyW7jtFm7oUpmZJnuyn0Kgnfq+UJxY3nLui6u1+vHW9T5mGuorxLfUk8AkymcPG+wHkLmbNirx+GpBPG0afPeUQR+e/qoagcATHdvi5CRXUjO9hhViT70VmASAoyXl7bNujF2nxCqBuvdQInptqBSNBrE+u5c4e7tiYHLxcAiPv8b1VoQEJOZSQK15KklW6keUUFd9PRAAYicA6BCRNywku2by8sW8z0ad3KRL1464Yn32cZOzAQ3SJ/9lo1zshz/y2rCqJ/smiLw6L4FVW9rITv+G2WhFNZ0X7gGSnpC0rel0fwCwWgPIPoDcHWT/Zi7Jrh0p/OuB3m9xrVWYU4HKgkYgwJbXl4BSrlDiyabTByFvDQKZ3UeQuaf1WyHlVk0WZWVST+/zePTB9Fc1PGDS0i0WpVN6T6QNv6z+BKTY0XTmoM5kDQV6X5wNdCZouvymPOCKYmf87GeXqqqoSyi+9I9aK/LCSwgKoJQ/hAc+F8ofM5mZI+GNFUS5IK2Y55RG/RJf2mrF1OsY/DmUQAxG9BCPkvNR+x4mAfvglD/eMk8deLcqgc6sTY4aisQDWFUvY9ALAFdEnXu4xuqrBGYYXDN9P+H76oQh/eMu88alx0Xir0M39GJWS7XZz/UsNtGVTbc00U8YY2V9S0j3VtlOB6tuZYpUR5GpwyVZPmaNFkdmmzYUYL1CF0biZLd3Ijn3ETe7McgGfLu5/h6YQaTLwniETn10cq79zK0EkF0Dm7dEyTCXWNy4H94GWONOAMZuVLUhJ0uwd8IZO1N9BCX437ZwD8z05Y9R2X+IDX8Co9Uw89SqWrBNJ2HbG3HbDUBrATAJoADM2gOQSuHnhTkgYIFIDCrwYMM3R6sPAan2stMH9k+Po1a9ZOWtXMLhvAs71YzkRjdX/lQ2FTKq9/iyFeUGAhSHsfVvozkf2GgUCGYj1kdq8g3isQzArEMGl+GswVXkDw7VgucJZN3GmYfJbhjfLF6BipEv4MCPO7ZdFcAASw5IaLBmvcBGo0DQqzYyw0xUv8yGyb6OWbwCYUeKKK5BIKLEhu62oUDoVEUU2FAgosSG7rahQOhURRTYUCCixIbutqFA6FRFFNhQIKLEhu62oUDoVEUU2FAgosSG7va2V+AfwoCz76dc/qIAAAAASUVORK5CYII=";
a.text={};a.text.blackOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFn0lEQVRoQ+2Za2yeUxzA17q3She3WF3W6chC3RIjQdqldelmQ5Bi6AeamHtQESLbXBIxfHEZRqTYh/IJcU1rXSxII0Q65tLoRDp3SrXM/fd785zkeNe+ffv2fd+a7CS/nPd5+jzn/P/n/C/n/7Rk2lbeSrZy+adtUyCLHazgmQNgevTsF/zeBL9k8X7GRwqxA6XMuACa4RjYCzbCUCTJnolS3l8HHdCdizL5VqAJIe6B7+EleBe+hj/hr0RA51TJ7WAGHAunwTdwKXwyEUXypYDj3AoXwlJ4L1lxTWQz/AF/JwQFtud6JyiD3eFMaIFTYX22SuRLgSVMeCVcBX3gDih8vPKjyeROqMiuoKktgsvgCPgpGyXyoUANE70GKvEOfAe/RZMr4N5wcHJvI70OHD+jHLvA/nAfrIYnwF3L2CargO/fkazecvqv4Pdoxj34/SA0gLatH8yEj+CCRJHwuGPtBvrB4XARuIMFVWBHRn8TboNXIA6LO3D9EJTDXfBrIolmc33yrGanf4TmO2eAptgI+k9BFdB2v4R6cFXjFdMxdWYF+jhSbmd+nwKtsBB+jiQ0Mp0O18LJMFJoBRTyGThpjIk6ua+pGEqDPeugNybXmkvsrCqgI1+XKDlcaAV0vP1AMwlx3jm9fyhUgw5svLc/BD6H1+FR+ACCafle0RUI0cN4LufBOWDEUTijzWegA/8IOrkZWbMxcbn6seJFV8BVs7nampKr+zS8Dzq0odKopKOK1zqmq+79WHjHmRIFNIsuMH6/DIOg8wUhQzLTB0IW1uRq4Q2IHb/oChgSu0GbbgdNRMdTqCCwjn4kHA2alj7j7w2gw8aOWnQF6hDgftD2PwXNJkQbc8TVcEWimH7QD/qETn4WGGJ/gNCKqoCrfxNoQteA558gvKbicdrs7N8UWh8I/mAe0NnPnUoFPOM8CW/DAxCHQ1f/MTCB2RttFF7TUrk7wULHhJWeyIqWBwybHrrWwCOJgHSppomsBBPYzWl/m821PmOCs4+PC0U1IRW4O1l5TSk+xPm3ejBZPQvuks0srGk9nPzN0nLK8oAHr/NhMViMxNFE/9gHDJUWKAcmCpjYPPQZgUarid0Bz0c3gMeTgh4lFPIgMJargLVt3PSDStDW3RGbiUybN1cEn4jfcUxLTGvkOYVWwIn90nAxXALWw4bJdIFcVbFpLkYjy8hb4F4wd4Smg+sjmtws+DZtvC0uJ1vQaEb7wuVwNrj1L4KOOdoxwZ2wuFkGHvRU/lWIKy9N7ym4HfwwkLFNVgEHdzWddB6YuGw98CFYK9h03plwPHiIexwMw8vAmiJumpe2Px96IWNZmQ8FnNwixfLRY4OJ7SjQP4JwRhsVUiB/K6BmlS68Y3lPX/A0a5bOXYHBwcHp5eXlc4aHhzdUVlbGKT9t0VKXCmT896Bmr3kpiM0EpgOb7MJBLxzF3Ym4+Y5+opJxaB5tzszfRvv7++urq6vX0M+j7x51hC1vxh+uFMYV1B8C435pyHKe1GOZTKhk7dq1TXV1dS/QL6DXofI6+UQEHevZTAqUdnZ2zm9sbHyefiG90SU9suRDhkmNsU2BSS1fHl5O7UCINvF4Q0NDpQMDA4fV1tau7O3tXVJVVbW+oqLiXyaUZXTKg5hjD5FSIESbic40weg00eGzel4FStra2mbV1NScMDIyEg5dqZdn0Jqbm5d2dHQs30SLRywrK9vc19e3bsWKFZaSUxadghN7HPDDapxUStrb209saWlZTb+Y3uIjFtRkY6U17ue/rJYyx4fiKJTajWic0q6urqaGhobn6BfRmwdiHwj/sMhx6vy8ti2M5mcdcx/lf70DJa2trbPnzp17XE9Pz1urVq3yw9SURZux9mi8esDoJEaaKY02uSrgeyr5n1v5oNB4O5C7dxXpza1egX8AjgCwQAfJDt4AAAAASUVORK5CYII=";
a.text.whiteOutline="data:image/png;base64,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";
a.text.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADRElEQVRoQ+1YS2sTURQ+d5JqktoUiyAVqzRqSSJSoeLaRaAIKkibVFy40Z0rRdFlXUpFF/0BFnfJtD4ogkiFdqEuBFeSxFBDtRKldNFHzAxx5h5PB5Q2mWkmwzVJYQJZZO49d77vfPe8wjCaQNjBH+YSaLJ6rgI2BFgExHf0Xfy3V5JOAMIAMNhnw37bLf9HAc4fqGU27svLPxjAbysEePTsbpACveCRRoGxESdkxBJAnANeOM8+v12vFwz2DYXBK30AYHvqsRVHADEJGfkyeZzXA2Dz3l+Rwe4A6yzUYy+KwCKkUyECr5m9nAqNBKFYh7GWnynSPt3yWkUSNyg2HtolIYSAxvFMW1aeq3wpAWcQjl8HiY1vWaMYgezkHTO1lFD8kM/HvjaUAKwo7awwXaoiEE0k6FnSFAziOZaRX1bZhGKd4OtaaSyBdEoib1a1JBgZygHzHDMFQyqw7OTt1iBg111b942wdCq18wig/lxDbcybffHeVLWmXKHq6F0G5BNUnGZB51/WStJSkKsqFKYVM9CbzbGpBBBugrL0GBZmV2sBtUyjzSGARaWsRwLzT7/bCQcjvYZiQZafWW2NGND0CMtNZS2KmAEWvJ3d1PMcoabuFEjSVeA82RpZiFoIyueXTMH3Xewn0LJpKm2VNKoBj7WlJ99UEij2Xtjf7vf9tLxSCHdZJnW/6VdIVfGwPy9/q6sK02bL9qPRQayUtR6z4MVwYpBauFfmCmAR0nKX2azQ+DSKbIBlkh+rFDge3wXI5ul5z9Y1Aq/xfgr6vGncNFoByiajlE3uWWQgD0RpUNG9J411LH+C3LP0tlNawwlsACsF/GxhQrVTA2rtoRrhhWjCcgyttBcyDwD1N5CZGqpnGjNiJJt6XVmxjSIXja/ZHS3FEDCuB86t6+pwMDe9vJ2XVw/Gu4Id7BHBvAKlpb1sYbaq98fw8BgVu1u11NpYF0fg79s21ADpCTVxGYVTwNLHL3kOUEY6TZPZNfrZXwMY/Q2jq5ZzRIWxeAJ23CZwj0tAoDMdHeUq4MhtAo1cBQQ609FRrgKO3CbQyFVAoDMdHeUq4MhtAo1cBQQ609FRrgKO3CbQyFVAoDMdHbXjFfgDDRCs4BqGKzQAAAAASUVORK5CYII=";
a.arrow={};a.arrow.blackOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAEnElEQVRoQ+2ZfUxVZRzHueTLguFQV2uwqTjYcom1/mDkYIigBihmmSxbg1Vk/ZVbYS1Nhs5XzLe15WRrMUcby9ZGkrpAZNHGSNcfsNHWXUwdVJpGIRSV6efLzmGHy30998C9OJ7ts+de7j3n+X2f5/v8nt+5uGKmeHNN8fhjpgVM8ApqgqvgNTgPZXDXOmY0r8BsAv0QnoTDcAQWwl9TQcAcgqyHO3Ac9kM7vAMD0S7gUQL8HL6Fj+E9+Ae2QS8MR7OAJwjuDHxiiHiVfhm8DldgEKJ2DzxNcCfhA2iCYngFSsANf3oGr5WIhk2sGGSTLSCPfwfL4aAhQN7/Hf63Wsd8HWkBswjkGGTDW9ANaVALb0Ib/AbazF5bJAU8TESfwr+wG3pgLnwFe0F74Ybxua/4I2ahx41AT9Mr0yi7zIRG+AYOwa+g7OO3TcQK6J7vg9KdfDwma/Bep+oOOApnoQ9kEdlGq7HdEPR3oOD1+UQIyOW+OjXVdkKD8TqRXhnmKXgXukCzbAa9mtfKOldhXLr0JcZpAbHGzM6gV+rbDJmQBXXwNZyAa6DN+R9sMq551hDlNV1OlgDVLz9COcjXp2AIHoFqkL9/gT9AtkkHbdatxmc36b2my8kSsIqBDoBmUzO5HlJBNlLgClCCFOR8uABfgA6w66AVCak5aSHTPppZlcDysYJ80BAjQfK7mvK/9kMSvA3ayGNqnGBVOCnAtE8Zg6sQU0APgMaQKDMb6b3KBM16IfxgiA025jHfc1KAaZ8NjKBN6svL8/hM5cEekP9vWcSFLMIpAZ726fcRicZTifASPAM/Q8i+t97bKQHe7ONNg07b50DngAKvBJ2+tptTAoK1j/bEQ5AMqjhfhs9gn10bOSEgWPtoljVeHDwGL8BKOAcqH2xZyQkBgeyjMZQ2U+B5KDJWQA8tOtiaQYdexAR4s4+Clt8XgUqFtUbQKiVa4HtQmr0NOpX1S4Nn0acVC9jCXQGrfXYxmk5Z/fSx0QhaDydKlTpxzaB1wAlVmzrYQiodPBWFK0D2UWCqcxbAGlDQsod+iLpsmWnHgraK8Cugv79/bnx8/JLBwcHuxMREPZd6tnj+oJpfpfAlj6DNmZY9wp5pX17yK6Cnp2dFSkpKC30u/UUvN9EKqNJMAD09TUrQwa6Aq7W1tSAnJ6eRvoheT0+eG83MMKr/lUUmbKbtrEBsU1NTYX5+/pf06+j1sB3WhvMVRDh/92ehaQHhzGyw146sgJltrBcNDAzE9vb2Lk1PT/+os7PzjeTk5K6EhIQxFvKTnYIdP+zvjQgws02od/OTnUK9le3vS4CroqJicWpqatbQ0JDS4mhLopWUlFTW19dX9dGsn8XFxQ273e626urqn7xkJ9sBhXqhuYlVIeqfCkqHZnPV1tZml5aW1tG/SK/Cy5pGlTb1nKvyIWLNmoVGVsMSSWxzc3NBXl5eA30xvc4B6x6QGFsFmJNqp9Ook7Np51739Qq4ysvL0zIyMjI7Ojraa2pq9JNhxD3vuUqBngeUnYQyTUSzjS97BRKg6/SdqJv50VxvZ+NE0zXBrEA0xTsulnuvCXxAhzz8GwAAAABJRU5ErkJggg==";
a.arrow.whiteOutline="data:image/png;base64,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";
a.arrow.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACx0lEQVRoQ+2Wz2sTQRTH3+xumiaaIKL1IlTUlk38gVAUvKgXFcGCIc0WD2qRHqv25t/gqVLBmyKKSBuCqL1YL570IHhsQopSpXioOUhTktpk9znZmjbUNruZvjUJzB4S2NmZ+Xzf9/tml2HUQGjji0kBTXZPOuC5ARaMw3LwLgQLxc32am0HLLwFmeRD0I0xUOB2ewmw2EWWmZhGPTECCnuwldOt5wDibzCtEyybyqA+eAEUfFsvpi0mABfy5eUj4eybHPbGddDUtFOPtZKAT7CIZ9l8srjY278npHbOA2P+NhGAT2AmOcwATNyfCEAY5gBYlxN8Zbz5DqA5CunUOIdH/k2jQtT4yLlOuoFvrgBEs4wrZ3yZVx8qIByeQTTxmP8NuYVvngDEb0sr5VOhLy8XqrAYid8Bpt5vBN47AYjPeE1LwJSb/wAhvID05A0emVJ1rKTHTmuKz3ai0cubHkDWlzcL30Na4OcaEI8MoBWDTGqqkvfq/fyhWNfODu0HP3HURuG9c2BmsqNSYYwMPLJdQOsdFHMGm3v/qxaSq/BBJDHL4btF4L0RgPCU8YjYjXn4UhgsdR/7OjW7EdBu2ojxnP9eFYX3SADrY+mJz05QqMf7QVFfOz3nNE7fA3/jU29jPHBuFwT25kRzX7s2rYCa+NQVEBmY5r1x3qm6bsaJBTjHBw9e7oHOYNYNnJtnaAW4iU+lsX07xjZ9R7gh3vAMnQCX8anuv/rF6b+3XSGEApzjU4VfPf8HjwFYo7yRrwkUfm0KnQCH+KxDI//mgevbgaY/hbaID4fWeKWP81caKbQHAtbjY0P3XDkKmn+ER2SI4qyv5xZNhJa03eAvdP8vaHoHqAItsA6NAwIbU02RAqgqKbqOdEC0clTzpANUlRRdRzogWjmqedIBqkqKriMdEK0c1TzpAFUlRdeRDohWjmpe2zvwB9rJQuD4In1EAAAAAElFTkSuQmCC";
a.line={};a.line.blackOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAC7klEQVRoQ+1YTYhSURSeZ9GPZjnbXITlBFFuZRZNNulmitqFixZuMphF7VxHbVpIq4gCYRgXFW5aFNVGKanF4C4MWmRJhBEUZYnSQFTfkXfh9rL7fubdezW88HFQ3zvv+94599xzNGYmfBkTzn9mKsDHCB6Er3fANzc+xyEC20D4DhADfgHHgC9ORegWsB1Eb5vEr8JmgQU3InQK4MlfBulPwC7gHHAEWAS6dpHQJcBK/i2I9gD6Pg6sAMvA2jgKGEX+K4j+BELAdXM/nIb9aKbXP3WojoCIPP12DZgDzgOvgf44RcAp+QsgTSlFUaGqJFyqIuCWPJ0FlFK2S4UAaeRJnWwBUsnLFiCdvEwBSsjLEqCMvAwBSsn7LUA5eT8FaCHvlwBt5P0QoJX8RgVoJ78RAXSC3zWbLRpGWPNF/QvfVbLGzHFvY9v8WC7w2krMw89N4CxAbS/r55WS9xoBEr0PeAjQMH4F+K76zbNAeI0Aza70N8iqCZqiaCinYUR62vBZ5FXAJjiZBfabAj7Drqsm7zWF2AtgImgI3wM8Bz4A0jasZf8OPwoj0O12Z0Oh0IF+v/8yEomM+rOJROwAtgADE7Zj4CgiXr8TCmi320djsdhj2EXYJ4KHkB+lxBkXkQCjXq8vpVKpB7AnYB/pIimKjkhAoFqtHs9kMvdhT8JS2XQ0aHtNBy/3TQV4eWt+3jOMAKs2vONerxfodDqHEonEjWazuRyNRl+Ew+E/UkhQnfzkKPQ1FMCqjdunOqhObl26vp4EGIVCYW88Hj88GAy28h52Y2Wz2YuVSuXSeyz+t2AwuN5qtZ4Vi8U3OqsT28RBkNgJbOZIGuVyeSGXy92CPQP71EL0Bz7TqUsHmLbFV6FhNDgmgVqttpROp+/BnoKlc4DfA3RwaTm8+Lc1LaPacsd88H8dASOfz88lk8n5RqOxViqVXo1DzlsjbjfQUHUisFZZd8b89Xw7AXSDtlbZydtyIsCJH23XTLyA36pqaEDt5j1NAAAAAElFTkSuQmCC";
a.line.whiteOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADZUlEQVRoQ2NkGOKAcYi7n2HUA9SKwc+fP2v/+vXrsbCw8CdSzBzwGNi/fz+HjY3N8u/fvyvy8PD8f/z4sZO8vPx7Yj0xoB5YtWoVZ2Bg4LInT57819PT692zZ0+4qampLSmeGDAPIDve0NCw6cOHD2+Aoc5/4sSJNDMzM7uLFy86AsU/EIqJAfEAFsc/BDr0MxBzsrKyqrx8+XLe/fv3M42NjU8MOg/gcPxHoEP/iYuLc58/f34qOzu7IjAfhH758uU1UPw/Pk/QNQbwOd7S0pJz06ZNk5mYmFStrKxyb968eRfo8K+DJgaIdTzQI3m3bt0CJSlQrOANfZDn6BIDZDgeVBf8IxT6dPEALR1Pcw/Q2vE09QA9HE8zD9DL8TTxAD0dT3UP0NvxVPXAQDieah4YKMdTxQMD6XiKPTDQjqfIA4PB8ZR4gPH379/rQD0paGcE1vj6h9yqRGqYEd22Iab9g6yGrMbc7du3LYCd7xmKioopHz9+BDV7we15ejue3BhgzMrKUu7p6dl279695To6Ou1Ag34MhOPJ9QBIH7+3t7f26tWrF7x582aBg4PD1JMnT/aCOiP0SDYUJyGgAcxALAj0hBrIE8D88O7Pnz8/6e14SmIApBfsCU9PTxV3d3f5goKCi0D+CyCmWYbFlsHxZmLgUIcgNze35tevX68LCAhgG2wCeYIHiNmA+BsUE+wGklrS4FOP1wPAoQ0HYEmzH0g7AukDeAwCmUNXh8Pcgs8DjAcPHvS0t7ffCqS9gfT2gXIkuTHABBzq83JxcdkMpH2B9DZQWU/N6KeGWfhiYNQD1AhhQmaAYwBW2iArBo7XMz19+lRHV1d3+uXLlzOlpaWv8PLyoiQhPKUTIXupJg/2AKy0IdVUIkonUo0kWT3IA4ylpaVKKioqNt++fWNHNkEKCMLDw+tXrlzZ+AwIkOW4uLh+3rlz50h3d/e9gSydYJmYC+gIPiBmQXIk48KFC23j4+OXAuloIH0YzaF/gHxQrQuqwAYMIJdC4NhAcgnT3r17PZ2dnTcBaT8gDaoHkPMAqOIakMoLObRGi9EBSztQi4d1DDCmpqaqAifcLE6dOnVi9uzZtwdDmkePcUJ9YlDpBMKwpvJApxgM+wl5AKRhwJrKxIQWMR4gxpwBUzPkPQAAUGXET4yuJQ8AAAAASUVORK5CYII=";
a.line.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABNklEQVRoQ+2XMQrCQBBFd0PAq6itnZcQBBUELfReKRQLEY9ha6mHkTgqsikCgWT274zCpM5M3vt/i42n4ZzcHz/eBJTbswZgBRAdnfeLrvt+ooHSldv8di4e/ck4z3qXLhLqAgE+QHeVUBWowwcJGsx27+O0atOEmkAjfH+6dFl+aAP/eUdFAAWvIoCEFxdAw4sKpIAXE0gFLyKQEj65QGr4pAIS8MkEpOCTCEjCwwWk4aECGvAwAS14iIAmfLSANnycANHe30/r+r2dOt7n2977m96L+x8gP/L347X6kxKGj2ugov5KSCcfPh/XQCXxLJzPNrHHgTOPEeB8GTRjAqAg2WusAXZ0oEFrABQke401wI4ONGgNgIJkr7EG2NGBBq0BUJDsNdYAOzrQoDUACpK95u8beAHJBRXgx8FPkwAAAABJRU5ErkJggg==";
a.rect={};a.rect.blackOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAC4klEQVRoQ+1YMYsTQRS+DYqYEMkpiF60iOQK0VRCsFBykjSnaCFiCotUKfwBqcU6P8AiVQqLyGGhqE2CF7SQgFUUC4MpNKcIajAkcijq94XMsRey2d1xJ5M7d+DjbcjMm/nem/dm3hgLO7wZO3z9Cz4B3R78bz1A4mvAVcUeuA/914A/VvPIeiAIhX1gBfihiMR+6F0HQsDAawKLUPgVOAV8VkTgMPS+Bg4C37wmQKVfgOPAB0UEjkHve+DQyFgTp5HdQpMIUNc+ICBJ6DfGbZr2+8wJhDH5d8nFi2EH8NEb/Zg5gSOY+CNwBvjlksge9H8JHAU+6SIgLBaT8AQt3x6LqZl7wNGEFp6ZFFOO9HkZxI4m9AmMWcD3gOkg87eQn4VcHD7SaW+es1DUFA8ubLGtK+Ooo+skjmDiZWCv5FXiJ8a9Bbq6CPA+w+KD0m16ZsXF+xOLJHGPcpTV3E4k/L1r6gFumQ3ZDW8zbmm0pZQUNCwp7wEZRYsXaqv4uA54XlKyqGfW4Z5nJaWisbJjTDAreV7UM3b4asASUjaO7EgzsFli8tVD7lml2+0uhkKhk/1+/00kErF0o91KVP4/1XrtdnslFos9hbwAua5yIbK6pxEw6vX6aiqVegR5CfLJNFfKLuBfx00jEKhWqxczmcxDyMuQjxUGrDQPn4C06TwaOPSAyDZmnb1eL9DpdE4nEok7zWbzZjQafRUOh7fl/HnITkMCItu4Nco8ZCcSMAqFwol4PH5uMBjwYNpqS2jZbPZWpVK5vYFm/i8YDG62Wq3nxWLxnc7sJIKYVwO+jvEqLJpRLpfP53K5u5A3IJ+NLZTXXr6FWh7zbj0q09+chYbeMCkJ1Gq11XQ6/QDyCiTPAXMM8Hi3POJlFiMzxk+jMlbzcsyu9oCRz+eXk8nk2Uaj8aJUKrHg1r7nx71nd5dndiKYabRmG6ttZ0eA49hn7iy/leu9DCgdupx4QMe6HM/5F9IGOEBp6J2bAAAAAElFTkSuQmCC";
a.rect.whiteOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADAElEQVRoQ+1Yv48SURC+tzljbgkXOMHo7VlguMIolQmx0HAGmtNoYYwUFlQU/gHUxpo/wIKKwgJjLDRqA/GIFobECo3FESmU0wieRLKYiwb8Bm8vK3Fh990uj8N9ycsUu/Pjm5k38+axuQO+2AG3f84FIDqC/20EWK/Xe8AYu+ZkBPr9/kNJkq5DR99ID28EZAhXAWANgn84BGIBOjagwwP5XbsB+CF8G8JPQ/AXhwAchY630LEE+d/sBrAE4V8h/AQEf3QIwAp0fICOI5C/PQkAlI6HsSVOQD3w7ejyfeIAvPDYd07jB2zw9iJIZ1fGxAEcA4BPMOIsDPhlEcg8eF+D9zj4PosCoHksBAOsRmIRAOpDZ2riETCl0CAy/yoKpuTx9gFuhS6AIQ+4EdA1MlM566aQm0J/PDCTVUhBM9rXxQ6NbAXOaYjqxD4oXsU+xHOVAM9P7E3stigA81BMwwdRq+WZJi66P6k68KaqmlVFWg2YmXmAUmbL4s3T7O/LOFObTg00/mazeT8QCCTMWsPzX6vVKgaDwRvgtX2klCFU2c15mqScWDTZ0ZmgqmT7UE9nZwGbRkjeczQONB1sGjHp1YPvWaXdbvs9Hs8pVVXf+Xw+wzCOs8TJ7yO9V6/X10Kh0HPQi6AbThrCK3sUAFYul9djsdgT0Mugz0aFkteA/fKNAiAVi8VLiUTiMegV0KdQ5tSB5cbhAuB2nU2Mgwho1UYvs9PpSI1G40wkErlbrVZvKYryxuv1/pVC01CdBgC0amPVKdNQnQgAy2QyJ8Ph8Plut0uNaW8tYyWTyduFQuHOFpb+myzLO7Va7WU2m30vsjpph5iuBvQuSVdhbbF8Pn8hlUrdA70J+mLIULr+0gucYZu3GlGe//VVaBANnRCpVCqtx+PxR6BXQakP6M8AtXfDFs9jDA+PW0Z5vGYnz0xHgKXT6dVoNHquUqm8yuVyNHALz/nh6I27y1N1ok2VRmi1MUq7cQCIj/6ZOs/v1Xo7D5QIWWYiIMIu0zp/A2/M/kD8slZNAAAAAElFTkSuQmCC";
a.rect.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAxklEQVRoQ+2XwQ2DMBAEcTsUlCJTEO3AF/mROTALQhm+iy7czPmstHX+rNOLn2YDD9vTwMMCpv820JZvSxqoLJghAzYA+jRA892PUIXYr5pn6l16Bmyg22oVIBrYz3SFmGegI+AIOUI7At4DdPP2+RlibqHkFjpqkN6v3CuXrlH6oKO5DRCx1/8jowbvyIfOwB0fSL9hA0QonWsgTZjqa4AIpXMNpAlTfQ0QoXSugTRhqq8BIpTONZAmTPU1QITSuQbShKn+Bvlt99H9PrktAAAAAElFTkSuQmCC";a.rrect={};a.rrect.blackOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAEfklEQVRoQ+2ZX0yWVRzHfVErIQpLl4Y2MdQ5ZWYXaBsOEqZDB1absfKCG7loc04t2trSbLW5iTVtNS/whgt01KamU+cGE6wL46Js1HSG4ir8M/+EERiVfz5fdh59gud9n/P4PvC+uPdsn52H5zl/fr/f+Z3f+Z2XyKgRXiIjXP5RKQUSvYJhrsAklFkN5TALngioXDftT8MB2AWXbPqHpcArTPY5NMEhuAD/2AjgajOW52xYDsWwBvb7jRGGAq8yyXZ4B34GWbIPbvtNPuB7Gn8/CpkwB7bBetgba5x4FZjC4N/BOlNfo/7bCH8noAKSRUo8Bk9DPuyABfB7tLHiUUB9N0MObISLILfR+0eMMLbjS1mtmPrrWf0nw0fQYebxNIjtBF4GkM/K+h/DUegxwpdRb4UZRoloxnO/l/C/wLtw0CiRQb0ENoFW41+vgeJR4HEGlNVfglNwC/Tue6PUj0YQGwUkxzx4H16Ev2A0zIYToAind4NKPApkMdofMA1+NcI+Y5Saab7Z7gPJMR7OgFznMujdc3DefOsKW4GnGFCbdio4m0xhUM8TzDevOaO908a9CgoMnaaRnn8Dfbs+HAr4ThhDIy+D+I4Xjws90IQpBQZYILUCAzaxr8+OBBdSSFUU8owaPgooCil0OlHN1yDxupCEfQHajWCK4d+AMkmdzkHOgaW0/wIKQAekSi6cNEqFHkZ1kB2HDaA0WsLq3RvwNkwHWwOp7zn4BPaADi31XQzKdBeZd0av+5XtBIM68kJpg5KtcbAWlIgpCdNpPBHGeHWK8e4/vl0BncLOWJ/xfBOULIaeSiiZmw9fg+4ESuycTFIpsb7bGkj9lKwpFXcyWqXR+2AF/GC+D9LfdgIvw6mvDrM3QW70OiiRU1IXT1ESp4TuS/gUdoP8P/R0WkLKysoUtQLvwVdQD9rUWvogRa6oTbsKVsIW0ArobuyZSmvweFbAEU7uIp9/Hl6DItAlR3skSJGP6/LSDLpGngXtCblV1BKGAhpcK6FfIZ4EKSQ3CDq2XETuJ4FvwJ8Q1fKORkEn8TOGIo8u5qp1vw1SdCtTJNIPAqqtzpAwFQgibGhtYyrQ1dU1PiMjY3ZPT8+prKws3b6SrsRUoKOjoygnJ+cY9cvUzUknvc9Gi7S0tJQWFhYeol5OfcTWL4dT0VgrkNbY2LispKTkIHUZ9WEEC/pr25DrklJgyE3sM0H/CjjRxt22u7s7rbOzc25eXt7Otra2t7Kzs3/KzMz8nwslQ3TqV8CJNkGtmQzRSQpEqqurp+fm5hb09vbqFL1XnqVUVFR80NDQ8OEFivtbenp6X3t7+7c1NTW6iFidmkENZNPe2cTpNFYu476EROrq6hZVVlbWU6+i1lXRLaiOe+UrvTYTDVUbdxTqXw3XRGlNTU2lxcXFB6jLqXUOuPeAlEmY5R05U2F0qFzDdtyHegUiVVVVM/Lz8xe2traeqK2t1X9QEu7zA1fG7z6g6CQUaRIabaK5lJ8C6qc2SWd5myhku48S2s5mBRIqoN/kdwGt8GRA8pNwxAAAAABJRU5ErkJggg==";
a.rrect.whiteOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFn0lEQVRoQ+1Ya0xcRRTm7vIqD1m6loIsRCqPNEjAhlBM2gBCNAhdXlFQICQgP0zAIIoJoFJTiImAqYLxB/KDAAqSAFKQmEAA6w8gpEqQVB66sixFsViQ8hRYv0PumpXu497upbs1THIy986dOXO+mXPOfHMZq4e8MA+5/VbHAMy9g4LtwNLSkrtUKn2FYRg5JADAHuEDTq1Wr6H/T6i7lpeXP3Nzc/uNy3hBAGxvbydaW1vXTk1N9be2tvZ0dnbeGh8f3+FigKZPSEiITUJCgmdqampcQEBA9O7ubp6dnV2nMR0mA9jY2EjCJFfLysrerKysnMQzreQ2ZN/Y5Ie+i/BuB3EuLCwMLC8vr9rb23vd2dm53ZAekwAMDw/LQkNDR4qLiwtg/AgmWoZsscareQIgWwiEPURaUFAQVlVV9dHY2Nj58PBwlT5dpgBgVldXL6tUKp/AwMB3MMEihNyGdNqyxnDVT2Bpx2g8PdN4j8nJySsymUzh4uJymW2/BwfXCXQtgA18f6S6urq8pKTkG3RYJ+NnZmYueXt7f2Bra+vHguCyEfs7OzszSqXyLT8/v2ussY5wo2eLioreRSyEoe1vXYpMAeAEH12Mjo5+enBw8CaU70Gctra2bjQ3N5fn5OSM61s1HYYw9fX1wenp6W/b29ufw/e7EHFkZOTZ/v7+YbFY7M62CboDEqS8O0iZj0OrkjX29P7+/qJIJPLH+x0+ANDXFWOnMdYDz7/TbkK8McevmMMVzytC78BJKF+Gci8o1gSZJ9pUaHsUbRTQfIoUY29jrAyDFtiBMrTNo02K9z8fBACjExpApGtBjOozJQbua8JjAIdW4HgHDgWxUZ+1eBdCKlQiFVIW0pk1DAHA2NsY662V1YwuiEkuBMaoTE5ODunq6pplDfMAubuO0zgvODiYTmeufIgZHR19DpTkE0dHxwsYR7TESi6X+3Z0dPyAg4xACZ5GJWtra9+2tbUVZmdn97PGShobG19KSUl5AyfqGbgXpwVCrldvbm4q2tvbqzIzM79gDy2mqanpGVDsq2CkF4/iIHOanp6+AkNPgPu8hgmIiBEJOw05BbHmc4qh7y7kDwidwge65ubmPgbf2vT39yeySPTinsJphfQYYpOfn/8UaPRXuMAkpaWlEZ3WMEmixDYQrvppHJE1ouIHjLalpeV8YmJiB8hcQk1Nzffsd0EBkHEnu7u7X46JiSkcGBh4MTY29gbaiNSZUsS9vb3noqKivuzr6/swPj7+cygj/9cZT1xXSJ9BtMruPT09SWClxQjgNnD4ZlwnZ/Py8jb5oKitrT2BwPdFIKc7ODi8ABb6flxcXAd00N1YJ5Um/aYCIB3kLqcyMjKeKC0tTfby8oqEAT6IXyc+ABDHd7EAivn5+cGKiop2BPDPGE8xQW6ltwgBgJTTTtBfCBcWkPg+FodchNyPDF6F/GVo5TWIhAKg2U3KPHQxp5rut3wKXSkpE9EPAao5nSFCAuBjrGB9DQJYWVlxxcl4dn19/aZEIqEblsUVgwAUCkWkj4/PAOoo1IMWZ72RQGOGhoZiIyIielDHoe7l6pcPEqihHRDhIHkeh9Q11JdQfw3D+P5tO3IsxwCOfImNTHCwA5pso90XVFm0sLDwZFBQ0KcTExOvenp6/gha+x8XsoTsdABAk234rqYlZCcCwICynvH19b0ALkKn6L/lMRT8ry/DP//3bqFofwPf2Z6dnf0OdPoXc2YnTRA7wAjiMtqXEKahoeFiVlZWM+p01NcPGUrHPfGVDb47J2R/7Sx0sBtaykWgtLGgyV2o5ajpHNCOAeIqnPiKkAYf1nWcRo9ydbno/l/vAJObm+sXFhYWjn82w3V1dTOW4PN8YoD6UnYioUxj1myjz524XGioj9mzjSkAuMSS2fpw2QGzGcdl4n8AppCQTyfJgBcAAAAASUVORK5CYII=";
a.rrect.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABvklEQVRoQ+2Xv04CQRDGZ0AkgInYGQorG+8ZNNpYoKHQKAW+HwVoLEiksIHoM0BjZQyxUvwDBBDWwQRUTNi7uRFyyWx3uZ3v5vt+u3d7aJysgQAPVAMLpqcEFgwABAkMmmDgDF56FWiUOgh05WHQZIRUJgbJ6C6V5gHCSTflMgaMuYH++z7elbtuHmqbYzbTUYisXAPijm2ugAFKvtdel2p+3PCXieX4o42EfwNmcIj1iytbUpz7xjlJA4Rmavs30OwksFFqT5LbyK1Bon9J19u0BMKuGjdmQPNuoRU5wvv880QrlYlDMtaapeHfQK0Q+rlhzdZphRqnjcgYxlSxXtybGBhtbCc7/FcDWCtQ/9+DDHy4Tn66MyJBBpZ+6VmOOr4J/DHg82zlVU8NeE3MtjO86ikBr4kpgakE5JdQ0F6jEPQPGQgeJV7f4Hj1ofg036MEDA+wdl62bU7O/fkc5iDox+lRtMH+oRkvDiIBmINmtxq8X0rOAheq8f0dEOqDLaMG2NEJFSoBoSDZMkqAHZ1QoRIQCpItowTY0QkVKgGhINkySoAdnVChEhAKki2jBNjRCRUqAaEg2TKBJ/AJEkBG4ESgm30AAAAASUVORK5CYII=";
a.ellipse={};a.ellipse.blackOutline="data:image/png;base64,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";
a.ellipse.whiteOutline="data:image/png;base64,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";
a.ellipse.mask="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACt0lEQVRoQ+1XzWsTQRR/b9M2u6QFLZUUvESQfIkHBU9e6kGpHqqm3XhSvPlx8OZf4VEqehM92bVRK2jBg714EvQgpkkRmotgsYhQl02a7IyTNN2mjcad3UziwuQY3r75fbz35g3SdJZCgH8oCfTZPelAnw0AAQ6QKhByB3BwHtbXVuD7UpmRtJtEQ3BgQoWxaBxodRoU5TaAMuhHhC4SYMCpfQWUgRx+NjbdgKJH9CEgtQxg6JFXIt0i8Bbsr+ex+G7DDfC9MTRxcgRCB1+w/0/xft8FAnQB8kYGd8qEF0Mjnl1GIUjrOQCc4kngjwClH2HZOPEn8L8OTUUjYXUSFJph6I42QCF8AoI5s1JeHF5dWGtzok4ipb8HxGNuSfgiYFrl8b1AaGxiH2hjc4DK6Y4gKHkD1noWS0s/W+MaxDX1Ww8IkAeYf3q99SAreSGmKgMr7huSVMukFtcKz0uteWh65j7Lcc0NCe8O2DSJRaO4fQiNXVVBM38w+zU3BzsxlFpgRUax9LA+brf6IXkpzkrPyd0pn3cCmxsqfnldcQ5N6TcY+Htc4LeDSe0WFnJ3nVyHz4ZhaMQhJIZAfk5hzetssjSlf+Bpvl2g2DDAZeO4Q6De7ukscSOGdwcCT6CthGZusskz60a1tpi+lBDBBBaesInTbLzANTF0aYzalYRWfLna+zHKTgz4RVYf2B1Widi58YgamWTzZJpFbq0SwFYJCvNm2VwcLr1qu20b+1AvV4lm9Qd4mdsp3CCv0851yh405DIooWd8Dxr7Ihu/j93vT7uHsPeL7K8D/x9PyuiZMIzuT/yHT0pPV5jvjwQ44BsTVwJJgEsuAcHSAQGicqWUDnDJJSBYOiBAVK6U0gEuuQQESwcEiMqVUjrAJZeAYOmAAFG5UkoHuOQSECwdECAqV8rAO/Ab29SO4DUnibIAAAAASUVORK5CYII=";
a.pixelate={};a.pixelate.blackOutline="data:image/png;base64,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";
a.pixelate.whiteOutline="data:image/png;base64,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";
a.stamp_accept={};a.stamp_accept.blackOutline="data:image/png;base64,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";
a.stamp_accept.whiteOutline="data:image/png;base64,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";
a.stamp_reject={};a.stamp_reject.blackOutline="data:image/png;base64,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";
a.stamp_reject.whiteOutline="data:image/png;base64,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";
a.stamp_exclaim={};a.stamp_exclaim.blackOutline="data:image/png;base64,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";
a.stamp_exclaim.whiteOutline="data:image/png;base64,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";
a.stamp_perfect={};a.stamp_perfect.blackOutline="data:image/png;base64,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";
a.stamp_perfect.whiteOutline="data:image/png;base64,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";
a.stamp_question={};a.stamp_question.blackOutline="data:image/png;base64,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";
a.stamp_question.whiteOutline="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAGt0lEQVRoQ+1ZeWwUVRj/ZvaY7kW30IM2ZUWhWlogGqVAUFEkJF4h/AF4JdyYmCAClVMERC0NYECMGKgKIUERSLQaiQXKYYK2Wq6mHLZAraUUuqVlt93Z2e7s+H3T3e1Suju7bMtC0pe8fH0z7735/b7rfW/LwAPemAccP9w3BOx2e5LJZGqIVKExJyBJEmFgfb2qqgoyMjKEcInEnEC4QIPN6yUQrQajXd9rgWg1GO36XgtEq8Fo1/daIFoNRru+1wKhNIhlQorb45nW6vRM1mlVmVo1Y6T5LrfUyrvEc4Y4dr+aZXcyDFN/t5boEQsgcJNDEPM5DTvnRCUvHjrbwp2rFeCGzS3jTDKpIXsAB+OHG4VRg3Ws4PIUGHWqJUjEHimRbieA4LMcgudQeY3QL++nBm2NtS0kJkuiBpZPTHINtXBWPce+gCQuREKiWwkQeKFNKik40mT45kgTI0kdUEw6Fvqb1fKD+mY32HmP/yWDKGY9nyDNHpfQgm6WEwmJiAkgyEQbL34mATPGWwL7geg0TPJXB2/qdhxr9u87NssAb49PgEdTOUBy8lxOw8CFqwJsO9wEx8+3+tcjAWn6WPM1tERmuO4UEQEEPxjd48TRitaEwpN2tadDiTIIEVV+utoJpHnUJKydkgzPDDEAh3+TlgMbzRHcEhypaIXVe29Am4gqwTlbZ6a5stK1X5v06nfCcaWwCSD4vgi+fG+JLXXzr42K6/LfSIGnM/Wg09JdRc48sgVYHBq49mfUeJcHjp5zwIrvr8tjiol9Cwa0qVWMJZzspAiENkXwqhanePyPf/icpd9dVwf6dldaGjfUAB9PTYE4dBVq59Fd5u+4Bla7KI+HW+Jg9eRkGJikkcdEbMnu63532jwjVRidEbdKo1LlK1khLAJ2vu2TphZp0Wuf13KkMaW2Z/4AGNxf63ebKZv+g6p6F4x5TA/GOBZ+O9MCmWkc7H43Xd6KFEIk3/qiVh6/+qQJFr7c92+zQTNC6VuKBFD7T6F/nnhzS62GQCi1eL0KDn0wEFQdXgJ/XeLlZSMG6cCG2ee5NVdkcmV5g/zbiaiXcWuvyNnpkWQtkXPgOWJQ+p4iAYdT/HdbcZNl57Fmpb3k91npHGybmwZ6r+8HLqptbIOC4iYoLLPDsxjcm6b19792ohtN+7IWKq+5gFLusVUPI8nOoX8nBEUCNt69q+ySc+rCXfXtDqvQQhEYvfKy7O/kSnmvp8ju5Gu8S4LpW3uAALqQ2eHyXFmzr8F88GyLEn7oyoV8i3JWXIaUeDX8vNhyxz495kL0JbdbmuR0e/ZM2lCj8WWSUEw6BzHNpTSaX2iVtb7gpX63Le/RIPZ9qVVw/3Cxtm3inIKr2s4HWGcyndMovafgHIvBS+3kuo7gpTG51eLd9fD7eYf8vrvSKON0OserVKrHRVE8XV1d/Wf6Qxln8AR+aH2hNSDHdG2LzgcZBWnej+2/HK7BM6DD93vmIKPgVtlstkV9+vRZh3Ipyo2NjY2pOlNC2YGT9oT9pTa1J6BYI0AYL1CJqfZ+KCVIw1xDQ0NuUlLSRyg/RLmBrI0gk20OcTvLMqNwfFsWwyLNtLXopkapmKM66WLdncXcLCzmZnRTMadCcIaamppci8WyEuValESASsf2eqCLhuSGoD+Xfnu0ybC9OLJyeiaW03O6sZymwt1YWVn5Pv5SvBzlpyjX4zPKo+3XqhAksOg7HOsLDREweQksQ5nnJUBXvpAEvLFg9F4p596LK6U/2/gzA8+zPM9zVqtVl52dvbSiomJdYmIir9PpBOy+ak4SBOGU0WgspvgN4lL35FKvbm5uzjWbzXmhXKOrd7huGa6j2KC46JJEpHtGOp+ySFx5efmL8fHxT6BGKXgZl8vFeDweNVpBnZOT815paekm1LybZVm3VqsloBLHceKtW7dODRs27ACOqUxVrrMjRRfGfCKgp4D1dg6lTAK7pqSkZPrIkSPnodyCcgc+o58YiABpnP4NREFNnf4Omp3CwHHXU2QLeEnoUGqx0xlAzznU/GyfBVAWeIESAdI2aZ0KfTr/Y2oByjhUKlP3gScr6NG15qGL5KLcgHKLF6zP34kEWYR6TGOAtB3YyZzyOYDZZ5EvC6Hc6HUXXxqVYyGg37UbRLMw2IUmqnMgGkCRrg1FwFhUVPRKWlra8Lq6urMTJkz4pZMFIv1Wj8wPRkCuhbCbKJi9wUuncMhaqEcQKmwajIBcjWKnzETuRH5PGYfSZUzyfTAewQjI9wEveCJDoIlEzLJNpARofmBminm2CUbgf3JePV57Zv76AAAAAElFTkSuQmCC";
return b});
define("surface/cursor/Cursor","require util/Class util/Color util/Img async/Promise graphics/CanvasGraphics env/Device env/Settings surface/cursor/CursorData log/Logger".split(" "),function(b){function a(){this.maskPromise=this.whiteOutlinePromise=this.blackOutlinePromise=null;this.x=10;this.y=36;this.color=new c("#ffffff");this.cssValue=null}var l=b("util/Class"),c=b("util/Color"),h=b("util/Img"),i=b("async/Promise"),g=b("graphics/CanvasGraphics");b("env/Device");var f=b("env/Settings"),k=b("surface/cursor/CursorData");
b("log/Logger").instance("surface.cursor.Cursor");a.path="../cursors/";a.imagePromises=function(a){return{blackOutlinePromise:h.loadAsync(k.forName(a).blackOutline),whiteOutlinePromise:h.loadAsync(k.forName(a).whiteOutline),maskPromise:k.forName(a).mask?h.loadAsync(k.forName(a).mask):i.wrap()}};a.imagePromisesFromDisk=function(b,c){return{blackOutlinePromise:h.loadAsync(a.path+"cursor_"+b+(c?"":"_blackoutline")+".png"),whiteOutlinePromise:h.loadAsync(a.path+"cursor_"+b+(c?"":"_whiteoutline")+".png"),
maskPromise:c?i.wrap():h.loadAsync(a.path+"cursor_"+b+"_mask.png")}};a.attachDefault=function(a,b){a.style.cursor=b||"default"};a.pregen=function(){function b(a){Object.keys(f.COLORS).forEach(function(b){b!="transparent"&&e(a,new c(f.COLORS[b]))})}function e(b,d){var e=new a(a.imagePromisesFromDisk(b,d==null));e.color=d||new c("#ffffff");var f=new Image;e.dataUrlAsync().done(function(a){f.src=a});e.color.equals(new c("#ffffff"))&&e.blackOutlinePromise.then(function(a){g.push("urls."+b+" = {};");g.push("urls."+
b+".blackOutline = '"+h.convertImageToDataURL(a)+"';");return e.whiteOutlinePromise}).then(function(a){g.push("urls."+b+".whiteOutline = '"+h.convertImageToDataURL(a)+"';");return e.maskPromise}).done(function(a){a&&g.push("urls."+b+".mask = '"+h.convertImageToDataURL(a)+"';");j++;j==i.length+k.length&&document.write(g.join("\n"))});document.body.appendChild(f)}var g=[],j=0,i=["marker","highlighter","text","arrow","line","rect","rrect","ellipse"];i.forEach(function(a){b(a)});var k=["pixelate","stamp_accept",
"stamp_reject","stamp_exclaim","stamp_perfect","stamp_question"];k.forEach(function(a){e(a)})};a.prototype={initialize:function(){},dataUrlAsync:function(){var a=this,b=new i,f=48/g.pixelRatio,j=48/g.pixelRatio,h=g.create(f,j),k=h.context.globalCompositeOperation,n=c.isDark(this.color)?this.whiteOutlinePromise:this.blackOutlinePromise;this.maskPromise.done(function(c){if(c!=null){h.drawImage(c,0,0,f,j);h.context.globalCompositeOperation="source-out";h.fillStyle(a.color.toRGBA());h.fillRect(0,0,f,
j);h.context.globalCompositeOperation=k;n.done(function(a){h.drawImage(a,0,0,f,j);b.resolve(h.context.canvas.toDataURL("image/png"))})}else n.done(function(a){b.resolve(a.src)})});return b},attach:function(a){var b=this;this.cssValue?a.style.cursor=this.cssValue:this.dataUrlAsync().done(function(c){a.style.cursor='url("'+c+'") '+b.x+" "+b.y+", crosshair"})}};return a=l.define(a)});
define("surface/controller/KeyHandlers","require util/Class util/Box graphics/Point env/Settings surface/action/DrawAction log/Logger".split(" "),function(b){function a(){this.tools=this.surface=this.controller=null}function l(a){return a.shiftKey?g.PAN_STEP_LARGE:a.altKey?g.PAN_STEP_SMALL:g.PAN_STEP}var c=b("util/Class"),h=b("util/Box"),i=b("graphics/Point"),g=b("env/Settings"),f=b("surface/action/DrawAction"),k=b("log/Logger").instance("surface.controller.KeyHandlers");a.prototype.onControlKeyDown=
function(){!this.controller.shiftKey&&(!this.controller.altKey&&!this.controller.metaKey)&&this.controller.useTool("pan")};a.prototype.onControlKeyUp=function(){this.controller.using("pan")&&this.controller.usePreviousTool()};a.prototype.onShiftKeyDown=function(){};a.prototype.onShiftKeyUp=function(){};a.prototype.onAltKeyDown=function(){};a.prototype.onAltKeyUp=function(){};a.prototype.onMetaKeyDown=function(){};a.prototype.onMetaKeyUp=function(){};a.prototype.onDeleteKeyDown=function(a){a.preventDefault();
this.controller.fire("elementsdeleted",this.tools.select.deleteSelectedElements())};a.prototype.onZeroKeyDown=function(a){if(a.ctrlKey||a.metaKey){a.preventDefault();this.surface.fit()}};a.prototype.onOneKeyDown=function(a){if(a.ctrlKey||a.metaKey){a.preventDefault();this.surface.resetZoomPan()}};a.prototype.onPlusKeyDown=function(a){var b=a.shiftKey?g.ZOOM_STEP_LARGE:a.altKey?g.ZOOM_STEP_SMALL:g.ZOOM_STEP,c=this.surface.getCenter();if(a.ctrlKey||a.metaKey){a.preventDefault();this.surface.zoom(1+
b,i(c.x,c.y,"dom").relativeTo("surface"))}};a.prototype.onMinusKeyDown=function(a){var b=a.shiftKey?g.ZOOM_STEP_LARGE:a.altKey?g.ZOOM_STEP_SMALL:g.ZOOM_STEP,c=this.surface.getCenter();if(a.ctrlKey||a.metaKey){a.preventDefault();this.surface.zoom(1/(1+b),i(c.x,c.y,"dom").relativeTo("surface"))}};a.prototype.onLeftArrowKeyDown=function(a){var b=l(a);a.preventDefault();if(this.tools.select.hasSelection()){this.tools.select.elements.forEach(function(a){a.move({x:-b,y:0})});this.surface.foreground.render()}else this.surface.pan({x:b,
y:0})};a.prototype.onRightArrowKeyDown=function(a){var b=l(a);a.preventDefault();if(this.tools.select.hasSelection()){this.tools.select.elements.forEach(function(a){a.move({x:b,y:0})});this.surface.foreground.render()}else this.surface.pan({x:-b,y:0})};a.prototype.onUpArrowKeyDown=function(a){var b=l(a);a.preventDefault();if(this.tools.select.hasSelection()){this.tools.select.elements.forEach(function(a){a.move({x:0,y:-b})});this.surface.foreground.render()}else this.surface.pan({x:0,y:b})};a.prototype.onDownArrowKeyDown=
function(a){var b=l(a);a.preventDefault();if(this.tools.select.hasSelection()){this.tools.select.elements.forEach(function(a){a.move({x:0,y:b})});this.surface.foreground.render()}else this.surface.pan({x:0,y:-b})};a.prototype.onEscapeKeyDown=function(a){this.controller.using("crop")?this.tools.crop.cancelCrop():this.controller.fire("keyesc",a)};a.prototype.onEnterKeyDown=function(a){if(this.controller.using("crop")){a.preventDefault();a.stopImmediatePropagation();this.tools.crop.applyCrop()}};a.prototype.onBackspaceKeyDown=
function(a){a.preventDefault();this.onDeleteKeyDown(a);this.controller.fire("keybackspace",a)};a.prototype.onSpacebarKeyDown=function(){this.controller.isSpacebarDown=true};a.prototype.onSpacebarKeyUp=function(){this.controller.isSpacebarDown=false};a.prototype.onYKeyDown=function(a){if(a.ctrlKey||a.metaKey){a.preventDefault();a.stopImmediatePropagation();this.controller.redo()}};a.prototype.onZKeyDown=function(a){if(a.metaKey&&a.shiftKey){a.preventDefault();a.stopImmediatePropagation();this.controller.redo()}else if(a.ctrlKey||
a.metaKey){a.preventDefault();a.stopImmediatePropagation();this.controller.undo()}};a.prototype.onSKeyDown=function(a){if(a.ctrlKey||a.metaKey){a.preventDefault();this.surface.dom.focus();this.surface.exportAsync().done(function(a){var b=new Blob([a.bytes],{type:a.mime});saveAs(b,(a.name||"skitch")+"."+a.extension)}).fail(function(a){k.error("Unable to export surface image");k.error(a)})}};a.prototype.onCKeyDown=function(a){if(a.ctrlKey||a.metaKey)if(this.tools.select.hasSelection()){this.controller.copied.splice(0);
this.tools.select.elements.forEach(function(a){this.controller.copied.push(a.clone())}.bind(this))}else if(typeof Windows!=="undefined"){var b=new Windows.ApplicationModel.DataTransfer.DataPackage;this.surface.updateBufferLayer(false);var a=Graphics.create(this.surface.layers.buffer.graphics.getWidth(),this.surface.layers.buffer.graphics.getHeight()),c=a.context.canvas;a.drawImage(this.surface.layers.buffer.graphics.context.canvas,0,0);c.toBlob(function(a){if(a.msDetachStream){b.setBitmap(Windows.Storage.Streams.RandomAccessStreamReference.createFromStream(a.msDetachStream()));
try{Windows.ApplicationModel.DataTransfer.Clipboard.setContent(b)}catch(c){k.error("Error copying content to Clipboard: "+c+". Try again.")}}})}};a.prototype.onVKeyDown=function(a){if((a.ctrlKey||a.metaKey)&&this.controller.copied){this.controller.tools.select.unselectAll();for(var b in this.controller.copied){a=this.controller.copied[b];a.move({x:40,y:40});var c=this.surface.getBox(),j=a.calculateBox(this.surface);if(!h.containsBox(c,j)){a.move({x:-40,y:-40});a.move({x:0,y:40});j=a.calculateBox(this.surface);
if(!h.containsBox(c,j)){a.move({x:0,y:-40});a.move({x:40,y:0});h.containsBox(c,j)||a.move({x:-40,y:0})}}this.surface.layers.foreground.addElement(a);this.controller.activeTool.fire("action",this.controller.activeTool,new f({element:a}));this.tools.select.select(a);this.controller.copied[b]=a.clone()}}};a.prototype.onAKeyDown=function(a){if(a.ctrlKey||a.metaKey){a.preventDefault();a.shiftKey||this.tools.select.selectAll()}};a.prototype.onRKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};
a.prototype.onUKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};a.prototype.onOKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};a.prototype.onLKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};a.prototype.onKKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};a.prototype.onMKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};a.prototype.onHKeyDown=function(a){(a.ctrlKey||
a.metaKey)&&a.shiftKey&&a.preventDefault()};a.prototype.onXKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};a.prototype.onTKeyDown=function(a){(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.preventDefault()};return a=c.define(a)});
define("surface/controller/Controller","require util/Obj util/Class util/Img env/Settings surface/action/DeleteAction surface/action/StyleAction surface/tool/Tool surface/tool/CropTool surface/tool/ZoomTool surface/tool/SelectTool surface/tool/ArrowTool surface/tool/EllipseTool surface/tool/HighlighterTool surface/tool/LineTool surface/tool/PenTool surface/tool/PixelateTool surface/tool/RectangleTool surface/tool/RoundedRectangleTool surface/tool/TextTool surface/tool/StampTool surface/tool/MeasurementTool surface/element/Arrow surface/element/stamp/ApproveStamp surface/element/stamp/ExclaimStamp surface/element/stamp/PerfectStamp surface/element/stamp/QuestionStamp surface/element/stamp/RejectStamp surface/element/Text surface/element/BubbleText surface/element/stamp/Stamp util/Color util/Box surface/cursor/Cursor graphics/Space graphics/Point log/Logger util/Transformer surface/controller/KeyHandlers".split(" "),function(b){function a(){this.spaces=
this.surface=null;this.pointerIds=[];this.pointers=[];this.activeScale=this.activePoint=this.activeElement=this.activeSize=this.activeColor=this.activeTool=this.activePointerId=this.activePointer=this.defaultTool=this.tools=this.previousTool=this.gesture=null;this.eventsEnabled=true;this.history={undo:null,redo:null};this.boundControl=null;this.highlighterColorOverriden=this.moved=false;this.lastRememberedSizeBeforeSelection=this.lastRememberedColorBeforeSelection=null;this.autoresize=true;this.metaKey=
this.altKey=this.ctrlKey=this.shiftKey=false;this.copied=[];this.allowZoom=true;this.keyHandlers=null;this.isShiftDown=false;this.startPoint=null;this.editingOnLastPointerDown=this.selectionChanged=false;this.registerEvents("elementsdeleted","toolchanged","toolstarted","toolupdated","toolstopped","toolaction","requestUndoEnable","requestUndoDisable","requestRedoEnable","requestRedoDisable","requestTrashEnable","requestTrashDisable","requestSizeChange","requestColorChange","keyesc","keybackspace")}
b("util/Obj");var l=b("util/Class");b("util/Img");var c=b("env/Settings");b("surface/action/DeleteAction");b("surface/action/StyleAction");b("surface/tool/Tool");var h=b("surface/tool/CropTool"),i=b("surface/tool/ZoomTool"),g=b("surface/tool/SelectTool"),f=b("surface/tool/ArrowTool"),k=b("surface/tool/EllipseTool"),d=b("surface/tool/HighlighterTool"),e=b("surface/tool/LineTool"),o=b("surface/tool/PenTool"),j=b("surface/tool/PixelateTool"),m=b("surface/tool/RectangleTool"),p=b("surface/tool/RoundedRectangleTool"),
n=b("surface/tool/TextTool"),r=b("surface/tool/StampTool");b("surface/tool/MeasurementTool");var w=b("surface/element/Arrow"),y=b("surface/element/stamp/ApproveStamp"),z=b("surface/element/stamp/ExclaimStamp"),B=b("surface/element/stamp/PerfectStamp"),t=b("surface/element/stamp/QuestionStamp"),C=b("surface/element/stamp/RejectStamp"),A=b("surface/element/Text"),u=b("surface/element/BubbleText"),v=b("surface/element/stamp/Stamp"),x=b("util/Color");b("util/Box");var s=b("surface/cursor/Cursor"),D=b("graphics/Space"),
E=b("graphics/Point");b("log/Logger").instance("surface.Controller");var q=c.EVENTS,F=b("util/Transformer"),G=b("surface/controller/KeyHandlers");a.prototype={initialize:function(){this.initSpaces();this.initHistory();this.initGesture();this.initTools();this.initEvents();this.initKeyHandlers()},initSpaces:function(){function a(b){E.spaces[b.name]=new D(b)}a({name:"dom"});a({name:"surface",transformable:this.surface});a({name:"background",transformable:this.surface.background});a({name:"foreground",
transformable:this.surface.foreground});a({name:"active",transformable:this.surface.active});a({name:"buffer",transformable:this.surface.buffer});a({name:"document"});this.surface.background.on("boxchanged",function(a,b){var c=this.surface.background.transformation.concat();F.translateBy(c,b.left,b.top);E.spaces.document.transformation=c},this);this.surface.background.on("transformed",function(a){var a=a.concat(),b=this.surface.background.getBox();F.translateBy(a,b.left,b.top);E.spaces.document.transformation=
a},this);a({name:"content"});this.surface.on("boxchanged",function(a){var b=this.surface.transformation.concat();F.translateBy(b,a.left,a.top);E.spaces.content.transformation=b},this);this.surface.on("transformed",function(a){var a=a.concat(),b=this.surface.getBox();F.translateBy(a,b.left,b.top);E.spaces.content.transformation=a},this);a({name:"clip"});this.surface.on("clipchanged",function(a){var b=this.surface.background.transformation.concat(),c=this.surface.background.getBox();F.translateBy(b,
c.left,c.top);E.spaces.document.transformation=b;b=E.spaces.document.transformation.concat();F.translateBy(b,a.left,a.top);E.spaces.clip.transformation=b},this);this.surface.on("transformed",function(){var a=E.spaces.document.transformation.concat(),b=this.surface.getClip();F.translateBy(a,b.left,b.top);E.spaces.clip.transformation=a},this)},initHistory:function(){this.history.undo=[];this.history.redo=[]},initGesture:function(){this.gesture=typeof MSGesture!=="undefined"?new MSGesture:{pointers:[],
addPointer:function(){}}},initTools:function(){var a=this.surface;this.tools={zoom:new i({name:"zoom",surface:a,cursor:new s({cssValue:"move"})}),pan:new i({name:"pan",surface:a,cursor:new s({cssValue:"move"})}),crop:new h({name:"crop",surface:a,cursor:new s({cssValue:"default"})}),select:new g({name:"select",surface:a,cursor:new s({cssValue:"default"})}),pen:new o({name:"marker",surface:a,cursor:new s(s.imagePromises("marker"))}),highlighter:new d({name:"highlighter",surface:a,cursor:new s(s.imagePromises("highlighter"))}),
text:new n({name:"text",surface:a,cursor:new s(s.imagePromises("text"))}),arrow:new f({name:"arrow",surface:a,cursor:new s(s.imagePromises("arrow"))}),ellipse:new k({name:"ellipse",surface:a,cursor:new s(s.imagePromises("ellipse"))}),pixelate:new j({name:"pixelate",surface:a,cursor:new s(s.imagePromises("pixelate",true))}),line:new e({name:"line",surface:a,cursor:new s(s.imagePromises("line"))}),rectangle:new m({name:"rectangle",surface:a,cursor:new s(s.imagePromises("rect"))}),roundedRectangle:new p({name:"roundedRectangle",
surface:a,cursor:new s(s.imagePromises("rrect"))}),stampAccept:new r({type:y,name:"stampAccept",surface:a,icon:"green",cursor:new s(s.imagePromises("stamp_accept",true))}),stampExclaim:new r({type:z,name:"stampExclaim",surface:a,icon:"orange",cursor:new s(s.imagePromises("stamp_exclaim",true))}),stampQuestion:new r({type:t,name:"stampQuestion",surface:a,icon:"blue",cursor:new s(s.imagePromises("stamp_question",true))}),stampReject:new r({type:C,name:"stampReject",surface:a,icon:"red",cursor:new s(s.imagePromises("stamp_reject",
true))}),stampPerfect:new r({type:B,name:"stampPerfect",surface:a,icon:"pink",cursor:new s(s.imagePromises("stamp_perfect",true))})};this.tools.marker=this.tools.pen;this.defaultTool=this.tools.arrow},initEvents:function(){var a=this.surface,b=c.USE_HAMMER?Hammer:$;this.boundControl=this.control.bind(this);this.boundOnDragOver=this.onDragOver.bind(this);this.boundOnDrop=this.onDrop.bind(this);a.foreground.on("elementselectionschanged",this.onForegroundElementSelectionsChanged,this);a.foreground.on("elementremoved",
this.onForegroundElementRemoved,this);$(window).on(q.resize,this.boundControl);a.dom.addEventListener(q.drop,this.boundOnDrop,false);a.dom.addEventListener(q.dragover,this.boundOnDragOver,false);$(a.dom).attr("touch-action","none").on([q.pointerdown,q.pointerup,q.pointermove,q.pointerout,q.pointerover,q.doubleclick,q.contextmenu].join(" "),this.boundControl);$(document).on([q.mousewheel,q.keydown,q.keyup,q.keypress].join(" "),this.boundControl);b(a.dom,{drag_min_distance:1}).on([q.tap,q.doubletap,
q.inertiastart,q.hold,q.dragstart,q.drag,q.dragend,q.gesturestart,q.gesturechange,q.gestureend].join(" "),this.boundControl)},initKeyHandlers:function(){this.keyHandlers=new G({surface:this.surface,tools:this.tools,controller:this})},getStampToolFromElement:function(a){if(a instanceof y)return this.tools.stampAccept;if(a instanceof z)return this.tools.stampExclaim;if(a instanceof B)return this.tools.stampPerfect;if(a instanceof t)return this.tools.stampQuestion;if(a instanceof C)return this.tools.stampReject},
onForegroundElementRemoved:function(a,b){this.tools.select.unselect(b)},destroy:function(){var a=this.surface,b=c.USE_HAMMER?Hammer:$;$(window).off(q.resize,this.boundControl);a.dom.removeEventListener(q.drop,this.boundOnDrop);a.dom.removeEventListener(q.dragover,this.boundOnDragOver);$(a.dom).off([q.pointerdown,q.pointerup,q.pointermove,q.pointerout,q.pointerover,q.doubleclick,q.contextmenu].join(" "),this.boundControl);$(document).off([q.mousewheel,q.keydown,q.keyup,q.keypress].join(" "),this.boundControl);
b(a.dom).off([q.tap,q.doubletap,q.inertiastart,q.hold,q.dragstart,q.drag,q.dragend,q.gesturestart,q.gesturechange,q.gestureend].join(" "),this.boundControl)},onDragOver:function(a){a.preventDefault();a.dataTransfer.dropEffect="copy"},onDrop:function(a){a.preventDefault();if(a=a.dataTransfer&&a.dataTransfer.files[0]){this.surface.reset();this.surface.importAsync(a).done(function(){this.surface.fit()}.bind(this))}},reset:function(){this.history.undo.splice(0);this.history.redo.splice(0);this.fire("requestUndoDisabled");
this.fire("requestRedoDisabled")},setColor:function(a){this.activeColor=c.COLORS[a];this.lastRememberedColorBeforeSelection=this.activeColorName=a;if(this.activeTool)this.activeTool.color=this.activeColor;if(this.activeTool===this.tools.highlighter)this.highlighterColorOverriden=true;if(this.activeTool&&this.activeTool.cursor){this.activeTool.cursor.color=new x(this.activeColor);this.activeTool.cursor.attach(this.surface.dom)}},setSize:function(a){this.lastRememberedSizeBeforeSelection=this.activeSize=
a;if(this.activeTool)this.activeTool.size=this.activeSize},saveAction:function(a){this.history.undo.push(a);this.history.redo.splice(0);this.fire("requestUndoEnable");this.fire("requestRedoDisable")},undo:function(){if(!this.tools.crop.isCropping){var a;a=this.history.undo;if(a.length>0){a=a.pop();this.history.redo.push(a);a.undo()}this.history.undo.length===0&&this.fire("requestUndoDisable");this.history.redo.length>0&&this.fire("requestRedoEnable");this.tools.select.elements.length==0&&this.fire("requestTrashDisable");
this.adjustForInfiniteCanvas()}},redo:function(){if(!this.tools.crop.isCropping){var a;a=this.history.redo;if(a.length>0){a=a.pop();this.history.undo.push(a);a.run()}this.history.redo.length===0&&this.fire("requestRedoDisable");this.history.undo.length>0&&this.fire("requestUndoEnable");this.adjustForInfiniteCanvas()}},useTool:function(a){var b=this.surface.active;typeof a==="string"&&this.tools[a]&&(a=this.tools[a]);if(!a||this.activeTool===a)return this.activeTool;if(this.activeTool&&this.activeTool.started){this.activeTool.stop(this.activePoint);
this.activeTool.afterStop()}if(this.activeTool){this.activeTool.off("started",b.onActiveToolStarted);this.activeTool.off("updated",b.onActiveToolUpdated);this.activeTool.off("stopped",b.onActiveToolStopped);this.activeTool.off("action",this.onActiveToolAction)}if(!this.using("select")&&!this.using("pan")&&!this.using("zoom"))this.previousTool=this.activeTool;this.activeTool=a;if(this.previousTool!=null){this.activeTool.isShiftDown=this.previousTool.isShiftDown;this.previousTool.isShiftDown=false}this.activeTool.color=
this.activeColor;this.activeTool.size=this.activeSize;if(this.activeTool.cursor){this.activeTool.cursor.color=new x(this.activeTool.color||"#000000");this.activeTool.cursor.cssValue?s.attachDefault(this.surface.dom,this.activeTool.cursor.cssValue):this.activeTool.cursor.attach(this.surface.dom)}else this.activeTool===this.tools.select?s.attachDefault(this.surface.dom,"move"):s.attachDefault(this.surface.dom);a.on("started",this.onActiveToolStarted,this);a.on("updated",this.onActiveToolUpdated,this);
a.on("stopped",this.onActiveToolStopped,this);a.on("action",this.onActiveToolAction,this);this.fire("toolchanged",a);if(a===this.tools.highlighter){if(this.previousTool!==this.tools.select&&this.previousTool!==this.tools.zoom)this.lastHighlighterColor=this.activeColorName;if(this.highlighterColorOverriden===false){this.setColor("yellow");this.fire("requestColorChange","yellow");this.highlighterColorOverriden=false}}else if(a!==this.tools.select&&a!==this.tools.zoom&&this.lastHighlighterColor){this.setColor(this.lastHighlighterColor);
this.fire("requestColorChange",this.lastHighlighterColor);this.highlighterColorOverriden=false;this.lastHighlighterColor=null}this.previousTool&&this.previousTool.release(this.activePoint,this.activeScale);this.activeTool&&this.activeTool.use(this.activePoint,this.activeScale);return a},usePreviousTool:function(){this.previousTool?this.useTool(this.previousTool):this.useTool(this.defaultTool)},using:function(a){typeof a==="string"&&this.tools[a]&&(a=this.tools[a]);return this.activeTool===a},processStampHit:function(a,
b){if(a.selected&&!this.activeHandle){if(a.label.hitTestHandle(this.activePoint)){a.label.deleteLabel();return false}if(a.label.hitTest(this.activePoint)){this.useTool("text");this.once("toolstopped",this.useTool.bind(this,this.previousTool.name),this);this.activeTool.element=a.label.text}else b&&this.useTool("select")}else b&&this.useTool("select")},switchTool:function(){var a=!this.activeTool.started||this.activeTool.started&&this.activeElement!==this.activeTool.element;if(!this.using("pan"))if(this.activeElement){if(this.activeElement instanceof
v)return this.processStampHit(this.activeElement,a);a&&this.useTool("select")}else{a=this.tools.select.elements.length;this.tools.select.unselectAll();this.selectionChanged=this.tools.select.elements.length!==a;if(this.using("select")){this.usePreviousTool();if(this.selectionChanged)return false}}},switchCursor:function(){this.activeTool instanceof n&&this.activeTool.started?s.attachDefault(this.surface.dom):this.activeHandle?s.attachDefault(this.surface.dom):this.activeElement?s.attachDefault(this.surface.dom,
"move"):this.using("select")?this.previousTool.cursor.attach(this.surface.dom):this.activeTool.cursor.attach(this.surface.dom)},onActiveToolStarted:function(a){this.fire("toolstarted",a)},onActiveToolUpdated:function(a){this.fire("toolupdated",a)},onActiveToolStopped:function(a){this.fire("toolstopped",a)},onActiveToolAction:function(a,b){this.saveAction(b);this.adjustForInfiniteCanvas()},adjustForInfiniteCanvas:function(){c.ENABLE_INFINITE_CANVAS?this.surface.expandClip():this.surface.removeElementsOutsideClip(this.surface.getClip());
this.surface.render()},control:function(a){if(this.eventsEnabled){this.updateState.apply(this,arguments);this.handleNativeEvent.apply(this,arguments)}},updateState:function(a){var b=a.originalEvent||a;if(!(b.detail==8||b.detail==10)){this.updatePointerState(a);this.updateGestureState(a);if(!(b instanceof KeyboardEvent||b.type=="resize"))this.activePoint=this.calculateActivePoint(b,$(this.surface.dom).offset());if(!this.activeTool.started||this.using("text"))this.activeHandle=(this.activeElement=this.surface.foreground.getElement(this.activePoint))&&
this.activeElement.selected&&this.activeElement.getHandle(this.activePoint)}},updatePointerState:function(a){var b=a.originalEvent||a,c=this.pointers,e=this.pointerIds,d=b.pointerId,f;this.previousPointers=c.concat();if(a.type===q.pointerdown){e.push(d);c.push(b)}f=e.indexOf(d);if(f>-1){this.activePointer=c[f];this.activePointerId=d;if(a.type===q.pointerup||a.type===q.pointerout){e.splice(f,1);c.splice(f,1)}else c[f]=b}},updateGestureState:function(a){var b=a.originalEvent||a,e=this.pointers;if(typeof b.pageX!==
"number"&&b.gesture){b.pageX=b.gesture.center.pageX;b.pageY=b.gesture.center.pageY}if(e.length===0)this.prevGestureScale=null;else if(e.length>1&&b.gesture&&b.gesture.scale&&a.type===q.gesturechange){this.activeScale=this.prevGestureScale?b.gesture.scale/this.prevGestureScale:1;this.prevGestureScale=b.gesture.scale}else this.activeScale=b.scale;if(a.type===q.pointerdown){if(!this.gesture.target)this.gesture.target=this.surface.active.dom;if(a.target===this.gesture.target&&(this.pointers.length===
1||this.pointers.length<=c.MAX_POINTERS_FOR_GESTURE&&this.activeTool===this.tools.zoom))try{this.gesture.addPointer(b.pointerId)}catch(d){}}},calculateActivePoint:function(a,b){var c=typeof a.pageX==="number"?a.pageX:a.clientX+$(document.body).scrollLeft(),e=typeof a.pageY==="number"?a.pageY:a.clientY+$(document.body).scrollTop();return E(c-b.left,e-b.top,"dom").relativeTo("surface")},handleNativeEvent:function(a){if(a.type===q.pointerdown)return this.onPointerDown.apply(this,arguments);if(a.type===
q.pointermove)return this.onPointerMove.apply(this,arguments);if(a.type===q.pointerup)return this.onPointerUp.apply(this,arguments);if(a.type===q.pointerout)return this.onPointerOut.apply(this,arguments);if(a.type===q.pointerover)return this.onPointerOver.apply(this,arguments);if(a.type===q.doubleclick)return this.onDoubleClick.apply(this,arguments);if(a.type===q.contextmenu)return this.onContextMenu.apply(this,arguments);if(a.type===q.tap)return this.onTap.apply(this,arguments);if(a.type===q.doubletap)return this.onDoubleTap.apply(this,
arguments);if(a.type===q.hold)return this.onHold.apply(this,arguments);if(a.type===q.dragstart)return this.onDragStart.apply(this,arguments);if(a.type===q.drag)return this.onDrag.apply(this,arguments);if(a.type===q.dragend)return this.onDragEnd.apply(this,arguments);if(a.type===q.gesturestart)return this.onGestureStart.apply(this,arguments);if(a.type===q.gesturechange)return this.onGestureChange.apply(this,arguments);if(a.type===q.gestureend)return this.onGestureEnd.apply(this,arguments);if(a.type===
q.inertiastart)return this.onInertiaStart.apply(this,arguments);if(a.type===q.mousewheel)return this.onMouseWheel.apply(this,arguments);if(a.type===q.keydown)return this.onKeyDown.apply(this,arguments);if(a.type===q.keyup)return this.onKeyUp.apply(this,arguments);if(a.type===q.keypress)return this.onKeyPress.apply(this,arguments);if(a.type===q.resize)return this.onResize.apply(this,arguments)},onPointerDown:function(a){if(this.pointers.length>0&&this.pointers[0].pointerId===this.activePointer.pointerId&&
a.target===this.surface.active.dom){this.startPoint=this.activePoint;this.moved=false;this.editingOnLastPointerDown=this.activeTool.element&&this.activeTool.element.editing;this.selectionChanged=false;if(this.switchTool()!==false)this.activeTool.onPointerDown(this.activePoint,this.activeScale)}},onPointerMove:function(){if(this.pointers.length===0)this.switchCursor();else if(this.pointers.length>0&&this.pointers[0].pointerId===this.activePointer.pointerId)this.activeTool.onPointerMove(this.activePoint,
this.activeScale)},onPointerUp:function(a){if(this.pointers.length===0&&a.target===this.surface.active.dom){this.moved=this.activePoint&&this.startPoint&&(Math.abs(this.activePoint.x-this.startPoint.x)>1||Math.abs(this.activePoint.y-this.startPoint.y)>1);this.activeTool.onPointerUp(this.activePoint,this.activeScale)}},onPointerOut:function(a){if(this.previousPointers.length>this.pointers.length)this.onPointerUp(a)},onPointerOver:function(){},onDoubleClick:function(){this.activeElement instanceof A&&
this.useTool("text");this.activeTool.onDoubleClick(this.activePoint,this.activeScale)},onContextMenu:function(a){a.preventDefault()},onTap:function(){},onDoubleTap:function(){},onHold:function(){},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},onGestureStart:function(){},onGestureChange:function(){},onGestureEnd:function(){},onInertiaStart:function(){},onMouseWheel:function(a,b,e,d){a.preventDefault();if(this.allowZoom&&!e&&!this.activeTool.started&&a.target===this.surface.active.dom){a=
1+d/Math.abs(d)*c.ZOOM_STEP;this.surface.zoom(a,this.activePoint)}},onKeyDown:function(a){var b=a.which,e=a.shiftKey,d=a.ctrlKey,f=a.altKey,j=a.metaKey;if(c.ENABLE_KEY_HANDLERS){if(this.shiftKey!==e)this.keyHandlers.onShiftKeyDown(a);if(this.ctrlKey!==d)this.keyHandlers.onControlKeyDown(a);if(this.altKey!==f)this.keyHandlers.onAltKeyDown(a);if(this.metaKey!==j)this.keyHandlers.onMetaKeyDown(a);this.shiftKey=this.activeTool.isShiftDown=e;this.ctrlKey=d;this.altKey=f;this.metaKey=j;if(b===46)return this.keyHandlers.onDeleteKeyDown(a);
if(b===48||b===96)return this.keyHandlers.onZeroKeyDown(a);if(b===49)return this.keyHandlers.onOneKeyDown(a);if(b===107||b===187)return this.keyHandlers.onPlusKeyDown(a);if(b===109||b===189)return this.keyHandlers.onMinusKeyDown(a);if(b===37)return this.keyHandlers.onLeftArrowKeyDown(a);if(b===38)return this.keyHandlers.onUpArrowKeyDown(a);if(b===39)return this.keyHandlers.onRightArrowKeyDown(a);if(b===40)return this.keyHandlers.onDownArrowKeyDown(a);if(b===27)return this.keyHandlers.onEscapeKeyDown(a);
if(b===13)return this.keyHandlers.onEnterKeyDown(a);if(b===8)return this.keyHandlers.onBackspaceKeyDown(a);if(b===32)return this.keyHandlers.onSpacebarKeyDown(a);if(b===89)return this.keyHandlers.onYKeyDown(a);if(b===90)return this.keyHandlers.onZKeyDown(a);if(b===65)return this.keyHandlers.onAKeyDown(a);if(b===83)return this.keyHandlers.onSKeyDown(a);if(b===67)return this.keyHandlers.onCKeyDown(a);if(b===86)return this.keyHandlers.onVKeyDown(a);if(b===82)return this.keyHandlers.onRKeyDown(a);if(b===
85)return this.keyHandlers.onUKeyDown(a);if(b===79)return this.keyHandlers.onOKeyDown(a);if(b===76)return this.keyHandlers.onLKeyDown(a);if(b===75)return this.keyHandlers.onKKeyDown(a);if(b===77)return this.keyHandlers.onMKeyDown(a);if(b===72)return this.keyHandlers.onHKeyDown(a);if(b===88)return this.keyHandlers.onXKeyDown(a);if(b===84)return this.keyHandlers.onTKeyDown(a)}},onKeyUp:function(a){var b=a.which,e=a.shiftKey,d=a.ctrlKey,f=a.altKey,j=a.metaKey;if(c.ENABLE_KEY_HANDLERS){if(this.shiftKey!==
e)this.keyHandlers.onShiftKeyUp(a);if(this.ctrlKey!==d)this.keyHandlers.onControlKeyUp(a);if(this.altKey!==f)this.keyHandlers.onAltKeyUp(a);if(this.metaKey!==j)this.keyHandlers.onMetaKeyUp(a);this.shiftKey=this.activeTool.isShiftDown=e;this.ctrlKey=d;this.altKey=f;this.metaKey=j;if(b===32)this.keyHandlers.onSpacebarKeyUp(a)}},onKeyPress:function(){},onResize:function(){if(this.autoresize){var a=$(window).height();this.surface.resize($(window).width(),a);this.surface.fit()}},setAutoResize:function(a){this.autoresize=
a},onForegroundElementSelectionsChanged:function(){for(var a=0,b=0;b<this.surface.foreground.elements.length;b++){var c=this.surface.foreground.elements[b];c.selected&&a++}if(a==1)for(b=0;b<this.surface.foreground.elements.length;b++){c=this.surface.foreground.elements[b];if(c.selected){var a=new x(this.activeColor),a=x.getOfficialColorName(a),b=this.activeSize,e;e=c instanceof w||c instanceof u?new x(c.fill.color):new x(c.stroke.color);e=x.getOfficialColorName(e);c=c.getSizeLevel();if(c!=null){this.lastRememberedSizeBeforeSelection=
b;this.fire("requestSizeChange",c,b)}if(e){if(this.lastRememberedColorBeforeSelection==null)this.lastRememberedColorBeforeSelection=a;this.fire("requestColorChange",e)}break}}else if(a==0){if(this.lastRememberedSizeBeforeSelection!=null){this.fire("requestSizeChange",this.lastRememberedSizeBeforeSelection);this.setSize(this.lastRememberedSizeBeforeSelection);this.lastRememberedSizeBeforeSelection=null}if(this.lastRememberedColorBeforeSelection!=null){this.fire("requestColorChange",this.lastRememberedColorBeforeSelection);
this.setColor(this.lastRememberedColorBeforeSelection);this.lastRememberedColorBeforeSelection=null}}}};return a=l.define(a)});
define("file/File","require async/Promise util/Binary util/Security util/Img util/Class util/Security log/Logger".split(" "),function(b){function a(){this.offset=this.bytes=this.source=this.name=null;this.saving=false;this.mime="application/octet-stream";this.extension="file";this.manifest=null;this.registerEvents("presave","saved","loaded")}var l=b("async/Promise"),c=b("util/Binary"),h=b("util/Security");b("util/Img");var i=b("util/Class"),h=b("util/Security"),g=b("log/Logger").instance("file.File");
a.supportedTypes=[];a.openAsync=function(b){var c=new l,d;Windows.Storage.StorageFile.getFileFromPathAsync(b).then(function(b){a.readAsync(b).done(function(b){d=new (a.getFileClass(b))({bytes:b});c.resolve(d)})},function(a){c.reject(a)});return c};a.isUnsupported=function(b){for(var c=0;c<a.supportedTypes.length;c++)if(a.supportedTypes[c].isOfFileType(b))return false;return true};a.getFileClass=function(b){for(var c=a,d=0;d<a.supportedTypes.length;d++)a.supportedTypes[d].isOfFileType(b)&&(c=a.supportedTypes[d]);
return c};a.isSkitch=function(b){var c;for(c=0;c<a.supportedTypes.length;c++)if(a.supportedTypes[c].isOfFileType(b)){c=a.supportedTypes[c];return c.isSkitchFile(b)}return false};a.uint32ToBytes=function(a){var b=new Uint8Array(4);(new DataView(b.buffer)).setUint32(0,a,false);return b};a.bytesToUint32=function(a){a.buffer||(a=new Uint8Array(a));return(new DataView(a.buffer)).getUint32(a.byteOffset,false)};a.slice=function(a,b,c){return!b&&typeof b!=="number"?a:typeof c==="number"&&c>=0?a.subarray(b,
b+c):a.subarray(b)};a.crc=function(){return 0};a.readAsync=function(b){var c=new l,d=new FileReader;if(b instanceof a)return c.resolve(b.bytes);if(typeof Windows!=="undefined"&&b instanceof Windows.Storage.StorageFile)Windows.Storage.FileIO.readBufferAsync(b).then(function(a){var b=Windows.Storage.Streams.DataReader.fromBuffer(a),a=new Uint8Array(a.length);b.readBytes(a);b.close();c.resolve(a)});else{d.onload=function(a){c.resolve(new Uint8Array(a.target.result))};d.onerror=function(){c.reject.bind(c,
arguments)};d.readAsArrayBuffer(b)}return c};a.prototype={initialize:function(){this.setBytes(this.bytes)},MD5:function(){return h.MD5(this.bytes)},setBytes:function(a){this.bytes=a;a=Array.prototype.concat.call(a||[]);if(typeof Blob!=="undefined")try{this.source=new Blob(a)}catch(b){g.warn("Cannot construct Blob");g.warn(b)}this.processNewBytes()},getManifestText:function(){var a,b=[];if(this.manifest){this.manifest.children.forEach(function(b){b.layerId==="__text__"&&(a=b)});a&&a.children&&a.children.forEach(function(a){b.push(a.text)});
return b}},toText:function(a,b){return c.toText(this.bytes,a,b)},toInt:function(a,b){return c.toUint32(this.bytes,a,b)},toHex:function(a,b){return c.toHex(this.bytes,a,b)},toObjectURL:function(a,b){return c.toObjectURL(this.bytes,a,b)},slice:function(b,c){return a.slice(this.bytes,b,c)},processNewBytes:function(){},save:function(a,b,c){var e=this,h=new l;if(!this.saving){this.saving=true;a.getFileAsync(e.name,{create:true}).then(function(a){return a.writeBytesAsync(e.bytes)}).done(function(){e.saving=
false;e.fire("saved",e,b,c);h.resolve(e)}).fail(function(a){g.error("File Save Error ["+e.name+"]: "+a.description);e.saving=false;h.reject(a)});return h}},reset:function(){this.seek(0)},seek:function(a){this.offset=a},forward:function(a){this.seek(this.offset+a)},onError:function(){},insertManifest:function(a){this.manifest=a},updateManifest:function(a){this.manifest=a},addResource:function(){}};return a=i.define(a)});
define("file/Image","require util/Binary util/Img async/Promise env/Settings file/File util/Class graphics/CanvasGraphics log/Logger".split(" "),function(b){function a(){this.extracted=false;this.resources=null;this.registerEvents("extracted","thumbnailcreated")}var l=b("util/Binary"),c=b("util/Img"),h=b("async/Promise"),i=b("env/Settings"),g=b("file/File"),f=b("util/Class"),k=b("graphics/CanvasGraphics"),d=b("log/Logger").instance("file.Image");a.CHUNK_FIELDS={LENGTH:0,CHUNK_TYPE:4,CHUNK_DATA:8};
a.CHUNK_TYPES={MANIFEST:"skMf",RESOURCE:"skRf",THUMBNAIL:"skTf"};a.prototype={save:function(b,c,d){var f=this,g=new h,i=arguments;this.createThumbnail(b).then(function(){return a.parent.prototype.save.apply(f,i)}).done(function(a){g.resolve(a)}).fail(function(){g.reject.apply(g,arguments)});return g},deleteAsync:function(a,b){var c=this,d,f=new h;if(a){d=new h;Windows.Storage.StorageFolder.getFolderFromPathAsync(a).then(function(a){d.resolve(a)},function(){d.reject.apply(d,arguments)})}else b&&(d=
d.resolve(b));d.done(function(a){a.getFileAsync(c.name).then(function(a){return a.deleteAsync()}).then(function(){return a.getFileAsync(c.name+".thumbnail."+c.extension)}).then(function(a){return a.deleteAsync()}).then(function(){f.resolve()},function(){f.reject.apply(f,arguments)})}).fail(function(){f.reject.apply(f,arguments)});return f},convertAsync:function(a){var b=new h,d,f;c.convertAsync(this.getFlatImageBytes(),destImage.definition.properties.mime).done(function(c){f=new a({name:this.name,
bytes:c});if(this.manifest){this.resources&&(d=Object.getOwnPropertyNames(this.resources)[0]);d&&f.addResource(d,this.resources[d]);f.insertManifest(this.manifest);f.processNewBytes()}b.resolve(f)}.bind(this));return b},updateResource:function(b,c){var d,f,g=this.chunks;for(d=0;d<g.length;d++)if(g[d].type===a.CHUNK_TYPES.RESOURCE){var h=this.getResourceId(g[d].offset+8);h===b&&(f=g[d]);break}if(f){g=l.fromHex(h.replace(/-/g,""));d=new Uint8Array(c.length+g.length);d.set(g,0);d.set(c,g.length);this.updateChunk(f,
a.CHUNK_TYPES.RESOURCE,d)}},updateManifest:function(b){var c,d,f=this.chunks;for(c=0;c<f.length;c++)if(f[c].type===a.CHUNK_TYPES.MANIFEST){d=f[c];break}if(d){b=l.fromText(JSON.stringify(b));this.updateChunk(d,a.CHUNK_TYPES.MANIFEST,b)}},insertManifest:function(b){b=l.fromText(JSON.stringify(b));this.addChunk(a.CHUNK_TYPES.MANIFEST,b)},addResource:function(b,c){var d,f;d=l.fromHex(b.replace(/-/g,""));f=new Uint8Array(c.length+d.length);f.set(d,0);f.set(c,d.length);this.addChunk(a.CHUNK_TYPES.RESOURCE,
f);return b},getFirstSkitchChunkOffset:function(){var a;this.reset();for(a=this.getNextChunk();a;){if(/^sk/i.test(a.type))break;a=this.getNextChunk()}return a&&a.offset},processNewBytes:function(){a.parent.prototype.processNewBytes.apply(this,arguments);this.extract()},extract:function(){this.chunks=this.thumbnail=this.image=this.resources=this.manifest=this.offset=null;this.extracted=false;this.extractChunks();this.extractManifest();this.extractResources();this.extracted=true;this.fire("extracted",
this)},isExtracted:function(){return this.extracted},extractChunks:function(){var a=this.getNextChunk();for(this.chunks=[];a;){this.chunks.push(a);a=this.getNextChunk()}},getChunk:function(b){var c;c=this.toInt(b+a.CHUNK_FIELDS.LENGTH,4);return{offset:b,size:c,type:l.toText(this.slice(b+a.CHUNK_FIELDS.CHUNK_TYPE,4)),data:this.slice(b+a.CHUNK_FIELDS.CHUNK_DATA,c),crc:this.toInt(b+a.CHUNK_FIELDS.CHUNK_DATA+c,4)}},extractManifest:function(){var b,c=this.chunks;for(b=0;b<c.length;b++)if(c[b].type===a.CHUNK_TYPES.MANIFEST){this.manifest=
JSON.parse(l.toText(c[b].data));break}},extractResources:function(){var b,c,d,f=this.chunks;this.resources={};for(b=0;b<f.length;b++)if(f[b].type===a.CHUNK_TYPES.RESOURCE){c=this.getResourceId(f[b].offset+8);d=g.slice(f[b].data,16);this.resources[c]=d}},getResourceId:function(a){return[this.toHex(a,4),this.toHex(a+4,2),this.toHex(a+6,2),this.toHex(a+8,2),this.toHex(a+10,6)].join("-").toUpperCase()},hasManifest:function(){return!!this.manifest},createThumbnail:function(a){var b=this,f=new h,g,l,n,
r,w,y=new k,z=y.context.canvas;c.toImageElementAsync(this.source).done(function(h){l=h;y.setWidth(i.THUMBNAIL_WIDTH);y.setHeight(i.THUMBNAIL_HEIGHT);if(l.width<l.height){w=r=l.width;n=0}else{r=w=l.height;n=(l.width-l.height)/2}y.drawImage(l,n,0,r,w,0,0,y.getWidth(),y.getHeight());c.toBytesAsync(z,b.mime).then(function(c){g=c;return a.getFileAsync(b.name+".thumbnail."+b.extension,{create:true,exclusive:false})}).then(function(a){return a.writeBytesAsync(g)}).done(function(){b.fire("thumbnailcreated",
z);f.resolve()}).fail(function(a){d.error(a.description);f.reject(a)})});return f},flattenAsync:function(a){var b=this;return c.toBytesAsync(a.buffer.graphics.context.canvas,b.mime).then(function(a){return h.wrap(b.updateFlattenedImage(a))})},getDocumentBytes:function(){return this.resources&&this.resources.skRf}};return a=f.define(a,g)});
define("file/JPG","require util/Class util/Binary util/Img file/Image file/File".split(" "),function(b){function a(){this.resources=this.manifest=null;this.richDataSize=0;this.chunks=this.thumbnail=this.image=null;this.useLargeIcon=this.extracted=false;this.mime="image/jpeg";this.extension="jpg"}var l=b("util/Class"),c=b("util/Binary");b("util/Img");var h=b("file/Image"),i=b("file/File");a.SKITCH_MARKER="skitch";a.createdBySkitch=function(b){return a.isSkitchFile(b)};a.isOfFileType=function(a){a=
c.toHex(a,6,5).toUpperCase();return a==="4A46494600"||a==="4578696600"};a.isSkitchFile=function(a){return String.fromCharCode.apply(String,c.slice(a,a.length-6,6)).toLowerCase()==="skitch"};a.prototype={insertManifest:function(b){a.createdBySkitch(this.bytes)||this.insertMarker();a.parent.prototype.insertManifest.apply(this,arguments)},insertMarker:function(){var b;b=this.bytes.subarray(0);this.bytes=new Uint8Array(b.length+4+a.SKITCH_MARKER.length);this.bytes.set(b,0);this.bytes.set(i.uint32ToBytes(this.richDataSize),
b.length);this.bytes.set(c.fromText(a.SKITCH_MARKER),b.length+4)},getFlatImageBytes:function(){var a,b;if(a=this.getFirstSkitchChunkOffset()){b=new Uint8Array(a);b.set(i.slice(this.bytes,0,a));return b}return this.bytes},updateFlattenedImage:function(a){var b,c;c=this.slice(this.getFirstSkitchChunkOffset());b=new Uint8Array(a.length+c.length);b.set(a,0);b.set(c,a.length);this.setBytes(b)},updateChunk:function(a,b,h){var d,e,l,j,m,p;e=h.length;l=a.offset;m=this.bytes.subarray(0,l);p=this.bytes.subarray(l+
a.size+12);d=new Uint8Array(h.length+b.length);d[0]=b[0].charCodeAt(0);d[1]=b[1].charCodeAt(0);d[2]=b[2].charCodeAt(0);d[3]=b[3].charCodeAt(0);d.set(h,4);j=i.crc(d);d=new Uint8Array(e+12);d.set(i.uint32ToBytes(e),0);d.set(h,8);d.set(i.uint32ToBytes(j),e+8);b=c.fromText(b);d.set(b,4);this.bytes=new Uint8Array(m.length+d.length+p.length);this.bytes.set(m,0);this.bytes.set(d,l);this.bytes.set(p,d.length+l);this.setRichDataSize(this.richDataSize-a.size+e);this.processNewBytes();return this.getChunk(l)},
setRichDataSize:function(b){this.bytes.set(i.uint32ToBytes(b),this.bytes.length-a.SKITCH_MARKER.length-4);this.richDataSize=b},addChunk:function(b,f){var h,d,e,l,j,m;a.createdBySkitch(this.bytes)||this.insertMarker();d=f.length;e=this.bytes.length-a.SKITCH_MARKER.length-4;j=this.slice(0,e);m=this.slice(e+4);h=new Uint8Array(f.length+b.length);h[0]=b[0].charCodeAt(0);h[1]=b[1].charCodeAt(0);h[2]=b[2].charCodeAt(0);h[3]=b[3].charCodeAt(0);h.set(f,4);l=i.crc(h);h=new Uint8Array(d+12);h.set(i.uint32ToBytes(d),
0);h.set(c.fromText(b),4);h.set(f,8);h.set(i.uint32ToBytes(l),d+8);this.setRichDataSize(this.richDataSize+h.length);this.bytes=new Uint8Array(j.length+h.length+4+m.length);this.bytes.set(j,0);this.bytes.set(h,e);this.bytes.set(i.uint32ToBytes(this.richDataSize),h.length+e);this.bytes.set(m,h.length+e+4);this.processNewBytes();return this.getChunk(e)},getNextChunk:function(){var b;if(this.bytes&&!(this.offset>=this.bytes.length-a.SKITCH_MARKER.length-4)){if(!this.offset){if(!a.createdBySkitch(this.bytes))return;
this.setRichDataSize(i.bytesToUint32(this.slice(this.bytes.length-a.SKITCH_MARKER.length-4,4)));this.offset=this.bytes.length-a.SKITCH_MARKER.length-4-this.richDataSize;this.seek(this.offset);if(this.offset>=this.bytes.length-a.SKITCH_MARKER.length-4)return}b=this.getChunk(this.offset);this.forward(b.size+12);return b}}};a=l.define(a,h);i.supportedTypes.push(a);return a});
define("file/PNG","require util/Class util/Binary util/Img file/File file/Image".split(" "),function(b){function a(){this.chunks=this.thumbnail=this.image=this.resources=this.manifest=null;this.useLargeIcon=this.extracted=false;this.mime="image/png";this.extension="png"}var l=b("util/Class"),c=b("util/Binary");b("util/Img");var h=b("file/File"),b=b("file/Image");a.createdBySkitch=function(b){return a.isSkitchFile(b)};a.isOfFileType=function(a){return c.toHex(a,0,8).toUpperCase()==="89504E470D0A1A0A"};
a.isSkitchFile=function(b){return(new a({bytes:b})).hasManifest()};a.prototype={updateFlattenedImage:function(a){var b,c;b=this.slice(this.getFirstSkitchChunkOffset());c=h.slice(a,0,-12);a=new Uint8Array(c.length+b.length);a.set(c,0);a.set(b,c.length);this.setBytes(a)},getFlatImageBytes:function(){var a,b,c;this.reset();b=new Uint8Array(this.bytes.length);b.set(h.slice(this.bytes,0,8),0);c=8;for(a=this.getNextChunk();a;){if(!/^sk/.test(a.type)){b.set(h.slice(this.bytes,a.offset,a.size+12),c);c=c+
(a.size+12)}a=this.getNextChunk()}a=new Uint8Array(c);a.set(h.slice(b,0,c));return a},updateChunk:function(a,b,f){var k,d,e,l,j;d=f.length;e=a.offset;j=this.bytes.subarray(0,e);a=this.bytes.subarray(e+a.size+12);k=new Uint8Array(f.length+b.length);k[0]=b[0].charCodeAt(0);k[1]=b[1].charCodeAt(0);k[2]=b[2].charCodeAt(0);k[3]=b[3].charCodeAt(0);k.set(f,4);l=h.crc(k);k=new Uint8Array(d+12);k.set(h.uint32ToBytes(d),0);k.set(f,8);k.set(h.uint32ToBytes(l),d+8);b=c.fromText(b);k.set(b,4);this.bytes=new Uint8Array(j.length+
k.length+a.length);this.bytes.set(j,0);this.bytes.set(k,e);this.bytes.set(a,k.length+e);this.processNewBytes();return this.getChunk(e)},addChunk:function(a,b){var f,k,d,e,l,j;k=b.length;d=this.getEndChunk().offset;l=this.bytes.subarray(0,d);j=this.bytes.subarray(d);f=new Uint8Array(b.length+a.length);f[0]=a[0].charCodeAt(0);f[1]=a[1].charCodeAt(0);f[2]=a[2].charCodeAt(0);f[3]=a[3].charCodeAt(0);f.set(b,4);e=h.crc(f);f=new Uint8Array(k+12);f.set(h.uint32ToBytes(k),0);f.set(c.fromText(a),4);f.set(b,
8);f.set(h.uint32ToBytes(e),k+8);this.bytes=new Uint8Array(l.length+f.length+j.length);this.bytes.set(l,0);this.bytes.set(f,d);this.bytes.set(j,f.length+d);this.processNewBytes();return this.getChunk(d)},getEndChunk:function(){this.reset();for(var a=this.getNextChunk();a;){if(a.type=="IEND")return a;a=this.getNextChunk()}throw"There is no IEND chunk";},getNextChunk:function(){var a;if(this.bytes&&!(this.offset>=this.bytes.length)){this.offset||this.seek(8);a=this.getChunk(this.offset);this.forward(a.size+
12);return a}}};a=l.define(a,b);h.supportedTypes.push(a);return a});
define("util/Svg",["util/Num"],function(){function b(){}var a=require("util/Num");b.absolute=function(a){var b=0,h=0,i=!1,a=a.slice(0);a.forEach(function(g,f){g=g.slice(0);i=/^(m|l|c|q)$/.test(g[0]);g[0]=g[0].toUpperCase();for(var k=2;k<g.length;k+=2)g[k-1]=parseFloat(g[k-1])+(i?b:0),g[k]=parseFloat(g[k])+(i?h:0),k==g.length-1&&(b=g[k-1],h=g[k]);a[f]=g});return a};b.quadraticToCubic=function(b,c){var h=c[1],i=c[2],g=c[3],f=c[4],k=["C"];k.push(a.fixed(b.x+2/3*(h-b.x)));k.push(a.fixed(b.y+2/3*(i-b.y)));
k.push(a.fixed(g+2/3*(h-g)));k.push(a.fixed(f+2/3*(i-f)));k.push(a.fixed(g));k.push(a.fixed(f));return k};return b});
define("buffer/ByteBuffer",["require","util/Class","util/Binary"],function(b){function a(){this.buffer=null;this.size=32;this.pos=0}var l=b("util/Class"),c=b("util/Binary");a.prototype={initialize:function(){null==this.buffer&&(this.buffer=new Uint8Array(this.size))},write:function(a){var b=1;"string"==typeof a&&(a=c.fromText(a));null!=a.byteLength&&(b=a.byteLength);b+this.pos>this.buffer.byteLength&&this.resize(2*(this.pos+b));null!=a.byteLength?this.buffer.set(a,this.pos):this.buffer[this.pos]=
a;this.pos+=b},writeLine:function(a){null==a&&(a="");if("string"==typeof a)return this.write(a+"\n");this.write(a);this.write("\n")},resize:function(a){var b=new Uint8Array(a);b.set(this.buffer.byteLength<=a?this.buffer:this.buffer.subarray(0,a));this.buffer=b},bytes:function(){return this.buffer.subarray(0,this.pos)},text:function(){return c.toText(this.bytes())}};return a=l.define(a)});
define("pdf/PdfSerializer","require util/Class util/Num util/Text util/Svg util/Color buffer/ByteBuffer log/Logger".split(" "),function(b){function a(){this.buffer=null}var l=b("util/Class"),c=b("util/Num"),h=b("util/Text"),i=b("util/Svg"),g=b("util/Color"),f=b("buffer/ByteBuffer"),k=b("log/Logger").instance("pdf.PdfSerializer");if(window.PDFJS&&PDFJS.Objects){PDFJS.Objects.Obj.prototype.serialize=function(a){a.obj(this)};PDFJS.Objects.Dict.prototype.serialize=function(a){a.dict(this)};PDFJS.Objects.Name.prototype.serialize=
function(a){a.pdfname(this)};PDFJS.Objects.Page.prototype.serialize=function(a){a.page(this)};PDFJS.Objects.Ref.prototype.serialize=function(a){a.ref(this)};PDFJS.Objects.Stream.prototype.serialize=function(a){a.stream(this)};PDFJS.Objects.WritableTextStream.prototype.serialize=function(a){a.textstream(this)};PDFJS.Objects.XRef.prototype.serialize=function(a){a.xref(this)}}a.prototype={initialize:function(){this.buffer=this.buffer||new f},elements:function(a,b){var c=this;a.forEach(function(a){c.element(a,
b)});return this},element:function(a,b){var c=b.buffer.length;b.save();a.initGraphics(b);a.draw(b);b.restore();this.buffer.writeLine(b.buffer.slice(c).join("\n"));return this},vector:function(a){var b=a.stroke,c=a.fill;this.buffer.writeLine("q");c&&this.color(c.color,"rg");if(b){this.color(b.color,"RG");b.width!=null&&this.buffer.writeLine(b.width+" w")}this.path(a.operations);this.buffer.writeLine("S");this.buffer.writeLine("Q");return this},color:function(a,b){var f;if(a==null)return"";f=new g(a);
if(f.a>0){f=f.toRGBArray().map(function(a){return c.fixed(a/255,2)});f.push(b);this.buffer.writeLine(f.join(" "))}return this},lineWidth:function(a){a!=null&&this.buffer.writeLine(c.fixed(a)+" w");return this},lineCap:function(a){a=["butt","round","square"].indexOf(a);a!=-1&&this.buffer.writeLine(a+" J");return this},lineJoin:function(a){a=["miter","round","bevel"].indexOf(a);a!=-1&&this.buffer.writeLine(a+" j");return this},miterLimit:function(a){a!=null&&this.buffer.writeLine(c.fixed(a)+" M");return this},
path:function(a){var b=[],f,j=[],g={x:0,y:0};if(!Array.isArray(a)){k.error("Unable to serialize path because operations is not an array");return this}a=i.absolute(a);a.forEach(function(a){a[0]=="Q"?a=i.quadraticToCubic(g,a):a[0]=="Z"&&(a[0]="h");f=a[0].toLowerCase();j=a.slice(1);j.forEach(function(a,b){a!==Math.round(a)&&(a=c.fixed(a));j[b]=a});b.push(j.concat(f).join(" "));j.length>1&&(g={y:j.pop(),x:j.pop()})});this.buffer.writeLine(b.join(" "));return this},obj:function(a){this.buffer.writeLine([a.ref.num,
a.ref.gen,"obj"].join(" "));this.serialize(a.data);this.buffer.writeLine("endobj");return this},page:function(a){this.buffer.writeLine([a.ref.num,a.ref.gen,"obj"].join(" "));this.serialize(a.pageDict);this.buffer.writeLine("endobj");return this},stream:function(a){a.dict=a.dict||new Dict;a.dict.set("Length",a.bytes.byteLength);this.dict(a.dict);this.buffer.writeLine("stream");this.buffer.writeLine(a.bytes);this.buffer.writeLine("endstream");return this},textstream:function(a){var b=a.textbuffer.join("\n");
a.dict=a.dict||new Dict;a.dict.set("Length",b.length);this.dict(a.dict);this.buffer.writeLine("stream");this.buffer.writeLine(b);this.buffer.writeLine("endstream");this.buffer.write("");return this},dict:function(a){var b=this;this.buffer.writeLine("<<");a.keys().forEach(function(c){b.pdfname(c);b.buffer.write(" ");b.serialize(a.getRaw(c));b.buffer.writeLine()});this.buffer.writeLine(">>");return this},array:function(a){var b=this;this.buffer.write("[ ");a.forEach(function(a){b.serialize(a);b.buffer.write(" ")});
this.buffer.write("]");return this},pdfname:function(a){this.buffer.write("/"+(a.name||a));return this},ref:function(a){this.buffer.write([a.num,a.gen,"R"].join(" "));return this},text:function(a){this.buffer.write("("+a+")");return this},xref:function(a){var b=["xref"],c=-2,f=null,g=0;a.entries.forEach(function(a,d){if(d>c+1){f!=null&&(b[f]=b[f]+" "+g);g=0;f=b.length;b.push(d)}b.push([h.lpad(a.offset,10,"0"),h.lpad(a.gen,5,"0"),a.free?"f":"n"].join(" "));c=d;g++});b[f]=b[f]+" "+g;b.push("trailer");
this.buffer.writeLine(b.join("\n"));this.dict(a.trailer);return this},startxref:function(a){var b=["startxref"];b.push(a);b.push("%%EOF");this.buffer.writeLine(b.join("\n"));return this},serialize:function(a){a.serialize?a.serialize(this):Array.isArray(a)?this.array(a):typeof a=="string"?this.text(a):this.buffer.write(a+"");return this}};return a=l.define(a)});
define("pdf/RunLengthEncoder",["require","util/Class","buffer/ByteBuffer"],function(b){function a(){this.buffer=new c;this.prev=null;this.unique=[];this.run=0}var l=b("util/Class"),c=b("buffer/ByteBuffer");a.prototype={write:function(a){127==this.run||127==this.unique.length?this.flush():this.prev!=a&&0<this.run?this.flush():this.prev==a&&(1<this.unique.length&&(this.unique.pop(),this.flush(),this.prev=a),this.run++);this.prev!=a&&this.unique.push(a);this.prev=a},flush:function(){var a=this;1<this.unique.length?
(this.buffer.write(this.unique.length-1),this.unique.forEach(function(b){a.buffer.write(b)})):null!=this.prev&&(this.buffer.write(256-this.run),this.buffer.write(this.prev));this.prev=null;this.unique=[];this.run=0},end:function(){this.flush();this.buffer.write(128)},bytes:function(){return this.buffer.bytes()}};return a=l.define(a)});
define("graphics/PdfGraphics","require util/Class util/Num util/Color util/Img util/Text util/Transformer pdf/PdfSerializer log/Logger pdf/RunLengthEncoder graphics/CanvasGraphics".split(" "),function(b){function a(){this.buffer=[];this.context=this.pos=null;this.$span=$("<span/>");this.extgstates={};this.shadows=[];this.path=[];this.matrices=[];this.matrix=[1,0,0,1,0,0];this.incomplete=false}var l=b("util/Class"),c=b("util/Num"),h=b("util/Color"),i=b("util/Img"),g=b("util/Text"),f=b("util/Transformer"),
k=b("pdf/PdfSerializer"),d=b("log/Logger").instance("pdf.PdfGraphics"),e=b("pdf/RunLengthEncoder"),o=b("graphics/CanvasGraphics");a.prototype={initialize:function(){this.context=this.context||o.create(300,150).context},setWidth:function(){},setHeight:function(){},save:function(){this.context.save();this.buffer.push("q");this.matrices.push(this.matrix.concat())},restore:function(){this.context.restore();this.buffer.push("Q");this.matrix=this.matrices.length>0?this.matrices.pop():[1,0,0,1,0,0]},scale:function(a,
b){this.context.scale(a,b);a=c.fixed(a);b=c.fixed(b);this.buffer.push([a,0,0,b,0,0,"cm"].join(" "));f.scaleBy(this.matrix,a,b)},rotate:function(a){this.context.rotate(a);this.buffer.push([c.fixed(Math.cos(a)),c.fixed(Math.sin(a)),c.fixed(-Math.sin(a)),c.fixed(Math.cos(a)),"cm"].join(" "));f.rotateBy(this.matrix,a)},translate:function(a,b){this.context.translate(a,b);a=c.fixed(a!=null?a:0);b=c.fixed(b!=null?b:0);this.buffer.push([1,0,0,1,a,b,"cm"].join(" "));f.translateBy(this.matrix,a,b)},transform:function(a,
b,d,e,g,h){this.context.transform(a,b,d,e,g,h);this.buffer.push([a,b,d,e,g,h].map(function(a){return c.fixed(a)}).join(" ")+" cm");this.matrix=f.transformBy(this.matrix,[a,b,d,e,g,h])},setTransform:function(){d.error("Cannot reset transformation matrix for PDF context");throw Error("Cannot reset transformation matrix for PDF context");},globalAlpha:function(){d.error("globalAlpha not yet implemented in pdf/PdfGraphics");throw Error(msg);},globalCompositeOperation:function(){d.error("globalCompositeOperation not yet implemented in pdf/PdfGraphics");
throw Error(msg);},strokeStyle:function(a){this.context.strokeStyle=a;(a=g.rtrim((new k).color(this.context.strokeStyle,"RG").buffer.text()))&&a.length>0&&this.buffer.push(a);return this.context.strokeStyle},fillStyle:function(a){this.context.fillStyle=a;(a=g.rtrim((new k).color(this.context.fillStyle,"rg").buffer.text()))&&a.length>0&&this.buffer.push(a);return this.context.fillStyle},createLinearGradient:function(){d.error("createLinearGradient not yet implemented in pdf/PdfGraphics");throw Error("createLinearGradient not yet implemented in pdf/PdfGraphics");
},createRadialGradient:function(){d.error("createRadialGradient not yet implemented in pdf/PdfGraphics");throw Error("createRadialGradient not yet implemented in pdf/PdfGraphics");},createPattern:function(){d.error("createPattern not yet implemented in pdf/PdfGraphics");throw Error("createPattern not yet implemented in pdf/PdfGraphics");},lineWidth:function(a){this.context.lineWidth=a;(a=g.rtrim((new k).lineWidth(this.context.lineWidth).buffer.text()))&&a.length>0&&this.buffer.push(a);return this.context.lineWidth},
lineCap:function(a){this.context.lineCap=a;(a=g.rtrim((new k).lineCap(this.context.lineCap).buffer.text()))&&a.length>0&&this.buffer.push(a);return this.context.lineCap},lineJoin:function(a){this.context.lineJoin=a;(a=g.rtrim((new k).lineJoin(this.context.lineJoin).buffer.text()))&&a.length>0&&this.buffer.push(a);return this.context.lineJoin},miterLimit:function(a){this.context.miterLimit=a;(a=g.rtrim((new k).lineWidth(this.context.miterLimit).buffer.text()))&&a.length>0&&this.buffer.push(a);return this.context.miterLimit},
shadowOffsetX:function(a){return this.context.shadowOffsetX=a},shadowOffsetY:function(a){return this.context.shadowOffsetY=a},shadowBlur:function(a){return this.context.shadowBlur=a},shadowColor:function(a){return this.context.shadowColor=a},clearRect:function(){d.error("clearRect not yet implemented in pdf/PdfGraphics");throw Error("clearRect not yet implemented in pdf/PdfGraphics");},fillRect:function(a,b,c,d){this.rect(a,b,c,d);this.fill()},strokeRect:function(a,b,c,d){this.rect(a,b,c,d);this.stroke()},
beginPath:function(){this.pos=[0,0];this.buffer.push("n");this.context.beginPath();this.incomplete=false;this.path=[]},closePath:function(){this.pos=[0,0];this.buffer.push("h");this.context.closePath();this.path.push("h")},moveTo:function(a,b){this.pos=[a,b];this.buffer.push([c.fixed(a),c.fixed(b),"m"].join(" "));this.context.moveTo(a,b);var d=f.transformPoint(this.matrix,{x:this.pos[0],y:this.pos[1]});this.path.push([c.fixed(d.x),c.fixed(d.y),"m"].join(" "))},lineTo:function(a,b){this.pos=[a,b];
this.buffer.push([c.fixed(a),c.fixed(b),"l"].join(" "));this.context.lineTo(a,b);var d=f.transformPoint(this.matrix,{x:this.pos[0],y:this.pos[1]});this.path.push([c.fixed(d.x),c.fixed(d.y),"l"].join(" "))},quadraticCurveTo:function(a,b,c,d){var e=this.pos[0],f=this.pos[1];this.bezierCurveTo(e+2/3*(a-e),f+2/3*(b-f),c+2/3*(a-c),d+2/3*(b-d),c,d)},bezierCurveTo:function(a,b,d,e,g,h){var i=this;this.buffer.push([a,b,d,e,g,h].map(function(a){return c.fixed(a)}).join(" ")+" c");this.pos=[g,h];this.context.bezierCurveTo.apply(this.context,
arguments);this.path.push([{x:a,y:b},{x:d,y:e},{x:g,y:h}].reduce(function(a,b){var d=f.transformPoint(i.matrix,b);a.push(c.fixed(d.x),c.fixed(d.y));return a},[]).join(" ")+" c")},arcTo:function(){d.error("arcTo not implemented in pdf/PdfGraphics");throw Error("arcTo not implemented in pdf/PdfGraphics");},rect:function(a,b,d,e){this.buffer.push([a,b,d,e].map(function(a){return c.fixed(a)}).join(" ")+" re");this.context.rect.apply(this.context,arguments);var g=f.transformPoint(this.matrix,{x:a,y:b});
this.path.push([g.x,g.y,d*this.matrix[0],e*this.matrix[3]," re"].join(" "))},arc:function(){d.error("arc not implemented in pdf/PdfGraphics");throw Error("arc not implemented in pdf/PdfGraphics");},alphaState:function(a){var b,d;if(a=="stroke"){b="StrokeAlpha";d=this.context.strokeStyle;a="CA"}else{b="FillAlpha";d=this.context.fillStyle;a="ca"}d=(new h(d)).a;if(d<1){b=b+Math.round(d*255);this.buffer.push("/"+b+" gs");this.extgstates[b]={};this.extgstates[b][a]=c.fixed(d)}},clear:function(a){a.setTransform(1,
0,0,1,0,0);a.clearRect(0,0,a.canvas.width,a.canvas.height);a.setTransform.apply(a,this.matrix)},shadow:function(){var a=this.context;if(!(a.shadowBlur==0&&a.shadowOffsetX==0&&a.shadowOffsetY==0||(new h(a.shadowColor)).a==1)){var b=i.getBox(a.getImageData(0,0,a.canvas.width,a.canvas.height)),d=a.getImageData(b.left,b.top,Math.max(b.width,1),Math.max(b.height,1));if(!(b.width==0||b.height==0)){for(var a={width:b.width,height:b.height,alias:"Shadow"+this.shadows.length,bytes:null},g=b.width*b.height,
k=new e,l=0;l<g;l++)k.write(Math.min(d.data[l*4+3],153));k.end();a.bytes=k.bytes();this.shadows.push(a);this.save();b=[b.width,0,0,-b.height,b.left,b.height+b.top];b=f.transformBy(b,f.inverse(this.matrix));b=b.map(function(a){return c.fixed(a)});this.buffer.push(b.join(" ")+" cm");this.buffer.push("/"+a.alias+" Do");this.restore()}}},ensurePath:function(){if(this.incomplete){var a=f.inverse(this.matrix).map(function(a){return c.fixed(a)});this.buffer.push("q");this.buffer.push("n % Delete existing path and rebuild");
this.buffer.push(a.join(" ")+" cm");this.buffer=this.buffer.concat(this.path)}},fill:function(a){if(a!=null){d.error("fill with path argument not yet implemented in pdf/PdfGraphics");throw Error("fill with path argument not yet implemented in pdf/PdfGraphics");}this.alphaState("fill");this.clear(this.context);this.context.fill();this.shadow();this.ensurePath();this.buffer.push("f");this.incomplete&&this.buffer.push("Q");this.incomplete=true},stroke:function(a){if(a!=null){d.error("stroke with path argument not yet implemented in pdf/PdfGraphics");
throw Error("stroke with path argument not yet implemented in pdf/PdfGraphics");}this.alphaState("stroke");a=this.context;this.clear(a);a.fill();var b=a.lineWidth;a.lineWidth=Math.max(a.lineWidth-1,0.1);a.stroke();a.lineWidth=b;this.shadow();this.ensurePath();this.buffer.push("S");this.incomplete&&this.buffer.push("Q");this.incomplete=true},clip:function(){d.error("clip not yet implemented in pdf/PdfGraphics");throw Error("clip not yet implemented in pdf/PdfGraphics");},isPointInPath:function(){d.error("isPointInPath not yet implemented in pdf/PdfGraphics");
throw Error("isPointInPath not yet implemented in pdf/PdfGraphics");},drawFocusRing:function(){d.error("drawFocusRing not yet implemented in pdf/PdfGraphics");throw Error("drawFocusRing not yet implemented in pdf/PdfGraphics");},font:function(a){this.context.font=a;return this.context.font},textAlign:function(a){this.context.textAlign=a;return this.context.textAlign},textBaseline:function(a){this.context.textBaseline=a;return this.context.textBaseline},fillText:function(a,b,c,d){this.clear(this.context);
this.context.fillText(a,b,c,d);this.shadow();this.text(a,b,c,d,0)},strokeText:function(a,b,c,d){var e=this.context;e.setTransform(1,0,0,1,0,0);e.clearRect(0,0,e.canvas.width,e.canvas.height);var f=e.lineWidth;e.lineWidth=Math.max(e.lineWidth-1,0.1);e.strokeText.apply(e,arguments);e.lineWidth=f;e.setTransform.apply(e,this.matrix);this.shadow();this.text(a,b,c,d,1)},measureText:function(a){return this.context.measureText(a)},text:function(a,b,c,d,e){e=e||0;a=a.replace("\\","\\\\").replace("(","\\(").replace(")",
"\\)");d=this.$span;d.css("font",this.context.font);d=parseFloat(d.css("fontSize").match(/\d+/)[0]);this.buffer.push(["BT",e,"Tr /HelveticaBold",d,"Tf 1 0 0 -1",b,c,"Tm","("+a+")","Tj ET"].join(" "))},drawImage:function(){d.error("drawImage not implemented in pdf/PdfGraphics");throw Error("drawImage not implemented in pdf/PdfGraphics");},createImageData:function(){d.error("createImageData not implemented in pdf/PdfGraphics");throw Error("createImageData not implemented in pdf/PdfGraphics");},getImageData:function(){d.error("getImageData not implemented in pdf/PdfGraphics");
throw Error("getImageData not implemented in pdf/PdfGraphics");},putImageData:function(){d.error("putImageData not implemented in pdf/PdfGraphics");throw Error("putImageData not implemented in pdf/PdfGraphics");},serialize:function(){return this.buffer.join("\n")}};return a=l.define(a)});
define("pdf/Caecilia",["require"],function(){if(window.PDFJS){var b=PDFJS.Objects.Dict,a=PDFJS.Objects.Stream,l=PDFJS.Objects.Name,c=function(){};c.font=function(){var a=new b;a.set("Type",new l("Font"));a.set("Subtype",new l("TrueType"));a.set("BaseFont",new l("GVHQMO+CaeciliaLTStd-Roman"));a.set("Encoding",new l("WinAnsiEncoding"));a.set("FirstChar",32);a.set("LastChar",122);a.set("Widths",[278,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,741,630,685,759,574,556,722,778,334,315,
704,556,926,796,760,574,760,648,593,668,759,722,1074,704,722,648,0,0,0,0,0,0,574,593,519,630,556,370,556,667,314,314,593,314,1E3,667,594,630,630,426,500,389,648,574,870,593,574,537]);a.set("FontDescriptor",null);return a};c.descriptor=function(){var a=new b;a.set("Type",new l("FontDescriptor"));a.set("FontName",new l("GVHQMO+CaeciliaLTStd-Roman"));a.set("FontFile2",null);a.set("StemV",80);a.set("Ascent",769);a.set("Flags",32);a.set("Descent",-231);a.set("ItalicAngle",0);a.set("FontBBox",[-167,-270,
1136,926]);a.set("CapHeight",700);return a};c.fontfile=function(){var c=new Uint8Array([120,156,237,89,121,124,84,213,189,255,157,115,111,102,203,158,73,50,147,101,146,89,146,153,36,147,100,194,172,89,32,151,108,38,100,95,73,34,75,144,29,10,200,86,164,40,180,2,174,184,87,16,145,82,138,130,178,72,213,82,159,109,169,40,173,8,86,121,106,65,173,218,24,106,75,213,23,23,210,64,176,190,220,121,191,115,230,78,8,202,123,127,189,207,123,255,52,195,111,238,185,119,206,111,255,254,126,231,55,3,16,0,80,195,100,
160,80,52,103,233,13,203,223,254,225,182,191,227,147,91,0,68,213,130,37,63,152,255,185,233,62,182,222,12,160,63,179,112,222,13,115,229,196,205,135,0,140,61,184,199,191,16,31,168,183,138,59,241,254,1,188,207,90,184,116,245,218,53,107,75,126,142,247,71,0,84,11,151,220,56,231,134,231,94,59,220,14,144,153,14,32,248,151,222,176,118,57,249,24,186,0,172,157,184,223,140,36,40,148,14,204,14,32,255,137,119,132,223,139,100,0,175,171,209,178,8,240,194,6,8,146,9,164,146,116,144,27,200,90,178,129,60,68,95,165,
167,232,159,133,253,194,81,225,37,115,162,57,213,156,97,182,154,237,230,34,115,169,185,218,124,200,162,183,88,45,118,75,161,149,90,85,214,88,107,130,53,201,154,106,205,176,58,173,117,214,89,214,121,217,175,13,72,151,26,47,117,94,10,142,88,70,236,35,210,200,186,145,159,141,60,53,242,243,145,35,35,47,140,28,27,185,52,18,252,134,6,131,220,194,221,168,181,130,180,147,89,168,117,61,106,61,129,90,223,83,180,234,205,70,115,186,217,204,181,150,92,67,107,60,106,77,25,211,58,23,181,194,165,170,75,29,151,134,
21,173,179,174,210,58,48,114,249,27,18,12,6,63,14,30,15,62,24,220,24,92,21,92,16,108,11,54,5,75,101,181,172,26,189,60,90,48,154,54,106,28,56,49,240,187,129,227,3,47,15,188,56,240,203,129,167,7,158,24,152,244,209,187,31,157,250,232,196,71,199,250,7,251,63,237,63,215,63,208,223,223,255,65,255,123,253,175,247,63,211,255,104,255,182,15,220,230,81,221,63,117,195,186,46,157,87,87,164,51,106,47,107,223,214,190,174,61,161,61,174,61,166,253,149,246,81,237,118,213,35,161,200,255,159,255,169,168,142,103,28,
190,163,159,32,22,67,127,20,254,231,191,16,167,0,34,98,68,133,40,214,128,22,116,16,9,81,16,13,49,16,11,113,16,15,9,160,135,68,72,130,100,48,128,17,82,32,21,210,16,93,38,200,128,76,204,175,5,172,96,131,44,200,6,59,56,32,7,114,33,15,156,144,15,5,80,8,46,40,130,9,224,6,15,226,207,7,126,8,64,49,148,64,41,148,193,68,152,4,229,32,33,54,43,160,18,170,160,26,106,224,58,168,133,58,152,2,245,208,0,141,208,4,205,208,2,173,208,6,237,208,1,157,136,249,169,208,13,61,208,11,215,195,52,152,14,51,96,38,244,193,44,
184,1,237,191,29,238,128,187,96,11,252,24,182,195,46,120,28,246,192,19,176,15,246,194,147,176,31,14,194,1,56,4,79,195,207,225,48,60,3,207,194,47,224,151,112,4,158,135,23,224,223,224,40,252,6,126,11,47,194,57,88,9,115,97,30,44,130,143,97,45,252,12,150,195,247,224,63,96,13,44,134,175,225,78,216,1,151,96,21,252,19,190,129,5,112,19,124,1,23,224,43,120,15,70,96,9,214,248,59,240,20,252,26,110,133,57,176,12,46,194,235,112,25,190,132,165,176,30,254,10,179,97,35,220,6,143,192,43,112,2,254,4,239,67,63,124,
4,31,192,135,240,43,248,79,120,25,78,193,39,240,41,156,135,191,147,237,228,81,248,11,252,0,254,12,3,240,55,216,12,247,192,38,184,23,238,134,251,225,1,120,16,238,131,173,176,13,61,124,24,118,194,79,224,49,56,14,111,192,25,88,1,111,194,91,240,54,172,131,179,240,71,56,141,159,71,240,100,14,211,163,152,75,21,230,48,10,115,7,19,226,45,241,130,222,162,55,196,19,75,36,137,215,147,225,127,30,144,15,157,60,32,223,71,58,15,156,60,64,143,142,86,147,45,16,148,207,4,137,60,122,22,251,67,190,76,33,136,152,137,
68,224,188,143,178,212,152,113,32,30,135,221,97,83,169,137,207,67,60,122,79,146,205,231,113,216,212,158,36,162,61,221,169,141,160,17,90,121,223,100,34,78,31,172,26,172,111,24,237,232,36,29,159,166,24,12,41,163,191,151,232,250,209,77,146,116,246,172,196,17,86,136,50,75,81,166,14,145,84,128,189,80,237,113,251,188,133,130,45,146,120,220,229,130,207,107,19,244,40,217,109,72,78,74,84,169,147,252,120,137,17,108,22,223,25,234,126,46,57,173,48,53,177,155,86,216,114,42,178,211,95,56,36,182,14,207,45,236,105,
152,52,101,105,122,97,197,117,14,121,144,174,191,180,193,58,193,16,69,229,63,200,35,52,38,213,107,191,13,175,229,82,114,222,226,170,78,29,37,51,90,243,171,157,166,72,137,227,221,29,28,166,55,211,147,136,96,32,232,139,221,102,85,37,37,38,123,220,18,241,168,99,136,205,106,247,121,203,169,199,77,111,110,46,157,178,113,199,143,239,245,77,22,155,69,211,77,190,103,95,41,156,182,181,239,70,186,119,247,178,248,109,91,30,120,44,118,245,129,232,184,35,207,54,108,92,80,198,235,204,137,111,175,160,127,145,88,
35,160,23,60,238,128,223,231,117,20,18,238,151,197,205,220,66,119,222,18,151,108,175,111,110,203,157,215,248,170,216,74,202,30,63,250,135,231,229,191,99,160,142,215,55,63,120,127,109,86,218,232,113,180,251,224,254,35,71,36,102,43,147,25,135,50,245,0,1,38,5,237,101,145,183,9,158,128,71,109,241,221,132,34,254,84,255,41,253,240,67,250,15,85,189,74,182,72,200,188,103,206,37,73,30,89,122,72,82,248,9,242,199,43,252,6,155,3,121,147,184,12,206,253,71,161,94,248,152,94,184,64,123,191,97,188,123,231,203,65,
73,150,164,112,156,142,97,156,44,0,217,73,227,2,147,108,24,31,181,128,15,147,150,68,87,240,0,229,247,62,52,83,90,151,86,95,56,251,214,135,126,124,111,149,123,234,208,208,185,112,140,140,209,187,22,26,182,222,131,113,59,40,141,249,246,17,218,150,22,178,141,121,101,81,174,28,99,1,75,216,202,161,70,74,150,80,188,240,165,252,48,46,153,177,146,28,36,68,146,70,143,227,74,177,25,49,70,204,60,7,99,50,153,140,117,98,136,153,115,177,253,184,45,120,50,88,79,210,113,111,20,102,139,239,140,33,106,135,63,160,119,
94,168,23,201,162,141,169,135,169,72,215,163,232,170,173,123,36,169,227,47,228,152,98,243,30,228,73,13,243,16,174,68,75,184,197,36,100,184,222,201,12,46,234,26,42,151,79,145,73,229,114,187,252,39,110,60,151,118,145,68,226,251,87,242,219,146,68,140,242,39,18,154,164,200,141,66,185,209,227,236,14,103,248,139,58,241,75,150,220,108,197,122,150,89,230,171,13,139,234,102,228,177,113,91,244,201,6,15,26,143,156,161,10,213,99,193,10,54,193,238,80,162,169,183,253,246,28,209,81,29,57,247,242,52,85,215,80,3,
165,58,245,153,198,119,133,72,74,187,6,219,84,104,219,232,91,52,55,151,82,23,15,16,37,217,241,163,151,104,172,42,91,142,80,108,204,64,27,101,212,151,162,216,72,80,163,98,171,141,132,245,220,36,206,120,146,172,143,76,166,98,247,96,131,88,43,175,142,137,166,98,207,39,204,116,25,98,179,201,69,244,96,19,141,73,52,50,177,161,243,137,225,236,4,226,44,146,245,26,189,215,239,9,149,138,213,238,79,204,32,238,114,226,45,36,86,149,251,240,206,93,135,24,77,119,45,219,179,204,197,222,72,251,190,55,95,125,4,233,
31,187,111,237,234,186,149,189,141,213,161,145,99,62,93,177,52,212,83,156,132,227,137,85,166,82,152,24,220,11,11,75,166,221,220,251,125,132,255,62,58,179,182,89,50,184,10,152,173,102,247,234,249,171,255,204,28,151,251,91,170,174,183,69,171,194,182,182,10,85,188,38,176,131,69,168,153,149,216,27,11,169,205,90,72,125,97,211,213,73,201,6,172,12,63,88,99,136,226,130,93,168,18,18,242,156,189,91,210,98,163,253,89,17,238,121,211,75,153,51,43,110,76,255,97,159,39,202,42,223,163,248,228,114,45,148,180,22,41,
74,173,74,141,207,107,189,167,135,121,184,233,119,102,26,49,57,87,164,131,33,39,241,141,219,194,250,233,102,222,163,243,67,253,198,239,181,59,177,71,187,51,132,144,17,153,36,131,148,97,139,179,218,93,164,144,40,238,123,244,103,104,71,221,212,238,230,175,62,115,86,212,185,50,102,85,23,20,148,217,210,76,153,185,129,162,244,170,9,133,5,1,218,246,15,134,85,249,114,245,125,126,73,149,108,175,114,181,207,85,83,218,52,191,44,85,50,58,87,117,20,140,112,64,112,12,86,98,238,50,49,30,104,75,0,145,144,204,67,
91,136,205,188,92,184,170,81,100,136,216,205,89,148,72,101,123,254,140,198,235,91,86,172,104,137,206,42,158,57,49,111,85,102,115,65,93,229,204,146,174,185,93,37,5,77,211,125,158,246,90,195,142,190,212,234,114,79,153,201,214,89,147,238,9,228,164,232,99,238,237,214,151,74,185,254,228,76,91,251,196,226,142,34,67,116,82,72,127,34,198,224,78,140,1,158,117,217,122,155,218,22,24,235,112,62,146,41,30,195,178,161,11,241,237,152,216,253,53,218,188,228,224,193,37,161,234,103,188,102,180,253,93,228,181,242,115,
128,117,51,67,178,59,80,78,194,5,136,49,196,252,34,78,124,222,0,138,75,104,160,49,73,57,253,5,137,58,66,187,135,154,168,193,92,254,200,190,201,198,88,218,70,143,74,191,127,188,166,41,213,93,150,218,222,69,166,96,121,223,86,217,235,104,236,182,116,79,187,235,29,41,60,141,209,55,81,23,154,109,17,184,120,125,6,49,120,174,40,35,101,35,149,67,205,47,10,106,66,137,90,56,218,57,88,57,194,218,197,232,69,77,170,40,166,106,104,36,171,155,177,201,78,44,66,89,57,223,149,229,184,150,104,246,34,182,247,107,135,
90,14,42,226,119,228,52,12,54,252,84,185,121,190,119,176,226,179,217,235,233,79,185,190,207,67,250,200,214,13,87,110,168,158,41,39,59,229,185,92,63,246,62,186,47,212,119,2,250,144,1,8,181,128,63,16,82,23,106,63,8,57,181,138,3,174,247,253,87,235,228,246,4,205,143,182,104,99,59,206,87,190,254,102,245,229,150,104,237,61,219,52,49,109,231,37,98,37,233,146,164,143,62,250,82,116,44,198,109,80,126,71,146,98,163,223,248,119,93,92,168,159,107,80,215,107,168,203,168,244,219,241,138,66,112,14,8,154,161,41,177,
218,167,247,171,146,166,158,159,252,165,208,242,197,20,225,34,115,37,54,250,171,65,173,1,133,62,251,165,36,125,65,90,185,237,94,148,215,25,58,15,61,62,226,199,35,6,33,147,68,84,106,11,118,91,47,217,41,166,202,7,25,104,4,121,177,54,153,44,192,101,25,53,171,210,23,61,37,141,158,143,50,46,222,207,234,78,66,220,24,105,28,78,198,1,140,128,187,156,250,242,72,76,4,194,71,64,123,148,22,144,196,108,67,216,176,99,147,117,134,114,209,227,243,98,41,12,25,11,39,152,50,51,3,25,121,6,131,46,224,172,159,211,190,
96,158,170,254,97,29,53,182,87,165,78,240,153,13,69,254,182,186,9,197,229,149,158,184,236,230,128,16,161,137,77,76,79,200,115,145,187,90,111,201,153,58,55,238,109,159,148,148,235,150,38,69,153,164,124,155,207,154,172,19,179,235,202,249,140,143,54,57,4,130,61,52,155,77,86,161,58,100,165,199,103,42,33,81,141,120,224,150,241,34,20,247,139,53,185,125,125,173,147,165,238,30,177,251,0,213,209,184,185,85,243,23,167,79,92,209,148,148,157,98,139,207,39,137,191,55,254,104,198,180,233,221,242,83,116,175,36,
95,200,13,4,106,239,89,234,158,117,125,64,16,181,170,216,16,14,93,193,97,242,30,198,129,205,7,172,82,184,159,56,31,40,85,31,131,93,40,3,187,0,57,43,118,84,78,89,90,150,238,106,238,46,156,57,165,222,226,115,86,56,140,26,33,217,222,226,119,117,213,165,20,180,76,247,95,183,116,82,70,234,29,109,81,169,185,197,158,244,56,75,85,145,29,125,242,163,79,173,232,83,52,67,26,241,225,164,168,140,28,122,86,223,222,128,67,153,73,48,228,6,86,160,191,16,12,241,89,201,211,231,215,215,110,235,20,155,126,138,78,117,
95,55,227,7,247,111,154,98,165,11,72,252,19,68,167,82,173,94,210,180,128,158,26,45,151,252,110,234,170,189,117,237,166,221,134,83,18,139,31,243,101,20,125,81,177,105,68,111,225,161,139,176,176,241,70,125,69,75,134,112,27,177,54,148,87,116,146,213,242,157,170,23,91,26,5,211,124,199,250,45,235,87,150,78,45,76,85,147,82,169,103,234,143,126,231,168,141,73,190,107,243,77,219,115,75,59,38,41,113,194,183,35,130,150,213,13,81,179,192,80,19,78,154,99,199,178,15,145,129,81,58,34,164,149,228,23,167,105,110,
35,155,105,231,224,117,180,171,235,116,21,29,173,142,74,42,116,101,231,73,242,58,28,23,110,151,220,127,196,57,218,47,127,77,189,104,107,17,126,119,106,228,189,11,219,170,45,116,102,178,0,177,182,207,111,120,231,242,177,169,141,4,124,172,41,179,72,233,29,188,31,179,153,27,243,101,23,148,152,50,184,80,111,161,42,205,44,78,184,101,102,106,85,182,247,238,170,186,135,23,85,126,111,202,198,22,139,217,148,144,229,50,173,157,233,44,140,188,59,105,122,77,181,45,205,231,183,184,238,154,212,210,28,168,104,169,
161,162,68,133,162,198,206,185,41,70,125,156,198,16,89,92,218,217,155,86,89,52,219,68,227,165,20,75,148,134,138,9,217,53,133,109,139,163,70,63,76,244,59,179,243,117,218,36,167,41,211,68,70,106,138,125,245,13,129,130,38,140,17,214,55,253,62,230,218,174,156,216,97,196,134,75,201,227,229,231,10,115,144,151,253,90,113,238,243,56,205,196,45,158,244,172,216,56,80,41,210,232,100,151,101,114,175,208,136,147,198,38,14,216,146,154,227,5,191,113,72,82,206,222,188,36,83,145,201,208,51,235,44,111,252,148,205,
49,36,29,243,161,13,79,197,30,158,138,4,175,223,157,156,168,178,174,21,103,62,35,182,95,10,100,187,179,179,221,44,232,114,25,158,119,171,216,93,54,227,15,158,146,191,134,243,200,31,203,231,21,54,53,170,216,220,24,106,184,126,69,202,7,34,113,216,39,174,141,154,58,33,205,72,197,190,201,89,222,172,44,47,21,229,245,235,54,229,215,26,43,13,101,230,21,179,73,141,116,56,44,86,137,129,36,240,254,26,178,42,52,90,219,212,6,30,1,159,99,204,115,250,74,221,128,239,157,79,139,7,202,223,162,213,3,220,99,243,30,
42,73,135,223,67,75,95,61,37,73,97,121,232,39,65,63,199,121,201,216,197,246,47,24,15,150,1,239,177,185,56,71,30,71,60,85,176,158,200,1,153,24,75,66,253,194,224,241,150,107,190,149,5,86,26,177,228,59,183,254,74,177,99,175,160,97,41,169,106,209,81,181,24,165,139,79,72,73,203,210,135,18,228,170,40,235,33,180,254,92,120,213,192,34,155,155,228,45,169,169,242,147,56,109,98,180,62,58,86,171,10,165,204,116,216,85,213,202,243,53,182,82,236,164,223,71,59,17,35,150,239,0,226,42,187,67,246,146,173,99,184,160,
13,3,87,204,67,131,174,70,69,216,18,174,61,52,231,97,63,160,54,212,21,194,8,203,41,202,100,19,105,50,155,178,172,174,219,63,185,29,255,77,237,218,213,213,181,107,120,195,174,251,87,32,189,251,204,202,149,207,172,12,241,103,4,35,104,45,242,167,50,107,13,252,32,190,186,7,135,146,57,190,83,175,18,123,15,140,107,196,126,47,157,58,180,123,172,79,31,165,183,74,9,87,218,112,2,78,49,228,77,165,73,243,94,25,65,91,81,95,52,235,255,227,123,165,128,39,164,210,42,149,9,213,192,128,48,190,89,182,52,224,1,16,59,
167,204,126,93,101,206,131,155,171,122,50,197,22,98,218,30,110,151,242,27,210,81,236,150,1,201,232,91,80,115,251,79,210,71,91,217,247,202,44,212,178,159,70,95,249,238,198,188,227,35,159,250,10,62,214,138,61,7,34,5,93,188,189,162,64,147,43,104,146,173,245,45,248,181,96,136,197,59,61,119,186,61,191,204,20,33,212,107,214,52,189,28,194,161,15,123,240,49,244,193,129,55,56,197,41,223,48,13,74,51,195,129,194,99,80,162,197,103,50,118,210,146,199,197,122,209,80,93,84,91,62,121,78,247,162,197,249,203,12,120,
95,84,227,170,43,245,172,158,54,103,161,101,30,185,112,203,20,125,118,158,35,43,50,190,74,170,159,166,143,218,220,100,112,58,109,182,200,148,178,218,234,110,61,175,19,59,234,189,153,222,193,250,2,206,24,18,31,147,85,161,179,43,192,207,53,1,27,168,207,222,33,182,139,123,30,23,137,38,46,211,224,241,8,69,213,185,165,233,177,148,8,228,21,105,67,196,38,233,80,183,201,228,76,138,75,170,48,26,51,253,230,226,101,119,176,31,78,32,19,113,52,155,138,252,84,70,124,50,177,148,253,218,49,137,40,5,233,149,136,45,
124,194,248,50,247,138,154,228,162,44,231,36,83,60,109,219,43,214,61,138,128,77,152,89,190,160,69,68,37,249,175,150,155,39,20,165,102,23,53,230,155,119,179,166,132,152,245,52,44,159,19,120,78,153,133,117,8,60,108,49,236,183,2,62,43,41,223,8,195,67,160,238,76,249,77,17,42,170,138,88,87,117,186,228,185,246,95,160,72,73,254,101,76,70,70,12,105,192,85,25,121,5,101,32,218,133,46,148,145,51,94,134,68,148,185,242,42,129,252,55,161,88,98,19,226,207,148,223,168,19,169,24,213,103,42,57,83,179,148,45,117,171,
106,78,151,61,61,181,141,63,158,217,126,144,235,58,150,97,52,100,14,55,133,86,198,12,82,193,180,126,158,97,76,54,127,206,117,179,254,87,130,186,29,138,238,164,208,176,119,117,19,12,205,149,161,110,20,112,100,14,84,170,116,115,231,233,84,117,167,203,118,60,81,62,80,163,210,45,91,170,83,85,157,46,123,114,7,211,73,133,168,13,27,162,4,108,141,47,156,230,119,119,223,205,239,78,190,200,226,197,207,81,17,76,215,138,23,203,137,195,199,127,21,18,116,239,87,220,28,242,106,202,233,146,93,37,203,250,172,105,
105,153,139,252,241,191,13,187,165,56,211,244,147,91,180,213,218,141,121,228,67,158,15,15,190,157,71,249,113,108,62,178,176,105,211,22,154,54,113,216,36,231,53,114,23,201,140,112,14,35,96,201,110,249,93,7,206,186,219,182,77,36,61,42,103,199,67,37,242,99,142,110,229,183,89,162,155,52,178,229,169,250,190,216,137,23,33,82,248,132,165,250,141,109,105,235,195,215,96,175,60,36,46,23,118,225,173,102,236,183,94,228,19,72,48,5,78,138,247,7,123,131,189,226,242,111,255,62,76,118,144,97,101,213,132,148,140,84,
10,125,228,40,116,210,124,72,68,74,23,42,32,87,208,65,29,126,54,3,63,107,64,18,73,31,164,210,30,112,225,179,106,242,8,212,227,181,137,172,12,254,21,247,91,145,38,34,21,33,5,144,98,144,42,145,10,144,74,145,242,216,154,239,71,94,38,35,76,104,71,159,96,6,59,253,27,68,210,53,80,72,159,6,55,29,1,39,126,193,116,34,143,147,190,13,110,180,195,73,154,161,144,148,5,79,210,151,66,207,209,99,155,144,14,25,244,50,238,103,123,217,245,78,228,111,67,189,59,209,135,17,48,35,47,21,221,64,145,39,21,215,26,252,220,139,
126,204,39,43,65,131,87,51,234,239,101,113,96,190,161,12,9,121,129,170,209,174,53,224,71,29,46,220,231,194,171,159,62,6,70,220,147,65,74,131,167,112,15,91,27,49,19,185,248,60,151,182,243,253,25,140,135,28,128,44,148,231,35,183,161,63,119,66,38,202,212,9,243,33,158,241,176,53,77,1,15,242,218,160,31,227,128,87,212,95,19,142,61,234,41,65,50,34,165,33,169,216,30,188,214,162,206,139,44,62,4,117,160,236,18,30,51,140,61,127,86,10,113,228,1,140,47,123,182,8,63,95,4,102,124,86,207,117,247,64,9,143,119,41,
76,196,231,118,178,24,98,24,191,80,9,102,133,242,241,190,158,199,253,26,36,156,13,142,242,92,148,43,185,80,8,243,16,195,115,209,28,252,6,41,200,114,53,150,135,111,83,15,212,241,43,203,197,120,98,185,96,242,94,66,220,176,184,95,131,48,110,94,158,139,252,171,137,227,48,148,139,11,44,54,60,254,225,60,124,155,122,148,43,139,199,120,98,185,88,131,118,224,149,201,66,185,113,60,167,223,128,79,216,130,88,69,12,177,60,134,49,195,242,70,243,131,178,162,243,2,143,123,105,112,4,175,179,145,74,144,90,241,254,
51,164,163,244,77,152,192,117,148,129,150,97,139,85,44,175,151,100,158,235,106,172,177,0,82,9,82,49,234,181,49,194,125,13,184,111,145,120,63,100,146,28,196,17,18,60,25,236,197,207,98,201,223,192,36,244,163,127,40,87,88,132,241,178,162,125,76,254,175,17,211,121,96,96,62,178,189,44,215,168,211,42,104,16,99,243,32,154,122,176,22,60,104,119,136,188,116,34,214,229,28,136,194,186,142,98,215,107,17,218,193,106,203,193,105,13,174,213,215,32,124,78,206,225,117,46,238,121,12,215,101,97,10,14,33,93,194,117,
4,201,9,126,138,242,248,62,70,136,15,39,98,169,128,19,242,161,13,110,206,127,13,226,178,231,224,58,5,121,135,161,152,17,117,130,137,63,191,19,227,245,109,154,131,189,106,11,196,97,206,12,184,190,66,44,103,72,76,183,112,28,233,19,30,239,116,164,141,72,213,72,147,88,124,149,43,195,86,142,66,46,101,95,73,40,199,99,57,159,205,242,203,253,65,251,67,57,199,61,204,70,204,189,82,219,125,24,31,47,235,105,188,167,140,143,169,18,207,239,196,110,92,172,198,226,116,141,56,176,24,92,211,95,69,47,171,133,16,46,
177,47,179,154,103,181,253,223,228,153,99,128,217,244,173,220,242,220,141,203,37,183,89,177,231,154,244,221,92,24,20,187,13,200,107,197,103,86,60,98,236,255,75,175,86,120,24,94,130,207,136,142,228,144,30,178,145,108,39,207,145,126,114,153,22,209,233,116,51,125,142,94,22,74,133,117,194,118,225,180,48,44,122,197,197,226,67,226,145,171,94,114,68,113,196,194,136,93,17,175,71,12,171,102,170,30,86,29,81,13,168,53,234,116,245,114,245,62,245,9,181,172,241,107,102,105,118,106,94,195,47,134,86,237,44,237,118,
237,73,237,103,255,122,253,235,245,255,241,82,254,83,127,7,180,131,122,236,127,241,9,159,226,38,135,230,182,255,2,115,242,22,216]),i=new b;i.set("Filter",new l("FlateDecode"));return new a(c,null,null,i)};return c}});
define("util/Pdf","require async/Promise pdf/PdfSerializer graphics/PdfGraphics buffer/ByteBuffer graphics/CanvasGraphics pdf/Caecilia pdf/RunLengthEncoder".split(" "),function(b){if(window.PDFJS){var a=b("async/Promise"),l=b("pdf/PdfSerializer"),c=b("graphics/PdfGraphics"),h=b("buffer/ByteBuffer"),i=b("graphics/CanvasGraphics"),g=b("pdf/Caecilia"),f=b("pdf/RunLengthEncoder"),k=PDFJS.Objects.Obj,d=PDFJS.Objects.Dict,e=PDFJS.Objects.Name,o=PDFJS.Objects.Ref,j=PDFJS.Objects.XRef,m=PDFJS.Objects.Stream,
p=PDFJS.Objects.WritableTextStream,n=function(){};n.runLengthEncode=function(a){for(var b=a.byteLength||a.length,c=new f,d=0;d<b;d++)c.write(a[d]);c.end();return c.bytes()};n.createAsync=function(b){var c=new a;PDFJS.disableWorker=true;a.wrap(PDFJS.getDocument(b)).done(function(a){PDFJS.disableWorker=false;c.resolve(a)}).fail(function(a){PDFJS.disableWorker=false;c.reject(a)});return c};n.getPageAsync=function(){return new a};n.addElement=function(a,b){var c=a.pageInfo.$page;if(c.elements==null)c.elements=
[];c.elements.push(b)};n.toStreamObj=function(a){return new k(new o(0,0),n.toStream(a))};n.toStream=function(a){var b=new p;b.write(a);b.flush();return b};n.toDictObj=function(a){return new k(new o(0,0),n.toDict(a))};n.toDict=function(a){var b=new d;Object.keys(a).forEach(function(c){b.set(c,a[c])});return b};n.nextObjNum=function(a){if(a.nextObjNum==null)a.nextObjNum=parseInt(a.pdfInfo.$doc.xref.trailer.get("Size"));return a.nextObjNum++};n.incrementalUpdate=function(a,b){var f=new h,p=[],B=n.toStreamObj("q");
B.ref.num=n.nextObjNum(a);p.push(B);var t=n.toStreamObj("Q");t.ref.num=n.nextObjNum(a);p.push(t);var C=n.toDictObj({Type:new e("Font"),BaseFont:new e("Helvetica-Bold"),Subtype:new e("Type1")});C.ref.num=n.nextObjNum(a);p.push(C);p.push(new k(new o(n.nextObjNum(a),0),g.fontfile()));p.push(new k(new o(n.nextObjNum(a),0),g.descriptor()));p[p.length-1].data.set("FontFile2",p[p.length-2].ref);var A=new k(new o(n.nextObjNum(a),0),g.font());p.push(A);p[p.length-1].data.set("FontDescriptor",p[p.length-2].ref);
a.pdfInfo.$doc.catalog.getCachedPages().forEach(function(b){if(!(b.elements==null||b.elements.length==0)){p.push(b);var f=b.pageDict.ensureArray("Contents");f.unshift(B.ref);f.push(t.ref);var g=new c({context:i.create(b.mediaBox[2],b.mediaBox[3]).context}),h=new l;h.buffer.writeLine("q");h.buffer.writeLine("1  0  0  -1  0 "+b.mediaBox[3]+" cm");h.elements(b.elements,g);h.buffer.writeLine("Q");h=n.toStreamObj(h.buffer.text());h.ref.num=n.nextObjNum(a);f.push(h.ref);p.push(h);Object.keys(g.extgstates).forEach(function(a){b.pageDict.ensureDict("Resources",
p).ensureDict("ExtGState",p).set(a,n.toDict(g.extgstates[a]))});g.shadows.forEach(function(c){var f=n.toDict({Type:new e("XObject"),Subtype:new e("Image"),ColorSpace:new e("DeviceGray"),BitsPerComponent:8,Filter:new e("RunLengthDecode"),Width:c.width,Height:c.height}),f=new m(c.bytes,null,null,f),f=new k(new o(n.nextObjNum(a),0),f);p.push(f);var g=n.toStreamObj(" ");g.data.dict=g.data.dict||new d;g.data.dict.set("Type",new e("XObject"));g.data.dict.set("Subtype",new e("Image"));g.data.dict.set("ColorSpace",
new e("DeviceGray"));g.data.dict.set("BitsPerComponent",1);g.data.dict.set("Width",1);g.data.dict.set("Height",1);g.data.dict.set("SMask",f.ref);g.ref.num=n.nextObjNum(a);p.push(g);b.pageDict.ensureDict("Resources",p).ensureDict("XObject",p).set(c.alias,g.ref)});f=b.pageDict.ensureDict("Resources",p).ensureDict("Font",p);f.set("HelveticaBold",C.ref);f.set("Caecilia",A.ref)}});if(b!=null){var u=n.toStreamObj(JSON.stringify(b));u.ref.num=n.nextObjNum(a);p.push(u);a.pdfInfo.$doc.catalog.catDict.set("SkitchManifest",
u.ref);p.push(new k(a.pdfInfo.$doc.xref.trailer.getRaw("Root"),a.pdfInfo.$doc.catalog.catDict))}p.sort(function(a,b){return a.ref.num-b.ref.num});var v=a.pdfInfo.$doc.stream.bytes.byteLength;p.forEach(function(a){var b=(new l).serialize(a).buffer.bytes();f.write(b);a.offset=v;v=v+b.byteLength});var u=v+1,x=new j;p.forEach(function(a){x.entries[a.ref.num]={offset:a.offset,gen:a.ref.gen}});x.trailer.set("Size",a.nextObjNum);x.trailer.set("Root",a.pdfInfo.$doc.xref.trailer.getRaw("Root"));x.trailer.set("Prev",
a.pdfInfo.$doc.startXRef);var s=new l({buffer:f});s.serialize(x);s.startxref(u);return f.bytes()};return n}});
define("file/PdfDoc","require util/Binary async/Promise env/Settings file/File util/Class util/Pdf log/Logger graphics/CanvasGraphics util/Img".split(" "),function(b){function a(){this.manifest=this.pdf=null;this.mime="application/pdf";this.extension="pdf";this.flattenedImage=null}var l=b("util/Binary"),c=b("async/Promise"),h=b("env/Settings"),i=b("file/File"),g=b("util/Class"),f=b("util/Pdf"),k=b("log/Logger").instance("doc.PdfDoc"),d=b("graphics/CanvasGraphics"),e=b("util/Img");a.isOfFileType=function(a){if(!window.PDFJS)return false;
a={stream:new PDFJS.Objects.Stream(a),pdfFormatVersion:null};PDFJS.Objects.Document.prototype.checkHeader.call(a);return a.pdfFormatVersion!=null};a.prototype={flattenAsync:function(a){var b=this;return e.toBytesAsync(a.buffer.graphics.context.canvas,"image/png").then(function(a){b.flattenedImage=a;return f.createAsync(b.bytes)}).then(function(a){b.pdf=a;return c.wrap(b.pdf.getPage(1))}).then(function(d){a.foreground.elements.forEach(function(a){f.addElement(d,a)});var e=f.incrementalUpdate(b.pdf,
b.manifest);b.bytes=l.concat(b.bytes,e);return c.wrap()})},save:function(b,d,e){var f=this,g=new c,h=arguments;this.createThumbnail(b).then(function(){return a.parent.prototype.save.apply(f,h)}).done(function(a){g.resolve(a)}).fail(function(){g.reject.apply(g,arguments)});return g},createThumbnail:function(a){var b=this,f=new c,g,i,l,w,y,z=new d,B=z.context.canvas;e.toImageElementAsync(this.flattenedImage).then(function(d){i=d;B.setWidth(h.THUMBNAIL_WIDTH);B.setHeight(h.THUMBNAIL_HEIGHT);if(i.width<
i.height){y=w=i.width;l=0}else{w=y=i.height;l=(i.width-i.height)/2}z.drawImage(i,l,0,w,y,0,0,z.getWidth(),z.getHeight());return c.wrap(a.createFileAsync(b.name+".thumbnail."+b.extension,Windows.Storage.CreationCollisionOption.replaceExisting))}).then(function(a){return c.wrap(a.openAsync(Windows.Storage.FileAccessMode.readWrite))}).then(function(a){g=new Windows.Storage.Streams.DataWriter(a);g.writeBuffer(Windows.Security.Cryptography.CryptographicBuffer.decodeFromBase64String(B.toDataURL(b.mime,
h.JPEG_QUALITY).split(",").pop()));return c.wrap(g.storeAsync())}).then(function(){return c.wrap(g.flushAsync())}).done(function(){g.close();b.fire("thumbnailcreated",B);f.resolve()}).fail(function(a){k.error(a.description);f.reject(a)});return f}};a=g.define(a,i);i.supportedTypes.push(a);return a});
define("surface/Surface","require util/Class util/Obj mixin/Transformable util/Transformer env/Settings async/Promise surface/layer/Buffer surface/layer/Layer surface/layer/Background surface/layer/Foreground surface/layer/Tool surface/element/ElementFactory util/Img util/Box util/Num surface/controller/Controller surface/Serializer util/Binary file/File file/JPG file/PNG file/PdfDoc surface/element/Bitmap util/Security util/Mime surface/element/Pixelate surface/element/LabelText graphics/CanvasGraphics graphics/Point surface/action/DeleteAction log/Logger util/Pdf surface/tool/CropTool".split(" "),function(b){function a(){this.margin=
i.SKITCH_MARGIN;this.size={width:0,height:0};this.position={x:0,y:0};this.mode={};this.file=null;this.style={};this.dom=null;this.layers={};this.buffer=this.active=this.background=this.foreground=null;this.coordinateSystem=a.coordinateSystem.UPPER_LEFT;this.contentScaleFactor=1;this.userAgentHistory=null;this.clipRect={top:0,left:0,width:0,height:0};this.doRender=true;this.ready=false;this.ZOOM_RESET_TEXT="Reset";this.ZOOM_TIP_TEXT="Tip: Hold Ctrl and move to pan";this.registerEvents("layeradded",
"layerremoved","updated","select","selected","boxchanged","clipchanged","presave","resize")}var l=b("util/Class");b("util/Obj");var c=b("mixin/Transformable"),h=b("util/Transformer"),i=b("env/Settings"),g=b("async/Promise"),f=b("surface/layer/Buffer"),k=b("surface/layer/Layer"),d=b("surface/layer/Background"),e=b("surface/layer/Foreground"),o=b("surface/layer/Tool"),j=b("surface/element/ElementFactory"),m=b("util/Img"),p=b("util/Box"),n=b("util/Num"),r=b("surface/controller/Controller"),w=b("surface/Serializer"),
y=b("util/Binary"),z=b("file/File");b("file/JPG");b("file/PNG");b("file/PdfDoc");var B=b("surface/element/Bitmap");b("util/Security");b("util/Mime");var t=b("surface/element/Pixelate"),C=b("surface/element/LabelText"),A=b("graphics/CanvasGraphics"),u=b("graphics/Point"),v=b("surface/action/DeleteAction"),x=b("log/Logger").instance("surface.Surface"),s=b("util/Pdf");b("surface/tool/CropTool");a.Settings=i;a.coordinateSystem={UNKNOWN:0,UPPER_LEFT:1,CENTER:2};a.prototype.initialize=function(){this.initDOM();
this.buffer=this.addLayer("buffer",new f({surface:this}),false);this.background=this.addLayer("background",new d({surface:this}));this.foreground=this.addLayer("foreground",new e({surface:this}));this.active=this.addLayer("active",new o({surface:this}));this.controller=new r({surface:this});this.initEvents();this.controller.useTool("arrow");this.controller.setColor("pink");this.controller.setSize("size-3")};a.prototype.initEvents=function(){this.on("boxchanged",this.onBoxChanged,this);this.background.on("loaded",
this.onBackgroundLoaded,this);this.foreground.on("elementadded",this.onForegroundElementAdded,this);this.foreground.on("elementremoved",this.onForegroundElementRemoved,this);this.foreground.on("elementmoved",this.onForegroundElementMoved,this);this.foreground.on("elementmanipulated",this.onForegroundElementManipulated,this)};a.prototype.initDOM=function(){var a,b;this.dom=document.createElement("div");a=this.size&&this.size.width>0&&this.size.width||$(window).width();b=this.size&&this.size.height>
0&&this.size.height||$(window).height();this.size={width:a,height:b};this.clipRect.width=a;this.clipRect.height=b;$(this.dom).attr("touch-action","none").addClass("skitch-surface").css({display:"block",position:"fixed",top:this.position.y+"px",left:this.position.x+"px",height:b+"px",width:a+"px","border-width":"0px",padding:"0px",margin:"0px",overflow:"hidden","background-color":i.DEFAULT_SURFACE_BACKGROUND_COLOR,"background-image":"none"}).css(this.style);this.dom.surface=this};a.prototype.importAsync=
function(a,b){var c,d=this.background.bgcolor;b||(typeof a==="string"?b="url":a instanceof HTMLElement&&(b="element"));this.disableRender();this.setBackgroundColor(i.COLORS.transparent);switch(b){case "url":c=this.importURLAsync(a);break;case "base64":c=this.importBase64Async(a);break;case "map":case "clipboard":case "element":c.resolve(a);break;case "pdf":c=this.importPDFAsync(a);break;default:c=this.importFileAsync(a)}c.done(function(a){this.enableRender();this.setBackgroundColor(d);a&&this.addToBackground(new B({dom:a}));
this.fit();this.initContentScaleFactor();a&&setImmediate(function(){this.controller.tools.pixelate.generatePixelatedImages()}.bind(this))}.bind(this));return c};a.prototype.reset=function(){this.controller.reset();this.clearLayer(this.buffer);this.clearLayer(this.background);this.clearLayer(this.foreground);this.clearLayer(this.active);this.file=null;this.coordinateSystem=a.coordinateSystem.UPPER_LEFT;this.contentScaleFactor=1;this.userAgentHistory=null;this.clipRect={top:0,left:0,width:0,height:0};
this.doRender=true};a.prototype.importURLAsync=function(a){return m.loadAsync(a)};a.prototype.importBase64Async=function(a){return y.fromBase64Async(a).then(function(a){return this.importBytesAsync(a)}.bind(this))};a.prototype.importFileAsync=function(a){return z.readAsync(a).then(function(a){return this.importBytesAsync(a)}.bind(this))};a.prototype.importBytesAsync=function(a){return z.isSkitch(a)?this.importSkitchImageAsync({bytes:a}):this.importURLAsync(y.toObjectURL(a))};a.prototype.importSkitchImageAsync=
function(a){return this.importDataAsync(this.createFile(a))};a.prototype.importPDFPageAsyncHelper=function(a,b,c,d,e){var f=this,g;f.file=d;c.getPage(b).then(function(b){var h=b.getViewport(1),i=A.create(h.width,h.height);i.save();i.fillStyle("#ffffff");i.fillRect(0,0,i.getWidth(),i.getHeight());i.restore();b.render({canvasContext:i.context,viewport:h}).then(function(){var b;m.toBytesAsync(i.context.canvas).then(function(a){b=a;g=new B;return g.setSrcAsync(i.context.canvas.toDataURL())}).then(function(){f.addToBackground(g);
e?d.manifest=e:f.createManifest(d,b,g);return f.importDataAsync(d)}).done(function(){a.resolve(f,c,d)}).fail(function(){a.reject.apply(a,arguments)})})});return a};a.prototype.importPDFAsync=function(a){var b=this,c=new g,d=1,e,f;PDFJS.disableWorker=true;if(a.url){var h;h=a.url;if(a.page)d=a.page;a=y.loadAsync(h)}else{if(a.pdf){b.importPDFPageAsyncHelper(c,a.page,a.pdf,a.file,a.manifest);return c}a=z.readAsync(a)}a.then(function(a){e=a;f=b.createFile({bytes:e});return s.createAsync(a)}).then(function(a){b.importPDFPageAsyncHelper(c,
d,a,f)}).fail(function(a){x.error(a);c.reject.apply(c,arguments)});return c};a.prototype.setPosition=function(a,b){this.position.x=a;this.position.y=b;$(this.dom).css("top",a+"px");$(this.dom).css("left",b+"px")};a.prototype.setSize=function(a,b){this.size.width=a;this.size.height=b;this.resize(a,b);this.controller.autoresize&&this.fit()};a.prototype.onForegroundElementAdded=function(){};a.prototype.onForegroundElementRemoved=function(){};a.prototype.onForegroundElementMoved=function(){};a.prototype.onForegroundElementManipulated=
function(){};a.prototype.expandClip=function(){var a=i.INFINITE_CANVAS_GUTTER,b=i.INFINITE_CANVAS_PADDING,c=this.background.getBox(),d=this.foreground.getBox(),e=c,f={};if(this.background.hasBitmap()){e=this.background.getBitmap();e=p.intersection(e.clipRect,c)}f.left=d.left<e.left-a?d.left-b:e.left;f.top=d.top<e.top-a?d.top-b:e.top;f.width=d.left+d.width>e.left+e.width+a?d.left+d.width+b-f.left:e.left+e.width-f.left;f.height=d.top+d.height>e.top+e.height+a?d.top+d.height+b-f.top:e.top+e.height-f.top;
this.setClip(f)};a.prototype.serialize=function(){var a=h.identity(),b=this.getClip();h.translateBy(a,-b.left,-b.top);var b=p.transform(b,a),c=[this.background.serialize(a,k.id.BACKGROUND),this.foreground.serialize(a,k.id.ANNOTATION),this.foreground.serialize(a,k.id.TEXT)],d=c[2].children;d.forEach(function(b){if(b.type=="Stamp"&&b.labelGuid){var c=new C({guid:b.labelGuid,labelParent:b.guid,value:b.text,position:b.textPosition});delete b.text;delete b.textPosition;c=c.serialize(a);c.guid=b.labelGuid;
c.labelParent=b.guid;d.push(c)}});return{type:"Document",metadata:{key:i.MANIFEST_KEY,creator:i.MANIFEST_CREATOR,creatorVersion:i.VERSION,version:"1.1",userAgentHistory:this.userAgentHistory},frame:w.serializeBox(b),deviceScale:1,contentScaleFactor:n.fixed(this.contentScaleFactor),coordinateSystem:this.coordinateSystem,children:c}};a.prototype.destroy=function(){this.controller.destroy();$(this.dom).remove()};a.prototype.updateUserAgentHistory=function(){var a=i.USER_AGENT;this.userAgentHistory?this.userAgentHistory.length>
0&&this.userAgentHistory[0]!==a&&this.userAgentHistory.unshift(a):this.userAgentHistory=[a]};a.prototype.getLayerById=function(a,b){var c;a.children&&a.children.forEach(function(a){a.layerId===b&&(c=a)});return c};a.prototype.getBackgroundLayerNode=function(a){return this.getLayerById(a,k.id.BACKGROUND)};a.prototype.getAnnotationLayerNode=function(a){return this.getLayerById(a,k.id.ANNOTATION)};a.prototype.getTextLayerNode=function(a){return this.getLayerById(a,k.id.TEXT)};a.prototype.importDataAsync=
function(b){var c=b.manifest,d=this.getBackgroundLayerNode(c),e=this.getAnnotationLayerNode(c),f=this.getTextLayerNode(c),i,j=new g;if(c.coordinateSystem===a.coordinateSystem.CENTER){i=h.identity();h.scaleBy(i,1,-1);a.transform(i,c);d&&Node.transform(i,d.children);e&&Node.transform(i,e.children);f&&Node.transform(i,f.children)}this.clipRect.left=c.frame.x;this.clipRect.top=c.frame.y;this.clipRect.width=c.frame.width;this.clipRect.height=c.frame.height;if(c.metadata&&c.metadata.userAgentHistory)this.userAgentHistory=
c.metadata.userAgentHistory;this.updateUserAgentHistory();if(f&&f.children){var k={},l=[];f.children.forEach(function(a,b){a.type=="Text"&&a.labelParent&&l.push(f.children.splice(b,1)[0]);a.type=="Stamp"&&(k[a.guid]=a)});l.forEach(function(a){k[a.labelParent].text=a.text})}this.contentScaleFactor=c.contentScaleFactor;e&&this.importToLayer(b,e.children,this.addToForeground);f&&this.importToLayer(b,f.children,this.addToForeground);if(d&&d.children&&d.children.length>0){this.importToLayer(b,d.children,
this.addToBackground);this.background.once("loaded",function(){j.resolve()})}else j.resolve();return j};a.prototype.fit=function(a){var b,c,d,e;a||(a=1);d=this.getWidth();e=this.getHeight();b=this.getClip();this.disableRender();this.resetZoomPan();if(b.width>=d||b.height>=e){c=this.getCenter();c=u(c.x,c.y,"dom").relativeTo("surface");a=Math.min(d/b.width,e/b.height)*(e-this.margin*2*a)/e;this.zoom(a*A.pixelRatio,c)}this.enableRender();this.render();return this};a.prototype.getCenter=function(){return u(this.graphics.getWidth()/
2,this.graphics.getHeight()/2,"dom")};a.prototype.importToLayer=function(a,b,c){var d,e,f;if(b)for(f=0;f<b.length;f++){e=b[f];try{d=j.createFrom(e);c.call(this,d,true)===true&&d.deserialize(a,e)}catch(g){x.error("Error importing element ["+(d&&d.toString())+"] to layer: "+g)}}};a.prototype.setBackgroundColor=function(a){this.background.bgcolor=a};a.prototype.resize=function(a,b){var c;$(this.dom).width(a).height(b);for(c in this.layers)this.layers[c]!=null&&this.layers[c].resize(a,b);this.fire("resize",
a,b)};a.prototype.moveTo=function(a,b){var c=$(this.dom).offset({left:a,top:b}).offset();this.position={x:c.left,y:c.top}};a.prototype.initContentScaleFactor=function(){this.contentScaleFactor=this.contentScaleFactor||Math.max(1,1/this.scaling.x)};a.prototype.updateBufferLayer=function(){var a=this.layers.buffer,b=this.getClip();a.resize(b.width/A.pixelRatio,b.height/A.pixelRatio);a.fillWithColor(i.COLORS.white);a.paste(this.background,b.left,b.top);a.paste(this.foreground,b.left,b.top);this.fire("updated",
a)};a.prototype.onBufferUpdated=function(a){x.info("extracting bytes from buffer layer");m.toBytesAsync(a.graphics.context.canvas,this.file.mime).done(function(b){a.bytes=b;x.info("done extracting bytes from buffer layer")})};a.prototype.onBackgroundLoaded=function(a){var b,c;if(a.elements.length>0){a=a.elements[0];this.setClip({left:a.left,top:a.top,width:a.width,height:a.height});a=this.getWidth();b=this.getHeight();c=this.getClip();this.contentScaleFactor=Math.max(1,1/(Math.min(a/c.width,b/c.height)*
(b-this.margin*2)/b))}};a.prototype.isEmpty=function(){return this.background.isEmpty()&&this.foreground.isEmpty()};a.prototype.isDirty=function(){return this.foreground.isDirty()};a.prototype.getBox=function(){var a=this.foreground.getBox(),b=this.background.getBox();return p.union(a,b)};a.prototype.getClip=function(){var a=this.clipRect;return{left:a.left,top:a.top,width:a.width,height:a.height}};a.prototype.setClip=function(a){var b;if(this.background.hasBitmap()){b=this.background.getBitmap();
b.clipRect=p.intersection(b.clipRect,a)}this.clipRect=a;this.fire("clipchanged",a);this.foreground.isEmpty()&&this.initContentScaleFactor()};a.prototype.removeElementsOutsideClip=function(a){var b=this.foreground,c=[],d;b.elements.forEach(function(d){if(!p.intersectsBox(a,d.box)){c.push(d);b.removeElement(d)}});if(c.length>0){d=new v({elements:c});this.controller.activeTool.fire("action",this.controller.activeTool,d)}};a.prototype.getWidth=function(){return $(this.dom).width()};a.prototype.getHeight=
function(){return $(this.dom).height()};a.prototype.getCenter=function(){return u(this.getWidth()/2,this.getHeight()/2,"dom")};a.prototype.resetZoomPan=function(){this.resetTransformation();this.scaleBy(1/A.pixelRatio,1/A.pixelRatio);this.center()};a.prototype.center=function(){var a=this.getClip(),b=this.getCenter().relativeTo("surface"),a=u(a.left+a.width/2,a.top+a.height/2,"surface");this.translateBy(Math.floor(b.x-a.x),Math.floor(b.y-a.y));this.render();this.updateZoomToolbox()};a.prototype.zoom=
function(a,b){var c=a*this.scaling.x;c<i.ZOOM_MIN?a=i.ZOOM_MIN/this.scaling.x:c>i.ZOOM_MAX&&(a=i.ZOOM_MAX/this.scaling.x);b=b||this.getCenter();this.scaleBy(a,a,b.x,b.y);this.render();this.updateZoomToolbox()};a.prototype.toast=function(a,b,c){c||(c=16);var d=$('<div class="skitchVisible"><span class="skitchToastBox skitchVisible"><div class="skitchToast skitchVisible">'+a+"</div></span></div>").get(0);$(d).css("position","absolute");$(d).css("width","100%");$(d).css("text-align","center");$(d).css("top",
"30px");b&&$(".skitchToastBox",d).css("width",b+"px");$(".skitchToastBox",d).css("height",c+"px");$(".skitchToastBox",d).css("padding","12px");$(".skitchToastBox",d).css("background-color","rgba(47,55,61,.95)");$(".skitchToastBox",d).css("border-radius","4px");$(".skitchToastBox",d).css("color","white");$(".skitchToastBox",d).css("cursor","default");$(".skitchToastBox",d).css("font-size","10pt");$(".skitchToastBox",d).css("text-shadow","1px 1px 2px rgba(0,0,0,.32)");$(".skitchToastBox",d).css("font-family",
'"GothamMedium", "Gotham_SSm_4r", Helvetica, Arial, sans-serif');$(".skitchToastBox",d).css("border","2px rgba(255,255,255,.38) solid");$(".skitchToast",d).css("padding-left","20px");$(".skitchToast",d).css("padding-right","20px");$(".skitchToast",d).css("display","inline-block");$(".skitchToast",d).css("width",b-40+"px");$(".skitchToast",d).css("height",c+"px");$(".skitchToast",d).css("color","#f1f5f8");$(".skitchToast",d).css("text-align","center");$(d).hide();$(this.dom).append(d);$(d).fadeIn(1E3,
function(){setTimeout(function(){$(d).fadeOut(1E3,function(){$(d).remove()})},3E3)})};a.prototype.localize=function(a){this.ZOOM_RESET_TEXT=a.ZOOM_RESET_TEXT;this.ZOOM_TIP_TEXT=a.ZOOM_TIP_TEXT;if(this.zoomToolbox){$(".skitchZoomToolboxReset",this.zoomToolbox).html(this.ZOOM_RESET_TEXT);$(".skitchZoomToolboxTip",this.zoomToolbox).html(this.ZOOM_TIP_TEXT)}};a.prototype.updateZoomToolbox=function(){var a=this;if(this.controller.activeTool!=this.controller.tools.crop){this.lastZoomTime=Date.now();if(!this.zoomToolbox&&
this.ready){this.zoomToolbox=$('<div class="skitchZoomToolboxContainer skitchVisible"><span class="skitchZoomToolbox skitchVisible"><div class="skitchZoomToolboxPercent skitchVisible">100%</div><div class="skitchZoomToolboxReset skitchVisible">'+this.ZOOM_RESET_TEXT+'</div><div class="skitchZoomToolboxTip skitchVisible">'+this.ZOOM_TIP_TEXT+"</div></span></div>").get(0);$(this.zoomToolbox).css("position","absolute");$(this.zoomToolbox).css("width","100%");$(this.zoomToolbox).css("text-align","center");
$(this.zoomToolbox).css("top","30px");$(".skitchZoomToolbox",this.zoomToolbox).css("height","16px");$(".skitchZoomToolbox",this.zoomToolbox).css("padding","12px");$(".skitchZoomToolbox",this.zoomToolbox).css("background-color","rgba(47,55,61,.95)");$(".skitchZoomToolbox",this.zoomToolbox).css("border-radius","4px");$(".skitchZoomToolbox",this.zoomToolbox).css("color","#f1f5f8");$(".skitchZoomToolbox",this.zoomToolbox).css("border","2px rgba(255,255,255,.38) solid");$(".skitchZoomToolbox",this.zoomToolbox).css("cursor",
"default");$(".skitchZoomToolbox",this.zoomToolbox).css("font-size","10pt");$(".skitchZoomToolbox",this.zoomToolbox).css("text-shadow","1px 1px 2px rgba(0,0,0,.32)");$(".skitchZoomToolbox",this.zoomToolbox).css("font-family",'"GothamMedium", "Gotham_SSm_4r", Helvetica, Arial, sans-serif');$(".skitchZoomToolboxPercent",this.zoomToolbox).css("display","inline-block");$(".skitchZoomToolboxPercent",this.zoomToolbox).css("height","16px");$(".skitchZoomToolboxPercent",this.zoomToolbox).css("border-right",
"solid 1px rgba(73,88,101,1)");$(".skitchZoomToolboxPercent",this.zoomToolbox).css("padding-right","20px");$(".skitchZoomToolboxPercent",this.zoomToolbox).css("padding-left","20px");$(".skitchZoomToolboxPercent",this.zoomToolbox).css("width","52px");$(".skitchZoomToolboxPercent",this.zoomToolbox).css("color","rgb(161,164,166)");$(".skitchZoomToolboxPercent",this.zoomToolbox).css("text-align","center");$(".skitchZoomToolboxReset",this.zoomToolbox).css("display","inline-block");$(".skitchZoomToolboxReset",
this.zoomToolbox).css("height","16px");$(".skitchZoomToolboxReset",this.zoomToolbox).css("padding-left","20px");$(".skitchZoomToolboxReset",this.zoomToolbox).css("cursor","pointer");$(".skitchZoomToolboxReset",this.zoomToolbox).css("padding-right","20px");$(".skitchZoomToolboxReset",this.zoomToolbox).css("border-right","solid 1px rgba(73,88,101,1)");$(".skitchZoomToolboxReset",this.zoomToolbox).css("text-align","center");$(".skitchZoomToolboxReset",this.zoomToolbox).hover(function(){$(this).css("color",
"#00baff")},function(){$(this).css("color","white")});$(".skitchZoomToolboxTip",this.zoomToolbox).css("padding-left","20px");$(".skitchZoomToolboxTip",this.zoomToolbox).css("display","inline-block");$(".skitchZoomToolboxTip",this.zoomToolbox).css("height","16px");$(".skitchZoomToolboxTip",this.zoomToolbox).css("text-align","center");$(".skitchZoomToolboxTip",this.zoomToolbox).css("color","rgb(161,164,166)");$(".skitchZoomToolboxTip",this.zoomToolbox).css("padding-right","20px");$(".skitchZoomToolboxReset",
this.zoomToolbox).click(function(){a.resetZoomPan()});$(this.dom).append(this.zoomToolbox);$(this.zoomToolbox).mousemove(function(){a.lastZoomTime=Date.now()});$(this.zoomToolbox).hide();setInterval(function(){Date.now()-a.lastZoomTime>3E3&&$(a.zoomToolbox).fadeOut(500)},500)}if(this.zoomToolbox){$(".skitchZoomToolboxPercent",this.zoomToolbox).html(Math.floor(100*this.scaling.x*A.pixelRatio)+"%");$(this.zoomToolbox).fadeIn(500)}}};a.prototype.constrainPan=function(a){var b=a.x,a=a.y,c=this.getClip(),
c=p.transform({left:c.left+b,top:c.top+a,width:c.width,height:c.height},this.active.transformation),d=this.getWidth(),e=this.getHeight();c.left+0.667*c.width<0&&(b=0);c.top+0.667*c.height<0&&(a=0);c.left+0.333*c.width>0+d&&(b=0);c.top+0.333*c.height>0+e&&(a=0);return{x:b,y:a}};a.prototype.pan=function(a){a=this.constrainPan(a);this.translateBy(a.x,a.y);this.render()};a.prototype.addLayerAfter=function(a,b,c,d){this.layers[a]=b;c!==false&&$(b.dom).insertAfter(this.layers[d].dom);this.fire("layeradded",
b,this);b.fire("added",this);return b};a.prototype.addLayer=function(a,b,c){this.layers[a]=b;c!==false&&$(this.dom).append(b.dom);b.on("boxchanged",this.onLayerBoxChanged,this);this.fire("layeradded",b,this);b.fire("added",this);return b};a.prototype.onLayerBoxChanged=function(){this.fire("boxchanged",this.getBox())};a.prototype.onBoxChanged=function(){};a.prototype.removeLayer=function(a){if(this.layers[a]){$(this.layers[a].dom).remove();this.layers[a]=null}};a.prototype.render=function(){if(this.doRender){this.background.render();
this.layers.pixelate&&this.layers.pixelate.render();this.foreground.render();this.active.render()}};a.prototype.disableRender=function(){this.doRender=false;this.background.doRender=false;this.foreground.doRender=false;this.active.doRender=false};a.prototype.enableRender=function(){this.doRender=true;this.background.doRender=true;this.foreground.doRender=true;this.active.doRender=true};a.prototype.renderToLayer=function(a,b){a.renderElement(b)};a.prototype.renderToForeground=function(a){this.renderToLayer(this.foreground,
a)};a.prototype.renderToTool=function(a){this.renderToLayer(this.active,a)};a.prototype.renderToBackground=function(a){this.renderToLayer(this.background,a)};a.prototype.addToLayer=function(a,b){return a.addElement(b)};a.prototype.addToForeground=function(a){return this.addToLayer(this.foreground,a)};a.prototype.addToTool=function(a){return this.addToLayer(this.active,a)};a.prototype.addToBackground=function(a){return this.addToLayer(this.background,a)};a.prototype.clearLayer=function(a){a.empty()};
a.prototype.clearForeground=function(){this.clearLayer(this.foreground)};a.prototype.clearBackground=function(){this.clearLayer(this.background)};a.prototype.clearTool=function(){this.clearLayer(this.active)};a.prototype.clear=function(a){a=this.foreground.empty(a);this.fire("clear",this);return a};a.prototype.createManifest=function(a,b,c){c&&this.file.addResource(c.uuid,b.subarray(0));b=this.serialize();a.insertManifest(b);return b};a.prototype.createFile=function(a){this.file=new (z.getFileClass(a.bytes))(a);
this.fire("filecreated",this,this.file);this.file.on("saved",this.onFileSaved,this);return this.file};a.prototype.updateManifest=function(){this.file.updateManifest(this.serialize());return this.file.manifest};a.prototype.validate=function(){return true};a.prototype.exportAsync=function(){var a=this,b=this.file,c=!!b,d=(new g).resolve(),e,f;this.fire("presave",this);this.updateBufferLayer();return m.toBytesAsync(this.buffer.graphics).then(function(g){if((a.isPixelated()||a.isCropped())&&a.background.hasBitmap()){f=
a.background.getBitmap();e=f.clipRect;d=a.background.getBitmap().toBytesAsync(e.left,e.top,e.width,e.height)}else!c&&a.background.hasBitmap()&&(d=m.toBytesAsync(a.background.getBitmap().dom));c?b.updateFlattenedImage(g):b=a.createFile({bytes:g});return d}).then(function(d){var e=a.serialize();if(c){d&&b.updateResource(a.background.getBitmap().uuid,d);b.updateManifest(e)}else a.createManifest(b,d,a.background.getBitmap());return g.wrap(b)})};a.prototype.isCropped=function(){var a=this.clipRect,b=this.getBox();
return a.left!=b.left||a.top!=b.top||a.width!=b.width||a.height!=b.height};a.prototype.isPixelated=function(){for(var a=false,b=0;b<this.foreground.elements.length;b++)if(this.foreground.elements[b]instanceof t){a=true;break}return a};a.prototype.setTransformation=function(a){this.background.setTransformation(a);this.foreground.setTransformation(a);this.active.setTransformation(a);return c.prototype.setTransformation.call(this,a)};a.prototype.resetTransformation=function(){this.background.resetTransformation();
this.foreground.resetTransformation();this.active.resetTransformation();return c.prototype.resetTransformation.call(this)};a.prototype.transformBy=function(a){this.background.transformBy(a);this.foreground.transformBy(a);this.active.transformBy(a);return c.prototype.transformBy.call(this,a)};a.prototype.translateBy=function(a,b){this.background.translateBy(a,b);this.foreground.translateBy(a,b);this.active.translateBy(a,b);return c.prototype.translateBy.call(this,a,b)};a.prototype.scaleBy=function(a,
b,d,e){this.background.scaleBy(a,b,d,e);this.foreground.scaleBy(a,b,d,e);this.active.scaleBy(a,b,d,e);return c.prototype.scaleBy.call(this,a,b,d,e)};a.prototype.rotateBy=function(a){this.background.rotateBy(a);this.foreground.rotateBy(a);this.active.rotateBy(a);return c.prototype.rotateBy.call(this,a)};return a=l.define(a,Object,[c])});
define("surface/SurfaceAPI","require util/Class util/Obj util/Box surface/Surface env/Settings graphics/Point surface/action/StyleAction".split(" "),function(b){function a(){this.surface=new i;this.registerEvents("toolChanged","toolStarted","toolUpdated","toolStopped","requestUndoEnable","requestUndoDisable","requestRedoEnable","requestRedoDisable","requestTrashDisable","requestTrashEnable","requestSizeChange","requestColorChange");this.surface.controller.on("toolchanged",this.onToolChanged,this);
this.surface.controller.on("toolstarted",this.onToolStarted,this);this.surface.controller.on("toolupdated",this.onToolUpdated,this);this.surface.controller.on("toolstopped",this.onToolStopped,this);this.surface.controller.on("requestUndoEnable",this.onUndoEnabled,this);this.surface.controller.on("requestRedoEnable",this.onRedoEnabled,this);this.surface.controller.on("requestUndoDisable",this.onUndoDisabled,this);this.surface.controller.on("requestRedoDisable",this.onRedoDisabled,this);this.surface.controller.on("requestTrashDisable",
this.onTrashDisabled,this);this.surface.controller.on("requestTrashEnable",this.onTrashEnabled,this);this.surface.controller.on("requestColorChange",this.onColorChanged,this);this.surface.controller.on("requestSizeChange",this.onSizeChanged,this)}var l=b("util/Class"),c=b("util/Obj"),h=b("util/Box"),i=b("surface/Surface"),g=b("env/Settings"),f=b("graphics/Point"),k=b("surface/action/StyleAction");a.prototype.onUndoEnabled=function(){this.fire.apply(this,["requestUndoEnable"].concat(arguments))};a.prototype.onTrashEnabled=
function(){this.fire.apply(this,["requestTrashEnable"].concat(arguments))};a.prototype.onTrashDisabled=function(){this.fire.apply(this,["requestTrashDisable"].concat(arguments))};a.prototype.onRedoEnabled=function(){this.fire.apply(this,["requestRedoEnable"].concat(arguments))};a.prototype.onUndoDisabled=function(){this.fire.apply(this,["requestUndoDisable"].concat(arguments))};a.prototype.onRedoDisabled=function(){this.fire.apply(this,["requestRedoDisable"].concat(arguments))};a.prototype.onColorChanged=
function(a){this.fire.apply(this,["requestColorChange",a])};a.prototype.onSizeChanged=function(a){this.fire.apply(this,["requestSizeChange",a])};a.prototype.onToolChanged=function(a){this.fire("toolChanged",a.name)};a.prototype.onToolStarted=function(a){this.fire("toolStarted",a.name)};a.prototype.onToolUpdated=function(a){this.fire("toolUpdated",a.name)};a.prototype.onToolStopped=function(a){this.fire("toolStopped",a.name)};a.prototype.destroy=function(){this.surface.destroy()};a.prototype.updateSelectedElementsColor=
function(a){for(var b in g.COLORS)if(b==a){a=g.COLORS[b];break}if(this.surface.controller.tools.select.hasSelection()){a={stroke:{color:a},fill:{color:a}};b=new k({oldStyles:this.surface.controller.tools.select.getSelectedElementStyles(),newStyle:a});this.surface.controller.tools.select.updateSelectedElementStyles(a)&&this.surface.controller.saveAction(b)}};a.prototype.updateSelectedElementsSize=function(a){a=="small"&&(a="size-1");a=="medium"&&(a="size-3");a=="large"&&(a="size-5");var b=this.surface.contentScaleFactor;
if(this.surface.controller.tools.select.hasSelection()){a={size:g.ARROW_SIZES[a]*b,stroke:{width:g.STROKE_SIZES[a]*b},font:{size:g.FONT_SIZES[a]*b}};b=new k({oldStyles:this.surface.controller.tools.select.getSelectedElementStyles(),newStyle:a});this.surface.controller.tools.select.updateSelectedElementStyles(a);this.surface.controller.saveAction(b)}};a.prototype.loadFromURL=function(a){return this.surface.importAsync(a,"url")};a.prototype.loadFromFile=function(a){return this.surface.importAsync(a)};
a.prototype.loadFromImage=function(a){return this.surface.importAsync(a,"element")};a.prototype.loadFromBase64=function(a){return this.surface.importAsync(a,"base64")};a.prototype.undo=function(){this.surface.controller.undo()};a.prototype.redo=function(){this.surface.controller.redo()};a.prototype.getElement=function(){return this.surface.dom};a.prototype.setAutoResize=function(a){this.surface.controller.setAutoResize(a)};a.prototype.setPosition=function(a,b){this.surface.setPosition(a,b)};a.prototype.setSize=
function(a,b){this.surface.setSize(a,b)};a.prototype.setBackgroundColor=function(a){this.surface.setBackgroundColor(a)};a.prototype.setAllowZoom=function(a){this.surface.controller.allowZoom=a};a.prototype.setMargin=function(a){this.surface.margin=a};a.prototype.useTool=function(a){this.surface.controller.useTool(a)};a.prototype.useColor=function(a){this.surface.controller.setColor(a);this.fire.apply(this,["requestColorChange",a])};a.prototype.crop=function(){this.useTool("crop")};a.prototype.applyCrop=
function(){this.surface.controller.activeTool==this.surface.controller.tools.crop&&this.surface.controller.tools.crop.applyCrop()};a.prototype.cancelCrop=function(){this.surface.controller.activeTool==this.surface.controller.tools.crop&&this.surface.controller.tools.crop.cancelCrop()};a.prototype.localize=function(a){if(a.CROP_APPLY_TEXT)this.surface.controller.tools.crop.CROP_APPLY_TEXT=a.CROP_APPLY_TEXT;if(a.CROP_CANCEL_TEXT)this.surface.controller.tools.crop.CROP_CANCEL_TEXT=a.CROP_CANCEL_TEXT;
(a.ZOOM_RESET_TEXT||a.ZOOM_TIP_TEXT)&&this.surface.localize(a)};a.prototype.useSize=function(a){a=="small"&&(a="size-1");a=="medium"&&(a="size-3");a=="large"&&(a="size-5");this.surface.controller.setSize(a);this.fire.apply(this,["requestSizeChange",a])};a.prototype.deleteSelectedElements=function(){this.surface.controller.tools.select.deleteSelectedElements()};a.prototype.toast=function(a,b,c){this.surface.toast(a,b,c)};a.prototype.getFile=function(a){return this.surface.exportAsync().done(a)};a.prototype.fit=
function(){return this.surface.fit()};a.prototype.pan=function(a,b){return this.surface.pan({x:a,y:b})};a.prototype.zoom=function(a,b){var c=b&&this.surface.inverseTransformPoint(b);return this.surface.zoom(a,c)};a.prototype.resetZoomPan=function(){return this.surface.resetZoomPan()};a.prototype.getZoomLevel=function(){return this.surface.scaling.x};a.prototype.unselectAll=function(){return this.surface.controller.tools.select.unselectAll()};a.prototype.center=function(){return this.surface.center()};
a.prototype.getBox=function(){var a=this.surface.getClip();return h.transform(a,this.surface.transformation)};a.prototype.enableEvents=function(){this.surface.controller.eventsEnabled=true};a.prototype.disableEvents=function(){this.surface.controller.eventsEnabled=false};a.prototype.startActiveTool=function(a,b){var g=f(a.x,a.y,"dom").relativeTo("surface"),h=this.surface.controller.activeTool;h.once("started",function(a){c.merge(true,a.element,b||{})});h.start(g)};a.prototype.disableRender=function(){this.surface.disableRender()};
a.prototype.enableRender=function(){this.surface.enableRender()};return a=l.define(a)});
define("text",["module"],function(b){var a,l,c,h,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],g=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,k="undefined"!==typeof location&&location.href,d=k&&location.protocol&&location.protocol.replace(/\:/,""),e=k&&location.hostname,o=k&&(location.port||void 0),j={},m=b.config&&b.config()||{};a={version:"2.0.7",strip:function(a){if(a){var a=a.replace(g,""),b=a.match(f);b&&(a=b[1])}else a="";
return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var a,b,c;if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!==typeof ActiveXObject)for(b=0;3>b;b+=1){c=i[b];try{a=new ActiveXObject(c)}catch(d){}if(a){i=[c];break}}return a},parseName:function(a){var b,
c,d=!1,e=a.indexOf(".");b=0===a.indexOf("./")||0===a.indexOf("../");-1!==e&&(!b||1<e)?(b=a.substring(0,e),c=a.substring(e+1,a.length)):b=a;a=c||b;e=a.indexOf("!");-1!==e&&(d="strip"===a.substring(e+1),a=a.substring(0,e),c?c=a:b=a);return{moduleName:b,ext:c,strip:d}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(b,c,d,e){var f,g;f=a.xdRegExp.exec(b);if(!f)return!0;b=f[2];f=f[3];f=f.split(":");g=f[1];f=f[0];return(!b||b===c)&&(!f||f.toLowerCase()===d.toLowerCase())&&(!g&&!f||g===e)},finishLoad:function(b,
c,d,e){d=c?a.strip(d):d;m.isBuild&&(j[b]=d);e(d)},load:function(b,c,f,g){if(g.isBuild&&!g.inlineText)f();else{m.isBuild=g.isBuild;var h=a.parseName(b),g=h.moduleName+(h.ext?"."+h.ext:""),i=c.toUrl(g),j=m.useXhr||a.useXhr;!k||j(i,d,e,o)?a.get(i,function(c){a.finishLoad(b,h.strip,c,f)},function(a){f.error&&f.error(a)}):c([g],function(b){a.finishLoad(h.moduleName+"."+h.ext,h.strip,b,f)})}},write:function(b,c,d){if(j.hasOwnProperty(c)){var e=a.jsEscape(j[c]);d.asModule(b+"!"+c,"define(function () { return '"+
e+"';});\n")}},writeFile:function(b,c,d,e,f){var c=a.parseName(c),g=c.ext?"."+c.ext:"",h=c.moduleName+g,i=d.toUrl(c.moduleName+g)+".js";a.load(h,d,function(){var c=function(a){return e(i,a)};c.asModule=function(a,b){return e.asModule(a,i,b)};a.write(b,h,c,f)},f)}};if("node"===m.env||!m.env&&"undefined"!==typeof process&&process.versions&&process.versions.node)l=require.nodeRequire("fs"),a.get=function(a,b,c){try{var d=l.readFileSync(a,"utf8");0===d.indexOf("\ufeff")&&(d=d.substring(1));b(d)}catch(e){c(e)}};
else if("xhr"===m.env||!m.env&&a.createXhr())a.get=function(b,c,d,e){var f=a.createXhr(),g;f.open("GET",b,!0);if(e)for(g in e)e.hasOwnProperty(g)&&f.setRequestHeader(g.toLowerCase(),e[g]);if(m.onXhr)m.onXhr(f,b);f.onreadystatechange=function(){var a;if(4===f.readyState&&(a=f.status,399<a&&600>a?(a=Error(b+" HTTP status: "+a),a.xhr=f,d(a)):c(f.responseText),m.onXhrComplete))m.onXhrComplete(f,b)};f.send(null)};else if("rhino"===m.env||!m.env&&"undefined"!==typeof Packages&&"undefined"!==typeof java)a.get=
function(a,b){var c,d,e=new java.io.File(a),f=java.lang.System.getProperty("line.separator"),e=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(e),"utf-8")),g="";try{c=new java.lang.StringBuffer;(d=e.readLine())&&(d.length()&&65279===d.charAt(0))&&(d=d.substring(1));for(null!==d&&c.append(d);null!==(d=e.readLine());)c.append(f),c.append(d);g=""+c.toString()}finally{e.close()}b(g)};else if("xpconnect"===m.env||!m.env&&"undefined"!==typeof Components&&Components.classes&&
Components.interfaces)c=Components.classes,h=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),a.get=function(a,b){var d,e,f={},g=new FileUtils.File(a);try{d=c["@mozilla.org/network/file-input-stream;1"].createInstance(h.nsIFileInputStream),d.init(g,1,0,!1),e=c["@mozilla.org/intl/converter-input-stream;1"].createInstance(h.nsIConverterInputStream),e.init(d,"utf-8",d.available(),h.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),e.readString(d.available(),
f),e.close(),d.close(),b(f.value)}catch(i){throw Error((g&&g.path||"")+": "+i);}};return a});define("text!appbar/PropertiesBar.html",[],function(){return'<div class="skitch-properties-bar"></div>'});
define("appbar/PropertiesBarView",["require","util/Class","text!appbar/PropertiesBar.html"],function(b){function a(){this.dom=null;this.registerEvents()}var l=b("util/Class"),c=b("text!appbar/PropertiesBar.html");a.prototype.initialize=function(){this.container||(this.container=document.body);this.dom=$(c).get(0);$(this.container).append(this.dom)};return a=l.define(a)});
define("appbar/AppBarController",["require","util/Class","appbar/PropertiesBarView"],function(b){function a(){this.surface=null;this.propertiesBar=!1}var l=b("util/Class"),c=b("appbar/PropertiesBarView");a.prototype.initialize=function(){this.view.on("toolSelected",this.onToolSelected,this);this.view.on("sizeSelected",this.onSizeSelected,this);this.view.on("colorSelected",this.onColorSelected,this);this.view.on("undoRequested",this.onUndoRequested,this);this.view.on("redoRequested",this.onRedoRequested,
this);this.view.on("exportRequested",this.onExportRequested,this);this.view.on("deleteRequested",this.onDeleteRequested,this);this.view.on("menuSelected",this.onMenuSelected,this);this.surface.on("toolChanged",this.onToolChanged,this);this.surface.on("requestUndoEnable",this.onUndoEnabled,this);this.surface.on("requestRedoEnable",this.onRedoEnabled,this);this.surface.on("requestUndoDisable",this.onUndoDisabled,this);this.surface.on("requestRedoDisable",this.onRedoDisabled,this);this.surface.on("requestTrashEnable",
this.onTrashEnabled,this);this.surface.on("requestTrashDisable",this.onTrashDisabled,this);this.surface.on("requestColorChange",this.onColorChanged,this);this.surface.on("requestSizeChange",this.onSizeChanged,this);this.surface.surface.foreground.on("elementselectionschanged",this.onSurfaceForegroundElementSelectionsChanged,this);this.onSurfaceForegroundElementSelectionsChanged();this.registerEvents("export","info","menuSelected");this.propertiesBar&&(this.propertiesBarView=new c({container:this.view.container}))};
a.prototype.onToolChanged=function(a){if("select"!=a)if("pan"==a||"zoom"==a)this.view.unselectAllButtons();else this.view.onButtonClicked(a,!0)};a.prototype.onUndoRequested=function(){this.surface.undo()};a.prototype.onRedoRequested=function(){this.surface.redo()};a.prototype.onExportRequested=function(){this.fire("export")};a.prototype.onSurfaceForegroundElementSelectionsChanged=function(){0<this.surface.surface.foreground.getSelectedElements().length?this.view.showTrashButton():this.view.hideTrashButton()};
a.prototype.onDeleteRequested=function(){this.surface.surface.controller.tools.select.deleteSelectedElements()};a.prototype.onMenuSelected=function(a){this.fire("menuSelected",a)};a.prototype.onSizeSelected=function(a){this.surface.useSize(a.size);this.surface.updateSelectedElementsSize(a.size)};a.prototype.onToolSelected=function(a){this.surface.useTool(a.tool)};a.prototype.onColorSelected=function(a){this.surface.useColor(a.color);this.surface.updateSelectedElementsColor(a.color)};a.prototype.onTrashEnabled=
function(){this.view.showTrashButton()};a.prototype.onTrashDisabled=function(){this.view.hideTrashButton()};a.prototype.onUndoEnabled=function(){this.view.enableUndoButton()};a.prototype.onUndoDisabled=function(){this.view.disableUndoButton()};a.prototype.onRedoEnabled=function(){this.view.enableRedoButton()};a.prototype.onRedoDisabled=function(){this.view.disableRedoButton()};a.prototype.onColorChanged=function(a){this.view.setColor(a)};a.prototype.onSizeChanged=function(a){this.view.setSize(a)};
a.prototype.destroy=function(){this.view.destroy()};a.prototype.getElement=function(){return this.view.dom};a.prototype.setResourceStrings=function(a){return this.view.setResourceStrings(a)};return a=l.define(a)});define("text!appbar/AppBar.html",[],function(){return'<div class="skitch-app-bar-wrapper">\n\n    <div class="skitch-app-bar-border">\n        <div class="skitch-app-bar-hitarea">\n            <div class="skitch-app-bar">\n                <div class="skitch-app-bar-main">\n                    <div class="skitch-app-bar-button skitch-arrow-button skitch-selected" draggable="false">\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-text-button" draggable="false">\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-shape-button skitch-rectangle" draggable="false">\n                        <div class="skitch-more-icon"></div>\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-pen-button skitch-marker" draggable="false">\n                        <div class="skitch-more-icon"></div>\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-pixelate-button" draggable="false">\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-stamp-button skitch-accept" draggable="false">\n                        <div class="skitch-more-icon"></div>\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-crop-button" draggable="false">\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-color-button skitch-red" draggable="false">\n                        <div class="skitch-more-icon"></div>\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                    <div class="skitch-app-bar-button skitch-size-button skitch-size-3" draggable="false">\n                        <div class="skitch-more-icon"></div>\n                        <div class="skitch-icon" draggable="false"></div>\n                        <div class="skitch-icon-text" draggable="false"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="skitch-app-bar-size-color">\n        <div class="skitch-app-bar-button skitch-export-button" draggable="false">\n            <div class="skitch-icon" draggable="false"></div>\n            <div class="skitch-icon-text" draggable="false"></div>\n        </div>\n    </div>\n\n    <div class="skitch-app-bar-undo-redo">\n        <div class="skitch-app-bar-button skitch-undo-button skitch-disabled" draggable="false">\n            <div class="skitch-icon" draggable="false"></div>\n            <div class="skitch-icon-text" draggable="false"></div>\n        </div>\n        <div class="skitch-app-bar-button skitch-redo-button skitch-disabled" draggable="false">\n            <div class="skitch-icon" draggable="false"></div>\n            <div class="skitch-icon-text" draggable="false"></div>\n        </div>\n        <div class="skitch-app-bar-button skitch-trash-button skitch-disabled" draggable="false">\n            <div class="skitch-icon" draggable="false"></div>\n            <div class="skitch-icon-text" draggable="false"></div>\n        </div>\n    </div>\n</div>\n'});
define("text!appbar/ShapeDialog.html",[],function(){return'<div class="skitch-shape-dialog">\n    <div class="skitch-app-bar-button skitch-rectangle-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-rounded-rectangle-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-ellipse-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-line-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n</div>'});
define("text!appbar/PenDialog.html",[],function(){return'<div class="skitch-pen-dialog">\n    <div class="skitch-app-bar-button skitch-marker-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-highlighter-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n</div>'});define("text!appbar/StampDialog.html",[],function(){return'<div class="skitch-stamp-dialog">\n    <div class="skitch-app-bar-button skitch-stamp-accept-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-stamp-exclaim-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-stamp-question-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-stamp-reject-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-stamp-perfect-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n</div>'});
define("text!appbar/ColorDialog.html",[],function(){return'<div class="skitch-color-dialog">\n    <div class="skitch-app-bar-button skitch-red-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-orange-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-yellow-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-green-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-blue-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-pink-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-white-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-black-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n</div>'});
define("text!appbar/SizeDialog.html",[],function(){return'<div class="skitch-size-dialog">\n    <div class="skitch-app-bar-button skitch-size-1-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-size-2-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-size-3-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-size-4-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n    <div class="skitch-app-bar-button skitch-size-5-button" draggable="false">\n        <div class="skitch-icon" draggable="false"></div>\n    </div>\n</div>'});
define("appbar/AppBarView","require util/Class env/Settings text!appbar/AppBar.html text!appbar/ShapeDialog.html text!appbar/PenDialog.html text!appbar/StampDialog.html text!appbar/ColorDialog.html text!appbar/SizeDialog.html".split(" "),function(b){function a(){this.dom=null;this.currentShape="rectangle";this.currentPen="marker";this.currentStamp="stampAccept";this.currentColor="red";this.currentSize="size-3";this.registerEvents("toolSelected","sizeSelected","colorSelected","undoRequested","redoRequested",
"exportRequested","deleteRequested","menuSelected")}var l=b("util/Class"),c=b("env/Settings"),h=b("text!appbar/AppBar.html"),i=b("text!appbar/ShapeDialog.html"),g=b("text!appbar/PenDialog.html"),f=b("text!appbar/StampDialog.html"),k=b("text!appbar/ColorDialog.html"),d=b("text!appbar/SizeDialog.html");a.prototype.initialize=function(){if(!this.container)this.container=document.body;this.preloadImages();this.dom=$(h).get(0);this.stampDialogDom=$(f).get(0);this.shapeDialogDom=$(i).get(0);this.penDialogDom=
$(g).get(0);this.colorDialogDom=$(k).get(0);this.sizeDialogDom=$(d).get(0);$(this.dom).attr("touch-action","none");$(this.stampDialogDom).attr("touch-action","none");$(this.shapeDialogDom).attr("touch-action","none");$(this.penDialogDom).attr("touch-action","none");$(this.colorDialogDom).attr("touch-action","none");$(this.sizeDialogDom).attr("touch-action","none");$(this.container).append(this.dom);$(".skitch-app-bar").append(this.shapeDialogDom);$(".skitch-app-bar").append(this.penDialogDom);$(".skitch-app-bar").append(this.stampDialogDom);
$(".skitch-app-bar").append(this.colorDialogDom);$(".skitch-app-bar").append(this.sizeDialogDom);$(".skitch-app-bar",this.dom).on(c.EVENTS.pointerup,this.onAppbarWhiteSpace.bind(this));$(".skitch-app-bar-hitarea").on("mouseleave",this.onAppbarOut.bind(this));$(".skitch-arrow-button",this.dom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"arrow"));$(".skitch-text-button",this.dom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"text"));$(".skitch-shape-button",this.dom).on(c.EVENTS.pointerup,
this.onButtonClicked.bind(this,"shape"));$(".skitch-pen-button",this.dom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"pen"));$(".skitch-pixelate-button",this.dom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"pixelate"));$(".skitch-stamp-button",this.dom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"stamp"));$(".skitch-crop-button",this.dom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"crop"));$(".skitch-color-button",this.dom).on(c.EVENTS.pointerup,this.onColorButtonClicked.bind(this));
$(".skitch-size-button",this.dom).on(c.EVENTS.pointerup,this.onSizeButtonClicked.bind(this));$(".skitch-rectangle-button",this.shapeDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"rectangle"));$(".skitch-line-button",this.shapeDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"line"));$(".skitch-ellipse-button",this.shapeDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"ellipse"));$(".skitch-rounded-rectangle-button",this.shapeDialogDom).on(c.EVENTS.pointerup,
this.onButtonClicked.bind(this,"roundedRectangle"));$(".skitch-marker-button",this.penDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"marker"));$(".skitch-highlighter-button",this.penDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"highlighter"));$(".skitch-stamp-accept-button",this.stampDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"stampAccept"));$(".skitch-stamp-exclaim-button",this.stampDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,
"stampExclaim"));$(".skitch-stamp-question-button",this.stampDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"stampQuestion"));$(".skitch-stamp-reject-button",this.stampDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"stampReject"));$(".skitch-stamp-perfect-button",this.stampDialogDom).on(c.EVENTS.pointerup,this.onButtonClicked.bind(this,"stampPerfect"));$(".skitch-red-button",this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,"red"));$(".skitch-orange-button",
this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,"orange"));$(".skitch-blue-button",this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,"blue"));$(".skitch-green-button",this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,"green"));$(".skitch-pink-button",this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,"pink"));$(".skitch-yellow-button",this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,
"yellow"));$(".skitch-white-button",this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,"white"));$(".skitch-black-button",this.colorDialogDom).on(c.EVENTS.pointerup,this.onColorClicked.bind(this,"black"));$(".skitch-size-1-button",this.sizeDialogDom).on(c.EVENTS.pointerup,this.onSpecificSizeClicked.bind(this,"size-1"));$(".skitch-size-2-button",this.sizeDialogDom).on(c.EVENTS.pointerup,this.onSpecificSizeClicked.bind(this,"size-2"));$(".skitch-size-3-button",this.sizeDialogDom).on(c.EVENTS.pointerup,
this.onSpecificSizeClicked.bind(this,"size-3"));$(".skitch-size-4-button",this.sizeDialogDom).on(c.EVENTS.pointerup,this.onSpecificSizeClicked.bind(this,"size-4"));$(".skitch-size-5-button",this.sizeDialogDom).on(c.EVENTS.pointerup,this.onSpecificSizeClicked.bind(this,"size-5"));$(".skitch-undo-button",this.dom).on(c.EVENTS.pointerup,this.onUndoButtonClicked.bind(this));$(".skitch-redo-button",this.dom).on(c.EVENTS.pointerup,this.onRedoButtonClicked.bind(this));$(".skitch-export-button",this.dom).on(c.EVENTS.pointerup,
this.onExportButtonClicked.bind(this));$(".skitch-trash-button",this.dom).on(c.EVENTS.pointerup,this.onTrashButtonClicked.bind(this));this.setResourceStrings({BUTTON_TEXT_UNDO:"Undo",BUTTON_TEXT_REDO:"Redo",BUTTON_TEXT_ARROW:"Arrow",BUTTON_TEXT_TEXT:"Text",BUTTON_TEXT_SHAPE_RECTANGLE:"Rectangle",BUTTON_TEXT_SHAPE_ROUNDED_RECTANGLE:"Rounded",BUTTON_TEXT_SHAPE_ELLIPSE:"Ellipse",BUTTON_TEXT_SHAPE_LINE:"Line",BUTTON_TEXT_PEN_MARKER:"Marker",BUTTON_TEXT_PEN_HIGHLIGHTER:"Highlighter",BUTTON_TEXT_STYLE:"Style",
BUTTON_TEXT_PIXELATE:"Pixelate",BUTTON_TEXT_CROP:"Crop",BUTTON_TEXT_STAMP:"Stamp",BUTTON_TEXT_EXPORT:"Export",BUTTON_TEXT_INFO:"Info",BUTTON_TEXT_TRASH:"Remove"})};a.prototype.preloadImages=function(){(function(a){$(a).each(function(a,b){$(new Image).load(function(){}).attr({src:b,id:"preloaded"+a})})})(["images/appbar/arrow_disabled_44x44.png","images/appbar/arrow_hover_44x44.png","images/appbar/arrow_off_44x44.png","images/appbar/arrow_on_44x44.png","images/appbar/color_black_parent_off_44x44.png",
"images/appbar/color_black_parent_on_44x44.png","images/appbar/color_black_submenu_off_44x44.png","images/appbar/color_black_submenu_on_44x44.png","images/appbar/color_blue_parent_off_44x44.png","images/appbar/color_blue_parent_on_44x44.png","images/appbar/color_blue_submenu_off_44x44.png","images/appbar/color_blue_submenu_on_44x44.png","images/appbar/color_custom_parent_off_44x44.png","images/appbar/color_custom_parent_on_44x44.png","images/appbar/color_custom_submenu_off_44x44.png","images/appbar/color_custom_submenu_on_44x44.png",
"images/appbar/color_green_parent_off_44x44.png","images/appbar/color_green_parent_on_44x44.png","images/appbar/color_green_submenu_off_44x44.png","images/appbar/color_green_submenu_on_44x44.png","images/appbar/color_orange_parent_off_44x44.png","images/appbar/color_orange_parent_on_44x44.png","images/appbar/color_orange_submenu_off_44x44.png","images/appbar/color_orange_submenu_on_44x44.png","images/appbar/color_pink_parent_off_44x44.png","images/appbar/color_pink_parent_on_44x44.png","images/appbar/color_pink_submenu_off_44x44.png",
"images/appbar/color_pink_submenu_on_44x44.png","images/appbar/color_red_parent_off_44x44.png","images/appbar/color_red_parent_on_44x44.png","images/appbar/color_red_submenu_off_44x44.png","images/appbar/color_red_submenu_on_44x44.png","images/appbar/color_white_parent_off_44x44.png","images/appbar/color_white_parent_on_44x44.png","images/appbar/color_white_submenu_off_44x44.png","images/appbar/color_white_submenu_on_44x44.png","images/appbar/color_yellow_parent_off_44x44.png","images/appbar/color_yellow_parent_on_44x44.png",
"images/appbar/color_yellow_submenu_off_44x44.png","images/appbar/color_yellow_submenu_on_44x44.png","images/appbar/crop_hover_44x44.png","images/appbar/crop_icon_disabled_44x44.png","images/appbar/crop_off_44x44.png","images/appbar/crop_on_44x44.png","images/appbar/ellipse_disabled_44x44.png","images/appbar/ellipse_parent_hover_44x44.png","images/appbar/ellipse_parent_off_44x44.png","images/appbar/ellipse_parent_on_44x44.png","images/appbar/ellipse_submenu_hover_44x44.png","images/appbar/ellipse_submenu_off_44x44.png",
"images/appbar/ellipse_submenu_on_44x44.png","images/appbar/font_disabled_44x44.png","images/appbar/font_hover_44x44.png","images/appbar/font_off_44x44.png","images/appbar/font_on_44x44.png","images/appbar/highlighter_disabled_44x44.png","images/appbar/highlighter_parent_hover_44x44.png","images/appbar/highlighter_parent_off_44x44.png","images/appbar/highlighter_parent_on_44x44.png","images/appbar/highlighter_submenu_hover_44x44.png","images/appbar/highlighter_submenu_off_44x44.png","images/appbar/highlighter_submenu_on_44x44.png",
"images/appbar/line_disabled_44x44.png","images/appbar/line_parent_hover_44x44.png","images/appbar/line_parent_off_44x44.png","images/appbar/line_parent_on_44x44.png","images/appbar/line_submenu_hover_44x44.png","images/appbar/line_submenu_off_44x44.png","images/appbar/line_submenu_on_44x44.png","images/appbar/marker_disabled_44x44.png","images/appbar/marker_parent_hover_44x44.png","images/appbar/marker_parent_off_44x44.png","images/appbar/marker_parent_on_44x44.png","images/appbar/marker_submenu_hover_44x44.png",
"images/appbar/marker_submenu_off_44x44.png","images/appbar/marker_submenu_on_44x44.png","images/appbar/pixelate_disabled_44x44.png","images/appbar/pixelate_hover_44x44.png","images/appbar/pixelate_off_44x44.png","images/appbar/pixelate_on_44x44.png","images/appbar/rect_disabled_44x44.png","images/appbar/rect_parent_hover_main_44x44.png","images/appbar/rect_parent_off_44x44.png","images/appbar/rect_parent_on_44x44.png","images/appbar/rect_submenu_hover_44x44.png","images/appbar/rect_submenu_off_44x44.png",
"images/appbar/rect_submenu_on_44x44.png","images/appbar/roundedrect_disabled_44x44.png","images/appbar/roundedrect_parent_hover_44x44.png","images/appbar/roundedrect_parent_off_44x44.png","images/appbar/roundedrect_parent_on_44x44.png","images/appbar/roundedrect_submenu_hover_44x44.png","images/appbar/roundedrect_submenu_off_44x44.png","images/appbar/roundedrect_submenu_on_44x44.png","images/appbar/size_1_parent_hover_44x44.png","images/appbar/size_1_parent_off_44x44.png","images/appbar/size_1_subtool_hover_44x44.png",
"images/appbar/size_1_subtool_off_44x44.png","images/appbar/size_1_subtool_on_44x44.png","images/appbar/size_2_parent_hover_44x44.png","images/appbar/size_2_parent_off_44x44.png","images/appbar/size_2_subtool_hover_44x44.png","images/appbar/size_2_subtool_off_44x44.png","images/appbar/size_2_subtool_on_44x44.png","images/appbar/size_3_parent_hover_44x44.png","images/appbar/size_3_parent_off_44x44.png","images/appbar/size_3_subtool_hover_44x44.png","images/appbar/size_3_subtool_off_44x44.png","images/appbar/size_3_subtool_on_44x44.png",
"images/appbar/size_4_parent_hover_44x44.png","images/appbar/size_4_parent_off_44x44.png","images/appbar/size_4_subtool_hover_44x44.png","images/appbar/size_4_subtool_off_44x44.png","images/appbar/size_4_subtool_on_44x44.png","images/appbar/size_5_parent_hover_44x44.png","images/appbar/size_5_parent_off_44x44.png","images/appbar/size_5_subtool_hover_44x44.png","images/appbar/size_5_subtool_off_44x44.png","images/appbar/size_5_subtool_on_44x44.png","images/appbar/stamp_check_parent_off_44x44.png",
"images/appbar/stamp_check_parent_on_44x44.png","images/appbar/stamp_check_submenu_hover_44x44.png","images/appbar/stamp_check_submenu_off_44x44.png","images/appbar/stamp_check_submenu_on_44x44.png","images/appbar/stamp_exclamation_parent_off_44x44.png","images/appbar/stamp_exclamation_parent_on_44x44.png","images/appbar/stamp_exclamation_submenu_hover_44x44.png","images/appbar/stamp_exclamation_submenu_off_44x44.png","images/appbar/stamp_exclamation_submenu_on_44x44.png","images/appbar/stamp_perfect_parent_off_44x44.png",
"images/appbar/stamp_perfect_parent_on_44x44.png","images/appbar/stamp_perfect_submenu_hover_44x44.png","images/appbar/stamp_perfect_submenu_off_44x44.png","images/appbar/stamp_perfect_submenu_on_44x44.png","images/appbar/stamp_question_parent_off_44x44.png","images/appbar/stamp_question_parent_on_44x44.png","images/appbar/stamp_question_submenu_hover_44x44.png","images/appbar/stamp_question_submenu_off_44x44.png","images/appbar/stamp_question_submenu_on_44x44.png","images/appbar/stamp_x_parent_off_44x44.png",
"images/appbar/stamp_x_parent_on_44x44.png","images/appbar/stamp_x_submenu_hover_44x44.png","images/appbar/stamp_x_submenu_off_44x44.png","images/appbar/stamp_x_submenu_on_44x44.png"])};a.prototype.showTrashButton=function(){$(".skitch-trash-button",this.dom).show()};a.prototype.hideTrashButton=function(){$(".skitch-trash-button",this.dom).hide()};a.prototype.onExportButtonClicked=function(){this.fire("exportRequested");this.fire("menuSelected","export")};a.prototype.onTrashButtonClicked=function(){this.fire("deleteRequested");
this.fire("menuSelected","delete")};a.prototype.onAppbarWhiteSpace=function(a){a.target===a.currentTarget&&this.resetAppbarSlide()};a.prototype.onAppbarOut=function(){this.resetAppbarSlide()};a.prototype.onColorButtonClicked=function(){$(".skitch-color-dialog").removeClass("slide-right").addClass("slide-left");$(".skitch-app-bar-main").removeClass("slide-right").addClass("slide-left");this.fire("menuSelected","colorMenu")};a.prototype.onSizeButtonClicked=function(){$(".skitch-size-dialog").removeClass("slide-right").addClass("slide-left");
$(".skitch-app-bar-main").removeClass("slide-right").addClass("slide-left");$(".skitch-"+this.currentSize+"-button").addClass("skitch-selected");this.fire("menuSelected","sizeMenu")};a.prototype.onUndoButtonClicked=function(){this.fire("undoRequested");this.fire("menuSelected","undo")};a.prototype.onRedoButtonClicked=function(){this.fire("redoRequested");this.fire("menuSelected","redo")};a.prototype.unselectAllButtons=function(){$(".skitch-app-bar-button").removeClass("skitch-selected")};a.prototype.resetAppbarSlide=
function(){$(".skitch-shape-dialog").removeClass("slide-left").addClass("slide-right");$(".skitch-pen-dialog").removeClass("slide-left").addClass("slide-right");$(".skitch-stamp-dialog").removeClass("slide-left").addClass("slide-right");$(".skitch-color-dialog").removeClass("slide-left").addClass("slide-right");$(".skitch-size-dialog").removeClass("slide-left").addClass("slide-right");$(".skitch-app-bar-main").removeClass("slide-left").addClass("slide-right")};a.prototype.onButtonClicked=function(a,
b){this.unselectAllButtons();if(a=="arrow"){this.fire("toolSelected",{tool:a});$(".skitch-arrow-button").addClass("skitch-selected")}else if(a=="text"){this.fire("toolSelected",{tool:a});$(".skitch-text-button").addClass("skitch-selected")}else if(a=="shape"){this.menuSelected(a);this.fire("menuSelected",a);this.fire("toolSelected",{tool:this.currentShape});this.onButtonClicked(this.currentShape,true)}else if(a=="pen"){this.menuSelected(a);this.fire("menuSelected",a);this.fire("toolSelected",{tool:this.currentPen});
this.onButtonClicked(this.currentPen,true)}else if(a=="pixelate"){this.fire("toolSelected",{tool:a});$(".skitch-pixelate-button").addClass("skitch-selected")}else if(a=="stamp"){this.menuSelected(a);this.fire("menuSelected",a);this.fire("toolSelected",{tool:this.currentStamp});this.onButtonClicked(this.currentStamp,true)}else if(a=="crop"){this.fire("toolSelected",{tool:a});$(".skitch-crop-button").addClass("skitch-selected")}else if(a=="rectangle"||a=="line"||a=="ellipse"||a=="roundedRectangle"){b!==
true&&this.resetAppbarSlide();this.fire("toolSelected",{tool:a});this.currentShape=a;$(".skitch-shape-button").removeClass("skitch-rectangle");$(".skitch-shape-button").removeClass("skitch-line");$(".skitch-shape-button").removeClass("skitch-rounded-rectangle");$(".skitch-shape-button").removeClass("skitch-ellipse");$(".skitch-shape-button").addClass("skitch-selected");if(a=="rectangle"){$(".skitch-"+a+"-button").addClass("skitch-selected");$(".skitch-shape-button").addClass("skitch-rectangle");$(".skitch-shape-button .skitch-icon-text",
this.dom).html(this.resources.BUTTON_TEXT_SHAPE_RECTANGLE)}else if(a=="roundedRectangle"){$(".skitch-rounded-rectangle-button").addClass("skitch-selected");$(".skitch-shape-button").addClass("skitch-rounded-rectangle");$(".skitch-shape-button .skitch-icon-text",this.dom).html(this.resources.BUTTON_TEXT_SHAPE_ROUNDED_RECTANGLE)}else if(a=="line"){$(".skitch-"+a+"-button").addClass("skitch-selected");$(".skitch-shape-button").addClass("skitch-line");$(".skitch-shape-button .skitch-icon-text",this.dom).html(this.resources.BUTTON_TEXT_SHAPE_LINE)}else if(a==
"ellipse"){$(".skitch-"+a+"-button").addClass("skitch-selected");$(".skitch-shape-button").addClass("skitch-ellipse");$(".skitch-shape-button .skitch-icon-text",this.dom).html(this.resources.BUTTON_TEXT_SHAPE_ELLIPSE)}}else if(a=="marker"||a=="highlighter"){b!==true&&this.resetAppbarSlide();this.fire("toolSelected",{tool:a});this.currentPen=a;$(".skitch-pen-button").removeClass("skitch-highlighter");$(".skitch-pen-button").removeClass("skitch-marker");$(".skitch-pen-button").addClass("skitch-selected");
if(a=="marker"){$(".skitch-"+a+"-button").addClass("skitch-selected");$(".skitch-pen-button").addClass("skitch-marker");$(".skitch-pen-button .skitch-icon-text",this.dom).html(this.resources.BUTTON_TEXT_PEN_MARKER)}else if(a=="highlighter"){$(".skitch-"+a+"-button").addClass("skitch-selected");$(".skitch-pen-button").addClass("skitch-highlighter");$(".skitch-pen-button .skitch-icon-text",this.dom).html(this.resources.BUTTON_TEXT_PEN_HIGHLIGHTER)}}else if(a=="stampAccept"){b!==true&&this.resetAppbarSlide();
this.fire("toolSelected",{tool:a});this.currentStamp=a;$(".skitch-stamp-accept-button").addClass("skitch-selected");$(".skitch-stamp-button").removeClass("skitch-accept");$(".skitch-stamp-button").removeClass("skitch-exclaim");$(".skitch-stamp-button").removeClass("skitch-question");$(".skitch-stamp-button").removeClass("skitch-reject");$(".skitch-stamp-button").removeClass("skitch-perfect");$(".skitch-stamp-button").addClass("skitch-selected");$(".skitch-stamp-button").addClass("skitch-accept")}else if(a==
"stampExclaim"){b!==true&&this.resetAppbarSlide();this.fire("toolSelected",{tool:a});this.currentStamp=a;$(".skitch-stamp-exclaim-button").addClass("skitch-selected");$(".skitch-stamp-button").removeClass("skitch-accept");$(".skitch-stamp-button").removeClass("skitch-exclaim");$(".skitch-stamp-button").removeClass("skitch-question");$(".skitch-stamp-button").removeClass("skitch-reject");$(".skitch-stamp-button").removeClass("skitch-perfect");$(".skitch-stamp-button").addClass("skitch-selected");$(".skitch-stamp-button").addClass("skitch-exclaim")}else if(a==
"stampQuestion"){b!==true&&this.resetAppbarSlide();this.fire("toolSelected",{tool:a});this.currentStamp=a;$(".skitch-stamp-question-button").addClass("skitch-selected");$(".skitch-stamp-button").removeClass("skitch-accept");$(".skitch-stamp-button").removeClass("skitch-exclaim");$(".skitch-stamp-button").removeClass("skitch-question");$(".skitch-stamp-button").removeClass("skitch-reject");$(".skitch-stamp-button").removeClass("skitch-perfect");$(".skitch-stamp-button").addClass("skitch-selected");
$(".skitch-stamp-button").addClass("skitch-question")}else if(a=="stampReject"){b!==true&&this.resetAppbarSlide();this.fire("toolSelected",{tool:a});this.currentStamp=a;$(".skitch-stamp-reject-button").addClass("skitch-selected");$(".skitch-stamp-button").removeClass("skitch-accept");$(".skitch-stamp-button").removeClass("skitch-exclaim");$(".skitch-stamp-button").removeClass("skitch-question");$(".skitch-stamp-button").removeClass("skitch-reject");$(".skitch-stamp-button").removeClass("skitch-perfect");
$(".skitch-stamp-button").addClass("skitch-selected");$(".skitch-stamp-button").addClass("skitch-reject")}else if(a=="stampPerfect"){b!==true&&this.resetAppbarSlide();this.fire("toolSelected",{tool:a});this.currentStamp=a;$(".skitch-stamp-perfect-button").addClass("skitch-selected");$(".skitch-stamp-button").removeClass("skitch-accept");$(".skitch-stamp-button").removeClass("skitch-exclaim");$(".skitch-stamp-button").removeClass("skitch-question");$(".skitch-stamp-button").removeClass("skitch-reject");
$(".skitch-stamp-button").removeClass("skitch-perfect");$(".skitch-stamp-button").addClass("skitch-selected");$(".skitch-stamp-button").addClass("skitch-perfect")}};a.prototype.menuSelected=function(a){$(".skitch-app-bar-main").removeClass("slide-right").addClass("slide-left");$(".skitch-"+a+"-dialog").removeClass("slide-right").addClass("slide-left")};a.prototype.disableUndoButton=function(){$(".skitch-undo-button",this.dom).addClass("skitch-disabled")};a.prototype.enableUndoButton=function(){$(".skitch-undo-button",
this.dom).removeClass("skitch-disabled")};a.prototype.disableRedoButton=function(){$(".skitch-redo-button",this.dom).addClass("skitch-disabled")};a.prototype.enableRedoButton=function(){$(".skitch-redo-button",this.dom).removeClass("skitch-disabled")};a.prototype.onSpecificSizeClicked=function(a){this.resetAppbarSlide();this.setSize(a);this.currentSize=a;$(".skitch-size-1-button").removeClass("skitch-selected");$(".skitch-size-2-button").removeClass("skitch-selected");$(".skitch-size-3-button").removeClass("skitch-selected");
$(".skitch-size-4-button").removeClass("skitch-selected");$(".skitch-size-5-button").removeClass("skitch-selected");$(".skitch-"+a+"-button").addClass("skitch-selected");this.fire("sizeSelected",{size:a});this.fire("menuSelected",a)};a.prototype.onColorClicked=function(a){this.resetAppbarSlide();this.setColor(a);this.fire("colorSelected",{color:a});this.fire("menuSelected",a)};a.prototype.setSize=function(a){a="skitch-"+a.toLowerCase();$(".skitch-size-button",this.dom).removeClass("skitch-size-1");
$(".skitch-size-button",this.dom).removeClass("skitch-size-2");$(".skitch-size-button",this.dom).removeClass("skitch-size-3");$(".skitch-size-button",this.dom).removeClass("skitch-size-4");$(".skitch-size-button",this.dom).removeClass("skitch-size-5");$(".skitch-size-button",this.dom).addClass(a)};a.prototype.onColorSelected=function(a){this.setColor(a);this.fire("colorSelected",{color:a})};a.prototype.setColor=function(a){a="skitch-"+a.toLowerCase();$(".color-button",this.colorDialogDom).removeClass("selected");
$(".color-button."+a,this.colorDialogDom).addClass("selected");$(".skitch-color-button",this.dom).removeClass("skitch-red");$(".skitch-color-button",this.dom).removeClass("skitch-orange");$(".skitch-color-button",this.dom).removeClass("skitch-yellow");$(".skitch-color-button",this.dom).removeClass("skitch-green");$(".skitch-color-button",this.dom).removeClass("skitch-blue");$(".skitch-color-button",this.dom).removeClass("skitch-pink");$(".skitch-color-button",this.dom).removeClass("skitch-white");
$(".skitch-color-button",this.dom).removeClass("skitch-black");$(".skitch-color-button",this.dom).addClass(a)};a.prototype.setResourceStrings=function(a){this.resources=a;$(".skitch-undo-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_UNDO);$(".skitch-redo-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_REDO);$(".skitch-arrow-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_ARROW);$(".skitch-text-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_TEXT);$(".skitch-shape-button .skitch-icon-text",
this.dom).html(a.BUTTON_TEXT_SHAPE_RECTANGLE);$(".skitch-pen-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_PEN_MARKER);$(".skitch-color-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_STYLE);$(".skitch-size-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_STYLE);$(".skitch-pixelate-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_PIXELATE);$(".skitch-crop-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_CROP);$(".skitch-stamp-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_STAMP);
$(".skitch-export-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_EXPORT);$(".skitch-info-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_INFO);$(".skitch-trash-button .skitch-icon-text",this.dom).html(a.BUTTON_TEXT_TRASH)};a.prototype.getDom=function(){return this.dom};a.prototype.destroy=function(){$(this.dom).remove();this.dom=null};return a=l.define(a)});
define("API","require surface/SurfaceAPI appbar/AppBarController appbar/AppBarView env/Settings async/Promise".split(" "),function(b){var a=b("surface/SurfaceAPI"),l=b("appbar/AppBarController"),c=b("appbar/AppBarView"),h=b("env/Settings"),i=b("async/Promise");return{createSurface:function(b){b||(b={});var c=640,k=480,d=new a,e;d.disableRender();d.setAutoResize(false);b.autoresize===true&&d.setAutoResize(true);if(b.fullscreen){d.setAutoResize(true);d.setPosition(0,0);c=$(window).width();k=$(window).height()}(b.allowZoom===
false||b.allowZoom===true)&&d.setAllowZoom(b.allowZoom);b.backgroundColor&&d.setBackgroundColor(b.backgroundColor);b.margin!==void 0&&d.setMargin(b.margin);if(b.top||b.left)d.setPosition(b.left||0,b.top||0);if(b.width||b.height){c=b.width||0;k=b.height||0}if(b.enableKeyboardShortcuts===true)h.ENABLE_KEY_HANDLERS=true;if(b.url)e=d.loadFromURL(b.url);else if(b.file)e=d.loadFromFile(b.file);else if(b.image)e=d.loadFromImage(b.image);else if(b.base64)e=d.loadFromBase64(b.image);else if(b.overlay){d.setBackgroundColor("transparent");
d.setAllowZoom(false)}else{d.setMargin(h.SKITCH_MARGIN);e=(new i).resolve()}e.done(function(){d.enableRender();d.surface.ready=true;b.success&&b.success(d)}).fail(function(a){b.fail&&b.fail(d,a)});d.setSize(c,k);return d},createAppBar:function(a){if(typeof a.propertiesBar=="undefined")a.propertiesBar=false;return new l({view:new c({container:a.container}),surface:a.surface,propertiesBar:a.propertiesBar})}}});
define("pdfeditor/PDFEditor","require util/Class util/Obj async/Promise graphics/CanvasGraphics util/Binary file/File log/Logger util/Pdf".split(" "),function(b){function a(){this.registerEvents("toolChanged");this.surface=this.file=this.pdf=null;this.currentPage=1;this.uiDom=$('<div class="skitch-pdf-pager"><div class="pagerButtonShowAll"></div><div class="pagerInfo"></div></div>').get(0);$(document.body).append(this.uiDom);$(document.body).append('<div class="skitch-pdf-pagerButtonLeft"></div>');
$(document.body).append('<div class="skitch-pdf-pagerButtonRight"></div>');$(".skitch-pdf-pagerButtonLeft").click(this.goToPreviousPage.bind(this));$(".skitch-pdf-pagerButtonRight").click(this.goToNextPage.bind(this));$(".pagerButtonShowAll",this.uiDom).click(this.showAllPages.bind(this));this.manifests=[]}var l=b("util/Class");b("util/Obj");var c=b("async/Promise"),h=b("graphics/CanvasGraphics"),i=b("util/Binary"),g=b("file/File"),f=b("log/Logger").instance("pdfeditor.PDFEditor"),k=b("util/Pdf");
a.prototype.showAllPages=function(){var a=$('<div class="pageSelector"><div><a href="#" class="pageSelectorClose"></a></div><div class="pageTilesHeader"><a href="#">All(100)</a> <a href="#">Annotated(10)</a></div><div class="pageTiles"></div></div>').get(0);$(".pageSelectorClose",a).click(function(){$(a).remove()});var b=1,c=this,f=function(b,e){var f=$('<a href="#"  class="pageTile"><img src="'+b+'"><div class="pageNumber">'+e+"</div></a>").get(0);$(f).click(function(){c.setCurrentPage(e);$(a).remove()});
$(".pageTiles",a).append(f)},g=function(){b>c.getPageCount()||c.pdf.getPage(b).then(function(a){var d=a.getViewport(0.3),i=h.create(d.width,d.height);i.save();i.fillStyle("#ffffff");i.fillRect(0,0,i.getWidth(),i.getHeight());i.restore();a.render({canvasContext:i.context,viewport:d}).then(function(){f(i.context.canvas.toDataURL(),b);b++;g.call(c)})})};g.call(this);$(document.body).append(a)};a.prototype.goToPreviousPage=function(){if(this.currentPage>1){this.updateManifest();this.setCurrentPage(this.currentPage-
1)}};a.prototype.goToNextPage=function(){if(this.currentPage<this.getPageCount()){this.updateManifest();this.setCurrentPage(this.currentPage+1)}};a.prototype.setCurrentPage=function(a){this.currentPage=a;new c;var b=this;return this.surface.surface.importAsync({pdf:this.pdf,file:this.file,page:a,manifest:this.getPageManifest(a)},"pdf").done(function(){b.surface.surface.fit();b.surface.surface.controller.onResize()})};a.prototype.getCurrentPage=function(){return this.currentPage};a.prototype.getPageCount=
function(){return this.pdf.pdfInfo.numPages};a.prototype.getPageManifest=function(a){for(var b=0;b<this.manifests.length;b++)if(this.manifests[b].page==a)return this.manifests[b].manifest;return null};a.prototype.updateManifest=function(){this.surface.surface.updateManifest();this.setPageManifest(this.currentPage,this.surface.surface.file.manifest)};a.prototype.setPageManifest=function(a,b){for(var c=0;c<this.manifests.length;c++)this.manifests[c].page==a&&this.manifests.splice(c,1);this.manifests.push({page:a,
manifest:b})};a.prototype.getPageManifests=function(){this.updateManifest();return this.manifests};a.prototype.setPageManifests=function(){this.manifests=[]};a.prototype.loadFromURL=function(a){var b=this,h=new c,j=Skitch.createSurface({fullscreen:true,background:"#676e73",margin:0,success:function(){var c=a.split("/");$(".pagerInfo",this.uiDom).html(c[c.length-1]);i.loadAsync(a).then(function(a){var c=g.getFileClass(a);b.file=new c({bytes:a});return k.createAsync(a)}).then(function(a){b.pdf=a;b.setPageManifests(b.pdf,
b.file);b.setCurrentPage(1);h.resolve(b)}).fail(function(a){f.error(a)})},fail:function(){h.reject(b)}});$(document.body).append(j.getElement());var l=Skitch.createAppBar({surface:j,container:document.body});$(document.body).append(l.getElement());j.useTool("arrow");j.useColor("yellow");j.useSize("small");this.surface=j;return h};a.prototype.loadEmpty=function(){var a=this,b=new c,f=Skitch.createSurface({fullscreen:true,background:"#676e73",margin:0,empty:true,success:function(){b.resolve(a)},fail:function(){b.reject(a)}});
$(document.body).append(f.getElement());var g=Skitch.createAppBar({surface:f,container:document.body});$(document.body).append(g.getElement());f.useTool("arrow");f.useColor("yellow");f.useSize("small");this.surface=f;this.appBar=g;return b};a.prototype.loadFromFile=function(a){var b=this,h=new c,i=function(){$(".pagerInfo",this.uiDom).html(a.name);g.readAsync(a).then(function(a){var c=g.getFileClass(a);b.file=new c({bytes:a});return k.createAsync(a)}).then(function(a){b.pdf=a;b.setPageManifests(b.pdf,
b.file);b.setCurrentPage(1);h.resolve(b)}).fail(function(a){f.error(a)})};if(this.surface)i();else{var l=Skitch.createSurface({fullscreen:true,background:"#676e73",margin:0,success:function(){i()},fail:function(){h.reject(b)}});$(document.body).append(l.getElement());var p=Skitch.createAppBar({surface:l,container:document.body});$(document.body).append(p.getElement());l.useTool("arrow");l.useColor("yellow");l.useSize("small");this.surface=l;this.appBar=p}return h};a.prototype.showHeader=function(){$(this.uiDom).slideDown()};
a.prototype.hideHeader=function(){$(this.uiDom).slideUp()};return a=l.define(a)});
define("pdfeditor/PDFEditorApi",["require","util/Class","util/Obj","pdfeditor/PDFEditor"],function(b){function a(){this.registerEvents("toolChanged");this.editor=new c}var l=b("util/Class");b("util/Obj");var c=b("pdfeditor/PDFEditor");a.prototype.fit=function(){this.editor.surface.surface.fit()};a.prototype.getElement=function(){return this.editor.dom};a.prototype.loadFromURL=function(a){return this.editor.loadFromURL(a)};a.prototype.loadEmpty=function(a){return this.editor.loadEmpty(a)};a.prototype.loadFromFile=
function(a){return this.editor.loadFromFile(a)};a.prototype.setCurrentPage=function(a){this.editor.setCurrentPage(a)};a.prototype.getCurrentPage=function(){this.editor.getCurrentPage()};a.prototype.getPageCount=function(){this.editor.getPageCount()};a.prototype.showHeader=function(){this.editor.showHeader()};a.prototype.hideHeader=function(){this.editor.hideHeader()};a.createEditor=function(b){var c=new a,g;b.url&&(g=c.loadFromURL(b.url));b.file&&(g=c.loadFromFile(b.file));!0===b.empty&&(g=c.loadEmpty());
g.done(function(){c.fit();b.success&&b.success(c)}).fail(function(a){b.fail&&b.fail(c,a)});return c};a.prototype.getFile=function(){};return a=l.define(a)});require.config({baseUrl:"../modules",paths:{API:"../sdk/API",surface:"../sdk/surface",text:"../lib/require/require-text",appbar:"../sdk/appbar",pdfeditor:"../sdk/pdfeditor"}});require(["API","pdfeditor/PDFEditorApi"],function(b,a){window.Skitch||(window.Skitch=b);Skitch.PDF=a});define("../sdk/bootstrap",function(){});
